<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#14181C">
  <title>RocketWatch - Track TV Shows</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <style>
    /*! ROCKETWATCH v5.0 - Complete TV Show Tracking App
     *  Based on comprehensive Letterboxd UI audit (724 items)
     *  
     *  NEW IN v5.0:
     *  - Rating scale with descriptions (Awful → Masterpiece)
     *  - RELATED NEWS section with carousel
     *  - MENTIONS section with brand logos
     *  - JustWatch attribution
     *  - iOS tracking permission dialog
     *  - 4-column highest rated grid
     *  - Action sheet blur effect
     *  - Long press poster actions
     *  - Improved color accuracy (#00C030 green)
     *  - Sans-serif display font (Outfit)
     *  - Poster rating overlays
     *  - Showtimes section
     *
     *  1.1 WATCHING/LOGGING:
     *  - Log with specific date picker
     *  - Auto-remove from watchlist on watch
     *  - Bulk select & mark multiple as watched
     *  - Import from IMDb/Trakt/CSV
     *  - Export data (JSON/CSV)
     *  - Draft diary entries
     *  - Rewatch tracking with count
     *  
     *  1.2 REVIEWS:
     *  - Write text reviews
     *  - Reviews with spoiler tags
     *  - Hide/blur spoiler reviews until watched
     *  - Review without rating (optional)
     *  - Edit reviews after posting
     *  - Delete reviews
     *  - Review formatting (bold, italic, links)
     *  - Character count
     *  
     *  1.3 TAGS:
     *  - Add custom tags to entries
     *  - Browse by tags (profile tab)
     *  - Search by tags (browse section)
     *  - Tag management (rename, delete)
     *  - Nested tags (with:partner, at:home)
     *  - Popular tags discovery
     *  
     *  1.4 DIARY:
     *  - Calendar diary view (grid with posters)
     *  - List/Calendar view toggle
     *  - Month navigation (prev/next)
     *  - Edit diary entries
     *  - Delete diary entries
     *  - Backdate entries
     *  
     *  CATEGORY 2: LISTS (15 features):
     *  - Create custom lists (title, description)
     *  - Unranked lists (toggle numbers off)
     *  - Private lists (visibility toggle)
     *  - Add notes to list entries
     *  - Reorder list entries (move up/down)
     *  - Filter list by watched/unwatched
     *  - Sort list (position, title, year, rating)
     *  - Like lists (with count update)
     *  - Share lists (native share/clipboard)
     *  - Clone/duplicate lists
     *  - Edit existing lists
     *  - Delete lists
     *  - Add to list from action sheet
     *  - Profile lists tab with count
     *  - Popular lists browse section
     *
     *  CATEGORY 3.1: PROFILE DISPLAY (13 features):
     *  - Username display
     *  - Display name (separate from username)
     *  - Bio (160 char max)
     *  - Location
     *  - Website link
     *  - Profile avatar
     *  - Profile backdrop image (Patron feature)
     *  - "Top Four" favorite shows
     *  - Pin reviews to profile (Pro feature)
     *  - Pin lists to profile (Pro feature)
     *  - Pronouns
     *  - X/Twitter link
     *  - Patron/Pro/Crew badges
     *
     *  CATEGORY 3.2: PROFILE TABS (11 features):
     *  - Profile tab (main)
     *  - Films tab (all watched grid)
     *  - Diary tab
     *  - Reviews tab
     *  - Watchlist tab
     *  - Lists tab
     *  - Likes tab (films/reviews/lists segments)
     *  - Tags tab
     *  - Network tab (following/followers)
     *  - Ratings tab (histogram view)
     *  - Tab counts display
     *
     *  CATEGORY 3.3: PROFILE STATS (6 features):
     *  - Total films count
     *  - Films this year count
     *  - Lists count
     *  - Following/Followers count
     *  - Reviews count
     *
     *  CATEGORY 4: STATS & ANALYTICS - PRO (30 features):
     *  4.1 All-Time Stats:
     *  - Total hours watched
     *  - Total films watched
     *  - Average rating given
     *  - Ratings histogram/spread
     *  - Most watched genres (bar chart)
     *  - Most watched decades (bar chart)
     *  - Highest rated films
     *  - Lowest rated films
     *  - Progress on milestone lists
     *  4.2 Year in Review:
     *  - Films watched this year
     *  - Films per month chart
     *  - Longest watching streak
     *  - Year navigation
     *  - Recently rated gallery
     *
     *  CATEGORY 5: FILM/SHOW PAGES (45 features):
     *  5.1 Film Info Display:
     *  - Film poster ✓
     *  - Film backdrop image ✓
     *  - Film title ✓
     *  - Release year ✓
     *  - Runtime ✓
     *  - Synopsis/overview ✓
     *  - Director(s) ✓
     *  - Full cast list ✓
     *  - Full crew list ✓
     *  - Studios ✓
     *  - Countries ✓
     *  - Languages ✓
     *  - Genres ✓
     *  5.2 Film Ratings & Social:
     *  - Community average rating ✓
     *  - Rating histogram ✓
     *  - Total watches count ✓
     *  - Total likes count ✓
     *  - Total lists containing film ✓
     *  - Popular reviews for film ✓
     *  5.3 Film Discovery:
     *  - Similar films ✓
     *  5.4 Streaming & Availability:
     *  - Where to watch (JustWatch) ✓
     *  - Streaming services list ✓
     *
     *  CATEGORY 6: SEARCH & DISCOVERY (25 features):
     *  6.1 Search Functionality:
     *  - Working search input ✓
     *  - Search shows by name ✓
     *  - Search members/users ✓
     *  - Search lists ✓
     *  - Search reviews ✓
     *  - Search results tabs ✓
     *  - Recent searches ✓
     *  - Clear search history ✓
     *  - No results state ✓
     *  - Search highlighting ✓
     *  6.2 Browse & Discovery:
     *  - Browse by Genre ✓
     *  - Genre filter results ✓
     *  - Browse by Decade ✓
     *  - Browse by Streaming Service ✓
     *  - Most Popular shows ✓
     *  - Highest Rated shows ✓
     *  - Genre cards with icons ✓
     *  - Service list with logos ✓
     *  - Browse page headers ✓
     *  - Filter chips ✓
     *  - Sort options (Popular/Rating/A-Z) ✓
     *  - Results grid with ratings ✓
     *  - Empty states ✓
     */
    
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    
    :root {
      --bg-primary: #14181C;
      --bg-tab-bar: #1F2830;
      --bg-elevated: #242C34;
      --bg-card: #2C3440;
      --bg-action-sheet: #445566;
      --bg-modal: #4B5867;
      --bg-input: #3D4752;
      --bg-pill-active: #3D4654;
      
      --brand-green: #00D735;
      --brand-orange: #FF8000;
      --brand-blue: #40BCF4;
      
      --text-primary: #FFFFFF;
      --text-secondary: #99AABB;
      --text-tertiary: #667788;
      --text-muted: #556677;
      
      --divider: #2C3440;
      --badge-crew: #6B7A8A;
      --badge-patron: #40A8D8;
      
      --font-display: 'Outfit', -apple-system, BlinkMacSystemFont, sans-serif;
      --font-body: -apple-system, BlinkMacSystemFont, 'SF Pro Text', system-ui, sans-serif;
    }
    
    html, body, #root { height: 100%; overflow: hidden; }
    
    body {
      font-family: var(--font-body);
      font-size: 15px;
      line-height: 1.4;
      color: var(--text-primary);
      background: var(--bg-primary);
      -webkit-font-smoothing: antialiased;
    }
    
    ::-webkit-scrollbar { display: none; }
    * { scrollbar-width: none; }
    
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    
    .app {
      display: flex;
      flex-direction: column;
      height: 100%;
      max-width: 430px;
      margin: 0 auto;
      background: var(--bg-primary);
      position: relative;
    }
    
    @media (min-width: 768px) { .app { box-shadow: 0 0 80px rgba(0,0,0,0.6); } }
    
    .main-content { flex: 1; overflow-y: auto; overflow-x: hidden; -webkit-overflow-scrolling: touch; }
    
    /* HEADER */
    .header { background: var(--bg-primary); padding: 12px 16px 8px; position: sticky; top: 0; z-index: 50; }
    .header-title { font-family: var(--font-display); font-size: 22px; text-align: center; letter-spacing: 0; font-weight: 700; }
    .header-row { display: flex; align-items: center; justify-content: space-between; }
    .header-btn { width: 44px; height: 44px; display: flex; align-items: center; justify-content: center; background: none; border: none; color: var(--text-primary); cursor: pointer; }
    
    /* TOP TABS */
    .top-tabs { display: flex; padding: 6px 16px; background: var(--bg-tab-bar); border-bottom: 1px solid var(--divider); }
    .top-tab { flex: 1; padding: 8px 12px; border-radius: 8px; font-size: 14px; font-weight: 500; color: var(--text-secondary); background: transparent; border: none; cursor: pointer; text-align: center; position: relative; transition: all 0.2s; }
    .top-tab.active { background: var(--bg-pill-active); color: var(--text-primary); font-weight: 600; }
    .notification-dot { position: absolute; top: 4px; right: 4px; width: 8px; height: 8px; background: var(--brand-orange); border-radius: 50%; }
    
    /* SEGMENT CONTROL - PIXEL PERFECT */
    .segment-control { display: flex; background: var(--bg-tab-bar); border-radius: 8px; padding: 3px; margin: 12px 16px; }
    .segment-btn { flex: 1; padding: 10px 12px; border-radius: 6px; font-size: 14px; font-weight: 500; color: var(--text-secondary); background: transparent; border: none; cursor: pointer; transition: all 0.2s; }
    .segment-btn.active { background: var(--bg-pill-active); color: var(--text-primary); font-weight: 600; }
    
    /* GENRE PILLS */
    .genre-pills { display: flex; gap: 8px; padding: 12px 16px; overflow-x: auto; }
    .genre-pill { padding: 8px 16px; border-radius: 20px; font-size: 13px; font-weight: 600; white-space: nowrap; cursor: pointer; background: var(--bg-card); color: var(--text-secondary); border: none; transition: all 0.2s; }
    .genre-pill:active { transform: scale(0.95); }
    .genre-pill.active { background: var(--brand-green); color: #000; }
    
    /* SECTION HEADER */
    .section-header { font-size: 17px; font-weight: 700; padding: 16px 16px 12px; display: flex; justify-content: space-between; align-items: center; }
    .section-header-action { font-size: 13px; font-weight: 500; color: var(--brand-blue); cursor: pointer; }
    
    /* POSTER GRID 3-col - PIXEL PERFECT: 8px gap */
    .poster-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; padding: 0 16px 16px; }
    .poster-item { aspect-ratio: 2/3; border-radius: 4px; overflow: hidden; cursor: pointer; position: relative; background: var(--bg-card); transition: transform 0.1s; }
    .poster-item:active { transform: scale(0.96); }
    .poster-item.selected { outline: 3px solid var(--brand-green); outline-offset: -3px; }
    .poster-img { width: 100%; height: 100%; object-fit: cover; }
    .poster-watched { position: absolute; bottom: 4px; left: 4px; width: 22px; height: 22px; background: var(--brand-green); border-radius: 50%; display: flex; align-items: center; justify-content: center; }
    .poster-rating-overlay { position: absolute; bottom: 4px; right: 4px; display: flex; align-items: center; gap: 2px; background: rgba(0,0,0,0.75); padding: 2px 5px; border-radius: 4px; font-size: 11px; font-weight: 600; }
    .poster-rating-overlay svg { color: var(--brand-green); width: 10px; height: 10px; }
    .poster-select { position: absolute; top: 4px; right: 4px; width: 24px; height: 24px; background: rgba(0,0,0,0.6); border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 2px solid white; }
    .poster-select.checked { background: var(--brand-green); border-color: var(--brand-green); }
    
    /* HIGHEST RATED GRID - 4 columns, 6px gap */
    .poster-grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; padding: 0 16px 16px; }
    .poster-grid-4 .poster-item { aspect-ratio: 2/3; }
    
    /* BULK SELECT BAR - NEW 1.1 */
    .bulk-select-bar { position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); background: var(--bg-card); border-radius: 12px; padding: 12px 20px; display: flex; gap: 16px; align-items: center; z-index: 100; box-shadow: 0 4px 20px rgba(0,0,0,0.5); }
    .bulk-select-count { font-size: 14px; font-weight: 600; }
    .bulk-select-btn { padding: 8px 16px; border-radius: 8px; font-size: 13px; font-weight: 600; border: none; cursor: pointer; }
    .bulk-select-btn.primary { background: var(--brand-green); color: #000; }
    .bulk-select-btn.secondary { background: transparent; color: var(--text-secondary); }
    
    /* LIST GRID 4-col with numbers - AUDIT FIX */
    .list-grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; padding: 12px 16px; }
    .list-grid-item { aspect-ratio: 2/3; border-radius: 4px; overflow: hidden; position: relative; background: var(--bg-card); }
    .list-grid-item img { width: 100%; height: 100%; object-fit: cover; }
    .list-grid-number { position: absolute; bottom: 4px; right: 4px; min-width: 20px; height: 20px; padding: 0 5px; background: rgba(0,0,0,0.8); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 600; }
    
    /* REVIEW CARD - PIXEL PERFECT */
    .review-card { padding: 16px; border-bottom: 1px solid var(--divider); }
    .review-header { display: flex; gap: 12px; }
    .review-left { flex: 1; min-width: 0; }
    .review-user-row { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
    .review-title-row { display: flex; align-items: baseline; gap: 6px; margin-bottom: 4px; }
    .review-title { font-size: 17px; font-weight: 700; }
    .review-year { font-size: 16px; color: var(--text-tertiary); }
    .review-rating-row { display: flex; align-items: center; gap: 6px; margin-bottom: 4px; }
    .review-date { font-size: 13px; color: var(--text-tertiary); }
    .review-poster { width: 65px; height: 98px; border-radius: 4px; object-fit: cover; flex-shrink: 0; background: var(--bg-card); }
    .review-text { font-size: 15px; color: var(--text-secondary); line-height: 1.55; margin-top: 12px; }
    
    /* SPOILER */
    .spoiler-block { background: var(--bg-card); border-radius: 8px; padding: 14px 16px; display: flex; align-items: center; gap: 12px; margin-top: 12px; cursor: pointer; }
    .spoiler-text { font-size: 14px; color: var(--text-tertiary); }
    
    /* LIST CARD */
    .list-card { padding: 16px; border-bottom: 1px solid var(--divider); cursor: pointer; }
    .list-card:active { background: var(--bg-elevated); }
    .list-card-header { display: flex; justify-content: space-between; align-items: flex-start; gap: 12px; margin-bottom: 4px; }
    .list-title { font-size: 17px; font-weight: 700; flex: 1; }
    .list-user { display: flex; align-items: center; gap: 6px; flex-shrink: 0; }
    .list-desc { font-size: 14px; color: var(--text-secondary); line-height: 1.5; margin-bottom: 12px; }
    .list-posters-scroll { display: flex; gap: 6px; overflow-x: auto; padding-bottom: 8px; margin: 0 -16px; padding-left: 16px; padding-right: 16px; }
    .list-poster-sm { width: 70px; height: 105px; border-radius: 4px; object-fit: cover; flex-shrink: 0; background: var(--bg-card); }
    .list-meta { display: flex; gap: 16px; font-size: 13px; color: var(--text-tertiary); margin-top: 8px; }
    .list-meta-item { display: flex; align-items: center; gap: 4px; }
    .list-private-badge { font-size: 10px; background: var(--bg-input); color: var(--text-secondary); padding: 2px 6px; border-radius: 4px; margin-left: 8px; }
    
    /* LIST DETAIL - ENHANCED */
    .list-detail-header { padding: 16px; border-bottom: 1px solid var(--divider); }
    .list-detail-author { display: flex; align-items: center; gap: 8px; margin-bottom: 12px; }
    .list-detail-title { font-size: 22px; font-weight: 700; margin-bottom: 8px; }
    .list-detail-desc { font-size: 14px; color: var(--text-secondary); line-height: 1.5; margin-bottom: 12px; }
    .list-detail-stats { display: flex; gap: 16px; font-size: 13px; color: var(--text-tertiary); }
    .list-detail-actions { display: flex; gap: 12px; margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--divider); }
    .list-action-btn { display: flex; align-items: center; gap: 6px; background: none; border: none; color: var(--text-secondary); cursor: pointer; padding: 8px 12px; border-radius: 6px; font-size: 14px; }
    .list-action-btn:active { background: var(--bg-input); }
    .list-action-btn.active { color: var(--brand-orange); }
    .list-filter-bar { display: flex; justify-content: space-between; padding: 12px 16px; background: var(--bg-card); border-bottom: 1px solid var(--divider); }
    .list-filter-btn { background: none; border: none; color: var(--text-secondary); cursor: pointer; padding: 6px 10px; border-radius: 4px; font-size: 13px; display: flex; align-items: center; gap: 4px; }
    .list-filter-btn.active { background: var(--bg-input); color: var(--text-primary); }
    
    /* LIST ENTRY WITH NOTES */
    .list-entry { display: flex; gap: 12px; padding: 12px 16px; border-bottom: 1px solid var(--divider); }
    .list-entry-number { width: 28px; font-size: 14px; font-weight: 600; color: var(--text-tertiary); text-align: center; flex-shrink: 0; padding-top: 4px; }
    .list-entry-poster { width: 60px; height: 90px; border-radius: 4px; object-fit: cover; flex-shrink: 0; }
    .list-entry-info { flex: 1; min-width: 0; }
    .list-entry-title { font-size: 15px; font-weight: 600; margin-bottom: 2px; }
    .list-entry-year { font-size: 13px; color: var(--text-tertiary); }
    .list-entry-note { font-size: 13px; color: var(--text-secondary); font-style: italic; margin-top: 6px; padding: 8px; background: var(--bg-card); border-radius: 6px; }
    .list-entry-actions { display: flex; flex-direction: column; gap: 4px; }
    .list-entry-action-btn { background: none; border: none; color: var(--text-tertiary); cursor: pointer; padding: 4px; }
    .list-entry-action-btn:active { color: var(--text-primary); }
    
    /* NEW LIST FORM - ENHANCED */
    .new-list-section { padding: 16px; border-bottom: 1px solid var(--divider); }
    .new-list-section-title { font-size: 11px; font-weight: 600; color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px; }
    .list-toggle-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; }
    .list-toggle-label { font-size: 15px; display: flex; align-items: center; gap: 10px; }
    .list-toggle-desc { font-size: 12px; color: var(--text-tertiary); margin-top: 2px; }
    
    /* ADD TO LIST MODAL */
    .add-to-list-item { display: flex; align-items: center; gap: 12px; padding: 12px 16px; border-bottom: 1px solid var(--divider); cursor: pointer; }
    .add-to-list-item:active { background: var(--bg-elevated); }
    .add-to-list-check { width: 24px; height: 24px; border: 2px solid var(--text-tertiary); border-radius: 50%; display: flex; align-items: center; justify-content: center; }
    .add-to-list-check.checked { background: var(--brand-green); border-color: var(--brand-green); }
    .add-to-list-info { flex: 1; }
    .add-to-list-title { font-size: 15px; font-weight: 500; }
    .add-to-list-count { font-size: 13px; color: var(--text-tertiary); }
    
    /* LISTS BROWSE */
    .lists-browse-section { padding: 16px; }
    .lists-browse-title { font-size: 18px; font-weight: 700; margin-bottom: 12px; }
    .lists-browse-scroll { display: flex; gap: 12px; overflow-x: auto; margin: 0 -16px; padding: 0 16px 12px; }
    .list-browse-card { width: 200px; flex-shrink: 0; background: var(--bg-card); border-radius: 8px; overflow: hidden; }
    .list-browse-posters { display: grid; grid-template-columns: repeat(2, 1fr); gap: 2px; height: 120px; }
    .list-browse-posters img { width: 100%; height: 60px; object-fit: cover; }
    .list-browse-info { padding: 10px; }
    .list-browse-name { font-size: 14px; font-weight: 600; margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .list-browse-meta { font-size: 12px; color: var(--text-tertiary); }
    
    /* JOURNAL */
    .journal-card { margin: 0 16px 20px; cursor: pointer; }
    .journal-card:active { opacity: 0.9; }
    .journal-img { width: 100%; height: 200px; border-radius: 8px; object-fit: cover; margin-bottom: 12px; background: var(--bg-card); }
    .journal-title { font-size: 18px; font-weight: 700; margin-bottom: 6px; }
    .journal-desc { font-size: 15px; color: var(--text-secondary); line-height: 1.5; }
    .journal-desc em { font-style: italic; }
    
    /* DIARY */
    .diary-month { background: var(--bg-modal); padding: 8px 16px; font-size: 11px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1.5px; }
    .diary-entry { display: flex; gap: 12px; padding: 12px 16px; border-bottom: 1px solid var(--divider); cursor: pointer; }
    .diary-entry:active { background: var(--bg-elevated); }
    
    /* DIARY VIEW TOGGLE - NEW 1.4 */
    .diary-header { display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; background: var(--bg-card); border-bottom: 1px solid var(--divider); }
    .diary-view-toggle { display: flex; gap: 4px; }
    .diary-view-btn { background: none; border: none; color: var(--text-tertiary); cursor: pointer; padding: 8px; border-radius: 6px; }
    .diary-view-btn.active { background: var(--bg-input); color: var(--text-primary); }
    .diary-month-nav { display: flex; align-items: center; gap: 8px; }
    .diary-month-nav button { background: none; border: none; color: var(--text-secondary); cursor: pointer; padding: 4px; }
    .diary-month-label { font-size: 14px; font-weight: 600; min-width: 120px; text-align: center; }
    
    /* CALENDAR VIEW - NEW 1.4 */
    .diary-calendar { padding: 8px; }
    .calendar-weekdays { display: grid; grid-template-columns: repeat(7, 1fr); text-align: center; padding: 8px 0; }
    .calendar-weekday { font-size: 10px; font-weight: 600; color: var(--text-tertiary); text-transform: uppercase; }
    .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; }
    .calendar-day { aspect-ratio: 1; background: var(--bg-card); border-radius: 4px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; position: relative; overflow: hidden; }
    .calendar-day.empty { background: transparent; cursor: default; }
    .calendar-day.today { border: 2px solid var(--brand-green); }
    .calendar-day.has-entry { padding: 0; }
    .calendar-day-number { font-size: 11px; color: var(--text-tertiary); position: absolute; top: 2px; left: 4px; z-index: 2; text-shadow: 0 1px 2px rgba(0,0,0,0.8); }
    .calendar-day.has-entry .calendar-day-number { color: #fff; font-weight: 600; }
    .calendar-day-poster { width: 100%; height: 100%; object-fit: cover; position: absolute; inset: 0; }
    .calendar-day-count { position: absolute; bottom: 2px; right: 2px; font-size: 9px; background: var(--brand-green); color: #000; padding: 1px 4px; border-radius: 3px; font-weight: 600; }
    
    /* EDIT DIARY ENTRY MODAL - NEW 1.4 */
    .diary-edit-section { padding: 16px; }
    .diary-edit-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--divider); }
    .diary-edit-label { font-size: 14px; color: var(--text-secondary); }
    .diary-edit-value { font-size: 14px; color: var(--text-primary); display: flex; align-items: center; gap: 8px; }
    .diary-date { width: 44px; height: 44px; border: 1.5px solid var(--text-muted); border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 18px; font-weight: 500; flex-shrink: 0; }
    .diary-poster { width: 48px; height: 72px; border-radius: 4px; object-fit: cover; flex-shrink: 0; background: var(--bg-card); }
    .diary-info { flex: 1; display: flex; flex-direction: column; justify-content: center; min-width: 0; }
    .diary-title-row { display: flex; align-items: center; gap: 6px; margin-bottom: 4px; flex-wrap: wrap; }
    .diary-title { font-size: 15px; font-weight: 600; }
    .diary-year { font-size: 14px; color: var(--text-tertiary); }
    .diary-actions { display: flex; align-items: center; gap: 8px; }
    .diary-menu { margin-left: auto; color: var(--text-muted); }
    
    /* ACTIVITY - AUDIT FIX: time on RIGHT, inline stars */
    .activity-item { display: flex; gap: 12px; padding: 12px 16px; border-bottom: 1px solid var(--divider); cursor: pointer; align-items: flex-start; }
    .activity-item:active { background: var(--bg-elevated); }
    .activity-content { flex: 1; min-width: 0; }
    .activity-row { display: flex; align-items: flex-start; justify-content: space-between; gap: 8px; }
    .activity-text { font-size: 14px; color: var(--text-secondary); line-height: 1.45; flex: 1; }
    .activity-text strong { color: var(--text-primary); font-weight: 600; }
    .activity-text .stars { color: var(--brand-green); }
    .activity-time { font-size: 13px; color: var(--text-muted); flex-shrink: 0; white-space: nowrap; }
    
    /* AVATAR */
    .avatar { width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, var(--brand-orange), var(--brand-green)); display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 700; flex-shrink: 0; overflow: hidden; }
    .avatar-sm { width: 28px; height: 28px; font-size: 11px; }
    .avatar-lg { width: 100px; height: 100px; font-size: 36px; }
    .avatar-placeholder { background: var(--bg-card); color: var(--text-muted); }
    
    /* BADGES */
    .badge { display: inline-flex; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; color: #fff; }
    .badge-crew { background: var(--badge-crew); }
    .badge-patron { background: var(--badge-patron); }
    .badge-pro { background: var(--brand-orange); }
    
    /* STAR RATING - PIXEL PERFECT */
    .stars { color: var(--brand-green); font-size: 14px; letter-spacing: -1px; }
    .star-rating-interactive { display: flex; justify-content: center; gap: 2px; }
    .star-btn { background: none; border: none; padding: 2px; cursor: pointer; color: var(--text-muted); transition: transform 0.1s; }
    .star-btn:active { transform: scale(1.2); }
    .star-btn.active { color: var(--brand-green); }
    .star-btn svg { width: 32px; height: 32px; }
    
    /* SEARCH */
    .search-header { padding: 16px; text-align: center; font-size: 17px; font-weight: 600; }
    .search-bar { display: flex; align-items: center; gap: 10px; background: var(--bg-card); border-radius: 8px; padding: 10px 14px; margin: 0 16px 16px; }
    .search-bar svg { color: var(--text-tertiary); flex-shrink: 0; }
    .search-bar input { flex: 1; background: none; border: none; font-size: 15px; color: var(--text-primary); outline: none; }
    .search-bar input::placeholder { color: var(--text-tertiary); }
    .browse-title { font-size: 16px; font-weight: 700; padding: 16px 16px 8px; }
    .browse-row { display: flex; align-items: center; justify-content: space-between; padding: 14px 16px; border-bottom: 1px solid var(--divider); cursor: pointer; }
    .browse-row:active { background: var(--bg-elevated); }
    .browse-row-label { font-size: 15px; color: var(--text-secondary); }
    .browse-row svg { color: var(--text-muted); }
    
    /* PROFILE */
    .profile-header-row { display: flex; align-items: center; justify-content: space-between; padding: 8px 16px; }
    .profile-username { font-size: 17px; font-weight: 600; }
    .profile-avatar-section { display: flex; flex-direction: column; align-items: center; padding: 20px 16px; }
    .profile-row { display: flex; align-items: center; justify-content: space-between; padding: 14px 16px; border-bottom: 1px solid var(--divider); cursor: pointer; }
    .profile-row:active { background: var(--bg-elevated); }
    .profile-row-label { font-size: 15px; color: var(--text-primary); }
    .profile-row-value { display: flex; align-items: center; gap: 6px; font-size: 15px; color: var(--text-tertiary); }
    .remove-ads { text-align: center; padding: 24px 16px; font-size: 12px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; }
    
    /* PROFILE DISPLAY ENHANCEMENTS - CAT 3.1 */
    .profile-backdrop { position: relative; height: 180px; background: linear-gradient(135deg, var(--bg-card), var(--bg-elevated)); overflow: hidden; }
    .profile-backdrop img { width: 100%; height: 100%; object-fit: cover; opacity: 0.7; }
    .profile-backdrop-overlay { position: absolute; inset: 0; background: linear-gradient(to top, var(--bg-primary) 0%, transparent 70%); }
    .profile-backdrop-badge { position: absolute; top: 12px; right: 12px; background: rgba(0,0,0,0.6); padding: 4px 8px; border-radius: 4px; font-size: 10px; font-weight: 600; color: var(--brand-blue); }
    
    .profile-main-info { position: relative; margin-top: -60px; padding: 0 16px 16px; }
    .profile-avatar-container { display: flex; align-items: flex-end; gap: 12px; margin-bottom: 12px; }
    .profile-avatar-large { width: 90px; height: 90px; border-radius: 50%; background: linear-gradient(135deg, var(--brand-orange), var(--brand-green)); display: flex; align-items: center; justify-content: center; font-size: 32px; font-weight: 700; color: #fff; border: 3px solid var(--bg-primary); flex-shrink: 0; }
    .profile-names { flex: 1; padding-bottom: 4px; min-width: 0; }
    .profile-display-name { font-size: 20px; font-weight: 700; display: flex; align-items: center; gap: 6px; flex-wrap: wrap; line-height: 1.3; }
    .profile-handle { font-size: 14px; color: var(--text-tertiary); margin-top: 2px; }
    .profile-pronouns { font-size: 11px; color: var(--text-secondary); background: var(--bg-card); padding: 2px 8px; border-radius: 10px; display: inline-block; }
    
    .profile-bio { font-size: 14px; color: var(--text-secondary); line-height: 1.5; margin: 8px 0 12px; }
    
    .profile-meta-row { display: flex; flex-wrap: wrap; gap: 16px; margin: 8px 0 16px; }
    .profile-meta-item { display: flex; align-items: center; gap: 5px; font-size: 13px; color: var(--text-tertiary); }
    .profile-meta-item svg { width: 14px; height: 14px; opacity: 0.7; }
    .profile-meta-link { color: var(--brand-blue); text-decoration: none; }
    .profile-meta-link:hover { text-decoration: underline; }
    
    /* TOP FOUR FAVORITES - CAT 3.1 */
    .top-four-section { margin: 0 0 16px; }
    .top-four-label { font-size: 11px; font-weight: 600; color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
    .top-four-grid { display: flex; gap: 6px; }
    .top-four-poster { flex: 1; aspect-ratio: 2/3; border-radius: 4px; overflow: hidden; background: var(--bg-card); transition: transform 0.2s; position: relative; }
    .top-four-poster.clickable { cursor: pointer; }
    .top-four-poster.clickable:active { transform: scale(0.96); }
    .top-four-poster img { width: 100%; height: 100%; object-fit: cover; }
    .top-four-empty { display: flex; align-items: center; justify-content: center; background: var(--bg-card); border: 2px dashed var(--text-muted); cursor: pointer; }
    .top-four-empty span { font-size: 24px; color: var(--text-muted); }
    
    /* PINNED CONTENT - CAT 3.1 */
    .pinned-section { margin: 16px 0; padding: 0 16px; }
    .pinned-header { display: flex; align-items: center; gap: 6px; font-size: 11px; font-weight: 600; color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
    .pinned-badge { background: var(--brand-orange); color: #000; padding: 1px 4px; border-radius: 3px; font-size: 9px; }
    .pinned-review { background: var(--bg-card); border-radius: 8px; padding: 12px; cursor: pointer; transition: background 0.2s; }
    .pinned-review:active { background: var(--bg-elevated); }
    .pinned-review-header { display: flex; gap: 10px; margin-bottom: 8px; }
    .pinned-review-poster { width: 40px; height: 60px; border-radius: 4px; object-fit: cover; flex-shrink: 0; }
    .pinned-review-info { flex: 1; min-width: 0; }
    .pinned-review-title { font-size: 14px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .pinned-review-meta { font-size: 12px; color: var(--text-tertiary); display: flex; align-items: center; gap: 6px; margin-top: 2px; }
    .pinned-review-text { font-size: 13px; color: var(--text-secondary); line-height: 1.5; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
    
    .pinned-list { background: var(--bg-card); border-radius: 8px; padding: 12px; margin-top: 8px; cursor: pointer; transition: background 0.2s; }
    .pinned-list:active { background: var(--bg-elevated); }
    .pinned-list-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
    .pinned-list-title { font-size: 14px; font-weight: 600; }
    .pinned-list-count { font-size: 12px; color: var(--text-tertiary); }
    .pinned-list-posters { display: flex; gap: 4px; }
    .pinned-list-poster { width: 40px; height: 60px; border-radius: 3px; object-fit: cover; }
    
    /* EDIT PROFILE MODAL - CAT 3.1 */
    .edit-profile-section { padding: 16px; }
    .edit-profile-avatar { display: flex; flex-direction: column; align-items: center; margin-bottom: 20px; }
    .edit-profile-avatar-btn { margin-top: 8px; font-size: 14px; color: var(--brand-blue); background: none; border: none; cursor: pointer; }
    .edit-profile-field { margin-bottom: 16px; }
    .edit-profile-label { font-size: 12px; font-weight: 600; color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px; }
    .edit-profile-input { width: 100%; background: var(--bg-input); border: none; border-radius: 8px; padding: 12px; font-size: 15px; color: var(--text-primary); outline: none; }
    .edit-profile-input:focus { outline: 2px solid var(--brand-blue); }
    .edit-profile-textarea { width: 100%; background: var(--bg-input); border: none; border-radius: 8px; padding: 12px; font-size: 15px; color: var(--text-primary); outline: none; min-height: 80px; resize: vertical; font-family: var(--font-body); }
    .edit-profile-hint { font-size: 11px; color: var(--text-muted); margin-top: 4px; }
    .edit-profile-char-count { font-size: 11px; color: var(--text-muted); text-align: right; margin-top: 4px; }
    
    /* TOP FOUR EDITOR - CAT 3.1 */
    .top-four-editor { margin: 20px 0; }
    .top-four-editor-grid { display: flex; gap: 8px; margin-top: 8px; }
    .top-four-editor-slot { flex: 1; aspect-ratio: 2/3; border-radius: 6px; overflow: hidden; position: relative; background: var(--bg-card); cursor: pointer; }
    .top-four-editor-slot img { width: 100%; height: 100%; object-fit: cover; }
    .top-four-editor-slot.empty { border: 2px dashed var(--text-muted); display: flex; align-items: center; justify-content: center; color: var(--text-muted); }
    .top-four-editor-slot.empty:hover { border-color: var(--brand-green); color: var(--brand-green); }
    .top-four-remove { position: absolute; top: 4px; right: 4px; width: 22px; height: 22px; background: rgba(0,0,0,0.7); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; color: #fff; font-size: 14px; }
    
    /* PROFILE EDIT BACKDROP - CAT 3.1 */
    .edit-backdrop-preview { height: 120px; border-radius: 8px; overflow: hidden; margin-bottom: 8px; background: var(--bg-card); position: relative; }
    .edit-backdrop-preview img { width: 100%; height: 100%; object-fit: cover; }
    .edit-backdrop-btn { width: 100%; padding: 10px; font-size: 14px; color: var(--brand-blue); background: var(--bg-input); border: none; border-radius: 8px; cursor: pointer; }
    .edit-backdrop-patron-badge { position: absolute; bottom: 8px; right: 8px; background: var(--badge-patron); color: #fff; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: 600; }
    
    /* CAT 3.2 PROFILE TABS */
    .profile-tabs-scroll { display: flex; gap: 0; padding: 0 16px; overflow-x: auto; background: var(--bg-tab-bar); border-bottom: 1px solid var(--divider); -webkit-overflow-scrolling: touch; scrollbar-width: none; -ms-overflow-style: none; }
    .profile-tabs-scroll::-webkit-scrollbar { display: none; }
    .profile-tab { padding: 12px 14px; font-size: 13px; font-weight: 500; color: var(--text-tertiary); background: none; border: none; cursor: pointer; white-space: nowrap; position: relative; transition: color 0.2s; flex-shrink: 0; }
    .profile-tab.active { color: var(--text-primary); font-weight: 600; }
    .profile-tab.active::after { content: ''; position: absolute; bottom: 0; left: 14px; right: 14px; height: 2px; background: var(--brand-green); border-radius: 1px; }
    .profile-tab-count { font-size: 11px; color: var(--text-muted); margin-left: 4px; }
    
    /* FILMS TAB - CAT 3.2 */
    .films-tab-header { display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; }
    .films-tab-count { font-size: 14px; color: var(--text-secondary); }
    .films-tab-sort { font-size: 13px; color: var(--brand-blue); background: none; border: none; cursor: pointer; display: flex; align-items: center; gap: 4px; }
    .films-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; padding: 0 16px 16px; }
    .films-grid-item { aspect-ratio: 2/3; border-radius: 3px; overflow: hidden; background: var(--bg-card); cursor: pointer; position: relative; }
    .films-grid-item img { width: 100%; height: 100%; object-fit: cover; }
    .films-grid-item:active { opacity: 0.8; }
    
    /* REVIEWS TAB - CAT 3.2 */
    .reviews-tab-header { display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; border-bottom: 1px solid var(--divider); }
    .reviews-tab-count { font-size: 14px; color: var(--text-secondary); }
    
    /* LIKES TAB - CAT 3.2 */
    .likes-segment { display: flex; background: var(--bg-tab-bar); border-radius: 8px; padding: 3px; margin: 12px 16px; }
    .likes-segment-btn { flex: 1; padding: 8px; border-radius: 6px; font-size: 13px; font-weight: 500; color: var(--text-tertiary); background: none; border: none; cursor: pointer; text-align: center; }
    .likes-segment-btn.active { background: var(--bg-pill-active); color: var(--text-primary); }
    .likes-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; padding: 0 16px 16px; }
    .likes-grid .poster-item { aspect-ratio: 2/3; }
    
    /* NETWORK TAB (Following/Followers) - CAT 3.2 */
    .network-segment { display: flex; background: var(--bg-tab-bar); border-radius: 8px; padding: 3px; margin: 12px 16px; }
    .network-segment-btn { flex: 1; padding: 10px; border-radius: 6px; font-size: 14px; font-weight: 500; color: var(--text-tertiary); background: none; border: none; cursor: pointer; text-align: center; }
    .network-segment-btn.active { background: var(--bg-pill-active); color: var(--text-primary); }
    .network-user { display: flex; align-items: center; gap: 12px; padding: 12px 16px; border-bottom: 1px solid var(--divider); }
    .network-user:active { background: var(--bg-elevated); }
    .network-user-info { flex: 1; min-width: 0; }
    .network-user-name { font-size: 15px; font-weight: 600; display: flex; align-items: center; gap: 6px; }
    .network-user-handle { font-size: 13px; color: var(--text-tertiary); }
    .network-user-bio { font-size: 12px; color: var(--text-secondary); margin-top: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .network-follow-btn { padding: 6px 16px; border-radius: 6px; font-size: 13px; font-weight: 600; cursor: pointer; border: none; transition: all 0.2s; flex-shrink: 0; }
    .network-follow-btn.following { background: var(--bg-card); color: var(--text-primary); border: 1px solid var(--divider); }
    .network-follow-btn.not-following { background: var(--brand-green); color: #000; }
    
    /* RATINGS HISTOGRAM - CAT 3.2 */
    .ratings-section { padding: 16px; }
    .ratings-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
    .ratings-title { font-size: 14px; font-weight: 600; }
    .ratings-avg { font-size: 13px; color: var(--text-tertiary); }
    .ratings-histogram { display: flex; align-items: flex-end; gap: 3px; height: 80px; }
    .ratings-bar-container { flex: 1; display: flex; flex-direction: column; align-items: center; }
    .ratings-bar-wrapper { width: 100%; height: 60px; display: flex; flex-direction: column; justify-content: flex-end; }
    .ratings-bar { width: 100%; background: var(--brand-green); border-radius: 2px 2px 0 0; min-height: 2px; transition: height 0.3s; }
    .ratings-bar-label { font-size: 9px; color: var(--text-muted); margin-top: 4px; }
    .ratings-bar-count { font-size: 8px; color: var(--text-tertiary); margin-bottom: 2px; min-height: 10px; }
    .ratings-stats-row { display: flex; justify-content: space-around; margin-top: 20px; padding-top: 16px; border-top: 1px solid var(--divider); }
    .ratings-stat { text-align: center; }
    .ratings-stat-value { font-size: 20px; font-weight: 700; color: var(--brand-green); }
    .ratings-stat-label { font-size: 11px; color: var(--text-tertiary); margin-top: 2px; }
    
    /* CAT 4: STATS & ANALYTICS */
    .stats-page { padding: 0 0 24px; }
    .stats-header { padding: 20px 16px; text-align: center; background: linear-gradient(180deg, var(--bg-elevated) 0%, var(--bg-primary) 100%); }
    .stats-header-title { font-size: 20px; font-weight: 700; display: flex; align-items: center; justify-content: center; gap: 8px; }
    .stats-header-subtitle { font-size: 13px; color: var(--text-tertiary); margin-top: 4px; }
    .stats-pro-badge { display: inline-flex; align-items: center; gap: 3px; background: var(--brand-orange); color: #000; padding: 2px 6px; border-radius: 4px; font-size: 9px; font-weight: 700; vertical-align: middle; }
    .profile-tab .stats-pro-badge { font-size: 8px; padding: 1px 4px; margin-left: 4px; }
    
    .stats-hero { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1px; background: var(--divider); margin: 16px; border-radius: 12px; overflow: hidden; }
    .stats-hero-item { background: var(--bg-card); padding: 20px 12px; text-align: center; }
    .stats-hero-value { font-size: 32px; font-weight: 700; color: var(--brand-green); line-height: 1; }
    .stats-hero-label { font-size: 10px; color: var(--text-tertiary); margin-top: 6px; text-transform: uppercase; letter-spacing: 0.5px; }
    
    .stats-section { margin: 20px 16px; }
    .stats-section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
    .stats-section-title { font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; color: var(--text-tertiary); }
    .stats-section-link { font-size: 12px; color: var(--text-muted); }
    
    .stats-bar-chart { display: flex; flex-direction: column; gap: 10px; background: var(--bg-card); border-radius: 12px; padding: 16px; }
    .stats-bar-row { display: flex; align-items: center; gap: 12px; }
    .stats-bar-label { width: 80px; font-size: 13px; color: var(--text-primary); flex-shrink: 0; font-weight: 500; }
    .stats-bar-track { flex: 1; height: 8px; background: var(--bg-elevated); border-radius: 4px; overflow: hidden; position: relative; }
    .stats-bar-fill { height: 100%; background: var(--brand-green); border-radius: 4px; transition: width 0.5s ease; }
    .stats-bar-count { width: 30px; font-size: 13px; font-weight: 600; color: var(--text-secondary); text-align: right; }
    
    .stats-month-chart { display: flex; align-items: flex-end; gap: 6px; height: 80px; padding: 0; }
    .stats-month-bar { flex: 1; background: var(--brand-green); border-radius: 2px 2px 0 0; min-height: 4px; transition: height 0.3s; }
    .stats-month-bar.empty { background: var(--bg-elevated); }
    .stats-month-labels { display: flex; justify-content: space-around; padding: 8px 0 0; }
    .stats-month-label { font-size: 10px; color: var(--text-muted); width: 100%; text-align: center; }
    
    .stats-highlight-card { background: var(--bg-card); border-radius: 12px; padding: 16px; margin-bottom: 12px; }
    .stats-highlight-row { display: flex; gap: 16px; align-items: center; }
    .stats-highlight-poster { width: 50px; height: 75px; border-radius: 4px; object-fit: cover; flex-shrink: 0; }
    .stats-highlight-info { flex: 1; min-width: 0; }
    .stats-highlight-label { font-size: 10px; color: var(--brand-green); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px; font-weight: 600; }
    .stats-highlight-title { font-size: 15px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .stats-highlight-meta { font-size: 13px; color: var(--text-secondary); margin-top: 4px; display: flex; align-items: center; gap: 6px; }
    
    .stats-streak { display: flex; align-items: center; gap: 16px; padding: 20px; background: var(--bg-card); border-radius: 12px; }
    .stats-streak-icon { font-size: 40px; }
    .stats-streak-number { font-size: 42px; font-weight: 700; color: var(--brand-orange); line-height: 1; }
    .stats-streak-text { flex: 1; }
    .stats-streak-label { font-size: 15px; font-weight: 600; }
    .stats-streak-sub { font-size: 12px; color: var(--text-tertiary); margin-top: 2px; }
    
    .stats-year-nav { display: flex; align-items: center; justify-content: center; gap: 20px; padding: 16px; background: var(--bg-card); margin: 16px; border-radius: 12px; }
    .stats-year-nav button { background: none; border: none; color: var(--text-secondary); cursor: pointer; padding: 8px; border-radius: 50%; }
    .stats-year-nav button:hover { background: var(--bg-elevated); }
    .stats-year-nav button:disabled { opacity: 0.3; cursor: not-allowed; }
    .stats-year-label { font-size: 20px; font-weight: 700; min-width: 60px; text-align: center; }
    
    .stats-milestones { display: flex; flex-direction: column; gap: 12px; }
    .stats-milestone { background: var(--bg-card); border-radius: 10px; padding: 14px; }
    .stats-milestone-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
    .stats-milestone-title { font-size: 14px; font-weight: 600; }
    .stats-milestone-count { font-size: 13px; color: var(--text-tertiary); }
    .stats-milestone-bar { height: 8px; background: var(--bg-elevated); border-radius: 4px; overflow: hidden; }
    .stats-milestone-progress { height: 100%; background: var(--brand-green); border-radius: 4px; transition: width 0.5s; }
    
    /* CATEGORY 5: SHOW DETAIL PAGE */
    .show-detail-page { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: var(--bg-primary); z-index: 1000; overflow-y: auto; -webkit-overflow-scrolling: touch; }
    .show-detail-backdrop { width: 100%; height: 280px; object-fit: cover; position: relative; }
    .show-detail-backdrop-gradient { position: absolute; top: 0; left: 0; right: 0; height: 280px; background: linear-gradient(to bottom, rgba(20,24,28,0) 0%, rgba(20,24,28,0.8) 70%, var(--bg-primary) 100%); }
    .show-detail-header { position: absolute; top: 0; left: 0; right: 0; display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; z-index: 10; }
    .show-detail-back { width: 36px; height: 36px; border-radius: 50%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; cursor: pointer; }
    .show-detail-share { width: 36px; height: 36px; border-radius: 50%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; cursor: pointer; }
    
    .show-detail-hero { display: flex; gap: 16px; padding: 0 16px; margin-top: -100px; position: relative; z-index: 5; }
    .show-detail-poster { width: 120px; height: 180px; border-radius: 8px; object-fit: cover; box-shadow: 0 4px 20px rgba(0,0,0,0.5); flex-shrink: 0; }
    .show-detail-info { flex: 1; padding-top: 60px; }
    .show-detail-title { font-size: 22px; font-weight: 700; line-height: 1.2; margin-bottom: 4px; }
    .show-detail-meta { font-size: 13px; color: var(--text-secondary); margin-bottom: 8px; }
    .show-detail-meta span { margin-right: 8px; }
    .show-detail-director { font-size: 13px; color: var(--text-tertiary); }
    .show-detail-director a { color: var(--brand-blue); }
    
    .show-detail-actions { display: flex; gap: 12px; padding: 16px; }
    .show-detail-action { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 4px; padding: 12px 8px; background: var(--bg-card); border-radius: 10px; cursor: pointer; transition: background 0.2s; }
    .show-detail-action:hover { background: var(--bg-elevated); }
    .show-detail-action.active { color: var(--brand-green); }
    .show-detail-action.liked { color: var(--brand-orange); }
    .show-detail-action-label { font-size: 11px; color: var(--text-secondary); }
    .show-detail-action.active .show-detail-action-label { color: var(--brand-green); }
    .show-detail-action.liked .show-detail-action-label { color: var(--brand-orange); }
    
    .show-detail-rating-section { padding: 16px; background: var(--bg-card); margin: 0 16px; border-radius: 12px; }
    .show-detail-rating-row { display: flex; justify-content: center; align-items: center; gap: 8px; margin-bottom: 12px; }
    .show-detail-rating-label { font-size: 12px; color: var(--text-tertiary); text-align: center; }
    
    .show-detail-community { display: flex; justify-content: space-around; padding: 20px 16px; border-bottom: 1px solid var(--divider); }
    .show-detail-stat { text-align: center; }
    .show-detail-stat-value { font-size: 18px; font-weight: 700; color: var(--brand-green); }
    .show-detail-stat-label { font-size: 11px; color: var(--text-tertiary); margin-top: 2px; text-transform: uppercase; }
    
    .show-detail-histogram { padding: 16px; }
    .show-detail-histogram-title { font-size: 12px; font-weight: 600; color: var(--text-tertiary); text-transform: uppercase; margin-bottom: 12px; }
    .show-detail-histogram-bars { display: flex; align-items: flex-end; gap: 3px; height: 50px; }
    .show-detail-histogram-bar { flex: 1; background: var(--brand-green); border-radius: 2px 2px 0 0; min-height: 2px; opacity: 0.7; }
    .show-detail-histogram-bar.active { opacity: 1; }
    .show-detail-histogram-labels { display: flex; justify-content: space-between; padding-top: 6px; }
    .show-detail-histogram-label { font-size: 9px; color: var(--text-muted); }
    
    .show-detail-section { padding: 16px; }
    .show-detail-section-title { font-size: 12px; font-weight: 700; color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px; }
    
    .show-detail-synopsis { font-size: 14px; line-height: 1.6; color: var(--text-secondary); }
    .show-detail-synopsis-more { color: var(--brand-blue); cursor: pointer; }
    
    .show-detail-cast-scroll { display: flex; gap: 12px; overflow-x: auto; padding-bottom: 8px; -webkit-overflow-scrolling: touch; }
    .show-detail-cast-scroll::-webkit-scrollbar { display: none; }
    .show-detail-cast-item { flex-shrink: 0; width: 70px; text-align: center; cursor: pointer; transition: transform 0.2s; }
    .show-detail-cast-item:active { transform: scale(0.95); }
    .show-detail-cast-photo { width: 70px; height: 70px; border-radius: 50%; object-fit: cover; background: var(--bg-elevated); }
    .show-detail-cast-name { font-size: 11px; font-weight: 600; margin-top: 6px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: var(--brand-blue); }
    .show-detail-cast-role { font-size: 10px; color: var(--text-tertiary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    
    .show-detail-info-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
    .show-detail-info-item { }
    .show-detail-info-label { font-size: 10px; color: var(--text-tertiary); text-transform: uppercase; margin-bottom: 2px; }
    .show-detail-info-value { font-size: 13px; color: var(--text-primary); }
    
    .show-detail-streaming { display: flex; flex-wrap: wrap; gap: 8px; }
    .show-detail-streaming-item { display: flex; align-items: center; gap: 8px; padding: 10px 14px; background: var(--bg-card); border-radius: 8px; }
    .show-detail-streaming-icon { width: 28px; height: 28px; border-radius: 6px; background: var(--bg-elevated); display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 700; }
    .show-detail-streaming-icon.netflix { background: #E50914; }
    .show-detail-streaming-icon.hulu { background: #1CE783; color: #000; }
    .show-detail-streaming-icon.max { background: #002BE7; }
    .show-detail-streaming-icon.disney { background: #113CCF; }
    .show-detail-streaming-icon.apple { background: #000; }
    .show-detail-streaming-icon.amazon { background: #00A8E1; }
    .show-detail-streaming-icon.peacock { background: #000; }
    .show-detail-streaming-icon.paramount { background: #0064FF; }
    .show-detail-streaming-name { font-size: 13px; font-weight: 500; }
    .show-detail-streaming-type { font-size: 11px; color: var(--text-tertiary); }
    
    .show-detail-similar { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 8px; }
    .show-detail-similar::-webkit-scrollbar { display: none; }
    .show-detail-similar-item { flex-shrink: 0; width: 100px; cursor: pointer; }
    .show-detail-similar-poster { width: 100px; height: 150px; border-radius: 6px; object-fit: cover; }
    .show-detail-similar-title { font-size: 11px; margin-top: 6px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    
    .show-detail-reviews { display: flex; flex-direction: column; gap: 12px; }
    .show-detail-review-card { background: var(--bg-card); border-radius: 10px; padding: 14px; }
    .show-detail-review-header { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
    .show-detail-review-user { font-size: 13px; font-weight: 600; }
    .show-detail-review-text { font-size: 13px; line-height: 1.5; color: var(--text-secondary); display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
    
    .show-detail-trailer { position: relative; width: 100%; padding-top: 56.25%; background: var(--bg-elevated); border-radius: 10px; overflow: hidden; cursor: pointer; }
    .show-detail-trailer-play { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 60px; height: 60px; background: rgba(0,0,0,0.7); border-radius: 50%; display: flex; align-items: center; justify-content: center; }
    .show-detail-trailer-thumb { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; }
    
    /* CATEGORY 6: SEARCH & DISCOVERY */
    .search-container { padding: 0 16px; }
    .search-input-wrapper { display: flex; align-items: center; gap: 10px; background: var(--bg-card); border-radius: 10px; padding: 12px 14px; margin-bottom: 16px; position: sticky; top: 60px; z-index: 5; }
    .search-input-wrapper input { flex: 1; background: none; border: none; color: var(--text-primary); font-size: 15px; outline: none; }
    .search-input-wrapper input::placeholder { color: var(--text-tertiary); }
    .search-clear { background: none; border: none; color: var(--text-tertiary); cursor: pointer; padding: 4px; display: flex; align-items: center; justify-content: center; }
    
    .search-tabs { display: flex; gap: 0; margin-bottom: 16px; background: var(--bg-card); border-radius: 8px; padding: 4px; }
    .search-tab { flex: 1; padding: 8px 12px; font-size: 13px; font-weight: 500; color: var(--text-tertiary); background: none; border: none; border-radius: 6px; cursor: pointer; transition: all 0.2s; }
    .search-tab.active { background: var(--bg-elevated); color: var(--text-primary); }
    
    .search-results { display: flex; flex-direction: column; gap: 8px; }
    .search-result-item { display: flex; align-items: center; gap: 12px; padding: 12px; background: var(--bg-card); border-radius: 8px; cursor: pointer; }
    .search-result-item:hover { background: var(--bg-elevated); }
    .search-result-poster { width: 45px; height: 68px; border-radius: 4px; object-fit: cover; background: var(--bg-elevated); }
    .search-result-avatar { width: 45px; height: 45px; border-radius: 50%; background: var(--bg-elevated); display: flex; align-items: center; justify-content: center; font-weight: 600; color: var(--text-secondary); }
    .search-result-info { flex: 1; min-width: 0; }
    .search-result-title { font-size: 15px; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .search-result-title mark { background: var(--brand-green); color: #000; padding: 0 2px; border-radius: 2px; }
    .search-result-meta { font-size: 13px; color: var(--text-tertiary); margin-top: 2px; }
    .search-result-rating { display: flex; align-items: center; gap: 4px; }
    
    .recent-searches { margin-bottom: 24px; }
    .recent-searches-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
    .recent-searches-title { font-size: 12px; font-weight: 600; color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 1px; }
    .recent-searches-clear { font-size: 12px; color: var(--brand-blue); background: none; border: none; cursor: pointer; }
    .recent-search-item { display: flex; align-items: center; gap: 10px; padding: 10px 0; border-bottom: 1px solid var(--divider); cursor: pointer; }
    .recent-search-item:last-child { border-bottom: none; }
    .recent-search-icon { color: var(--text-tertiary); }
    .recent-search-text { flex: 1; font-size: 14px; }
    .recent-search-remove { color: var(--text-muted); background: none; border: none; cursor: pointer; padding: 4px; }
    
    .browse-page { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: var(--bg-primary); z-index: 800; overflow-y: auto; }
    .browse-header { display: flex; align-items: center; gap: 12px; padding: 16px; border-bottom: 1px solid var(--divider); position: sticky; top: 0; background: var(--bg-primary); z-index: 10; }
    .browse-back { background: none; border: none; color: var(--text-primary); cursor: pointer; padding: 4px; margin: -4px; }
    .browse-header-title { font-size: 18px; font-weight: 600; flex: 1; }
    
    .filter-chips { display: flex; gap: 8px; padding: 12px 16px; overflow-x: auto; -webkit-overflow-scrolling: touch; position: relative; }
    .filter-chips::-webkit-scrollbar { display: none; }
    .filter-chips::after { content: ''; position: sticky; right: 0; width: 40px; background: linear-gradient(to right, transparent, var(--bg-primary)); flex-shrink: 0; }
    .filter-chip { flex-shrink: 0; padding: 8px 16px; background: var(--bg-card); border-radius: 20px; font-size: 13px; color: var(--text-secondary); cursor: pointer; border: 1px solid transparent; transition: all 0.2s; white-space: nowrap; }
    .filter-chip.active { background: var(--brand-green); color: #000; border-color: var(--brand-green); font-weight: 500; }
    .filter-chip:hover:not(.active) { border-color: var(--text-muted); }
    
    .sort-bar { display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; }
    .sort-count { font-size: 13px; color: var(--text-tertiary); }
    .sort-options { display: flex; gap: 8px; }
    .sort-btn { background: none; border: none; color: var(--text-tertiary); cursor: pointer; padding: 6px; border-radius: 4px; }
    .sort-btn.active { color: var(--brand-green); background: var(--bg-card); }
    
    .browse-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 0 16px 100px; }
    .browse-grid-item { cursor: pointer; }
    .browse-grid-poster { width: 100%; aspect-ratio: 2/3; border-radius: 6px; object-fit: cover; background: var(--bg-elevated); }
    .browse-grid-title { font-size: 11px; margin-top: 6px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .browse-grid-rating { font-size: 10px; color: var(--text-tertiary); display: flex; align-items: center; gap: 4px; margin-top: 2px; }
    
    .genre-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; padding: 16px; }
    .genre-card { background: linear-gradient(135deg, var(--bg-card) 0%, var(--bg-elevated) 100%); border-radius: 12px; padding: 20px 16px; cursor: pointer; transition: transform 0.2s; }
    .genre-card:hover { transform: scale(1.02); }
    .genre-card-icon { font-size: 28px; margin-bottom: 8px; }
    .genre-card-name { font-size: 15px; font-weight: 600; }
    .genre-card-count { font-size: 12px; color: var(--text-tertiary); margin-top: 4px; }
    
    .service-list { padding: 16px; display: flex; flex-direction: column; gap: 8px; }
    .service-item { display: flex; align-items: center; gap: 12px; padding: 14px; background: var(--bg-card); border-radius: 10px; cursor: pointer; }
    .service-item:hover { background: var(--bg-elevated); }
    .service-icon { width: 40px; height: 40px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 16px; font-weight: 700; }
    .service-name { flex: 1; font-size: 15px; font-weight: 500; }
    .service-count { font-size: 13px; color: var(--text-tertiary); }
    
    .decade-list { padding: 16px; display: flex; flex-direction: column; gap: 8px; }
    .decade-item { display: flex; align-items: center; justify-content: space-between; padding: 16px; background: var(--bg-card); border-radius: 10px; cursor: pointer; }
    .decade-item:hover { background: var(--bg-elevated); }
    .decade-name { font-size: 18px; font-weight: 600; }
    .decade-count { font-size: 13px; color: var(--text-tertiary); }
    
    .load-more { display: flex; justify-content: center; padding: 20px; }
    .load-more-btn { padding: 12px 32px; background: var(--bg-card); border: 1px solid var(--divider); border-radius: 8px; color: var(--text-secondary); font-size: 14px; cursor: pointer; }
    .load-more-btn:hover { background: var(--bg-elevated); }
    
    .no-results { text-align: center; padding: 60px 32px; }
    .no-results-icon { font-size: 48px; margin-bottom: 16px; opacity: 0.5; }
    .no-results-title { font-size: 18px; font-weight: 600; color: var(--text-secondary); margin-bottom: 8px; }
    .no-results-text { font-size: 14px; color: var(--text-tertiary); }
    
    /* CATEGORY 7: SETTINGS & ACCOUNT */
    .settings-page { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: var(--bg-primary); z-index: 900; overflow-y: auto; -webkit-overflow-scrolling: touch; padding-bottom: env(safe-area-inset-bottom); }
    .settings-header { display: flex; align-items: center; gap: 12px; padding: 16px; border-bottom: 1px solid var(--divider); position: sticky; top: 0; background: var(--bg-primary); z-index: 10; }
    .settings-back { background: none; border: none; color: var(--text-primary); cursor: pointer; padding: 4px; margin: -4px; display: flex; align-items: center; justify-content: center; }
    .settings-header-title { font-size: 18px; font-weight: 600; flex: 1; }
    
    .settings-section { padding: 16px; border-bottom: 1px solid var(--divider); }
    .settings-section:last-child { border-bottom: none; }
    .settings-section-title { font-size: 12px; font-weight: 600; color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px; }
    
    .settings-row { display: flex; align-items: center; justify-content: space-between; padding: 14px 0; border-bottom: 1px solid var(--divider); cursor: pointer; }
    .settings-row:last-child { border-bottom: none; }
    .settings-row:hover { opacity: 0.8; }
    .settings-row-left { display: flex; align-items: center; gap: 12px; flex: 1; min-width: 0; }
    .settings-row-icon { width: 32px; height: 32px; border-radius: 8px; background: var(--bg-elevated); display: flex; align-items: center; justify-content: center; color: var(--text-secondary); flex-shrink: 0; }
    .settings-row-icon.green { background: rgba(0, 208, 124, 0.15); color: var(--brand-green); }
    .settings-row-icon.blue { background: rgba(64, 188, 244, 0.15); color: var(--brand-blue); }
    .settings-row-icon.orange { background: rgba(238, 124, 60, 0.15); color: var(--brand-orange); }
    .settings-row-icon.red { background: rgba(239, 68, 68, 0.15); color: #EF4444; }
    .settings-row-content { flex: 1; min-width: 0; }
    .settings-row-label { font-size: 15px; font-weight: 500; }
    .settings-row-sublabel { font-size: 13px; color: var(--text-tertiary); margin-top: 2px; }
    .settings-row-value { font-size: 14px; color: var(--text-tertiary); margin-right: 8px; max-width: 150px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .settings-row-chevron { color: var(--text-muted); flex-shrink: 0; display: flex; align-items: center; }
    
    .settings-toggle { width: 50px; height: 30px; border-radius: 15px; background: var(--bg-elevated); border: none; cursor: pointer; position: relative; transition: background 0.2s; flex-shrink: 0; }
    .settings-toggle.active { background: var(--brand-green); }
    .settings-toggle::after { content: ''; position: absolute; top: 3px; left: 3px; width: 24px; height: 24px; border-radius: 50%; background: white; transition: transform 0.2s; }
    .settings-toggle.active::after { transform: translateX(20px); }
    
    .settings-input-group { margin-bottom: 16px; }
    .settings-input-label { font-size: 12px; font-weight: 600; color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; display: block; }
    .settings-input { width: 100%; padding: 14px 16px; background: var(--bg-card); border: 1px solid var(--divider); border-radius: 10px; font-size: 15px; color: var(--text-primary); outline: none; transition: border-color 0.2s; }
    .settings-input:focus { border-color: var(--brand-green); }
    .settings-input::placeholder { color: var(--text-muted); }
    .settings-input-hint { font-size: 12px; color: var(--text-tertiary); margin-top: 6px; }
    
    .settings-textarea { width: 100%; padding: 14px 16px; background: var(--bg-card); border: 1px solid var(--divider); border-radius: 10px; font-size: 15px; color: var(--text-primary); outline: none; resize: none; min-height: 100px; font-family: inherit; }
    .settings-textarea:focus { border-color: var(--brand-green); }
    
    .settings-avatar-section { display: flex; align-items: center; gap: 16px; margin-bottom: 20px; }
    .settings-avatar-large { width: 80px; height: 80px; border-radius: 50%; background: var(--brand-green); display: flex; align-items: center; justify-content: center; font-size: 32px; font-weight: 700; color: #000; flex-shrink: 0; }
    .settings-avatar-buttons { display: flex; flex-direction: column; gap: 8px; }
    .settings-avatar-btn { padding: 10px 16px; background: var(--bg-card); border: 1px solid var(--divider); border-radius: 8px; font-size: 14px; color: var(--text-primary); cursor: pointer; }
    .settings-avatar-btn:hover { background: var(--bg-elevated); }
    .settings-avatar-btn.remove { color: #EF4444; border-color: rgba(239, 68, 68, 0.3); }
    
    .settings-plan-card { background: linear-gradient(135deg, var(--bg-card) 0%, var(--bg-elevated) 100%); border-radius: 16px; padding: 20px; margin-bottom: 16px; }
    .settings-plan-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; }
    .settings-plan-name { font-size: 20px; font-weight: 700; }
    .settings-plan-badge { padding: 4px 10px; background: var(--brand-green); color: #000; border-radius: 12px; font-size: 11px; font-weight: 700; text-transform: uppercase; }
    .settings-plan-badge.pro { background: var(--brand-blue); color: #fff; }
    .settings-plan-badge.patron { background: var(--brand-orange); color: #fff; }
    .settings-plan-price { font-size: 14px; color: var(--text-tertiary); margin-bottom: 16px; }
    .settings-plan-features { display: flex; flex-direction: column; gap: 8px; margin-bottom: 16px; }
    .settings-plan-feature { display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--text-secondary); }
    .settings-plan-feature-icon { color: var(--brand-green); }
    .settings-plan-btn { width: 100%; padding: 14px; background: var(--brand-green); color: #000; border: none; border-radius: 10px; font-size: 15px; font-weight: 600; cursor: pointer; }
    .settings-plan-btn:hover { opacity: 0.9; }
    .settings-plan-btn.secondary { background: var(--bg-card); color: var(--text-primary); border: 1px solid var(--divider); }
    
    .settings-services-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
    .settings-service-item { display: flex; align-items: center; gap: 10px; padding: 12px; background: var(--bg-card); border-radius: 10px; cursor: pointer; border: 2px solid transparent; transition: all 0.2s; }
    .settings-service-item.selected { border-color: var(--brand-green); background: rgba(0, 208, 124, 0.1); }
    .settings-service-icon { width: 32px; height: 32px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 700; }
    .settings-service-name { font-size: 13px; font-weight: 500; }
    .settings-service-check { margin-left: auto; color: var(--brand-green); opacity: 0; }
    .settings-service-item.selected .settings-service-check { opacity: 1; }
    
    .settings-danger-zone { background: rgba(239, 68, 68, 0.1); border-radius: 12px; padding: 16px; }
    .settings-danger-title { font-size: 14px; font-weight: 600; color: #EF4444; margin-bottom: 8px; }
    .settings-danger-text { font-size: 13px; color: var(--text-tertiary); margin-bottom: 12px; line-height: 1.5; }
    .settings-danger-btn { padding: 12px 20px; background: transparent; border: 1px solid #EF4444; border-radius: 8px; color: #EF4444; font-size: 14px; font-weight: 500; cursor: pointer; }
    .settings-danger-btn:hover { background: rgba(239, 68, 68, 0.1); }
    
    .settings-signout { width: 100%; padding: 16px; background: var(--bg-card); border: none; border-radius: 12px; font-size: 15px; font-weight: 500; color: #EF4444; cursor: pointer; margin-top: 8px; }
    .settings-signout:hover { background: var(--bg-elevated); }
    
    .settings-version { text-align: center; padding: 20px; color: var(--text-muted); font-size: 12px; }
    
    /* CATEGORY 8: SOCIAL INTERACTIONS */
    .review-actions { display: flex; align-items: center; gap: 16px; margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--divider); }
    .review-action { display: flex; align-items: center; gap: 6px; background: none; border: none; color: var(--text-tertiary); font-size: 13px; cursor: pointer; padding: 6px 0; transition: all 0.2s; }
    .review-action:hover { color: var(--text-secondary); }
    .review-action.liked { color: var(--brand-orange); }
    .review-action.liked svg { fill: var(--brand-orange); }
    .review-action-count { font-weight: 500; }
    
    .review-reactions { display: flex; gap: 4px; margin-top: 8px; }
    .review-reaction { padding: 4px 8px; background: var(--bg-elevated); border-radius: 12px; font-size: 12px; cursor: pointer; transition: all 0.2s; border: 1px solid transparent; display: flex; align-items: center; gap: 4px; }
    .review-reaction:hover { border-color: var(--text-muted); }
    .review-reaction.active { background: rgba(0, 208, 124, 0.15); border-color: var(--brand-green); }
    .review-reaction-emoji { font-size: 14px; }
    .review-reaction-count { font-size: 11px; color: var(--text-tertiary); }
    .add-reaction-btn { padding: 4px 8px; background: var(--bg-elevated); border-radius: 12px; font-size: 14px; cursor: pointer; border: 1px dashed var(--text-muted); color: var(--text-muted); }
    .add-reaction-btn:hover { border-color: var(--text-secondary); color: var(--text-secondary); }
    
    .reaction-picker { position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%); background: var(--bg-card); border-radius: 20px; padding: 8px 12px; display: flex; gap: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.3); z-index: 100; margin-bottom: 8px; }
    .reaction-picker-item { font-size: 20px; cursor: pointer; padding: 4px; border-radius: 8px; transition: all 0.15s; }
    .reaction-picker-item:hover { background: var(--bg-elevated); transform: scale(1.2); }
    .reaction-picker-backdrop { position: fixed; inset: 0; z-index: 99; }
    
    .comments-section { margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--divider); }
    .comments-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
    .comments-title { font-size: 13px; font-weight: 600; color: var(--text-tertiary); }
    .comments-toggle { font-size: 12px; color: var(--brand-blue); background: none; border: none; cursor: pointer; }
    
    .comment-item { display: flex; gap: 10px; margin-bottom: 12px; }
    .comment-item.reply { margin-left: 40px; }
    .comment-content { flex: 1; }
    .comment-header { display: flex; align-items: center; gap: 8px; margin-bottom: 4px; }
    .comment-username { font-size: 13px; font-weight: 600; }
    .comment-time { font-size: 11px; color: var(--text-muted); }
    .comment-text { font-size: 14px; line-height: 1.4; color: var(--text-secondary); }
    .comment-text .mention { color: var(--brand-blue); font-weight: 500; }
    .comment-actions { display: flex; gap: 12px; margin-top: 6px; }
    .comment-action { font-size: 12px; color: var(--text-muted); background: none; border: none; cursor: pointer; }
    .comment-action:hover { color: var(--text-secondary); }
    .comment-action.liked { color: var(--brand-orange); }
    
    .comment-input-wrapper { display: flex; gap: 10px; margin-top: 12px; align-items: center; }
    .comment-input { flex: 1; background: var(--bg-elevated); border: 1px solid var(--divider); border-radius: 20px; padding: 10px 16px; font-size: 14px; color: var(--text-primary); outline: none; transition: border-color 0.2s; }
    .comment-input:focus { border-color: var(--brand-green); }
    .comment-input::placeholder { color: var(--text-muted); }
    .comment-submit { background: var(--brand-green); color: #000; border: none; border-radius: 50%; width: 36px; height: 36px; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
    .comment-submit:disabled { opacity: 0.5; cursor: not-allowed; }
    
    .reply-indicator { display: flex; align-items: center; gap: 8px; font-size: 12px; color: var(--text-muted); margin-top: 6px; margin-left: 44px; padding: 6px 10px; background: var(--bg-elevated); border-radius: 8px; width: fit-content; }
    .reply-indicator-cancel { background: none; border: none; color: var(--text-tertiary); cursor: pointer; padding: 2px 6px; border-radius: 4px; font-size: 12px; }
    .reply-indicator-cancel:hover { background: var(--bg-card); color: var(--text-secondary); }
    
    .share-menu { position: fixed; bottom: 0; left: 0; right: 0; background: var(--bg-action-sheet); border-radius: 16px 16px 0 0; padding: 16px; padding-bottom: max(16px, env(safe-area-inset-bottom)); z-index: 1000; animation: slideUp 0.3s ease-out; }
    .share-menu-header { text-align: center; font-size: 15px; font-weight: 600; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid var(--divider); }
    .share-options { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; }
    .share-option { display: flex; flex-direction: column; align-items: center; gap: 8px; background: none; border: none; cursor: pointer; color: var(--text-primary); }
    .share-option-icon { width: 56px; height: 56px; border-radius: 16px; display: flex; align-items: center; justify-content: center; font-size: 24px; }
    .share-option-icon.twitter { background: #000; color: #fff; }
    .share-option-icon.facebook { background: #1877F2; color: #fff; }
    .share-option-icon.copy { background: var(--bg-elevated); color: var(--text-primary); }
    .share-option-icon.more { background: var(--bg-elevated); color: var(--text-primary); }
    .share-option-label { font-size: 12px; color: var(--text-secondary); }
    
    .follow-btn { padding: 8px 20px; border-radius: 20px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
    .follow-btn.following { background: var(--bg-elevated); border: 1px solid var(--divider); color: var(--text-primary); }
    .follow-btn.not-following { background: var(--brand-green); border: 1px solid var(--brand-green); color: #000; }
    .follow-btn:hover { opacity: 0.9; }
    
    .user-actions-menu { position: absolute; top: 100%; right: 0; background: var(--bg-card); border-radius: 12px; padding: 8px 0; box-shadow: 0 4px 20px rgba(0,0,0,0.3); z-index: 101; min-width: 180px; }
    .user-actions-backdrop { position: fixed; inset: 0; z-index: 100; }
    .user-action-item { display: flex; align-items: center; gap: 12px; padding: 12px 16px; font-size: 14px; color: var(--text-primary); cursor: pointer; }
    .user-action-item:hover { background: var(--bg-elevated); }
    .user-action-item.danger { color: #EF4444; }
    .user-action-item svg { width: 18px; height: 18px; }
    
    .report-modal { padding: 20px; }
    .report-title { font-size: 18px; font-weight: 600; margin-bottom: 16px; }
    .report-options { display: flex; flex-direction: column; gap: 8px; }
    .report-option { display: flex; align-items: center; gap: 12px; padding: 14px; background: var(--bg-card); border-radius: 10px; cursor: pointer; border: 2px solid transparent; }
    .report-option:hover { border-color: var(--text-muted); }
    .report-option.selected { border-color: var(--brand-green); background: rgba(0, 208, 124, 0.1); }
    .report-option-radio { width: 20px; height: 20px; border-radius: 50%; border: 2px solid var(--text-muted); display: flex; align-items: center; justify-content: center; }
    .report-option.selected .report-option-radio { border-color: var(--brand-green); }
    .report-option.selected .report-option-radio::after { content: ''; width: 10px; height: 10px; border-radius: 50%; background: var(--brand-green); }
    .report-option-text { font-size: 14px; }
    .report-submit { width: 100%; margin-top: 16px; padding: 14px; background: var(--brand-green); color: #000; border: none; border-radius: 10px; font-size: 15px; font-weight: 600; cursor: pointer; }
    .report-submit:disabled { opacity: 0.5; cursor: not-allowed; }
    
    /* CATEGORY 10: ADVANCED FEATURES */
    
    /* Skeleton Loading */
    .skeleton { background: linear-gradient(90deg, var(--bg-card) 25%, var(--bg-elevated) 50%, var(--bg-card) 75%); background-size: 200% 100%; animation: skeleton-shimmer 1.5s infinite; border-radius: 8px; }
    @keyframes skeleton-shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
    .skeleton-poster { width: 100%; aspect-ratio: 2/3; border-radius: 6px; }
    .skeleton-text { height: 14px; margin-bottom: 8px; }
    .skeleton-text.short { width: 60%; }
    .skeleton-text.medium { width: 80%; }
    .skeleton-avatar { width: 40px; height: 40px; border-radius: 50%; }
    .skeleton-card { padding: 16px; background: var(--bg-card); border-radius: 12px; margin-bottom: 12px; }
    
    /* Pull to Refresh */
    .pull-indicator { position: absolute; top: -50px; left: 50%; transform: translateX(-50%); display: flex; align-items: center; justify-content: center; width: 40px; height: 40px; border-radius: 50%; background: var(--bg-card); box-shadow: 0 2px 10px rgba(0,0,0,0.2); transition: top 0.2s, opacity 0.2s; opacity: 0; }
    .pull-indicator.visible { top: 10px; opacity: 1; }
    .pull-indicator.refreshing { animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: translateX(-50%) rotate(0deg); } 100% { transform: translateX(-50%) rotate(360deg); } }
    
    /* Offline Indicator */
    .offline-banner { position: fixed; top: 0; left: 0; right: 0; background: #EF4444; color: white; text-align: center; padding: 8px 16px; font-size: 13px; font-weight: 500; z-index: 9999; display: flex; align-items: center; justify-content: center; gap: 8px; }
    .offline-banner-icon { width: 16px; height: 16px; }
    
    /* Calendar View */
    .calendar-container { padding: 16px; }
    .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
    .calendar-title { font-size: 18px; font-weight: 600; }
    .calendar-nav { display: flex; gap: 8px; }
    .calendar-nav-btn { background: var(--bg-card); border: none; border-radius: 8px; padding: 8px 12px; color: var(--text-primary); cursor: pointer; }
    .calendar-nav-btn:hover { background: var(--bg-elevated); }
    .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; }
    .calendar-weekday { text-align: center; font-size: 11px; font-weight: 600; color: var(--text-muted); padding: 8px 0; text-transform: uppercase; }
    .calendar-day { aspect-ratio: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 8px; cursor: pointer; position: relative; background: var(--bg-card); }
    .calendar-day:hover { background: var(--bg-elevated); }
    .calendar-day.other-month { opacity: 0.3; }
    .calendar-day.today { border: 2px solid var(--brand-green); }
    .calendar-day.has-entry { background: rgba(0, 208, 124, 0.15); }
    .calendar-day-num { font-size: 14px; font-weight: 500; }
    .calendar-day-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--brand-green); margin-top: 2px; }
    .calendar-day-posters { display: flex; gap: 2px; margin-top: 4px; }
    .calendar-day-poster { width: 16px; height: 24px; border-radius: 2px; object-fit: cover; }
    
    /* Advanced Filters */
    .advanced-filters { padding: 16px; }
    .filter-section { margin-bottom: 24px; }
    .filter-section-title { font-size: 14px; font-weight: 600; color: var(--text-secondary); margin-bottom: 12px; }
    .filter-chips-wrap { display: flex; flex-wrap: wrap; gap: 8px; }
    .filter-chip-multi { padding: 8px 14px; background: var(--bg-card); border: 1px solid var(--divider); border-radius: 20px; font-size: 13px; cursor: pointer; transition: all 0.2s; }
    .filter-chip-multi.selected { background: var(--brand-green); border-color: var(--brand-green); color: #000; }
    .filter-range { display: flex; align-items: center; gap: 12px; }
    .filter-range-input { flex: 1; padding: 12px; background: var(--bg-card); border: 1px solid var(--divider); border-radius: 8px; font-size: 14px; color: var(--text-primary); text-align: center; }
    .filter-range-sep { color: var(--text-muted); }
    .filter-slider { width: 100%; margin: 8px 0; accent-color: var(--brand-green); }
    .filter-rating-row { display: flex; justify-content: space-between; margin-top: 8px; }
    .filter-rating-label { font-size: 12px; color: var(--text-muted); }
    
    /* Import/Export */
    .import-export-section { padding: 16px; }
    .import-card { background: var(--bg-card); border-radius: 12px; padding: 20px; margin-bottom: 16px; border: 2px dashed var(--divider); text-align: center; cursor: pointer; transition: all 0.2s; }
    .import-card:hover { border-color: var(--brand-green); background: rgba(0, 208, 124, 0.05); }
    .import-card-icon { font-size: 32px; margin-bottom: 12px; }
    .import-card-title { font-size: 16px; font-weight: 600; margin-bottom: 4px; }
    .import-card-desc { font-size: 13px; color: var(--text-tertiary); }
    .export-btn { width: 100%; padding: 14px; background: var(--brand-green); color: #000; border: none; border-radius: 10px; font-size: 15px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; }
    .export-btn:hover { opacity: 0.9; }
    .export-btn.secondary { background: var(--bg-card); color: var(--text-primary); border: 1px solid var(--divider); }
    .import-progress { margin-top: 16px; }
    .import-progress-bar { height: 4px; background: var(--bg-elevated); border-radius: 2px; overflow: hidden; }
    .import-progress-fill { height: 100%; background: var(--brand-green); transition: width 0.3s; }
    .import-progress-text { font-size: 12px; color: var(--text-tertiary); margin-top: 8px; text-align: center; }
    
    /* Watchlist Sorting */
    .watchlist-sort-bar { display: flex; align-items: center; justify-content: space-between; padding: 12px 16px; background: var(--bg-card); margin-bottom: 12px; border-radius: 8px; }
    .watchlist-sort-label { font-size: 13px; color: var(--text-tertiary); }
    .watchlist-sort-select { background: var(--bg-elevated); border: none; border-radius: 6px; padding: 8px 12px; font-size: 13px; color: var(--text-primary); cursor: pointer; }
    .watchlist-item-priority { display: flex; align-items: center; gap: 4px; }
    .priority-badge { padding: 2px 8px; border-radius: 10px; font-size: 10px; font-weight: 600; text-transform: uppercase; }
    .priority-badge.high { background: rgba(239, 68, 68, 0.15); color: #EF4444; }
    .priority-badge.medium { background: rgba(245, 158, 11, 0.15); color: #F59E0B; }
    .priority-badge.low { background: rgba(107, 114, 128, 0.15); color: #6B7280; }
    
    /* Onboarding */
    .onboarding-overlay { position: fixed; inset: 0; background: var(--bg-primary); z-index: 9999; display: flex; flex-direction: column; padding-top: max(20px, env(safe-area-inset-top)); }
    .onboarding-slide { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 40px 32px; text-align: center; }
    .onboarding-image { width: 200px; height: 200px; margin-bottom: 32px; display: flex; align-items: center; justify-content: center; font-size: 100px; }
    .onboarding-title { font-size: 28px; font-weight: 700; margin-bottom: 16px; }
    .onboarding-desc { font-size: 16px; color: var(--text-secondary); line-height: 1.6; max-width: 300px; }
    .onboarding-dots { display: flex; gap: 8px; justify-content: center; margin-bottom: 24px; }
    .onboarding-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--bg-elevated); }
    .onboarding-dot.active { background: var(--brand-green); width: 24px; border-radius: 4px; }
    .onboarding-actions { padding: 24px 32px; padding-bottom: max(24px, env(safe-area-inset-bottom)); }
    .onboarding-btn { width: 100%; padding: 16px; background: var(--brand-green); color: #000; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; }
    .onboarding-skip { width: 100%; padding: 12px; background: none; border: none; color: var(--text-tertiary); font-size: 14px; cursor: pointer; margin-top: 12px; }
    
    /* Keyboard Shortcuts Modal */
    .shortcuts-modal { padding: 20px; }
    .shortcuts-title { font-size: 18px; font-weight: 600; margin-bottom: 16px; }
    .shortcut-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--divider); }
    .shortcut-row:last-child { border-bottom: none; }
    .shortcut-desc { font-size: 14px; color: var(--text-secondary); }
    .shortcut-keys { display: flex; gap: 4px; }
    .shortcut-key { padding: 4px 8px; background: var(--bg-elevated); border-radius: 4px; font-size: 12px; font-weight: 600; font-family: monospace; }
    
    /* CAST & CREW PAGES */
    .person-page { position: fixed; inset: 0; background: var(--bg-primary); z-index: 1100; overflow-y: auto; }
    .person-header { position: relative; padding-top: max(20px, env(safe-area-inset-top)); }
    .person-header-bg { position: absolute; top: 0; left: 0; right: 0; height: 200px; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); }
    .person-header-content { position: relative; z-index: 1; padding: 16px; display: flex; flex-direction: column; align-items: center; }
    .person-back { position: fixed; top: max(16px, env(safe-area-inset-top)); left: 16px; background: rgba(0,0,0,0.6); border: none; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; color: white; cursor: pointer; z-index: 1200; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); }
    .person-photo { width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 3px solid var(--bg-primary); box-shadow: 0 4px 20px rgba(0,0,0,0.4); margin-top: 20px; background: var(--bg-card); }
    .person-photo-placeholder { width: 120px; height: 120px; border-radius: 50%; background: var(--bg-card); border: 3px solid var(--bg-primary); display: flex; align-items: center; justify-content: center; font-size: 48px; color: var(--text-muted); margin-top: 20px; }
    .person-name { font-size: 24px; font-weight: 700; margin-top: 16px; text-align: center; }
    .person-role { font-size: 14px; color: var(--text-secondary); margin-top: 4px; }
    .person-stats { display: flex; gap: 24px; margin-top: 16px; }
    .person-stat { text-align: center; }
    .person-stat-value { font-size: 20px; font-weight: 700; color: var(--brand-green); }
    .person-stat-label { font-size: 12px; color: var(--text-tertiary); margin-top: 2px; }
    .person-actions { display: flex; gap: 12px; margin-top: 20px; width: 100%; max-width: 300px; }
    .person-follow-btn { flex: 1; padding: 12px; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 6px; transition: all 0.2s; }
    .person-follow-btn.following { background: var(--brand-green); color: #000; border: none; }
    .person-follow-btn.not-following { background: transparent; color: var(--brand-green); border: 1px solid var(--brand-green); }
    .person-links { display: flex; gap: 12px; margin-top: 16px; }
    .person-link { padding: 8px 16px; background: var(--bg-card); border-radius: 20px; font-size: 12px; color: var(--text-secondary); text-decoration: none; display: flex; align-items: center; gap: 6px; transition: all 0.2s; }
    .person-link:hover { background: var(--bg-elevated); }
    .person-link.imdb { border: 1px solid #F5C518; }
    .person-link.imdb .person-link-icon { color: #F5C518; }
    .person-link.tmdb { border: 1px solid #01b4e4; }
    .person-link.tmdb .person-link-icon { color: #01b4e4; }
    .person-link-icon { font-weight: 700; }
    
    .person-content { padding: 16px; }
    .person-section-title { font-size: 16px; font-weight: 600; margin-bottom: 16px; display: flex; align-items: center; justify-content: space-between; }
    .person-filter-bar { display: flex; gap: 8px; margin-bottom: 16px; overflow-x: auto; padding-bottom: 8px; }
    .person-filter-chip { padding: 8px 14px; background: var(--bg-card); border: 1px solid var(--divider); border-radius: 20px; font-size: 13px; cursor: pointer; white-space: nowrap; transition: all 0.2s; color: var(--text-primary); }
    .person-filter-chip.active { background: var(--brand-green); border-color: var(--brand-green); color: #000; font-weight: 600; }
    .person-sort-select { background: var(--bg-card); border: 1px solid var(--divider); border-radius: 8px; padding: 8px 12px; font-size: 13px; color: var(--text-primary); cursor: pointer; }
    
    .filmography-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; padding-bottom: max(24px, env(safe-area-inset-bottom)); }
    .filmography-item { position: relative; cursor: pointer; transition: transform 0.2s; }
    .filmography-item:active { transform: scale(0.95); }
    .filmography-poster { width: 100%; aspect-ratio: 2/3; border-radius: 6px; object-fit: cover; background: var(--bg-card); }
    .filmography-rating { position: absolute; top: 4px; left: 4px; background: rgba(0,0,0,0.85); padding: 3px 6px; border-radius: 4px; font-size: 11px; display: flex; align-items: center; gap: 3px; }
    .filmography-rating svg { color: var(--brand-green); }
    .filmography-year { position: absolute; top: 4px; right: 4px; background: rgba(0,0,0,0.85); padding: 3px 6px; border-radius: 4px; font-size: 10px; color: var(--text-secondary); }
    .filmography-role { position: absolute; bottom: 28px; right: 4px; background: var(--brand-blue); padding: 2px 6px; border-radius: 4px; font-size: 9px; color: #fff; font-weight: 600; }
    .filmography-title { font-size: 11px; font-weight: 500; margin-top: 6px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: center; }
    .filmography-character { font-size: 10px; color: var(--text-tertiary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: center; }
    .filmography-unwatched .filmography-poster { opacity: 0.5; }
    .filmography-actions { position: absolute; bottom: 30px; left: 4px; display: flex; gap: 4px; }
    .filmography-action-btn { width: 24px; height: 24px; border-radius: 50%; background: rgba(0,0,0,0.85); border: none; display: flex; align-items: center; justify-content: center; cursor: pointer; color: var(--text-secondary); transition: all 0.2s; }
    .filmography-action-btn:hover { background: var(--brand-green); color: #000; }
    .filmography-action-btn.active { color: var(--brand-green); }
    .filmography-action-btn.liked { color: var(--brand-orange); }
    
    .person-bio { font-size: 14px; color: var(--text-secondary); line-height: 1.6; margin-bottom: 20px; }
    .person-bio-toggle { color: var(--brand-blue); cursor: pointer; font-size: 13px; }
    
    .known-for-row { display: flex; gap: 12px; overflow-x: auto; padding-bottom: 8px; margin-bottom: 20px; scroll-snap-type: x mandatory; -webkit-overflow-scrolling: touch; }
    .known-for-row::-webkit-scrollbar { display: none; }
    .known-for-item { flex-shrink: 0; width: 100px; text-align: center; cursor: pointer; scroll-snap-align: start; transition: transform 0.2s; }
    .known-for-item:active { transform: scale(0.95); }
    .known-for-poster { width: 100px; height: 150px; border-radius: 6px; object-fit: cover; margin-bottom: 8px; background: var(--bg-card); }
    .known-for-title { font-size: 12px; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .known-for-role { font-size: 10px; color: var(--text-tertiary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-top: 2px; }
    
    /* CHAT */
    .chat-container { display: flex; flex-direction: column; height: 100%; }
    .chat-messages { flex: 1; overflow-y: auto; padding: 16px; }
    .chat-message { display: flex; gap: 10px; margin-bottom: 16px; }
    .chat-message.own { flex-direction: row-reverse; }
    .chat-bubble { background: var(--bg-card); padding: 10px 14px; border-radius: 16px; border-top-left-radius: 4px; max-width: 75%; }
    .chat-bubble.own { background: var(--brand-green); color: #000; border-top-left-radius: 16px; border-top-right-radius: 4px; }
    .chat-username { font-size: 12px; font-weight: 600; margin-bottom: 4px; color: var(--brand-blue); }
    .chat-text { font-size: 15px; line-height: 1.4; }
    .chat-time { font-size: 11px; opacity: 0.7; margin-top: 4px; }
    .chat-input-area { display: flex; gap: 12px; padding: 12px 16px; background: var(--bg-tab-bar); border-top: 1px solid var(--divider); }
    .chat-input { flex: 1; background: var(--bg-card); border: none; border-radius: 20px; padding: 10px 16px; font-size: 15px; color: var(--text-primary); outline: none; }
    .chat-input::placeholder { color: var(--text-tertiary); }
    .chat-send { width: 40px; height: 40px; border-radius: 50%; background: var(--brand-green); border: none; color: #000; cursor: pointer; display: flex; align-items: center; justify-content: center; }
    
    /* EMPTY STATE - PIXEL PERFECT */
    .empty-state { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 80px 32px; text-align: center; min-height: 400px; }
    .empty-title { font-size: 24px; font-weight: 400; color: #667788; margin-bottom: 12px; }
    .empty-quote { font-size: 15px; color: #556677; font-style: normal; font-weight: 500; max-width: 320px; line-height: 1.5; }
    
    /* BOTTOM NAV - PIXEL PERFECT */
    .bottom-nav { display: flex; background: var(--bg-tab-bar); padding: 8px 0; padding-bottom: max(20px, env(safe-area-inset-bottom)); }
    .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 4px; padding: 8px; background: none; border: none; cursor: pointer; color: var(--text-secondary); transition: color 0.2s; }
    .nav-item:active { opacity: 0.7; }
    .nav-item.active { color: var(--brand-blue); }
    .nav-item svg { width: 24px; height: 24px; }
    .nav-add { flex: 1; display: flex; align-items: center; justify-content: center; }
    .nav-add-btn { width: 28px; height: 28px; border-radius: 50%; border: 2px solid var(--brand-green); background: transparent; color: var(--brand-green); display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s; }
    .nav-add-btn:active { background: var(--brand-green); color: #000; transform: scale(0.95); }
    .nav-add-btn svg { width: 16px; height: 16px; }
    
    /* MODALS - PIXEL PERFECT */
    .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 900; animation: fadeIn 0.2s ease-out; -webkit-backdrop-filter: blur(4px); backdrop-filter: blur(4px); }
    .bottom-sheet { position: fixed; bottom: 0; left: 0; right: 0; max-width: 430px; margin: 0 auto; background: rgba(68,85,102,0.92); -webkit-backdrop-filter: blur(40px); backdrop-filter: blur(40px); border-radius: 16px 16px 0 0; z-index: 1000; max-height: 90vh; overflow-y: auto; animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
    .sheet-handle { width: 36px; height: 5px; background: rgba(255,255,255,0.3); border-radius: 2.5px; margin: 12px auto; }
    .sheet-header { display: flex; align-items: center; justify-content: space-between; padding: 12px 16px; border-bottom: 1px solid rgba(255,255,255,0.1); }
    .sheet-cancel { font-size: 15px; color: var(--text-secondary); background: none; border: none; cursor: pointer; padding: 8px; margin: -8px; }
    .sheet-title { font-size: 17px; font-weight: 600; }
    .sheet-save { font-size: 15px; font-weight: 600; color: var(--brand-green); background: none; border: none; cursor: pointer; padding: 8px; margin: -8px; }
    .sheet-save:disabled { color: var(--text-muted); }
    
    /* ACTION SHEET - PIXEL PERFECT */
    .action-sheet-content { padding: 20px 24px; }
    .action-poster-section { text-align: center; padding-bottom: 20px; margin-bottom: 16px; border-bottom: 1px solid var(--divider); }
    .action-poster { width: 140px; height: 210px; border-radius: 6px; object-fit: cover; margin: 0 auto 12px; display: block; box-shadow: 0 8px 24px rgba(0,0,0,0.4); }
    .action-show-title { font-size: 17px; font-weight: 600; color: var(--text-primary); margin-top: 12px; }
    .action-show-year { font-size: 14px; color: var(--text-tertiary); margin-top: 4px; }
    .action-row { display: flex; justify-content: space-around; padding: 16px 0; gap: 32px; }
    .action-btn { display: flex; flex-direction: column; align-items: center; gap: 6px; background: none; border: none; cursor: pointer; color: var(--text-secondary); padding: 8px; transition: transform 0.1s; }
    .action-btn:active { transform: scale(0.9); }
    .action-btn.active { color: var(--brand-green); }
    .action-btn.liked { color: var(--brand-orange); }
    .action-btn svg { width: 28px; height: 28px; }
    .action-label { font-size: 11px; font-weight: 500; color: var(--text-primary); }
    .action-divider { height: 1px; background: var(--divider); margin: 8px 0; }
    .rating-section { text-align: center; padding: 16px 0; }
    .rating-label { font-size: 14px; color: var(--text-secondary); margin-bottom: 12px; }
    .star-btn.half { color: var(--brand-green); opacity: 0.6; }
    .star-container { margin: 0 -1px; }
    .menu-item { padding: 14px 0; text-align: center; font-size: 16px; color: var(--text-secondary); border-bottom: 1px solid rgba(85,102,119,0.5); cursor: pointer; }
    .menu-item:active { background: var(--bg-input); }
    .menu-item:last-child { border-bottom: none; }
    .menu-item.disabled { color: var(--text-muted); }
    
    /* DATE PICKER - NEW 1.1 */
    .date-picker-section { margin: 16px 0; padding: 16px; background: var(--bg-input); border-radius: 12px; }
    .date-picker-label { font-size: 12px; font-weight: 600; color: var(--text-tertiary); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px; }
    .date-picker-row { display: flex; gap: 8px; }
    .date-picker-input { flex: 1; background: var(--bg-card); border: none; border-radius: 8px; padding: 12px; color: var(--text-primary); font-size: 15px; text-align: center; cursor: pointer; color-scheme: dark; }
    .date-today-btn { background: var(--brand-green); color: #000; border: none; border-radius: 8px; padding: 12px 16px; font-size: 13px; font-weight: 600; cursor: pointer; white-space: nowrap; }
    
    /* REWATCH SECTION - NEW 1.1 */
    .rewatch-section { display: flex; align-items: center; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--divider); }
    .rewatch-label { font-size: 14px; display: flex; align-items: center; gap: 8px; }
    .rewatch-count { font-size: 12px; color: var(--text-tertiary); }
    
    /* DRAFT BADGE - NEW 1.1 */
    .diary-draft-badge { font-size: 10px; font-weight: 600; background: var(--brand-orange); color: #000; padding: 2px 6px; border-radius: 4px; margin-left: 8px; }
    
    /* IMPORT/EXPORT - NEW 1.1 */
    .import-export-section { padding: 16px; }
    .import-export-title { font-size: 18px; font-weight: 700; margin-bottom: 16px; }
    .import-option { display: flex; align-items: center; gap: 16px; padding: 16px; background: var(--bg-card); border-radius: 12px; margin-bottom: 12px; cursor: pointer; }
    .import-option:active { opacity: 0.8; }
    .import-icon { width: 48px; height: 48px; background: var(--bg-input); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; }
    .import-details { flex: 1; }
    .import-name { font-size: 15px; font-weight: 600; margin-bottom: 2px; }
    .import-desc { font-size: 13px; color: var(--text-tertiary); }
    
    /* REVIEW WRITING - NEW 1.2 */
    .review-write-section { padding: 16px; }
    .review-show-header { display: flex; gap: 12px; margin-bottom: 16px; align-items: center; }
    .review-show-poster { width: 60px; height: 90px; border-radius: 4px; object-fit: cover; }
    .review-show-info { flex: 1; }
    .review-show-title { font-size: 18px; font-weight: 700; margin-bottom: 2px; }
    .review-show-year { font-size: 14px; color: var(--text-tertiary); }
    .review-textarea { width: 100%; min-height: 150px; background: var(--bg-input); border: none; border-radius: 12px; padding: 16px; color: var(--text-primary); font-size: 15px; line-height: 1.6; resize: vertical; outline: none; font-family: var(--font-body); }
    .review-textarea::placeholder { color: var(--text-tertiary); }
    .review-textarea:focus { box-shadow: 0 0 0 2px var(--brand-green); }
    .review-options { margin-top: 16px; }
    .review-option-row { display: flex; align-items: center; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--divider); }
    .review-option-label { font-size: 14px; display: flex; align-items: center; gap: 8px; }
    .review-char-count { font-size: 12px; color: var(--text-tertiary); text-align: right; margin-top: 8px; }
    .review-format-bar { display: flex; gap: 8px; margin-bottom: 12px; }
    .format-btn { width: 36px; height: 36px; background: var(--bg-card); border: none; border-radius: 8px; color: var(--text-secondary); cursor: pointer; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 14px; }
    .format-btn:active { background: var(--bg-pill-active); }
    .format-btn.active { background: var(--brand-green); color: #000; }
    
    /* SPOILER BLUR */
    .review-spoiler-blur { filter: blur(8px); user-select: none; pointer-events: none; }
    .review-spoiler-overlay { position: relative; }
    .review-spoiler-badge { display: inline-flex; align-items: center; gap: 4px; background: var(--brand-orange); color: #000; font-size: 11px; font-weight: 600; padding: 2px 8px; border-radius: 4px; margin-left: 8px; }
    .spoiler-reveal-btn { background: var(--bg-card); border: 1px solid var(--divider); border-radius: 8px; padding: 12px 20px; color: var(--text-primary); font-size: 14px; cursor: pointer; margin-top: 8px; }
    
    /* USER REVIEWS LIST */
    .my-reviews-section { padding: 16px; }
    .my-review-card { background: var(--bg-card); border-radius: 12px; padding: 16px; margin-bottom: 12px; }
    .my-review-header { display: flex; gap: 12px; margin-bottom: 12px; }
    .my-review-info { flex: 1; }
    .my-review-title { font-size: 16px; font-weight: 600; }
    .my-review-meta { font-size: 12px; color: var(--text-tertiary); margin-top: 4px; }
    .my-review-text { font-size: 14px; color: var(--text-secondary); line-height: 1.5; }
    .my-review-actions { display: flex; gap: 16px; margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--divider); }
    .my-review-action { font-size: 13px; color: var(--brand-blue); cursor: pointer; display: flex; align-items: center; gap: 4px; }
    .my-review-action.delete { color: var(--brand-orange); }
    
    /* TAGS SYSTEM - NEW 1.3 */
    .tags-input-section { margin: 12px 0; padding: 0 0 12px 0; }
    .action-sheet-content .tags-input-section { margin: 16px 0; padding: 16px; background: var(--bg-input); border-radius: 12px; }
    .tags-input-label { font-size: 12px; font-weight: 600; color: var(--text-tertiary); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px; }
    .tags-input-wrapper { display: flex; flex-wrap: wrap; gap: 8px; padding: 12px; background: var(--bg-input); border-radius: 8px; min-height: 44px; align-items: center; }
    .tag-chip { display: inline-flex; align-items: center; gap: 4px; background: var(--bg-card); padding: 4px 10px; border-radius: 4px; font-size: 13px; color: var(--text-secondary); }
    .tag-chip.nested { background: var(--brand-blue); color: #000; }
    .tag-chip-remove { cursor: pointer; opacity: 0.6; font-size: 16px; line-height: 1; }
    .tag-chip-remove:hover { opacity: 1; }
    .tags-text-input { flex: 1; min-width: 100px; background: transparent; border: none; color: var(--text-primary); font-size: 14px; outline: none; }
    .tags-text-input::placeholder { color: var(--text-tertiary); }
    .tags-suggestions { margin-top: 8px; display: flex; flex-wrap: wrap; gap: 6px; }
    .tag-suggestion { background: var(--bg-card); padding: 6px 12px; border-radius: 4px; font-size: 12px; color: var(--text-secondary); cursor: pointer; border: 1px solid transparent; }
    .tag-suggestion:hover { border-color: var(--brand-green); }
    .tag-suggestion.popular { border-color: var(--brand-orange); }
    
    /* TAGS BROWSE/PROFILE */
    .tags-grid { display: flex; flex-wrap: wrap; gap: 8px; padding: 16px; }
    .tag-browse-chip { background: var(--bg-card); padding: 8px 16px; border-radius: 6px; font-size: 14px; color: var(--text-primary); cursor: pointer; display: flex; align-items: center; gap: 8px; }
    .tag-browse-chip:active { background: var(--bg-pill-active); }
    .tag-count { font-size: 12px; color: var(--text-tertiary); }
    .tags-section-title { font-size: 11px; font-weight: 600; color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 1px; padding: 16px 16px 8px; }
    
    /* TAG DETAIL VIEW */
    .tag-detail-header { padding: 20px 16px; background: var(--bg-card); margin-bottom: 16px; display: flex; justify-content: space-between; align-items: flex-start; }
    .tag-detail-name { font-size: 24px; font-weight: 700; margin-bottom: 4px; }
    .tag-detail-count { font-size: 14px; color: var(--text-tertiary); }
    .tag-detail-actions { display: flex; gap: 12px; margin-top: 12px; }
    .tag-action-btn { padding: 8px 16px; border-radius: 6px; font-size: 13px; background: var(--bg-input); border: none; color: var(--text-secondary); cursor: pointer; }
    .tag-action-btn:active { background: var(--bg-pill-active); }
    
    /* NEW LIST MODAL */
    .new-list-content { padding: 0 16px 16px; }
    .form-label { font-size: 11px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; display: block; padding-top: 16px; }
    .form-input { width: 100%; background: transparent; border: none; border-bottom: 1px solid var(--divider); padding: 12px 0; font-size: 15px; color: var(--text-primary); outline: none; }
    .form-input::placeholder { color: var(--text-tertiary); }
    .form-link { color: var(--brand-blue); font-size: 15px; padding: 20px 0; border-bottom: 1px solid var(--divider); display: block; }
    .form-tags { padding: 16px 0; font-size: 15px; color: var(--text-tertiary); border-bottom: 1px solid var(--divider); }
    .list-options { display: flex; justify-content: space-around; padding: 20px 0; }
    .list-option { display: flex; flex-direction: column; align-items: center; gap: 8px; color: var(--text-tertiary); }
    .list-option svg { width: 28px; height: 28px; }
    .list-option span { font-size: 12px; }
    
    /* FILTERS MODAL */
    .filters-content { padding: 0 16px 16px; }
    .filter-section-label { font-size: 11px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; padding: 20px 0 8px; }
    .filter-row { display: flex; align-items: center; justify-content: space-between; padding: 14px 0; border-bottom: 1px solid var(--divider); }
    .filter-label { font-size: 15px; color: var(--text-primary); }
    .filter-value { display: flex; align-items: center; gap: 6px; font-size: 15px; color: var(--text-tertiary); }
    .toggle { width: 51px; height: 31px; background: var(--bg-card); border-radius: 16px; position: relative; cursor: pointer; transition: background 0.2s; }
    .toggle.active { background: var(--brand-green); }
    .toggle-knob { position: absolute; top: 2px; left: 2px; width: 27px; height: 27px; background: white; border-radius: 50%; transition: transform 0.2s; }
    .toggle.active .toggle-knob { transform: translateX(20px); }
    
    /* LOGIN - AUDIT FIX: seamless button stack */
    .login-screen { display: flex; flex-direction: column; min-height: 100%; }
    .login-backdrop { flex: 1; background-size: cover; background-position: center; position: relative; }
    .login-backdrop::after { content: ''; position: absolute; inset: 0; background: linear-gradient(to bottom, rgba(20,24,28,0.3) 0%, rgba(20,24,28,0.95) 70%, var(--bg-primary) 100%); }
    .login-content { position: relative; z-index: 1; padding: 0 24px 32px; text-align: center; }
    .login-logo { display: flex; justify-content: center; gap: 0; margin-bottom: 20px; }
    .logo-circle { width: 48px; height: 48px; border-radius: 50%; margin: 0 -8px; }
    .logo-orange { background: var(--brand-orange); }
    .logo-green { background: var(--brand-green); }
    .logo-blue { background: var(--brand-blue); }
    .login-title { font-family: var(--font-display); font-size: 32px; font-weight: 700; letter-spacing: 0; margin-bottom: 0; }
    .login-tagline { font-size: 16px; color: var(--text-secondary); margin-bottom: 32px; display: none; }
    .login-buttons { border-radius: 0; overflow: hidden; border-top: 1px solid rgba(255,255,255,0.1); }
    .login-btn { width: 100%; padding: 16px; font-size: 17px; font-weight: 400; border: none; cursor: pointer; display: block; text-align: left; background: transparent; color: var(--text-primary); border-bottom: 1px solid rgba(255,255,255,0.08); }
    .login-btn:last-child { border-bottom: none; }
    .login-btn-primary { }
    .login-btn-divider { }
    .login-btn-ghost { color: var(--text-secondary); }
    .login-footer { font-size: 13px; color: var(--text-muted); margin-top: 24px; line-height: 1.5; }
    .carousel-dots { display: flex; justify-content: center; gap: 8px; padding: 20px 0; }
    .carousel-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--text-muted); }
    .carousel-dot.active { background: var(--text-primary); }
    
    /* ONBOARDING */
    .onboarding-screen { min-height: 100%; background: linear-gradient(to bottom, #2A3642 0%, var(--bg-primary) 60%); display: flex; flex-direction: column; }
    .onboarding-poster-row { display: flex; justify-content: center; align-items: center; gap: 8px; padding: 40px 0 20px; }
    .onboarding-poster { width: 100px; height: 150px; border-radius: 6px; object-fit: cover; opacity: 0.6; }
    .onboarding-poster.center { width: 140px; height: 210px; opacity: 1; box-shadow: 0 8px 32px rgba(0,0,0,0.5); }
    .onboarding-actions { display: flex; justify-content: center; gap: 24px; padding: 16px 0; }
    .onboarding-action { display: flex; flex-direction: column; align-items: center; gap: 4px; color: var(--text-tertiary); }
    .onboarding-action svg { width: 28px; height: 28px; }
    .onboarding-action span { font-size: 11px; }
    .onboarding-content { flex: 1; padding: 20px 24px; text-align: center; }
    .onboarding-title { font-size: 24px; font-weight: 700; margin-bottom: 16px; }
    .onboarding-desc { font-size: 15px; color: var(--text-secondary); line-height: 1.6; margin-bottom: 16px; }
    .onboarding-buttons { display: flex; gap: 0; margin-top: auto; padding: 16px 24px 32px; }
    .onboarding-btn { flex: 1; padding: 16px; font-size: 15px; font-weight: 600; border: none; cursor: pointer; }
    .onboarding-btn-skip { background: var(--bg-action-sheet); color: var(--text-primary); border-radius: 8px 0 0 8px; }
    .onboarding-btn-action { background: var(--brand-green); color: #000; border-radius: 0 8px 8px 0; }
    
    /* ============================================
       ROCKETWATCH v5.0 - NEW AUDIT FEATURES
       ============================================ */
    
    /* RATING SCALE WITH DESCRIPTIONS */
    .rating-scale { padding: 16px; background: var(--bg-card); margin: 16px; border-radius: 12px; }
    .rating-scale-title { font-size: 12px; font-weight: 700; color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px; }
    .rating-scale-row { display: flex; align-items: center; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--divider); }
    .rating-scale-row:last-child { border-bottom: none; }
    .rating-scale-stars { display: flex; align-items: center; gap: 2px; min-width: 80px; }
    .rating-scale-stars svg { width: 12px; height: 12px; color: var(--brand-green); }
    .rating-scale-label { font-size: 14px; color: var(--text-secondary); }
    .rating-scale-toggle { display: flex; align-items: center; gap: 8px; padding: 12px 16px; cursor: pointer; border-top: 1px solid var(--divider); margin-top: 8px; }
    .rating-scale-toggle-text { font-size: 13px; color: var(--brand-blue); }
    
    /* RELATED NEWS CAROUSEL */
    .related-news { padding: 16px 0; border-bottom: 1px solid var(--divider); }
    .related-news-title { font-size: 12px; font-weight: 700; color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 1px; padding: 0 16px 12px; }
    .news-carousel { position: relative; overflow: hidden; }
    .news-carousel-track { display: flex; transition: transform 0.3s ease; }
    .news-card { flex: 0 0 calc(100% - 32px); margin: 0 16px; background: var(--bg-card); border-radius: 12px; overflow: hidden; cursor: pointer; }
    .news-card:active { opacity: 0.9; }
    .news-card-image { width: 100%; height: 140px; object-fit: cover; }
    .news-card-content { padding: 12px; }
    .news-card-title { font-size: 15px; font-weight: 600; margin-bottom: 4px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    .news-card-meta { font-size: 12px; color: var(--text-tertiary); }
    .news-dots { display: flex; justify-content: center; gap: 6px; padding: 12px 0; }
    .news-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--text-muted); cursor: pointer; transition: background 0.2s; }
    .news-dot.active { background: var(--text-primary); }
    
    /* MENTIONS SECTION */
    .mentions-section { padding: 16px; border-bottom: 1px solid var(--divider); }
    .mentions-title { font-size: 12px; font-weight: 700; color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px; }
    .mentions-row { display: flex; gap: 16px; overflow-x: auto; padding-bottom: 8px; }
    .mentions-row::-webkit-scrollbar { display: none; }
    .mention-item { flex-shrink: 0; display: flex; flex-direction: column; align-items: center; gap: 6px; cursor: pointer; }
    .mention-item:active { opacity: 0.8; }
    .mention-avatar { width: 56px; height: 56px; border-radius: 50%; background: var(--bg-elevated); display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden; }
    .mention-avatar img { width: 100%; height: 100%; object-fit: cover; }
    .mention-avatar-placeholder { font-size: 18px; font-weight: 700; color: var(--text-tertiary); }
    .mention-badge { position: absolute; top: -2px; right: -2px; min-width: 18px; height: 18px; background: var(--brand-blue); border-radius: 9px; font-size: 10px; font-weight: 700; display: flex; align-items: center; justify-content: center; padding: 0 4px; border: 2px solid var(--bg-primary); }
    .mention-name { font-size: 11px; color: var(--text-secondary); max-width: 70px; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    
    /* IOS TRACKING PERMISSION DIALOG */
    .ios-tracking-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.4); z-index: 9999; display: flex; align-items: center; justify-content: center; padding: 40px; animation: fadeIn 0.2s ease; }
    .ios-tracking-dialog { background: #F2F2F7; border-radius: 14px; width: 100%; max-width: 270px; overflow: hidden; text-align: center; }
    .ios-tracking-content { padding: 20px 16px 16px; }
    .ios-tracking-icon { width: 40px; height: 40px; margin: 0 auto 12px; background: var(--brand-blue); border-radius: 8px; display: flex; align-items: center; justify-content: center; }
    .ios-tracking-icon svg { color: white; width: 24px; height: 24px; }
    .ios-tracking-title { font-size: 17px; font-weight: 600; color: #000; margin-bottom: 8px; line-height: 1.3; }
    .ios-tracking-desc { font-size: 13px; color: #666; line-height: 1.4; }
    .ios-tracking-buttons { display: flex; flex-direction: column; border-top: 1px solid #C6C6C8; }
    .ios-tracking-btn { padding: 12px; font-size: 17px; background: none; border: none; cursor: pointer; border-top: 1px solid #C6C6C8; }
    .ios-tracking-btn:first-child { border-top: none; }
    .ios-tracking-btn-allow { color: #007AFF; font-weight: 400; }
    .ios-tracking-btn-deny { color: #007AFF; font-weight: 600; }
    
    /* JUSTWATCH ATTRIBUTION */
    .justwatch-attribution { display: flex; align-items: center; justify-content: center; gap: 6px; padding: 12px 16px; font-size: 11px; color: var(--text-muted); }
    .justwatch-attribution svg { width: 14px; height: 14px; opacity: 0.6; }
    
    /* ACTION SHEET BLUR EFFECT */
    .action-sheet-backdrop { backdrop-filter: blur(4px); -webkit-backdrop-filter: blur(4px); }
    .action-sheet-blur { backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); background: rgba(60,68,80,0.85) !important; }
    
    /* SHOWTIMES SECTION */
    .showtimes-section { padding: 16px; border-bottom: 1px solid var(--divider); }
    .showtimes-row { display: flex; align-items: center; justify-content: space-between; cursor: pointer; }
    .showtimes-row:active { opacity: 0.7; }
    .showtimes-label { font-size: 15px; color: var(--text-primary); display: flex; align-items: center; gap: 8px; }
    .showtimes-label svg { color: var(--text-tertiary); }
    .showtimes-value { font-size: 14px; color: var(--text-tertiary); display: flex; align-items: center; gap: 6px; }
    
    /* TAGLINE STYLING */
    .show-detail-tagline { font-size: 13px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; padding: 8px 16px 0; }
    
    /* OPEN IN BUTTONS */
    .open-in-section { padding: 16px; border-bottom: 1px solid var(--divider); }
    .open-in-title { font-size: 12px; font-weight: 700; color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px; }
    .open-in-buttons { display: flex; gap: 8px; flex-wrap: wrap; }
    .open-in-btn { padding: 8px 16px; border: 1px solid var(--text-muted); border-radius: 20px; font-size: 12px; font-weight: 600; color: var(--text-secondary); background: transparent; cursor: pointer; text-transform: uppercase; letter-spacing: 0.5px; }
    .open-in-btn:active { background: var(--bg-card); }
    
    /* LONG PRESS CONTEXT MENU */
    .context-menu { position: fixed; background: var(--bg-action-sheet); border-radius: 12px; padding: 8px 0; min-width: 200px; z-index: 1000; box-shadow: 0 8px 32px rgba(0,0,0,0.4); animation: fadeIn 0.15s ease; }
    .context-menu-item { padding: 12px 16px; font-size: 15px; color: var(--text-primary); cursor: pointer; display: flex; align-items: center; gap: 12px; }
    .context-menu-item:active { background: var(--bg-elevated); }
    .context-menu-item svg { width: 18px; height: 18px; color: var(--text-secondary); }
    .context-menu-divider { height: 1px; background: var(--divider); margin: 4px 0; }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState } = React;
    
    // DATA - EXPANDED FOR CATEGORY 5
    const SHOWS = [
      { 
        id: 1, name: 'Love Island', year: '2024', genre: 'Reality', 
        poster: 'https://image.tmdb.org/t/p/w500/h9f3vNGZGDRqOw26uwDMYhSLZ01.jpg',
        backdrop: 'https://image.tmdb.org/t/p/w1280/qb3FGYv8FPBWHkREPTLqXSvPCxW.jpg',
        runtime: 60, seasons: 11, episodes: 198,
        synopsis: 'British dating game show in which singles looking for love live together in a villa in Mallorca, Spain.',
        director: 'Various',
        cast: [{ name: 'Maya Jama', role: 'Host', photo: 'https://image.tmdb.org/t/p/w185/6Qvx8hJVxNj8oBW0k94vHXNdY6L.jpg' }],
        crew: [{ name: 'Richard Cowles', role: 'Executive Producer' }],
        studio: 'ITV Studios', country: 'UK', language: 'English',
        communityRating: 3.2, watchCount: 45200, likeCount: 12300,
        streaming: [{ name: 'Hulu', type: 'stream' }, { name: 'Peacock', type: 'stream' }],
        trailer: 'dQw4w9WgXcQ',
        similar: [2, 5, 4]
      },
      { 
        id: 2, name: 'The Bachelor', year: '2024', genre: 'Reality', 
        poster: 'https://image.tmdb.org/t/p/w500/mKadW8gXqVdg01IJYkMHNrzoZ3a.jpg',
        backdrop: 'https://image.tmdb.org/t/p/w1280/zFTKe8hppAKLSvPJ0jXWfatvT6r.jpg',
        runtime: 120, seasons: 28, episodes: 350,
        synopsis: 'A single bachelor dates multiple women over several weeks, narrowing them down to hopefully find his true love.',
        director: 'Various',
        cast: [{ name: 'Jesse Palmer', role: 'Host', photo: 'https://image.tmdb.org/t/p/w185/zN5XM9k9wPpL2K2R0f8e2CxQemH.jpg' }],
        crew: [{ name: 'Mike Fleiss', role: 'Creator' }],
        studio: 'Warner Bros. Television', country: 'USA', language: 'English',
        communityRating: 2.8, watchCount: 89000, likeCount: 23000,
        streaming: [{ name: 'ABC', type: 'stream' }, { name: 'Hulu', type: 'stream' }],
        trailer: 'dQw4w9WgXcQ',
        similar: [1, 5, 4]
      },
      { 
        id: 3, name: 'Survivor', year: '2024', genre: 'Reality', 
        poster: 'https://image.tmdb.org/t/p/w500/ddYkNcvJJ1FJFy3SaZfqTXExkPc.jpg',
        backdrop: 'https://image.tmdb.org/t/p/w1280/zXq2gL1qVEP3Y3d2nRqMeFh6Xbg.jpg',
        runtime: 60, seasons: 46, episodes: 650,
        synopsis: 'A reality show where a group of contestants are stranded in a remote location with little more than the clothes on their back.',
        director: 'Various',
        cast: [{ name: 'Jeff Probst', role: 'Host', photo: 'https://image.tmdb.org/t/p/w185/ar1h3bPj0Z37V91gXZG0LFyQQzv.jpg' }],
        crew: [{ name: 'Mark Burnett', role: 'Creator' }],
        studio: 'CBS', country: 'USA', language: 'English',
        communityRating: 4.1, watchCount: 156000, likeCount: 78000,
        streaming: [{ name: 'Paramount+', type: 'stream' }, { name: 'CBS', type: 'stream' }],
        trailer: 'dQw4w9WgXcQ',
        similar: [4, 6, 1]
      },
      { 
        id: 4, name: 'The Traitors', year: '2024', genre: 'Reality', 
        poster: 'https://image.tmdb.org/t/p/w500/7FN2nmpApXjLjQJKmJBLqZF91pz.jpg',
        backdrop: 'https://image.tmdb.org/t/p/w1280/hQG3XRPbfLffT7Mhj5XqEGxJzPP.jpg',
        runtime: 70, seasons: 3, episodes: 36,
        synopsis: 'Contestants compete in a series of missions while trying to identify who among them are "traitors" secretly plotting to steal the prize.',
        director: 'Various',
        cast: [{ name: 'Alan Cumming', role: 'Host', photo: 'https://image.tmdb.org/t/p/w185/hxZkBjCCEj8b2hPdANP7N1dJXTG.jpg' }],
        crew: [{ name: 'Stephen Lambert', role: 'Executive Producer' }],
        studio: 'Peacock', country: 'USA', language: 'English',
        communityRating: 4.3, watchCount: 67000, likeCount: 45000,
        streaming: [{ name: 'Peacock', type: 'stream' }],
        trailer: 'dQw4w9WgXcQ',
        similar: [3, 6, 1]
      },
      { 
        id: 5, name: 'Love Is Blind', year: '2024', genre: 'Reality', 
        poster: 'https://image.tmdb.org/t/p/w500/bHKgb4ShQ8AsCPFe3K4HQC64aKP.jpg',
        backdrop: 'https://image.tmdb.org/t/p/w1280/2Yih7vHN8AlnM7vBPnZRx4KJsBz.jpg',
        runtime: 55, seasons: 7, episodes: 72,
        synopsis: 'Singles try to find a match and fall in love without ever seeing each other, as emotional connection tries to conquer physical attraction.',
        director: 'Various',
        cast: [{ name: 'Nick Lachey', role: 'Host', photo: 'https://image.tmdb.org/t/p/w185/eBqzwv3sMuUkQPMXK3IhSP2rX1q.jpg' }, { name: 'Vanessa Lachey', role: 'Host', photo: 'https://image.tmdb.org/t/p/w185/6QOT4Cce4qLMXKYlBNWbzPKXxBZ.jpg' }],
        crew: [{ name: 'Chris Coelen', role: 'Creator' }],
        studio: 'Netflix', country: 'USA', language: 'English',
        communityRating: 3.5, watchCount: 234000, likeCount: 89000,
        streaming: [{ name: 'Netflix', type: 'stream' }],
        trailer: 'dQw4w9WgXcQ',
        similar: [1, 2, 4]
      },
      { 
        id: 6, name: 'The Circle', year: '2024', genre: 'Reality', 
        poster: 'https://image.tmdb.org/t/p/w500/iLfxuPBWgDg5556UsmREzA9cNiA.jpg',
        backdrop: 'https://image.tmdb.org/t/p/w1280/p1PP3R9YbyCSqcPvBYIdjYiPSFC.jpg',
        runtime: 45, seasons: 7, episodes: 91,
        synopsis: 'Players compete for popularity and $100,000 while living in the same building but never meeting in person.',
        director: 'Various',
        cast: [{ name: 'Michelle Buteau', role: 'Host', photo: 'https://image.tmdb.org/t/p/w185/mCLKOHwqXnULmJFqFnJkDYbMVZM.jpg' }],
        crew: [{ name: 'Studio Lambert', role: 'Production' }],
        studio: 'Netflix', country: 'USA', language: 'English',
        communityRating: 3.8, watchCount: 178000, likeCount: 67000,
        streaming: [{ name: 'Netflix', type: 'stream' }],
        trailer: 'dQw4w9WgXcQ',
        similar: [4, 3, 5]
      },
      { 
        id: 11, name: 'The Last of Us', year: '2024', genre: 'Drama', 
        poster: 'https://image.tmdb.org/t/p/w500/uKvVjHNqB5VmOrdxqAt2F7J78ED.jpg',
        backdrop: 'https://image.tmdb.org/t/p/w1280/uDgy6hyPd82kOHh6I95FLtLnj6p.jpg',
        runtime: 55, seasons: 2, episodes: 17,
        synopsis: 'Twenty years after modern civilization has been destroyed, Joel is hired to smuggle Ellie out of an oppressive quarantine zone.',
        director: 'Craig Mazin',
        cast: [
          { name: 'Pedro Pascal', role: 'Joel Miller', photo: 'https://image.tmdb.org/t/p/w185/9VYK7oxcqhjd5LAH6ZFJ3XzOlID.jpg' },
          { name: 'Bella Ramsey', role: 'Ellie Williams', photo: 'https://image.tmdb.org/t/p/w185/cOtzU3rX9TkJKzmzjm7mBKOdewz.jpg' }
        ],
        crew: [{ name: 'Craig Mazin', role: 'Creator' }, { name: 'Neil Druckmann', role: 'Creator' }],
        studio: 'HBO', country: 'USA', language: 'English',
        communityRating: 4.6, watchCount: 890000, likeCount: 567000,
        streaming: [{ name: 'Max', type: 'stream' }, { name: 'Amazon', type: 'rent', price: '$3.99' }],
        trailer: 'uLtkt8BonwM',
        similar: [14, 13, 15]
      },
      { 
        id: 12, name: 'The Bear', year: '2024', genre: 'Drama', 
        poster: 'https://image.tmdb.org/t/p/w500/zMpJY5CizTJfH8njYsYk87S9eHf.jpg',
        backdrop: 'https://image.tmdb.org/t/p/w1280/fNylhsqfm8uH8gXLKcP3k1tvnyv.jpg',
        runtime: 30, seasons: 3, episodes: 28,
        synopsis: 'A young chef from the fine dining world returns to Chicago to run his family\'s sandwich shop after a tragedy.',
        director: 'Christopher Storer',
        cast: [
          { name: 'Jeremy Allen White', role: 'Carmen "Carmy" Berzatto', photo: 'https://image.tmdb.org/t/p/w185/6E7dYLYwdPCptKNuU8fKl3w3s2R.jpg' },
          { name: 'Ayo Edebiri', role: 'Sydney Adamu', photo: 'https://image.tmdb.org/t/p/w185/ceLLSq3r5n1VPV8lDOqCNhJ4xCK.jpg' },
          { name: 'Ebon Moss-Bachrach', role: 'Richard "Richie" Jerimovich', photo: 'https://image.tmdb.org/t/p/w185/p6aQ5iPCDwYQJvVm3Z3rxLCzPjY.jpg' }
        ],
        crew: [{ name: 'Christopher Storer', role: 'Creator' }],
        studio: 'FX', country: 'USA', language: 'English',
        communityRating: 4.7, watchCount: 678000, likeCount: 456000,
        streaming: [{ name: 'Hulu', type: 'stream' }, { name: 'Disney+', type: 'stream' }],
        trailer: 'y-cqqAJIXhs',
        similar: [13, 15, 16],
        imdbId: 'tt14452776',
        tmdbId: '136315'
      },
      { 
        id: 13, name: 'Severance', year: '2024', genre: 'Drama', 
        poster: 'https://image.tmdb.org/t/p/w500/lFqJzi7XFuzp3cp6rFxPYL5Frdm.jpg',
        backdrop: 'https://image.tmdb.org/t/p/w1280/9z3CCXR7UsCWqmGXVj5aJP0Tc6p.jpg',
        runtime: 55, seasons: 2, episodes: 19,
        synopsis: 'Mark leads a team of office workers whose memories have been surgically divided between their work and personal lives.',
        director: 'Ben Stiller',
        cast: [
          { name: 'Adam Scott', role: 'Mark Scout', photo: 'https://image.tmdb.org/t/p/w185/1A2IYN1E3r9LQj5lnN84j7o0jxr.jpg' },
          { name: 'Britt Lower', role: 'Helly Riggs', photo: 'https://image.tmdb.org/t/p/w185/5Pj9c4ArcnKJNbDhxP5ihD3yZm2.jpg' },
          { name: 'John Turturro', role: 'Irving Bailiff', photo: 'https://image.tmdb.org/t/p/w185/gMGzwsYkEt0p6XJnYC0n8IJRwpp.jpg' },
          { name: 'Zach Cherry', role: 'Dylan George', photo: 'https://image.tmdb.org/t/p/w185/8sCbFNt26VLdXNEPJe6M5r8YlLX.jpg' },
          { name: 'Patricia Arquette', role: 'Harmony Cobel', photo: 'https://image.tmdb.org/t/p/w185/rPGkjHzxyQIXHqB5ERjCKvnUkK8.jpg' },
          { name: 'Christopher Walken', role: 'Burt Goodman', photo: 'https://image.tmdb.org/t/p/w185/vl61kWdWnNMreLXaQAsW6MvdaJG.jpg' }
        ],
        crew: [{ name: 'Dan Erickson', role: 'Creator' }, { name: 'Ben Stiller', role: 'Director' }],
        studio: 'Apple TV+', country: 'USA', language: 'English',
        communityRating: 4.8, watchCount: 567000, likeCount: 423000,
        streaming: [{ name: 'Apple TV+', type: 'stream' }],
        trailer: 'xEQP4VVuyrY',
        similar: [11, 15, 16],
        imdbId: 'tt11280740',
        tmdbId: '95396'
      },
      { 
        id: 14, name: 'House of the Dragon', year: '2024', genre: 'Drama', 
        poster: 'https://image.tmdb.org/t/p/w500/7QMsOTMUswlwxJP0rTTZfmz2tX2.jpg',
        backdrop: 'https://image.tmdb.org/t/p/w1280/etj8E2o0Bud0HkONVQPjyCkIvpv.jpg',
        runtime: 60, seasons: 2, episodes: 18,
        synopsis: 'The story of the Targaryen civil war that took place about 200 years before events portrayed in Game of Thrones.',
        director: 'Ryan Condal',
        cast: [
          { name: 'Matt Smith', role: 'Prince Daemon Targaryen', photo: 'https://image.tmdb.org/t/p/w185/fUCSMTolBH5sZLwmOHxb6pqL7Lu.jpg' },
          { name: 'Emma D\'Arcy', role: 'Queen Rhaenyra Targaryen', photo: 'https://image.tmdb.org/t/p/w185/vQM6P0u6xaHgDX9Rb4Xv5o9NZQR.jpg' },
          { name: 'Olivia Cooke', role: 'Queen Alicent Hightower', photo: 'https://image.tmdb.org/t/p/w185/pKXpB7OHR8x4yfPMYVhK9i6N2RA.jpg' }
        ],
        crew: [{ name: 'Ryan Condal', role: 'Creator' }, { name: 'George R.R. Martin', role: 'Creator' }],
        studio: 'HBO', country: 'USA', language: 'English',
        communityRating: 4.4, watchCount: 789000, likeCount: 345000,
        streaming: [{ name: 'Max', type: 'stream' }],
        trailer: 'DotnJ7tTA34',
        similar: [15, 11, 16],
        imdbId: 'tt11198330',
        tmdbId: '94997'
      },
      { 
        id: 15, name: 'Succession', year: '2023', genre: 'Drama', 
        poster: 'https://image.tmdb.org/t/p/w500/7HW47XbkNQ5fiwQFYGWdw9gs144.jpg',
        backdrop: 'https://image.tmdb.org/t/p/w1280/xfBjvJp1v6UBbl0c5EePz8gYrEh.jpg',
        runtime: 60, seasons: 4, episodes: 39,
        synopsis: 'The Roy family is known for controlling the biggest media and entertainment company in the world.',
        director: 'Jesse Armstrong',
        cast: [
          { name: 'Brian Cox', role: 'Logan Roy', photo: 'https://image.tmdb.org/t/p/w185/wHN64eH0T4s6sCXvBjB7qrIw6MV.jpg' },
          { name: 'Jeremy Strong', role: 'Kendall Roy', photo: 'https://image.tmdb.org/t/p/w185/fpAv7U2qyTDKDCsVRUmXhPfTzZu.jpg' },
          { name: 'Sarah Snook', role: 'Siobhan "Shiv" Roy', photo: 'https://image.tmdb.org/t/p/w185/xT98Bm3xMz2g6pYAaLUdhT0w9rs.jpg' },
          { name: 'Kieran Culkin', role: 'Roman Roy', photo: 'https://image.tmdb.org/t/p/w185/wp03kPDOZpkrIbE8QlDRjbWHT9H.jpg' },
          { name: 'Matthew Macfadyen', role: 'Tom Wambsgans', photo: 'https://image.tmdb.org/t/p/w185/2FF3Yjxd7DYR4EIJL6s2GpKDMkJ.jpg' }
        ],
        crew: [{ name: 'Jesse Armstrong', role: 'Creator' }],
        studio: 'HBO', country: 'USA', language: 'English',
        communityRating: 4.9, watchCount: 1200000, likeCount: 890000,
        streaming: [{ name: 'Max', type: 'stream' }, { name: 'Amazon', type: 'rent', price: '$3.99' }],
        trailer: 'OzYxJV_rmE8',
        similar: [16, 12, 13],
        imdbId: 'tt7660850',
        tmdbId: '76331'
      },
      { 
        id: 16, name: 'The White Lotus', year: '2024', genre: 'Drama', 
        poster: 'https://image.tmdb.org/t/p/w500/gH5i3JbnLsyTvcImlofNvXtH3i5.jpg',
        backdrop: 'https://image.tmdb.org/t/p/w1280/bHvVufsyDvL8FgLyoKwpLqbGJw3.jpg',
        runtime: 60, seasons: 3, episodes: 20,
        synopsis: 'Follow the exploits of various guests and employees at an exclusive tropical resort over a week.',
        director: 'Mike White',
        cast: [
          { name: 'Jennifer Coolidge', role: 'Tanya McQuoid', photo: 'https://image.tmdb.org/t/p/w185/h2uNPTwG2p1B8qPSgRj6e3B4Ptv.jpg' },
          { name: 'Aubrey Plaza', role: 'Harper Spiller', photo: 'https://image.tmdb.org/t/p/w185/j7DKJJdWXhJcM3RYpP4lLT5bZ3T.jpg' }
        ],
        crew: [{ name: 'Mike White', role: 'Creator' }],
        studio: 'HBO', country: 'USA', language: 'English',
        communityRating: 4.5, watchCount: 567000, likeCount: 345000,
        streaming: [{ name: 'Max', type: 'stream' }],
        trailer: 'TGLq7_dqt9w',
        similar: [15, 12, 13]
      },
      { 
        id: 21, name: 'Abbott Elementary', year: '2024', genre: 'Comedy', 
        poster: 'https://image.tmdb.org/t/p/w500/fLZJHG8gXF0H1fCYd6cCMKDMkQD.jpg',
        backdrop: 'https://image.tmdb.org/t/p/w1280/pKXapsfznvNPV8ik1bLztDC5QM4.jpg',
        runtime: 22, seasons: 4, episodes: 60,
        synopsis: 'A group of dedicated teachers are brought together in a Philadelphia public school where, despite the odds stacked against them, they are determined to help their students succeed in life.',
        director: 'Quinta Brunson',
        cast: [
          { name: 'Quinta Brunson', role: 'Janine Teagues', photo: 'https://image.tmdb.org/t/p/w185/v1Jq4sJt8xKdaGE6LX4Xrr46QZS.jpg' },
          { name: 'Tyler James Williams', role: 'Gregory Eddie', photo: 'https://image.tmdb.org/t/p/w185/xK7vjP08pJOeuyYv32xfAW3SzGi.jpg' }
        ],
        crew: [{ name: 'Quinta Brunson', role: 'Creator' }],
        studio: 'ABC', country: 'USA', language: 'English',
        communityRating: 4.3, watchCount: 456000, likeCount: 234000,
        streaming: [{ name: 'Hulu', type: 'stream' }, { name: 'ABC', type: 'stream' }],
        trailer: 'DiV4Bj0SQOU',
        similar: [22, 23, 12]
      },
      { 
        id: 22, name: 'Hacks', year: '2024', genre: 'Comedy', 
        poster: 'https://image.tmdb.org/t/p/w500/pxb3FLLpJKU6rAcP0nQmTY2L95p.jpg',
        backdrop: 'https://image.tmdb.org/t/p/w1280/dR9HoYpQyA7HTJGiirJG6p8N4Ne.jpg',
        runtime: 30, seasons: 3, episodes: 28,
        synopsis: 'A dark mentorship forms between Deborah Vance, a legendary Las Vegas comedian, and an entitled, outcast 25-year-old.',
        director: 'Lucia Aniello',
        cast: [
          { name: 'Jean Smart', role: 'Deborah Vance', photo: 'https://image.tmdb.org/t/p/w185/tKijM7qZEqTG1GnXQ1pKzMwzJWW.jpg' },
          { name: 'Hannah Einbinder', role: 'Ava Daniels', photo: 'https://image.tmdb.org/t/p/w185/sNzaB6DsIKE7hLlH9y4zHEX4rDT.jpg' }
        ],
        crew: [{ name: 'Lucia Aniello', role: 'Creator' }, { name: 'Paul W. Downs', role: 'Creator' }],
        studio: 'HBO Max', country: 'USA', language: 'English',
        communityRating: 4.4, watchCount: 234000, likeCount: 156000,
        streaming: [{ name: 'Max', type: 'stream' }],
        trailer: 'gXCNhCQb1qo',
        similar: [21, 23, 12]
      },
      { 
        id: 23, name: 'What We Do in the Shadows', year: '2024', genre: 'Comedy', 
        poster: 'https://image.tmdb.org/t/p/w500/chckIPxBbvyFCcCFz5NJwPAkawf.jpg',
        backdrop: 'https://image.tmdb.org/t/p/w1280/je6hLxo9u6KbKHChQ4WTFYx3y4h.jpg',
        runtime: 25, seasons: 6, episodes: 57,
        synopsis: 'A documentary-style look into the daily lives of four vampires who\'ve been roommates for hundreds of years in Staten Island.',
        director: 'Jemaine Clement',
        cast: [
          { name: 'Kayvan Novak', role: 'Nandor', photo: 'https://image.tmdb.org/t/p/w185/3AY0TZHMUmvDZz5q42UqSYVSKKb.jpg' },
          { name: 'Matt Berry', role: 'Laszlo Cravensworth', photo: 'https://image.tmdb.org/t/p/w185/bH3Xk5aX0NbHw3Z5nkJZUZ0nCW7.jpg' },
          { name: 'Natasia Demetriou', role: 'Nadja', photo: 'https://image.tmdb.org/t/p/w185/dL8r5z4HNPCCNbDt9y1YZCJ5E8y.jpg' }
        ],
        crew: [{ name: 'Jemaine Clement', role: 'Creator' }, { name: 'Taika Waititi', role: 'Creator' }],
        studio: 'FX', country: 'USA', language: 'English',
        communityRating: 4.5, watchCount: 345000, likeCount: 234000,
        streaming: [{ name: 'Hulu', type: 'stream' }, { name: 'Disney+', type: 'stream' }],
        trailer: 'VLdTB8nJvmA',
        similar: [21, 22, 12]
      },
    ];
    
    // CAST & CREW DATA
    const PEOPLE = {
      'jeremy-allen-white': {
        id: 'jeremy-allen-white',
        name: 'Jeremy Allen White',
        photo: 'https://image.tmdb.org/t/p/w185/6E7dYLYwdPCptKNuU8fKl3w3s2R.jpg',
        knownFor: 'Acting',
        bio: 'Jeremy Allen White is an American actor. He is best known for his role as Lip Gallagher in the Showtime series Shameless and as Carmen "Carmy" Berzatto in the FX series The Bear, for which he won two Primetime Emmy Awards.',
        birthdate: 'February 17, 1991',
        birthplace: 'Brooklyn, New York, USA',
        imdbId: 'nm3704901',
        tmdbId: '84244',
        filmography: [
          { showId: 12, role: 'Carmen "Carmy" Berzatto', type: 'actor', year: 2024 },
          { showId: null, title: 'Shameless', role: 'Lip Gallagher', type: 'actor', year: 2011, poster: 'https://image.tmdb.org/t/p/w500/9akij7PqZ1g6zl42DQQTtL9CTSb.jpg' },
          { showId: null, title: 'The Iron Claw', role: 'Kerry Von Erich', type: 'actor', year: 2023, poster: 'https://image.tmdb.org/t/p/w500/nfs7DCYhgrEIgxKYbITHTzKsggf.jpg' },
          { showId: null, title: 'Movie 43', role: 'Various', type: 'actor', year: 2013, poster: 'https://image.tmdb.org/t/p/w500/d1CvwIi5GGV3Q3T2fNCrj7x8Pqn.jpg' }
        ]
      },
      'ayo-edebiri': {
        id: 'ayo-edebiri',
        name: 'Ayo Edebiri',
        photo: 'https://image.tmdb.org/t/p/w185/ceLLSq3r5n1VPV8lDOqCNhJ4xCK.jpg',
        knownFor: 'Acting',
        bio: 'Ayo Edebiri is an American actress, comedian, and writer. She is known for her role as Sydney Adamu in the FX series The Bear and for voice acting as Missy Foreman-Greenwald in Big Mouth.',
        birthdate: 'October 3, 1995',
        birthplace: 'Boston, Massachusetts, USA',
        imdbId: 'nm7546379',
        tmdbId: '2155020',
        filmography: [
          { showId: 12, role: 'Sydney Adamu', type: 'actor', year: 2024 },
          { showId: null, title: 'Big Mouth', role: 'Missy (voice)', type: 'actor', year: 2019, poster: 'https://image.tmdb.org/t/p/w500/v0WLRABsLmCXPLYo9qJgPiPlJyN.jpg' },
          { showId: null, title: 'Inside Out 2', role: 'Envy (voice)', type: 'actor', year: 2024, poster: 'https://image.tmdb.org/t/p/w500/vpnVM9B6NMmQpWeZvzLvDESb2QY.jpg' },
          { showId: null, title: 'Bottoms', role: 'Josie', type: 'actor', year: 2023, poster: 'https://image.tmdb.org/t/p/w500/ieb8sOEP7M9D0hL1BFqpkIEiTyN.jpg' }
        ]
      },
      'adam-scott': {
        id: 'adam-scott',
        name: 'Adam Scott',
        photo: 'https://image.tmdb.org/t/p/w185/1A2IYN1E3r9LQj5lnN84j7o0jxr.jpg',
        knownFor: 'Acting',
        bio: 'Adam Paul Scott is an American actor. He is known for his role as Ben Wyatt in Parks and Recreation, as well as Derek in Step Brothers, and Mark Scout in the Apple TV+ series Severance.',
        birthdate: 'April 3, 1973',
        birthplace: 'Santa Cruz, California, USA',
        imdbId: 'nm0003073',
        tmdbId: '59315',
        filmography: [
          { showId: 13, role: 'Mark Scout', type: 'actor', year: 2024 },
          { showId: null, title: 'Parks and Recreation', role: 'Ben Wyatt', type: 'actor', year: 2010, poster: 'https://image.tmdb.org/t/p/w500/3EJbLQ0NUcjnZ4k2RvuPQ5kGhMH.jpg' },
          { showId: null, title: 'Big Little Lies', role: 'Ed Mackenzie', type: 'actor', year: 2017, poster: 'https://image.tmdb.org/t/p/w500/8s4vH8cM6EPLRaIJdZmfFC0HQio.jpg' },
          { showId: null, title: 'Step Brothers', role: 'Derek', type: 'actor', year: 2008, poster: 'https://image.tmdb.org/t/p/w500/wm9gBI6BsQE6dqq2WUnAPsbg0qV.jpg' }
        ]
      },
      'ben-stiller': {
        id: 'ben-stiller',
        name: 'Ben Stiller',
        photo: 'https://image.tmdb.org/t/p/w185/2ngknsjAgYnjYyRAOFKWpilqp0D.jpg',
        knownFor: 'Directing',
        bio: 'Benjamin Edward Meara Stiller is an American actor, comedian, producer, film director, and screenwriter. He is the son of the comedians Jerry Stiller and Anne Meara. He directed episodes of Severance, earning critical acclaim.',
        birthdate: 'November 30, 1965',
        birthplace: 'New York City, USA',
        imdbId: 'nm0001774',
        tmdbId: '7399',
        filmography: [
          { showId: 13, role: 'Director/Executive Producer', type: 'director', year: 2024 },
          { showId: null, title: 'Zoolander', role: 'Director/Actor', type: 'director', year: 2001, poster: 'https://image.tmdb.org/t/p/w500/hLWdLGC4xfHupAoXcq8BNdF8m3q.jpg' },
          { showId: null, title: 'Tropic Thunder', role: 'Director/Actor', type: 'director', year: 2008, poster: 'https://image.tmdb.org/t/p/w500/pPdEU30xEHLlkFmTvTRiQhXcGZP.jpg' },
          { showId: null, title: 'The Secret Life of Walter Mitty', role: 'Director/Actor', type: 'director', year: 2013, poster: 'https://image.tmdb.org/t/p/w500/e4kdYvq7BmFa7tykWjl3TOvIQPf.jpg' },
          { showId: null, title: 'Escape at Dannemora', role: 'Director', type: 'director', year: 2018, poster: 'https://image.tmdb.org/t/p/w500/rRrHgLZzYRqDPqKnpN5sPyK6Vqw.jpg' }
        ]
      },
      'matt-smith': {
        id: 'matt-smith',
        name: 'Matt Smith',
        photo: 'https://image.tmdb.org/t/p/w185/fUCSMTolBH5sZLwmOHxb6pqL7Lu.jpg',
        knownFor: 'Acting',
        bio: 'Matthew Robert Smith is an English actor. He is known for playing the Eleventh Doctor in Doctor Who, Prince Philip in The Crown, and Prince Daemon Targaryen in House of the Dragon.',
        birthdate: 'October 28, 1982',
        birthplace: 'Northampton, England, UK',
        imdbId: 'nm1741002',
        tmdbId: '17288',
        filmography: [
          { showId: 14, role: 'Prince Daemon Targaryen', type: 'actor', year: 2024 },
          { showId: null, title: 'Doctor Who', role: 'The Eleventh Doctor', type: 'actor', year: 2010, poster: 'https://image.tmdb.org/t/p/w500/4edFyasCrkH4MKs6H4mHqlrxA6b.jpg' },
          { showId: null, title: 'The Crown', role: 'Prince Philip', type: 'actor', year: 2016, poster: 'https://image.tmdb.org/t/p/w500/1M876KPjulVwppEpldhdc8V4o68.jpg' },
          { showId: null, title: 'Last Night in Soho', role: 'Jack', type: 'actor', year: 2021, poster: 'https://image.tmdb.org/t/p/w500/3EIPzOjVqOvkhbDWCj4b4S2SRER.jpg' }
        ]
      },
      'christopher-storer': {
        id: 'christopher-storer',
        name: 'Christopher Storer',
        photo: 'https://image.tmdb.org/t/p/w185/fQcKcM5HY4R0aEVXQZKK0wYrqaW.jpg',
        knownFor: 'Directing',
        bio: 'Christopher Storer is an American television writer, director, and producer. He is the creator of The Bear, for which he has won multiple Emmy Awards.',
        birthdate: 'October 16, 1985',
        birthplace: 'New York, USA',
        imdbId: 'nm3252089',
        tmdbId: '1608054',
        filmography: [
          { showId: 12, role: 'Creator/Director/Writer', type: 'director', year: 2024 },
          { showId: null, title: 'Ramy', role: 'Director', type: 'director', year: 2019, poster: 'https://image.tmdb.org/t/p/w500/tq0AdC5gPg6mbQ1vgF0tOd6HmjN.jpg' },
          { showId: null, title: 'Bo Burnham: Eighth Grade Tour', role: 'Director', type: 'director', year: 2020, poster: 'https://image.tmdb.org/t/p/w500/4hmDSwMgCAoQQnPKjZFwJmn8bVu.jpg' }
        ]
      },
      'emma-darcy': {
        id: 'emma-darcy',
        name: 'Emma D\'Arcy',
        photo: 'https://image.tmdb.org/t/p/w185/vQM6P0u6xaHgDX9Rb4Xv5o9NZQR.jpg',
        knownFor: 'Acting',
        bio: 'Emma D\'Arcy is an English actor. They are known for playing Queen Rhaenyra Targaryen in the HBO series House of the Dragon.',
        birthdate: 'June 27, 1992',
        birthplace: 'London, England, UK',
        imdbId: 'nm6798142',
        tmdbId: '1818310',
        filmography: [
          { showId: 14, role: 'Queen Rhaenyra Targaryen', type: 'actor', year: 2024 },
          { showId: null, title: 'Truth Seekers', role: 'Elton\'s Sister', type: 'actor', year: 2020, poster: 'https://image.tmdb.org/t/p/w500/3LCaeXZZPcLHYhLYfFfpWMDaIPs.jpg' }
        ]
      },
      'bryan-cranston': {
        id: 'bryan-cranston',
        name: 'Bryan Cranston',
        photo: 'https://image.tmdb.org/t/p/w185/7Jahy5LZX2Fo8fGJltMreAI49hC.jpg',
        knownFor: 'Acting',
        bio: 'Bryan Lee Cranston is an American actor and filmmaker. He is best known for portraying Walter White in the AMC crime drama series Breaking Bad.',
        birthdate: 'March 7, 1956',
        birthplace: 'Hollywood, California, USA',
        imdbId: 'nm0186505',
        tmdbId: '17419',
        filmography: [
          { showId: 1, role: 'Walter White', type: 'actor', year: 2013 },
          { showId: null, title: 'Malcolm in the Middle', role: 'Hal', type: 'actor', year: 2000, poster: 'https://image.tmdb.org/t/p/w500/fLdL8Lpf68a2B4ujz7NQpRNLxaB.jpg' },
          { showId: null, title: 'Godzilla', role: 'Joe Brody', type: 'actor', year: 2014, poster: 'https://image.tmdb.org/t/p/w500/pGwChWiAY1bdoxL79sXmaFBlYJH.jpg' },
          { showId: null, title: 'Trumbo', role: 'Dalton Trumbo', type: 'actor', year: 2015, poster: 'https://image.tmdb.org/t/p/w500/fPlXtQYYz0RyPsfiKfXF26xpewE.jpg' }
        ]
      },
      'vince-gilligan': {
        id: 'vince-gilligan',
        name: 'Vince Gilligan',
        photo: 'https://image.tmdb.org/t/p/w185/uFh3OrBvkwKSU3N5y0XnXOhqBJz.jpg',
        knownFor: 'Directing',
        bio: 'George Vincent Gilligan Jr. is an American writer, producer, and director. He is known for his work as the creator, head writer, and executive producer of Breaking Bad and its spin-off Better Call Saul.',
        birthdate: 'February 10, 1967',
        birthplace: 'Richmond, Virginia, USA',
        imdbId: 'nm0319213',
        tmdbId: '66633',
        filmography: [
          { showId: 1, role: 'Creator/Writer/Director', type: 'director', year: 2013 },
          { showId: null, title: 'Better Call Saul', role: 'Creator', type: 'director', year: 2015, poster: 'https://image.tmdb.org/t/p/w500/fC2HDm5t0kHl7mTm7jxMR31b7by.jpg' },
          { showId: null, title: 'El Camino: A Breaking Bad Movie', role: 'Writer/Director', type: 'director', year: 2019, poster: 'https://image.tmdb.org/t/p/w500/iy3nT7fjyFFgPCSxaNRPv5jLhTw.jpg' },
          { showId: null, title: 'The X-Files', role: 'Writer/Producer', type: 'writer', year: 1995, poster: 'https://image.tmdb.org/t/p/w500/5BD0kiTGnQeOlFCq2YCQKU42y5R.jpg' }
        ]
      }
    };
    
    const USERS = {
      me: { 
        id: 'me', 
        username: 'tvlover',
        displayName: 'TV Lover',
        pronouns: 'they/them',
        bio: 'Obsessed with prestige TV and trashy reality shows. No in between.',
        location: 'Los Angeles, CA',
        website: 'https://tvlover.blog',
        twitter: 'tvlover',
        backdrop: 'https://image.tmdb.org/t/p/w1280/9z3CCXR7UsCWqmGXVj5aJP0Tc6p.jpg',
        topFour: [1, 3, 5, 6], // Show IDs for favorite shows
        pinnedReviews: [101], // Review IDs
        pinnedLists: [4], // List IDs
        badge: 'patron',
      },
      ari: { id: 'ari', username: 'ari', displayName: 'Ari', pronouns: 'she/her', bio: 'Film school dropout, TV enthusiast.', location: 'Brooklyn, NY' },
      princess: { id: 'princess', username: 'PrincessLucas', displayName: 'Princess Lucas', pronouns: 'she/her', badge: 'patron', bio: 'Curator of comfort watches.', topFour: [1, 2, 3, 4] },
      lobo: { id: 'lobo', username: '✧lobotomommy✧', displayName: 'Lobo', badge: 'crew', bio: 'I watch too much TV and have opinions.', pronouns: 'she/they' },
      drew: { id: 'drew', username: 'Drew Cowen', displayName: 'Drew', bio: 'Making lists since 2019.', location: 'Austin, TX', website: 'https://drewreviews.com' },
      bryan: { id: 'bryan', username: 'Bryan Howell', displayName: 'Bryan', pronouns: 'he/him' },
      nolan: { id: 'nolan', username: 'nolanfilms', displayName: 'Nolan', badge: 'pro', bio: 'Director wannabe. Comfort show collector.', twitter: 'nolanfilms' },
    };
    
    // Activity from people you follow - EXACTLY matching screenshot
    const FRIEND_ACTIVITY = [
      { id: 1, userId: 'ari', type: 'liked_review', target: 'PrincessLucas', rating: 4.5, showName: 'Once Upon a Studio', time: '3m' },
      { id: 2, userId: 'ari', type: 'liked_review', target: '✧lobotomommy✧', rating: 4.5, showName: 'Cecil B. Demented', time: '3m' },
      { id: 3, userId: 'ari', type: 'liked_review', target: 'Drew Cowen', showName: 'Chasing Time', time: '3m' },
      { id: 4, userId: 'lobo', type: 'followed', target: 'Bryan Howell', time: '21m' },
      { id: 5, userId: 'lobo', type: 'liked_review', target: 'Bryan Howell', rating: 2.5, showName: 'Shelby Oaks', time: '21m' },
      { id: 6, userId: 'lobo', type: 'liked_review', target: 'Bryan Howell', rating: 4.5, showName: 'Superman', time: '21m' },
      { id: 7, userId: 'lobo', type: 'liked_review', target: 'Bryan Howell', rating: 2, showName: 'HIM', time: '21m' },
      { id: 8, userId: 'drew', type: 'watchlist', showName: 'One Night in Miami...', time: '2h' },
    ];
    
    const REVIEWS = [
      { id: 1, userId: 'lobo', showId: 12, showName: 'The Bear', year: 2024, rating: 5, text: '**Yes Chef.** That\'s it. That\'s the review. Actually no—this show made me feel things I didn\'t know I could feel about a kitchen. The *anxiety* is real but so is the heart.', date: 'Jan 18, 2025', poster: SHOWS.find(s => s.id === 12).poster, hasSpoilers: false, likes: 847 },
      { id: 2, userId: 'princess', showId: 13, showName: 'Severance', year: 2024, rating: 4.5, text: '**MAJOR SPOILER:** When we find out that Helly is actually *Helena Eagan*, the daughter of the company CEO, it completely reframes everything we thought we knew about her character. The finale\'s dance sequence is haunting.', date: 'Jan 15, 2025', poster: SHOWS.find(s => s.id === 13).poster, hasSpoilers: true, likes: 1203 },
      { id: 3, userId: 'sarah', showId: 15, showName: 'Succession', year: 2023, rating: 5, text: 'The most **Shakespearean** show on television. Every character is awful and I love them all. Logan Roy is a monster but *Brian Cox* makes you understand why his children keep coming back.', date: 'Jan 12, 2025', poster: SHOWS.find(s => s.id === 15).poster, hasSpoilers: false, likes: 2156 },
    ];
    
    const LISTS = [
      { 
        id: 1, 
        userId: 'drew', 
        title: 'Movies everyone should watch at least once', 
        desc: 'I asked reddit whats one movie everyone should watch at least once in their lifetime.', 
        posters: SHOWS.slice(0, 6).map(s => s.poster),
        entries: SHOWS.slice(0, 6).map((s, i) => ({ showId: s.id, position: i + 1, note: i === 0 ? 'Absolute masterpiece' : '' })),
        isRanked: true,
        isPublic: true,
        allowComments: true,
        likes: 1247,
        comments: 89,
        createdAt: '2024-12-15',
        tags: ['must-watch', 'classics']
      },
      { 
        id: 2, 
        userId: 'princess', 
        title: 'Best TV Shows of the 2020s', 
        desc: 'The definitive ranking of prestige television this decade.', 
        posters: SHOWS.slice(0, 4).map(s => s.poster),
        entries: SHOWS.slice(0, 4).map((s, i) => ({ showId: s.id, position: i + 1, note: '' })),
        isRanked: true,
        isPublic: true,
        allowComments: true,
        likes: 892,
        comments: 156,
        createdAt: '2025-01-10',
        tags: ['2020s', 'prestige-tv']
      },
      { 
        id: 3, 
        userId: 'nolan', 
        title: 'Comfort Watches', 
        desc: 'Shows I put on when I need to feel better.', 
        posters: [SHOWS[2].poster, SHOWS[4].poster, SHOWS[6].poster],
        entries: [{ showId: SHOWS[2].id, position: 1, note: 'Always calms me down' }, { showId: SHOWS[4].id, position: 2, note: '' }, { showId: SHOWS[6].id, position: 3, note: '' }],
        isRanked: false,
        isPublic: true,
        allowComments: false,
        likes: 234,
        comments: 12,
        createdAt: '2025-01-05',
        tags: ['comfort', 'rewatch']
      },
      { 
        id: 4, 
        userId: 'me', 
        title: 'My Watchlist Priorities', 
        desc: 'What I need to watch next, in order.', 
        posters: SHOWS.slice(6, 10).map(s => s.poster),
        entries: SHOWS.slice(6, 10).map((s, i) => ({ showId: s.id, position: i + 1, note: i === 0 ? 'Everyone keeps recommending this' : '' })),
        isRanked: true,
        isPublic: false,
        allowComments: false,
        likes: 0,
        comments: 0,
        createdAt: '2025-01-18',
        tags: ['personal', 'to-watch']
      },
    ];
    
    const DIARY_ENTRIES = [
      { id: 1, day: '21', fullDate: '2025-01-21', showName: 'Severance', year: 2024, rating: 4.5, liked: true, rewatch: false, poster: SHOWS.find(s => s.id === 13).poster, isDraft: false, tags: ['binged', 'at:home'] },
      { id: 2, day: '20', fullDate: '2025-01-20', showName: 'The Bear', year: 2024, rating: 5, liked: true, rewatch: true, poster: SHOWS.find(s => s.id === 12).poster, isDraft: false, tags: ['with:partner', 'comfort-watch'] },
      { id: 3, day: '18', fullDate: '2025-01-18', showName: 'The White Lotus', year: 2024, rating: 4.5, liked: true, rewatch: false, poster: SHOWS.find(s => s.id === 16).poster, isDraft: true, tags: [] },
      { id: 4, day: '15', fullDate: '2025-01-15', showName: 'Succession', year: 2023, rating: 5, liked: true, rewatch: false, poster: SHOWS.find(s => s.id === 15).poster, isDraft: false, tags: ['binged'] },
    ];
    
    const MOVIE_QUOTES = [
      "Game over, man! It's game over!",
      "Nothing left but some damn rocks on the window sill. And that cupcake on the wall!",
      "Tyler's not here. Tyler went away. Tyler's gone.",
      "He speaks a dozen languages, knows every local custom. He'll blend in, disappear, you'll never see him again.",
    ];
    
    // ICONS - AUDIT FIXED
    const Icon = ({ name, size = 24, filled = false }) => {
      const icons = {
        // FIXED: Logged = filled green circle with eye cutout (THE signature Letterboxd icon)
        Eye: filled 
          ? <svg width={size} height={size} viewBox="0 0 24 24"><circle cx="12" cy="12" r="11" fill="currentColor"/><path d="M12 7C8 7 5 12 5 12s3 5 7 5 7-5 7-5-3-5-7-5z" fill="#14181C"/><circle cx="12" cy="12" r="2.5" fill="currentColor"/></svg>
          : <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>,
        
        Heart: <svg width={size} height={size} viewBox="0 0 24 24" fill={filled ? 'currentColor' : 'none'} stroke="currentColor" strokeWidth="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>,
        
        // FIXED: Watchlist = clock with + badge
        Clock: filled
          ? <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/><circle cx="19" cy="19" r="4.5" fill="#14181C" stroke="none"/><circle cx="19" cy="19" r="4" fill="none" stroke="currentColor" strokeWidth="1.5"/><path d="M19 17v4M17 19h4" stroke="currentColor" strokeWidth="1.5"/></svg>
          : <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
        
        Star: <svg width={size} height={size} viewBox="0 0 24 24" fill={filled ? 'currentColor' : 'none'} stroke="currentColor" strokeWidth="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>,
        Films: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="2" y="2" width="20" height="20" rx="2"/><rect x="6" y="6" width="12" height="12" rx="1"/></svg>,
        Search: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>,
        Plus: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,
        Activity: <svg width={size} height={size} viewBox="0 0 24 24" fill={filled ? 'currentColor' : 'none'} stroke="currentColor" strokeWidth="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
        Profile: <svg width={size} height={size} viewBox="0 0 24 24" fill={filled ? 'currentColor' : 'none'} stroke="currentColor" strokeWidth="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>,
        ChevronLeft: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="15 18 9 12 15 6"/></svg>,
        ChevronRight: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="9 18 15 12 9 6"/></svg>,
        Settings: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="3"/><path d="M12 1v4M12 19v4M4.22 4.22l2.83 2.83M16.95 16.95l2.83 2.83M1 12h4M19 12h4M4.22 19.78l2.83-2.83M16.95 7.05l2.83-2.83"/></svg>,
        MoreHorizontal: <svg width={size} height={size} viewBox="0 0 24 24" fill="currentColor"><circle cx="5" cy="12" r="2"/><circle cx="12" cy="12" r="2"/><circle cx="19" cy="12" r="2"/></svg>,
        Filter: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="4" y1="8" x2="20" y2="8"/><circle cx="8" cy="8" r="2" fill="currentColor"/><line x1="4" y1="16" x2="20" y2="16"/><circle cx="16" cy="16" r="2" fill="currentColor"/></svg>,
        Menu: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>,
        Repeat: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="17 1 21 5 17 9"/><path d="M3 11V9a4 4 0 0 1 4-4h14"/><polyline points="7 23 3 19 7 15"/><path d="M21 13v2a4 4 0 0 1-4 4H3"/></svg>,
        Check: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="#000" strokeWidth="3"><polyline points="20 6 9 17 4 12"/></svg>,
        Send: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>,
        Globe: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>,
        Trophy: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>,
        Comment: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg>,
        Copy: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>,
        X: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
        Download: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>,
        Link: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>,
        Calendar: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/><rect x="6" y="14" width="4" height="4" rx="0.5" fill="currentColor"/></svg>,
        Lock: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>,
        Unlock: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 9.9-1"/></svg>,
        Share: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>,
        Play: <svg width={size} height={size} viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"/></svg>,
        ArrowUp: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="19" x2="12" y2="5"/><polyline points="5 12 12 5 19 12"/></svg>,
        ArrowDown: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"/><polyline points="19 12 12 19 5 12"/></svg>,
        Trash: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>,
        Edit: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>,
        List: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>,
        MapPin: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>,
        Twitter: <svg width={size} height={size} viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>,
        Pin: <svg width={size} height={size} viewBox="0 0 24 24" fill={filled ? 'currentColor' : 'none'} stroke="currentColor" strokeWidth="2"><line x1="12" y1="17" x2="12" y2="22"/><path d="M5 17h14v-1.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V6h1a2 2 0 0 0 0-4H8a2 2 0 0 0 0 4h1v4.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24Z"/></svg>,
        Image: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="m21 15-5-5L5 21"/></svg>,
        ChevronDown: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="6 9 12 15 18 9"/></svg>,
        Users: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>,
      };
      return <span style={{ display: 'inline-flex', alignItems: 'center', justifyContent: 'center' }}>{icons[name] || icons.Star}</span>;
    };
    
    // Stars as text (for inline display) - matches screenshot exactly
    const Stars = ({ rating }) => {
      const full = Math.floor(rating);
      const half = rating % 1 >= 0.5;
      let s = '';
      for (let i = 0; i < full; i++) s += '★';
      if (half) s += '½';
      return <span className="stars">{s}</span>;
    };
    
    // Interactive star rating - Letterboxd style with HALF STARS
    const StarRating = ({ rating, onChange }) => {
      const handleClick = (star, isHalf) => {
        const newRating = isHalf ? star - 0.5 : star;
        // Toggle off if clicking same rating
        onChange?.(rating === newRating ? 0 : newRating);
      };
      
      return (
        <div className="star-rating-interactive">
          {[1, 2, 3, 4, 5].map(star => (
            <div key={star} className="star-container" style={{ position: 'relative', display: 'inline-block' }}>
              {/* Left half - for half stars */}
              <div 
                style={{ position: 'absolute', left: 0, top: 0, width: '50%', height: '100%', cursor: 'pointer', zIndex: 2 }}
                onClick={() => handleClick(star, true)}
              />
              {/* Right half - for full stars */}
              <div 
                style={{ position: 'absolute', right: 0, top: 0, width: '50%', height: '100%', cursor: 'pointer', zIndex: 2 }}
                onClick={() => handleClick(star, false)}
              />
              <button className={`star-btn ${rating >= star ? 'active' : rating >= star - 0.5 ? 'half' : ''}`}>
                <Icon name="Star" size={32} filled={rating >= star - 0.5} />
              </button>
            </div>
          ))}
          {rating > 0 && <span style={{ marginLeft: 8, fontSize: 14, color: 'var(--text-secondary)' }}>{rating}</span>}
        </div>
      );
    };
    
    // CATEGORY 10: Skeleton Loading Components
    const SkeletonPoster = () => <div className="skeleton skeleton-poster" />;
    
    const SkeletonReviewCard = () => (
      <div className="skeleton-card">
        <div style={{ display: 'flex', gap: 12, marginBottom: 12 }}>
          <div className="skeleton skeleton-avatar" />
          <div style={{ flex: 1 }}>
            <div className="skeleton skeleton-text short" />
            <div className="skeleton skeleton-text" style={{ width: '40%', height: 10 }} />
          </div>
        </div>
        <div className="skeleton skeleton-text" />
        <div className="skeleton skeleton-text medium" />
        <div className="skeleton skeleton-text short" />
      </div>
    );
    
    const SkeletonPosterGrid = ({ count = 6 }) => (
      <div className="poster-grid">
        {Array.from({ length: count }).map((_, i) => (
          <div key={i} className="poster-item">
            <SkeletonPoster />
          </div>
        ))}
      </div>
    );
    
    // Pull to Refresh Component
    const PullToRefresh = ({ isRefreshing }) => (
      <div className={`pull-indicator ${isRefreshing ? 'visible refreshing' : ''}`}>
        <Icon name="Repeat" size={20} />
      </div>
    );
    
    const Avatar = ({ user, size = 'md', className = '' }) => {
      const sizeClass = size === 'sm' ? 'avatar-sm' : size === 'lg' ? 'avatar-lg' : '';
      return <div className={`avatar ${sizeClass} ${className}`}>{user?.username?.charAt(0).toUpperCase() || '?'}</div>;
    };
    
    const Badge = ({ type }) => type ? <span className={`badge badge-${type}`}>{type}</span> : null;
    
    const EmptyState = ({ title, quoteIndex = 0 }) => (
      <div className="empty-state">
        <div className="empty-title">{title}</div>
        <div className="empty-quote">{MOVIE_QUOTES[quoteIndex]}</div>
      </div>
    );
    
    // ==========================================================================
    // MAIN APP
    // ==========================================================================
    function App() {
      const [screen, setScreen] = useState('login');
      const [showTrackingPermission, setShowTrackingPermission] = useState(false); // iOS tracking dialog
      const [bottomTab, setBottomTab] = useState('home');
      const [mainTab, setMainTab] = useState('films');
      const [activityTab, setActivityTab] = useState('friends');
      const [profileTab, setProfileTab] = useState('profile');
      const [genreFilter, setGenreFilter] = useState('All');
      
      const [showActionSheet, setShowActionSheet] = useState(false);
      const [showDetailPage, setShowDetailPage] = useState(null); // CAT 5: Full show detail page
      const [showAddFilm, setShowAddFilm] = useState(false);
      const [showNewList, setShowNewList] = useState(false);
      const [showFilters, setShowFilters] = useState(false);
      const [showListDetail, setShowListDetail] = useState(null); // Changed to store list object
      const [showChat, setShowChat] = useState(null);
      const [selectedEpisode, setSelectedEpisode] = useState(null);
      
      // CATEGORY 2: LISTS STATE
      const [userLists, setUserLists] = useState(LISTS);
      const [likedLists, setLikedLists] = useState({});
      const [showAddToList, setShowAddToList] = useState(false);
      const [listFilter, setListFilter] = useState('all'); // 'all', 'watched', 'unwatched'
      const [listSort, setListSort] = useState('position'); // 'position', 'title', 'year', 'rating'
      const [newListTitle, setNewListTitle] = useState('');
      const [newListDesc, setNewListDesc] = useState('');
      const [newListRanked, setNewListRanked] = useState(true);
      const [newListPublic, setNewListPublic] = useState(true);
      const [newListComments, setNewListComments] = useState(true);
      const [newListEntries, setNewListEntries] = useState([]);
      const [editingListEntry, setEditingListEntry] = useState(null);
      const [entryNoteInput, setEntryNoteInput] = useState('');
      const [editingListId, setEditingListId] = useState(null);
      
      const [watched, setWatched] = useState({ 1: true, 3: true, 5: true, 11: true, 12: true, 13: true, 15: true });
      const [liked, setLiked] = useState({ 1: true, 11: true, 12: true });
      const [ratings, setRatings] = useState({ 1: 4, 3: 4.5, 5: 3.5, 11: 5, 12: 5, 13: 4.5, 15: 4 });
      const [fadeWatched, setFadeWatched] = useState(false);
      const [watchlist, setWatchlist] = useState({ 2: true, 4: true, 14: true });
      const [diaryEntries, setDiaryEntries] = useState(DIARY_ENTRIES);
      
      // NEW 1.1 FEATURES STATE
      const [logDate, setLogDate] = useState(new Date().toISOString().split('T')[0]);
      const [isRewatch, setIsRewatch] = useState(false);
      const [rewatchCount, setRewatchCount] = useState({});
      const [bulkSelectMode, setBulkSelectMode] = useState(false);
      const [selectedForBulk, setSelectedForBulk] = useState({});
      
      // NEW 1.2 REVIEWS STATE
      const [showWriteReview, setShowWriteReview] = useState(false);
      const [reviewText, setReviewText] = useState('');
      const [reviewHasSpoilers, setReviewHasSpoilers] = useState(false);
      const [reviewRating, setReviewRating] = useState(0);
      const [editingReview, setEditingReview] = useState(null);
      const [revealedSpoilers, setRevealedSpoilers] = useState({});
      const [userReviews, setUserReviews] = useState([
        { id: 101, showId: 13, showName: 'Severance', year: 2024, poster: SHOWS.find(s => s.id === 13).poster, rating: 4.5, text: 'The most **unsettling** workplace drama since... well, my actual workplace. The way it explores *identity* and *autonomy* is genuinely haunting.', hasSpoilers: false, date: 'Jan 20, 2025', userId: 'me' },
      ]);
      
      // NEW 1.3 TAGS STATE
      const [entryTags, setEntryTags] = useState({
        1: ['binged', 'at:home'],
        2: ['with:partner', 'comfort-watch'],
        4: ['binged'],
      }); // { showId: ['tag1', 'tag2'] }
      const [currentTags, setCurrentTags] = useState([]); // tags being edited
      const [tagInput, setTagInput] = useState('');
      const [showTagDetail, setShowTagDetail] = useState(null);
      const [allUserTags, setAllUserTags] = useState([
        { name: 'with:partner', count: 12 },
        { name: 'at:home', count: 24 },
        { name: 'rewatch', count: 8 },
        { name: 'comfort-watch', count: 5 },
        { name: 'binged', count: 15 },
        { name: 'with:friends', count: 6 },
        { name: 'airplane', count: 3 },
      ]);
      const popularTags = ['binged', 'comfort-watch', 'with:partner', 'at:home', 'rewatch', 'late-night', 'weekend'];
      
      // NEW 1.4 DIARY STATE
      const [diaryView, setDiaryView] = useState('list'); // 'list' or 'calendar'
      const [diaryMonth, setDiaryMonth] = useState(new Date(2025, 0)); // January 2025
      const [editingDiaryEntry, setEditingDiaryEntry] = useState(null);
      const [showEditDiary, setShowEditDiary] = useState(false);
      
      // NEW CAT 3.1 PROFILE DISPLAY STATE
      const [showEditProfile, setShowEditProfile] = useState(false);
      const [showTopFourPicker, setShowTopFourPicker] = useState(false);
      const [topFourSlot, setTopFourSlot] = useState(null); // Which slot is being edited (0-3)
      const [userProfile, setUserProfile] = useState({
        displayName: USERS.me.displayName || '',
        bio: USERS.me.bio || '',
        location: USERS.me.location || '',
        website: USERS.me.website || '',
        twitter: USERS.me.twitter || '',
        pronouns: USERS.me.pronouns || '',
        backdrop: USERS.me.backdrop || '',
        topFour: USERS.me.topFour || [],
        pinnedReviews: USERS.me.pinnedReviews || [],
        pinnedLists: USERS.me.pinnedLists || [],
      });
      
      const handleSaveProfile = () => {
        // Update the user profile
        USERS.me = { ...USERS.me, ...userProfile };
        setShowEditProfile(false);
      };
      
      const handleAddToTopFour = (showId) => {
        if (topFourSlot !== null) {
          const newTopFour = [...(userProfile.topFour || [])];
          // Ensure array has enough slots
          while (newTopFour.length <= topFourSlot) {
            newTopFour.push(null);
          }
          newTopFour[topFourSlot] = showId;
          setUserProfile({ ...userProfile, topFour: newTopFour });
        }
        setShowTopFourPicker(false);
        setTopFourSlot(null);
      };
      
      const handleRemoveFromTopFour = (index) => {
        const newTopFour = [...(userProfile.topFour || [])];
        newTopFour.splice(index, 1);
        setUserProfile({ ...userProfile, topFour: newTopFour });
      };
      
      const togglePinnedReview = (reviewId) => {
        const pinned = userProfile.pinnedReviews || [];
        if (pinned.includes(reviewId)) {
          setUserProfile({ ...userProfile, pinnedReviews: pinned.filter(id => id !== reviewId) });
        } else {
          setUserProfile({ ...userProfile, pinnedReviews: [...pinned, reviewId] });
        }
      };
      
      const togglePinnedList = (listId) => {
        const pinned = userProfile.pinnedLists || [];
        if (pinned.includes(listId)) {
          setUserProfile({ ...userProfile, pinnedLists: pinned.filter(id => id !== listId) });
        } else {
          setUserProfile({ ...userProfile, pinnedLists: [...pinned, listId] });
        }
      };
      
      const getShowById = (id) => SHOWS.find(s => s.id === id);
      const getReviewById = (id) => [...userReviews, ...REVIEWS].find(r => r.id === id);
      const getListById = (id) => userLists.find(l => l.id === id);
      
      // CAT 3.2 PROFILE TABS STATE
      const [following, setFollowing] = useState(['ari', 'princess', 'lobo', 'drew']);
      const [followers, setFollowers] = useState(['ari', 'princess', 'nolan', 'bryan']);
      const [likedShows, setLikedShows] = useState({ 1: true, 3: true, 5: true, 11: true, 12: true, 13: true }); // showId: true
      const [likedReviews, setLikedReviews] = useState({ 1: true, 3: true }); // reviewId: true
      
      const handleFollow = (userId) => {
        if (following.includes(userId)) {
          setFollowing(following.filter(id => id !== userId));
        } else {
          setFollowing([...following, userId]);
        }
      };
      
      const handleLikeShow = (showId) => {
        setLikedShows(prev => ({ ...prev, [showId]: !prev[showId] }));
      };
      
      const handleLikeReview = (reviewId) => {
        setLikedReviews(prev => ({ ...prev, [reviewId]: !prev[reviewId] }));
      };
      
      // Get all watched shows for Films tab
      const getWatchedShows = () => SHOWS.filter(s => watched[s.id]);
      
      // Get ratings distribution for histogram
      const getRatingsDistribution = () => {
        const dist = { 0.5: 0, 1: 0, 1.5: 0, 2: 0, 2.5: 0, 3: 0, 3.5: 0, 4: 0, 4.5: 0, 5: 0 };
        Object.entries(ratings).forEach(([id, rating]) => {
          if (rating > 0 && dist.hasOwnProperty(rating)) {
            dist[rating]++;
          }
        });
        return dist;
      };
      
      // Get liked content counts
      const getLikedShowsCount = () => Object.values(likedShows).filter(Boolean).length;
      const getLikedReviewsCount = () => Object.values(likedReviews).filter(Boolean).length;
      const getLikedListsCount = () => Object.values(likedLists).filter(Boolean).length;
      
      // CAT 3.2 Tab sub-views
      const [likesView, setLikesView] = useState('films'); // 'films', 'reviews', 'lists'
      const [networkView, setNetworkView] = useState('following'); // 'following', 'followers'
      
      // CAT 3.3 + CAT 4: STATS HELPERS
      const [statsYear, setStatsYear] = useState(2025);
      
      // CATEGORY 6: SEARCH & DISCOVERY STATE
      const [searchQuery, setSearchQuery] = useState('');
      const [searchTab, setSearchTab] = useState('films'); // films, members, lists, reviews
      const [recentSearches, setRecentSearches] = useState(['Succession', 'The Bear', 'reality tv']);
      const [browsePage, setBrowsePage] = useState(null); // null, 'genre', 'decade', 'service', 'popular', 'rated'
      const [browseFilter, setBrowseFilter] = useState(null); // selected genre/decade/service
      const [browseSort, setBrowseSort] = useState('popular'); // popular, rating, name
      
      // CATEGORY 7: SETTINGS & ACCOUNT STATE
      const [showSettings, setShowSettings] = useState(false);
      const [settingsPage, setSettingsPage] = useState('main'); // main, profile, account, notifications, streaming, subscription, privacy
      const [editingProfile, setEditingProfile] = useState({
        displayName: 'TV Enthusiast',
        username: 'tvfan2024',
        bio: 'Obsessed with prestige TV and reality show chaos. Currently watching way too many shows at once.',
        location: 'Los Angeles, CA',
        website: 'https://myblog.com',
        pronouns: 'they/them',
        email: 'tvfan@email.com'
      });
      const [notificationSettings, setNotificationSettings] = useState({
        newFollowers: true,
        reviewLikes: true,
        comments: true,
        listUpdates: false,
        friendActivity: true,
        emailDigest: false
      });
      const [privacySettings, setPrivacySettings] = useState({
        showActivity: true,
        showWatchlist: true,
        showStats: true,
        allowComments: true
      });
      const [selectedStreamingServices, setSelectedStreamingServices] = useState(['Netflix', 'Max', 'Hulu']);
      
      // CATEGORY 8: SOCIAL INTERACTIONS STATE
      const [reviewLikes, setReviewLikes] = useState({}); // { reviewId: true }
      const [reviewReactions, setReviewReactions] = useState({
        // reviewId: { emoji: count, userReacted: boolean }
        1: { '😂': 24, '🔥': 12, '💯': 8 },
        2: { '❤️': 45, '🔥': 18 },
        3: { '😭': 31, '💯': 22 }
      });
      const [userReactions, setUserReactions] = useState({}); // { 'reviewId-emoji': true }
      const [showReactionPicker, setShowReactionPicker] = useState(null); // reviewId or null
      const [reviewComments, setReviewComments] = useState({
        1: [
          { id: 1, userId: 'princess', text: 'This review is everything! 🙌', time: '2h ago', likes: 12, replies: [
            { id: 11, userId: 'nolan', text: '@tvprincess totally agree!', time: '1h ago', likes: 3 }
          ]},
          { id: 2, userId: 'bingewatcher', text: 'Finally someone said it', time: '5h ago', likes: 8, replies: [] }
        ],
        2: [
          { id: 3, userId: 'nolan', text: 'The cinematography alone deserves 5 stars', time: '1d ago', likes: 24, replies: [] }
        ]
      });
      const [expandedComments, setExpandedComments] = useState({}); // { reviewId: true }
      const [commentText, setCommentText] = useState('');
      const [replyingTo, setReplyingTo] = useState(null); // { reviewId, commentId, username }
      const [commentLikes, setCommentLikes] = useState({});
      const [showShareMenu, setShowShareMenu] = useState(null); // reviewId or null
      const [showUserMenu, setShowUserMenu] = useState(null); // userId or null
      const [showReportModal, setShowReportModal] = useState(null); // { type: 'user'|'review', id }
      const [reportReason, setReportReason] = useState('');
      const [blockedUsers, setBlockedUsers] = useState([]);
      const [following, setFollowing] = useState(['princess', 'nolan']); // userIds
      
      const REACTION_EMOJIS = ['❤️', '😂', '🔥', '😭', '💯', '🤯'];
      
      const toggleReviewLike = (reviewId) => {
        setReviewLikes(prev => ({ ...prev, [reviewId]: !prev[reviewId] }));
      };
      
      const toggleReaction = (reviewId, emoji) => {
        const key = `${reviewId}-${emoji}`;
        const wasReacted = userReactions[key];
        
        setUserReactions(prev => ({ ...prev, [key]: !wasReacted }));
        setReviewReactions(prev => {
          const reviewEmojis = prev[reviewId] || {};
          const currentCount = reviewEmojis[emoji] || 0;
          return {
            ...prev,
            [reviewId]: {
              ...reviewEmojis,
              [emoji]: wasReacted ? Math.max(0, currentCount - 1) : currentCount + 1
            }
          };
        });
        setShowReactionPicker(null);
      };
      
      const addComment = (reviewId) => {
        if (!commentText.trim()) return;
        
        const newComment = {
          id: Date.now(),
          userId: 'me',
          text: replyingTo ? `@${replyingTo.username} ${commentText}` : commentText,
          time: 'Just now',
          likes: 0,
          replies: []
        };
        
        setReviewComments(prev => {
          const comments = prev[reviewId] || [];
          if (replyingTo && replyingTo.commentId) {
            return {
              ...prev,
              [reviewId]: comments.map(c => 
                c.id === replyingTo.commentId 
                  ? { ...c, replies: [...(c.replies || []), newComment] }
                  : c
              )
            };
          }
          return { ...prev, [reviewId]: [...comments, newComment] };
        });
        
        setCommentText('');
        setReplyingTo(null);
      };
      
      const toggleCommentLike = (commentId) => {
        setCommentLikes(prev => ({ ...prev, [commentId]: !prev[commentId] }));
      };
      
      const toggleFollow = (userId) => {
        setFollowing(prev => 
          prev.includes(userId) 
            ? prev.filter(id => id !== userId)
            : [...prev, userId]
        );
      };
      
      const blockUser = (userId) => {
        setBlockedUsers(prev => [...prev, userId]);
        setShowUserMenu(null);
        alert(`User blocked. You won't see their content anymore.`);
      };
      
      const reportContent = (type, id) => {
        if (!reportReason) return;
        alert(`Thank you for reporting. We'll review this ${type} shortly.`);
        setShowReportModal(null);
        setReportReason('');
      };
      
      const copyLink = (reviewId) => {
        navigator.clipboard?.writeText(`https://rocketwatch.app/review/${reviewId}`);
        alert('Link copied to clipboard!');
        setShowShareMenu(null);
      };
      
      const shareToTwitter = (review) => {
        const text = `Check out this review of ${review.showName} on RocketWatch!`;
        window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}`, '_blank');
        setShowShareMenu(null);
      };
      
      // CATEGORY 10: ADVANCED FEATURES STATE
      const [showOnboarding, setShowOnboarding] = useState(false);
      const [onboardingStep, setOnboardingStep] = useState(0);
      const [isOffline, setIsOffline] = useState(false);
      const [isRefreshing, setIsRefreshing] = useState(false);
      const [showCalendarView, setShowCalendarView] = useState(false);
      const [calendarMonth, setCalendarMonth] = useState(new Date().getMonth());
      const [calendarYear, setCalendarYear] = useState(new Date().getFullYear());
      const [showAdvancedFilters, setShowAdvancedFilters] = useState(false);
      const [advancedFilters, setAdvancedFilters] = useState({
        genres: [],
        yearFrom: 1990,
        yearTo: 2025,
        ratingMin: 0,
        ratingMax: 5,
        services: []
      });
      const [showImportExport, setShowImportExport] = useState(false);
      const [importProgress, setImportProgress] = useState(0);
      const [isImporting, setIsImporting] = useState(false);
      const [watchlistSort, setWatchlistSort] = useState('added'); // added, priority, title, year
      const [watchlistPriorities, setWatchlistPriorities] = useState({ 2: 'high', 4: 'medium', 14: 'low' }); // { showId: 'high' | 'medium' | 'low' }
      const [showPriorityPicker, setShowPriorityPicker] = useState(null); // showId or null
      
      // CAST & CREW PAGE STATE
      const [selectedPerson, setSelectedPerson] = useState(null); // person object or null
      const [personSort, setPersonSort] = useState('year'); // year, rating, title
      const [personFilter, setPersonFilter] = useState('all'); // all, actor, director, writer
      const [followedPeople, setFollowedPeople] = useState(['jeremy-allen-white', 'bryan-cranston']); // person IDs
      const [personBioExpanded, setPersonBioExpanded] = useState(false);
      const [showShortcuts, setShowShortcuts] = useState(false);
      const [showSkeleton, setShowSkeleton] = useState(false);
      
      const ONBOARDING_SLIDES = [
        { emoji: '🚀', title: 'Track your shows', desc: 'Use RocketWatch to track the shows you\'ve watched, and those you want to watch.' },
        { emoji: '📓', title: 'Build your diary', desc: 'Log and rate each show as you watch it, to build up a diary of your viewing history.' },
        { emoji: '✍️', title: 'Review & discuss', desc: 'Add a review and tags to each entry, then share and discuss with others.' },
        { emoji: '👥', title: 'Follow friends', desc: 'Follow your friends to see what they\'re watching and liking in your activity feed.' }
      ];
      
      const KEYBOARD_SHORTCUTS = [
        { keys: ['/', '⌘K'], desc: 'Open search' },
        { keys: ['L'], desc: 'Log a show' },
        { keys: ['W'], desc: 'Add to watchlist' },
        { keys: ['R'], desc: 'Write a review' },
        { keys: ['1-5'], desc: 'Quick rate (1-5 stars)' },
        { keys: ['Esc'], desc: 'Close modal' },
        { keys: ['?'], desc: 'Show shortcuts' }
      ];
      
      // Offline detection
      React.useEffect(() => {
        const handleOnline = () => setIsOffline(false);
        const handleOffline = () => setIsOffline(true);
        window.addEventListener('online', handleOnline);
        window.addEventListener('offline', handleOffline);
        setIsOffline(!navigator.onLine);
        return () => {
          window.removeEventListener('online', handleOnline);
          window.removeEventListener('offline', handleOffline);
        };
      }, []);
      
      // Keyboard shortcuts
      React.useEffect(() => {
        const handleKeyDown = (e) => {
          if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
          
          if (e.key === '/' || (e.metaKey && e.key === 'k')) {
            e.preventDefault();
            setBottomTab('search');
          } else if (e.key === '?' && !e.shiftKey) {
            setShowShortcuts(true);
          } else if (e.key === 'Escape') {
            setShowShortcuts(false);
            setShowAdvancedFilters(false);
            setShowImportExport(false);
            setShowCalendarView(false);
          }
        };
        window.addEventListener('keydown', handleKeyDown);
        return () => window.removeEventListener('keydown', handleKeyDown);
      }, []);
      
      // Pull to refresh simulation
      const handlePullRefresh = () => {
        setIsRefreshing(true);
        setTimeout(() => setIsRefreshing(false), 1500);
      };
      
      // Calendar helpers
      const getCalendarDays = () => {
        const firstDay = new Date(calendarYear, calendarMonth, 1);
        const lastDay = new Date(calendarYear, calendarMonth + 1, 0);
        const daysInMonth = lastDay.getDate();
        const startDay = firstDay.getDay();
        
        const days = [];
        // Previous month days
        const prevMonth = new Date(calendarYear, calendarMonth, 0);
        for (let i = startDay - 1; i >= 0; i--) {
          days.push({ day: prevMonth.getDate() - i, otherMonth: true });
        }
        // Current month days
        for (let i = 1; i <= daysInMonth; i++) {
          const dateStr = `${calendarYear}-${String(calendarMonth + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
          const entries = diaryEntries.filter(e => e.fullDate === dateStr);
          days.push({ 
            day: i, 
            otherMonth: false, 
            isToday: new Date().toDateString() === new Date(calendarYear, calendarMonth, i).toDateString(),
            entries 
          });
        }
        // Next month days
        const remaining = 42 - days.length;
        for (let i = 1; i <= remaining; i++) {
          days.push({ day: i, otherMonth: true });
        }
        return days;
      };
      
      const MONTHS = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
      
      // Export functions
      const escapeCSV = (str) => {
        if (!str) return '';
        const escaped = String(str).replace(/"/g, '""');
        return escaped.includes(',') || escaped.includes('"') || escaped.includes('\n') ? `"${escaped}"` : escaped;
      };
      
      const exportDiaryCSV = () => {
        const headers = ['Date', 'Show', 'Rating', 'Rewatch', 'Review'];
        const rows = diaryEntries.map(e => [
          escapeCSV(e.fullDate || e.date),
          escapeCSV(e.showName),
          e.rating || '',
          e.isRewatch ? 'Yes' : 'No',
          escapeCSV(e.review || '')
        ]);
        const csv = [headers, ...rows].map(r => r.join(',')).join('\n');
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'rocketwatch-diary.csv';
        a.click();
        URL.revokeObjectURL(url);
        alert('Diary exported successfully!');
      };
      
      const exportWatchlistCSV = () => {
        const headers = ['Show', 'Year', 'Genre', 'Priority'];
        const rows = SHOWS.filter(s => watchlist[s.id]).map(s => [
          escapeCSV(s.name),
          s.year,
          escapeCSV(s.genre),
          watchlistPriorities[s.id] || 'none'
        ]);
        const csv = [headers, ...rows].map(r => r.join(',')).join('\n');
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'rocketwatch-watchlist.csv';
        a.click();
        URL.revokeObjectURL(url);
        alert('Watchlist exported successfully!');
      };
      
      // Import simulation
      const simulateImport = () => {
        setIsImporting(true);
        setImportProgress(0);
        const interval = setInterval(() => {
          setImportProgress(p => {
            if (p >= 100) {
              clearInterval(interval);
              setIsImporting(false);
              alert('Import complete! 47 shows added to your diary.');
              return 100;
            }
            return p + 10;
          });
        }, 300);
      };
      
      // Sorted watchlist
      const getSortedWatchlist = () => {
        const watchlistShows = SHOWS.filter(s => watchlist[s.id]);
        switch (watchlistSort) {
          case 'priority':
            const priorityOrder = { high: 0, medium: 1, low: 2, undefined: 3 };
            return watchlistShows.sort((a, b) => 
              (priorityOrder[watchlistPriorities[a.id]] || 3) - (priorityOrder[watchlistPriorities[b.id]] || 3)
            );
          case 'title':
            return watchlistShows.sort((a, b) => a.name.localeCompare(b.name));
          case 'year':
            return watchlistShows.sort((a, b) => parseInt(b.year) - parseInt(a.year));
          default:
            return watchlistShows;
        }
      };
      
      // CAST & CREW HELPER FUNCTIONS
      const openPersonPage = (personName) => {
        // Try to find person in PEOPLE database
        const personKey = personName.toLowerCase().replace(/[^a-z]/g, '-').replace(/-+/g, '-');
        const person = PEOPLE[personKey] || Object.values(PEOPLE).find(p => p.name === personName);
        
        if (person) {
          setSelectedPerson(person);
          setPersonBioExpanded(false);
          setPersonFilter('all');
          setPersonSort('year');
        } else {
          // Build filmography from SHOWS data for unknown people
          const filmography = [];
          SHOWS.forEach(show => {
            // Check cast
            const castRole = show.cast?.find(c => c.name === personName);
            if (castRole) {
              filmography.push({
                showId: show.id,
                role: castRole.role,
                type: 'actor',
                year: parseInt(show.year)
              });
            }
            // Check crew
            const crewRole = show.crew?.find(c => c.name === personName);
            if (crewRole) {
              const roleType = crewRole.role.toLowerCase().includes('director') ? 'director' 
                : crewRole.role.toLowerCase().includes('writer') ? 'writer' 
                : 'crew';
              filmography.push({
                showId: show.id,
                role: crewRole.role,
                type: roleType,
                year: parseInt(show.year)
              });
            }
          });
          
          // Find photo from first cast role
          const firstShow = filmography.length > 0 ? SHOWS.find(s => s.id === filmography[0].showId) : null;
          const castEntry = firstShow?.cast?.find(c => c.name === personName);
          
          setSelectedPerson({
            id: personKey,
            name: personName,
            photo: castEntry?.photo || null,
            knownFor: filmography.length > 0 
              ? (filmography.some(f => f.type === 'director') ? 'Directing' : 'Acting')
              : 'Film & TV',
            bio: null,
            filmography: filmography.sort((a, b) => b.year - a.year)
          });
          setPersonBioExpanded(false);
          setPersonFilter('all');
          setPersonSort('year');
        }
      };
      
      const getFilteredFilmography = (person) => {
        if (!person?.filmography) return [];
        let films = [...person.filmography];
        
        // Apply filter
        if (personFilter !== 'all') {
          films = films.filter(f => f.type === personFilter);
        }
        
        // Apply sort
        switch (personSort) {
          case 'rating':
            films.sort((a, b) => {
              const ratingA = a.showId ? (ratings[a.showId] || 0) : 0;
              const ratingB = b.showId ? (ratings[b.showId] || 0) : 0;
              return ratingB - ratingA;
            });
            break;
          case 'title':
            films.sort((a, b) => {
              const titleA = a.showId ? SHOWS.find(s => s.id === a.showId)?.name || a.title : a.title;
              const titleB = b.showId ? SHOWS.find(s => s.id === b.showId)?.name || b.title : b.title;
              return titleA.localeCompare(titleB);
            });
            break;
          case 'year':
          default:
            films.sort((a, b) => b.year - a.year);
            break;
        }
        
        return films;
      };
      
      const getPersonStats = (person) => {
        if (!person?.filmography) return { films: 0, watched: 0, avgRating: 0 };
        
        const totalFilms = person.filmography.length;
        const watchedFilms = person.filmography.filter(f => f.showId && watched[f.showId]).length;
        
        const ratedFilms = person.filmography.filter(f => f.showId && ratings[f.showId]);
        const avgRating = ratedFilms.length > 0 
          ? ratedFilms.reduce((sum, f) => sum + (ratings[f.showId] || 0), 0) / ratedFilms.length 
          : 0;
        
        return { films: totalFilms, watched: watchedFilms, avgRating: avgRating.toFixed(1) };
      };
      
      const toggleFollowPerson = (personId) => {
        setFollowedPeople(prev => 
          prev.includes(personId) 
            ? prev.filter(id => id !== personId)
            : [...prev, personId]
        );
      };
      
      const currentYear = 2025;
      
      // Films watched in a specific year (based on diary entries)
      const getFilmsInYear = (year) => {
        return diaryEntries.filter(e => {
          const entryYear = e.fullDate ? new Date(e.fullDate).getFullYear() : currentYear;
          return entryYear === year;
        }).length;
      };
      
      // Films watched this year (for profile display - always current year)
      const getFilmsThisYear = () => getFilmsInYear(currentYear);
      
      // Films watched in selected stats year
      const getFilmsInStatsYear = () => getFilmsInYear(statsYear);
      
      // Total hours watched (mock runtime data ~45min per episode avg)
      const getTotalHoursWatched = () => {
        const totalMinutes = Object.values(watched).filter(Boolean).length * 45 * 8; // 8 episodes avg
        return Math.round(totalMinutes / 60);
      };
      
      // Genre distribution from watched shows
      const getGenreDistribution = () => {
        const genres = {};
        SHOWS.filter(s => watched[s.id]).forEach(show => {
          genres[show.genre] = (genres[show.genre] || 0) + 1;
        });
        return Object.entries(genres).sort((a, b) => b[1] - a[1]);
      };
      
      // Decade distribution (mock - based on year)
      const getDecadeDistribution = () => {
        const decades = { '2020s': 0, '2010s': 0, '2000s': 0, '1990s': 0 };
        SHOWS.filter(s => watched[s.id]).forEach(show => {
          const year = parseInt(show.year);
          if (year >= 2020) decades['2020s']++;
          else if (year >= 2010) decades['2010s']++;
          else if (year >= 2000) decades['2000s']++;
          else decades['1990s']++;
        });
        return Object.entries(decades).filter(([_, count]) => count > 0);
      };
      
      // Longest watching streak
      const getLongestStreak = () => {
        // Mock calculation - would need real date data
        return 12; // days
      };
      
      // Films per month this year
      const getFilmsPerMonth = () => {
        const months = Array(12).fill(0);
        diaryEntries.forEach(e => {
          if (e.fullDate) {
            const date = new Date(e.fullDate);
            if (date.getFullYear() === statsYear) {
              months[date.getMonth()]++;
            }
          }
        });
        return months;
      };
      
      // Highest and lowest rated
      const getHighestRated = () => {
        let highest = null;
        let highestRating = 0;
        Object.entries(ratings).forEach(([id, rating]) => {
          if (rating > highestRating) {
            highestRating = rating;
            highest = SHOWS.find(s => s.id === parseInt(id));
          }
        });
        return highest ? { show: highest, rating: highestRating } : null;
      };
      
      const getLowestRated = () => {
        let lowest = null;
        let lowestRating = 6;
        Object.entries(ratings).forEach(([id, rating]) => {
          if (rating > 0 && rating < lowestRating) {
            lowestRating = rating;
            lowest = SHOWS.find(s => s.id === parseInt(id));
          }
        });
        return lowest ? { show: lowest, rating: lowestRating } : null;
      };
      
      // CATEGORY 6: SEARCH & DISCOVERY HELPERS
      const GENRES = [
        { name: 'Drama', icon: '🎭', color: '#8B5CF6' },
        { name: 'Comedy', icon: '😂', color: '#F59E0B' },
        { name: 'Reality', icon: '📺', color: '#EC4899' },
        { name: 'Thriller', icon: '😱', color: '#EF4444' },
        { name: 'Sci-Fi', icon: '🚀', color: '#3B82F6' },
        { name: 'Documentary', icon: '🎬', color: '#10B981' },
      ];
      
      const DECADES = [
        { name: '2020s', range: [2020, 2029] },
        { name: '2010s', range: [2010, 2019] },
        { name: '2000s', range: [2000, 2009] },
        { name: '1990s', range: [1990, 1999] },
      ];
      
      const SERVICES = [
        { name: 'Netflix', icon: 'N', color: '#E50914' },
        { name: 'Max', icon: 'M', color: '#002BE7' },
        { name: 'Hulu', icon: 'H', color: '#1CE783' },
        { name: 'Disney+', icon: 'D', color: '#113CCF' },
        { name: 'Apple TV+', icon: 'A', color: '#000000' },
        { name: 'Amazon', icon: 'P', color: '#00A8E1' },
        { name: 'Peacock', icon: 'P', color: '#000000' },
        { name: 'Paramount+', icon: 'P', color: '#0064FF' },
      ];
      
      const searchShows = (query) => {
        if (!query.trim()) return [];
        const q = query.toLowerCase();
        return SHOWS.filter(s => 
          s.name.toLowerCase().includes(q) || 
          s.genre?.toLowerCase().includes(q) ||
          s.director?.toLowerCase().includes(q) ||
          s.cast?.some(c => c.name.toLowerCase().includes(q)) ||
          s.crew?.some(c => c.name.toLowerCase().includes(q))
        );
      };
      
      const searchMembers = (query) => {
        if (!query.trim()) return [];
        const q = query.toLowerCase();
        return Object.values(USERS).filter(u => 
          u.username?.toLowerCase().includes(q) || 
          u.displayName?.toLowerCase().includes(q)
        );
      };
      
      const searchLists = (query) => {
        if (!query.trim()) return [];
        const q = query.toLowerCase();
        return LISTS.filter(l => 
          l.title?.toLowerCase().includes(q) || 
          l.desc?.toLowerCase().includes(q)
        );
      };
      
      const searchReviews = (query) => {
        if (!query.trim()) return [];
        const q = query.toLowerCase();
        return [...REVIEWS, ...userReviews].filter(r => 
          r.showName?.toLowerCase().includes(q) || 
          r.text?.toLowerCase().includes(q)
        );
      };
      
      const getShowsByGenre = (genre) => SHOWS.filter(s => s.genre === genre);
      
      const getShowsByDecade = (decade) => {
        const d = DECADES.find(dd => dd.name === decade);
        if (!d) return [];
        return SHOWS.filter(s => {
          const year = parseInt(s.year);
          return year >= d.range[0] && year <= d.range[1];
        });
      };
      
      const getShowsByService = (service) => {
        return SHOWS.filter(s => s.streaming?.some(st => st.name === service));
      };
      
      const getPopularShows = () => {
        return [...SHOWS].sort((a, b) => (b.watchCount || 0) - (a.watchCount || 0));
      };
      
      const getHighestRatedShows = () => {
        return [...SHOWS].sort((a, b) => (b.communityRating || 0) - (a.communityRating || 0));
      };
      
      const sortShows = (shows, sortBy) => {
        switch (sortBy) {
          case 'rating': return [...shows].sort((a, b) => (b.communityRating || 0) - (a.communityRating || 0));
          case 'name': return [...shows].sort((a, b) => a.name.localeCompare(b.name));
          case 'popular': 
          default: return [...shows].sort((a, b) => (b.watchCount || 0) - (a.watchCount || 0));
        }
      };
      
      const handleSearch = (query) => {
        setSearchQuery(query);
        if (query.trim() && !recentSearches.includes(query.trim())) {
          // Will add to recent when user clicks a result
        }
      };
      
      const addToRecentSearches = (query) => {
        if (!query.trim()) return;
        setRecentSearches(prev => {
          const filtered = prev.filter(s => s !== query.trim());
          return [query.trim(), ...filtered].slice(0, 5);
        });
      };
      
      const clearRecentSearches = () => setRecentSearches([]);
      
      const highlightMatch = (text, query) => {
        if (!query.trim()) return text;
        const regex = new RegExp(`(${query.trim()})`, 'gi');
        const parts = text.split(regex);
        return parts.map((part, i) => 
          regex.test(part) ? <mark key={i}>{part}</mark> : part
        );
      };
      
      const handleEpisodePress = (ep) => { 
        if (bulkSelectMode) {
          setSelectedForBulk(prev => ({ ...prev, [ep.id]: !prev[ep.id] }));
        } else {
          // CAT 5: Open full detail page instead of action sheet
          const fullShow = SHOWS.find(s => s.id === ep.id);
          setShowDetailPage(fullShow || ep);
        }
      };
      
      // Open quick action sheet from detail page
      const handleOpenActionSheet = (show) => {
        setSelectedEpisode({ id: show.id, poster: show.poster, showName: show.name, year: show.year });
        setLogDate(new Date().toISOString().split('T')[0]);
        setIsRewatch(watched[show.id] || false);
        setCurrentTags(entryTags[show.id] || []);
        setTagInput('');
        setShowActionSheet(true);
      };
      
      // Mark as watched with date - NEW 1.1 FEATURE
      const handleMarkWatched = () => {
        const id = selectedEpisode.id;
        const wasWatched = watched[id];
        
        // If already watched and rewatch toggle is ON, add new diary entry
        if (wasWatched && isRewatch) {
          setRewatchCount(prev => ({ ...prev, [id]: (prev[id] || 1) + 1 }));
          const newEntry = {
            id: Date.now(),
            day: new Date(logDate).getDate().toString(),
            fullDate: logDate,
            showName: selectedEpisode.showName,
            year: selectedEpisode.year || 2024,
            rating: ratings[id] || 0,
            liked: liked[id] || false,
            rewatch: true,
            poster: selectedEpisode.poster,
            isDraft: false,
            tags: currentTags,
          };
          setDiaryEntries(prev => [newEntry, ...prev]);
          saveTagsForEntry(id);
          return; // Don't toggle off
        }
        
        // Toggle watched state
        setWatched(prev => ({ ...prev, [id]: !prev[id] }));
        
        // If marking as watched (not unwatching)
        if (!wasWatched) {
          // Auto-remove from watchlist - NEW 1.1 FEATURE
          if (watchlist[id]) {
            setWatchlist(prev => ({ ...prev, [id]: false }));
          }
          // Save tags
          if (currentTags.length > 0) {
            saveTagsForEntry(id);
          }
          // Add first watch to diary
          const newEntry = {
            id: Date.now(),
            day: new Date(logDate).getDate().toString(),
            fullDate: logDate,
            showName: selectedEpisode.showName,
            year: selectedEpisode.year || 2024,
            rating: ratings[id] || 0,
            liked: liked[id] || false,
            rewatch: false,
            poster: selectedEpisode.poster,
            isDraft: false,
            tags: currentTags,
          };
          setDiaryEntries(prev => [newEntry, ...prev]);
        }
      };
      
      // Bulk mark as watched - NEW 1.1 FEATURE
      const handleBulkMarkWatched = () => {
        const selected = Object.keys(selectedForBulk).filter(k => selectedForBulk[k]);
        const updates = {};
        selected.forEach(id => { updates[id] = true; });
        setWatched(prev => ({ ...prev, ...updates }));
        const newEntries = selected.map(id => {
          const show = SHOWS.find(s => s.id === parseInt(id));
          return {
            id: Date.now() + parseInt(id),
            day: new Date().getDate().toString(),
            showName: show?.name || 'Unknown',
            year: show?.year || 2024,
            rating: 0,
            liked: false,
            rewatch: false,
            poster: show?.poster,
            isDraft: false,
          };
        });
        setDiaryEntries(prev => [...newEntries, ...prev]);
        setBulkSelectMode(false);
        setSelectedForBulk({});
      };
      
      // Save as draft - NEW 1.1 FEATURE
      const handleSaveAsDraft = () => {
        const newEntry = {
          id: Date.now(),
          day: new Date(logDate).getDate().toString(),
          fullDate: logDate,
          showName: selectedEpisode.showName,
          year: selectedEpisode.year || 2024,
          rating: ratings[selectedEpisode.id] || 0,
          liked: liked[selectedEpisode.id] || false,
          rewatch: isRewatch,
          poster: selectedEpisode.poster,
          isDraft: true,
          tags: currentTags,
        };
        setDiaryEntries(prev => [newEntry, ...prev]);
        setShowActionSheet(false);
      };
      
      // Export data - NEW 1.1 FEATURE
      const handleExportData = (format) => {
        const data = {
          watched: Object.keys(watched).filter(k => watched[k]).map(id => {
            const show = SHOWS.find(s => s.id === parseInt(id));
            return { id, name: show?.name, rating: ratings[id], liked: liked[id] };
          }),
          watchlist: Object.keys(watchlist).filter(k => watchlist[k]).map(id => {
            const show = SHOWS.find(s => s.id === parseInt(id));
            return { id, name: show?.name };
          }),
          diary: diaryEntries,
        };
        if (format === 'json') {
          const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url; a.download = 'rocketwatch-export.json'; a.click();
        } else if (format === 'csv') {
          const csv = data.watched.map(w => `${w.name},${w.rating || ''},${w.liked ? 'Yes' : 'No'}`).join('\n');
          const blob = new Blob([`Name,Rating,Liked\n${csv}`], { type: 'text/csv' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url; a.download = 'rocketwatch-export.csv'; a.click();
        }
        alert(`Exported ${data.watched.length} watched, ${data.watchlist.length} watchlist, ${data.diary.length} diary entries`);
      };
      
      // NEW 1.2 REVIEW FUNCTIONS
      const handleOpenWriteReview = (show) => {
        setSelectedEpisode(show);
        setReviewText('');
        setReviewHasSpoilers(false);
        setReviewRating(ratings[show?.id] || 0);
        setEditingReview(null);
        setShowWriteReview(true);
        setShowActionSheet(false);
      };
      
      const handleEditReview = (review) => {
        setSelectedEpisode({ id: review.showId, showName: review.showName, poster: review.poster, year: review.year });
        setReviewText(review.text);
        setReviewHasSpoilers(review.hasSpoilers);
        setReviewRating(review.rating || 0);
        setEditingReview(review);
        setShowWriteReview(true);
      };
      
      const handleSaveReview = () => {
        if (!reviewText.trim() && !reviewRating) return;
        
        if (editingReview) {
          // Update existing review
          setUserReviews(prev => prev.map(r => 
            r.id === editingReview.id 
              ? { ...r, text: reviewText, hasSpoilers: reviewHasSpoilers, rating: reviewRating }
              : r
          ));
        } else {
          // Create new review
          const newReview = {
            id: Date.now(),
            showId: selectedEpisode.id,
            showName: selectedEpisode.showName,
            year: selectedEpisode.year || 2024,
            poster: selectedEpisode.poster,
            rating: reviewRating,
            text: reviewText,
            hasSpoilers: reviewHasSpoilers,
            date: new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }),
            userId: 'me',
          };
          setUserReviews(prev => [newReview, ...prev]);
          
          // Also update ratings if set
          if (reviewRating > 0) {
            setRatings(prev => ({ ...prev, [selectedEpisode.id]: reviewRating }));
          }
        }
        
        setShowWriteReview(false);
        setReviewText('');
        setEditingReview(null);
      };
      
      const handleDeleteReview = (reviewId) => {
        if (confirm('Delete this review? This cannot be undone.')) {
          setUserReviews(prev => prev.filter(r => r.id !== reviewId));
        }
      };
      
      const toggleSpoilerReveal = (reviewId) => {
        setRevealedSpoilers(prev => ({ ...prev, [reviewId]: !prev[reviewId] }));
      };
      
      // Format text helpers
      const insertFormat = (format) => {
        const textarea = document.querySelector('.review-textarea');
        if (!textarea) return;
        const start = textarea.selectionStart;
        const end = textarea.selectionEnd;
        const selected = reviewText.substring(start, end);
        let formatted;
        if (format === 'bold') formatted = `**${selected}**`;
        else if (format === 'italic') formatted = `*${selected}*`;
        else if (format === 'link') formatted = `[${selected}](url)`;
        else return;
        const newText = reviewText.substring(0, start) + formatted + reviewText.substring(end);
        setReviewText(newText);
      };
      
      // Render markdown in reviews
      const renderMarkdown = (text) => {
        if (!text) return null;
        // Process bold **text**
        let html = text.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
        // Process italic *text*
        html = html.replace(/\*(.+?)\*/g, '<em>$1</em>');
        // Process links [text](url)
        html = html.replace(/\[(.+?)\]\((.+?)\)/g, '<a href="$2" style="color: var(--brand-blue)">$1</a>');
        return <span dangerouslySetInnerHTML={{ __html: html }} />;
      };
      
      // NEW 1.3 TAG FUNCTIONS
      const handleAddTag = (tag) => {
        const cleanTag = tag.trim().toLowerCase().replace(/[^a-z0-9:-]/g, '-');
        if (cleanTag && !currentTags.includes(cleanTag)) {
          setCurrentTags([...currentTags, cleanTag]);
          // Update global tag list
          if (!allUserTags.find(t => t.name === cleanTag)) {
            setAllUserTags([...allUserTags, { name: cleanTag, count: 1 }]);
          }
        }
        setTagInput('');
      };
      
      const handleRemoveTag = (tag) => {
        setCurrentTags(currentTags.filter(t => t !== tag));
      };
      
      const handleTagInputKeyDown = (e) => {
        if (e.key === 'Enter' || e.key === ',') {
          e.preventDefault();
          handleAddTag(tagInput);
        } else if (e.key === 'Backspace' && !tagInput && currentTags.length > 0) {
          handleRemoveTag(currentTags[currentTags.length - 1]);
        }
      };
      
      const saveTagsForEntry = (showId) => {
        setEntryTags(prev => ({ ...prev, [showId]: currentTags }));
        // Update tag counts
        setAllUserTags(prev => {
          const updated = [...prev];
          currentTags.forEach(tag => {
            const existing = updated.find(t => t.name === tag);
            if (existing) {
              existing.count += 1;
            } else {
              updated.push({ name: tag, count: 1 });
            }
          });
          return updated;
        });
      };
      
      const isNestedTag = (tag) => tag.includes(':');
      
      const getEntriesForTag = (tagName) => {
        return Object.entries(entryTags)
          .filter(([_, tags]) => tags.includes(tagName))
          .map(([showId]) => SHOWS.find(s => s.id === parseInt(showId)))
          .filter(Boolean);
      };
      
      // NEW 1.4 DIARY HELPER FUNCTIONS
      const getDaysInMonth = (date) => new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate();
      const getFirstDayOfMonth = (date) => new Date(date.getFullYear(), date.getMonth(), 1).getDay();
      
      const getEntriesForDay = (day) => {
        return diaryEntries.filter(entry => parseInt(entry.day) === day);
      };
      
      const formatMonthYear = (date) => {
        return date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' }).toUpperCase();
      };
      
      const handlePrevMonth = () => {
        setDiaryMonth(new Date(diaryMonth.getFullYear(), diaryMonth.getMonth() - 1));
      };
      
      const handleNextMonth = () => {
        setDiaryMonth(new Date(diaryMonth.getFullYear(), diaryMonth.getMonth() + 1));
      };
      
      const handleEditDiaryEntry = (entry) => {
        setEditingDiaryEntry(entry);
        setShowEditDiary(true);
      };
      
      const handleUpdateDiaryEntry = (updatedEntry) => {
        setDiaryEntries(prev => prev.map(e => e.id === updatedEntry.id ? updatedEntry : e));
        setShowEditDiary(false);
        setEditingDiaryEntry(null);
      };
      
      const handleDeleteDiaryEntry = (entryId) => {
        if (!confirm('Delete this diary entry?')) return;
        setDiaryEntries(prev => prev.filter(e => e.id !== entryId));
        setShowEditDiary(false);
        setEditingDiaryEntry(null);
      };
      
      const handleRenameTag = (oldName, newName) => {
        const cleanNew = newName.trim().toLowerCase().replace(/[^a-z0-9:-]/g, '-');
        if (!cleanNew || oldName === cleanNew) return;
        
        // Update all entries
        setEntryTags(prev => {
          const updated = {};
          Object.entries(prev).forEach(([id, tags]) => {
            updated[id] = tags.map(t => t === oldName ? cleanNew : t);
          });
          return updated;
        });
        
        // Update tag list
        setAllUserTags(prev => {
          const filtered = prev.filter(t => t.name !== oldName);
          const existing = filtered.find(t => t.name === cleanNew);
          if (existing) {
            existing.count += prev.find(t => t.name === oldName)?.count || 0;
          } else {
            filtered.push({ name: cleanNew, count: prev.find(t => t.name === oldName)?.count || 1 });
          }
          return filtered;
        });
        
        setShowTagDetail(cleanNew);
      };
      
      const handleDeleteTag = (tagName) => {
        if (!confirm(`Delete tag "${tagName}"? This will remove it from all entries.`)) return;
        
        setEntryTags(prev => {
          const updated = {};
          Object.entries(prev).forEach(([id, tags]) => {
            updated[id] = tags.filter(t => t !== tagName);
          });
          return updated;
        });
        
        setAllUserTags(prev => prev.filter(t => t.name !== tagName));
        setShowTagDetail(null);
      };
      
      // CATEGORY 2: LISTS FUNCTIONS
      const handleCreateList = () => {
        if (!newListTitle.trim()) return;
        
        if (editingListId) {
          // Update existing list
          setUserLists(prev => prev.map(l => {
            if (l.id !== editingListId) return l;
            return {
              ...l,
              title: newListTitle.trim(),
              desc: newListDesc.trim(),
              entries: newListEntries,
              posters: newListEntries.slice(0, 6).map(e => SHOWS.find(s => s.id === e.showId)?.poster).filter(Boolean),
              isRanked: newListRanked,
              isPublic: newListPublic,
              allowComments: newListComments
            };
          }));
        } else {
          // Create new list
          const newList = {
            id: Date.now(),
            userId: 'me',
            title: newListTitle.trim(),
            desc: newListDesc.trim(),
            entries: newListEntries,
            posters: newListEntries.slice(0, 6).map(e => SHOWS.find(s => s.id === e.showId)?.poster).filter(Boolean),
            isRanked: newListRanked,
            isPublic: newListPublic,
            allowComments: newListComments,
            likes: 0,
            comments: 0,
            createdAt: new Date().toISOString().split('T')[0],
            tags: []
          };
          setUserLists(prev => [newList, ...prev]);
        }
        
        setShowNewList(false);
        setNewListTitle('');
        setNewListDesc('');
        setNewListEntries([]);
        setNewListRanked(true);
        setNewListPublic(true);
        setNewListComments(true);
        setEditingListId(null);
      };
      
      const handleToggleListLike = (listId) => {
        const isCurrentlyLiked = likedLists[listId];
        setLikedLists(prev => ({ ...prev, [listId]: !prev[listId] }));
        setUserLists(prev => prev.map(l => 
          l.id === listId 
            ? { ...l, likes: l.likes + (isCurrentlyLiked ? -1 : 1) }
            : l
        ));
      };
      
      const handleAddToList = (listId, show) => {
        setUserLists(prev => prev.map(l => {
          if (l.id !== listId) return l;
          const exists = l.entries.some(e => e.showId === show.id);
          if (exists) {
            // Remove from list
            return {
              ...l,
              entries: l.entries.filter(e => e.showId !== show.id),
              posters: l.posters.filter(p => p !== show.poster)
            };
          } else {
            // Add to list
            return {
              ...l,
              entries: [...l.entries, { showId: show.id, position: l.entries.length + 1, note: '' }],
              posters: [...l.posters.slice(0, 5), show.poster].slice(0, 6)
            };
          }
        }));
      };
      
      const handleMoveListEntry = (listId, entryShowId, direction) => {
        setUserLists(prev => prev.map(l => {
          if (l.id !== listId) return l;
          const entries = [...l.entries];
          const index = entries.findIndex(e => e.showId === entryShowId);
          if (index === -1) return l;
          
          const newIndex = direction === 'up' ? index - 1 : index + 1;
          if (newIndex < 0 || newIndex >= entries.length) return l;
          
          // Swap
          [entries[index], entries[newIndex]] = [entries[newIndex], entries[index]];
          // Update positions
          entries.forEach((e, i) => e.position = i + 1);
          
          return { ...l, entries };
        }));
      };
      
      const handleUpdateEntryNote = (listId, showId, note) => {
        setUserLists(prev => prev.map(l => {
          if (l.id !== listId) return l;
          return {
            ...l,
            entries: l.entries.map(e => e.showId === showId ? { ...e, note } : e)
          };
        }));
        setEditingListEntry(null);
        setEntryNoteInput('');
      };
      
      const handleRemoveFromList = (listId, showId) => {
        setUserLists(prev => prev.map(l => {
          if (l.id !== listId) return l;
          const show = SHOWS.find(s => s.id === showId);
          return {
            ...l,
            entries: l.entries.filter(e => e.showId !== showId).map((e, i) => ({ ...e, position: i + 1 })),
            posters: l.posters.filter(p => p !== show?.poster)
          };
        }));
      };
      
      const handleShareList = (list) => {
        if (navigator.share) {
          navigator.share({
            title: list.title,
            text: list.desc,
            url: `https://rocketwatch.app/list/${list.id}`
          });
        } else {
          navigator.clipboard.writeText(`https://rocketwatch.app/list/${list.id}`);
          alert('Link copied to clipboard!');
        }
      };
      
      const handleDeleteList = (listId) => {
        if (!confirm('Are you sure you want to delete this list? This cannot be undone.')) return;
        setUserLists(prev => prev.filter(l => l.id !== listId));
        setShowNewList(false);
        setEditingListId(null);
        setNewListTitle('');
        setNewListDesc('');
        setNewListEntries([]);
      };
      
      const handleCloneList = (list) => {
        const clonedList = {
          ...list,
          id: Date.now(),
          userId: 'me',
          title: `${list.title} (Copy)`,
          likes: 0,
          comments: 0,
          createdAt: new Date().toISOString().split('T')[0]
        };
        setUserLists(prev => [clonedList, ...prev]);
        alert('List cloned!');
      };
      
      const getFilteredListEntries = (list) => {
        let entries = [...list.entries];
        
        // Filter
        if (listFilter === 'watched') {
          entries = entries.filter(e => watched[e.showId]);
        } else if (listFilter === 'unwatched') {
          entries = entries.filter(e => !watched[e.showId]);
        }
        
        // Sort
        if (listSort === 'title') {
          entries.sort((a, b) => {
            const showA = SHOWS.find(s => s.id === a.showId);
            const showB = SHOWS.find(s => s.id === b.showId);
            return (showA?.name || '').localeCompare(showB?.name || '');
          });
        } else if (listSort === 'year') {
          entries.sort((a, b) => {
            const showA = SHOWS.find(s => s.id === a.showId);
            const showB = SHOWS.find(s => s.id === b.showId);
            return (showB?.year || 0) - (showA?.year || 0);
          });
        } else if (listSort === 'rating') {
          entries.sort((a, b) => (ratings[b.showId] || 0) - (ratings[a.showId] || 0));
        }
        // 'position' keeps original order
        
        return entries;
      };
      
      const getListsContainingShow = (showId) => {
        return userLists.filter(l => l.entries.some(e => e.showId === showId));
      };
      
      const getMyLists = () => userLists.filter(l => l.userId === 'me');
      const getPopularLists = () => userLists.filter(l => l.isPublic).sort((a, b) => b.likes - a.likes);
      
      const filteredShows = genreFilter === 'All' ? SHOWS : SHOWS.filter(s => s.genre === genreFilter);
      const selectedBulkCount = Object.values(selectedForBulk).filter(Boolean).length;
      
      // LOGIN
      if (screen === 'login') {
        return (
          <div className="app">
            <div className="login-screen">
              <div className="login-backdrop" style={{ backgroundImage: 'url(https://image.tmdb.org/t/p/w1280/uDgy6hyPd82kOHh6I95FLtLnj6p.jpg)' }} />
              <div className="login-content">
                <div className="login-logo">
                  <div className="logo-circle logo-orange" />
                  <div className="logo-circle logo-green" />
                  <div className="logo-circle logo-blue" />
                </div>
                <h1 className="login-title">RocketWatch</h1>
                <p className="login-tagline">The social network for TV lovers.</p>
                
                <div className="login-buttons">
                  <button className="login-btn login-btn-primary" onClick={() => { setScreen('main'); setShowTrackingPermission(true); }}>Sign in</button>
                  <button className="login-btn login-btn-divider">Create account</button>
                  <button className="login-btn login-btn-ghost" onClick={() => setScreen('onboarding')}>Skip this step</button>
                </div>
                
                <p className="login-footer">An account is not required to browse content, but you must have one to track episodes and participate.</p>
                <div className="carousel-dots">{[0,1,2,3,4,5].map(i => <div key={i} className={`carousel-dot ${i === 0 ? 'active' : ''}`} />)}</div>
              </div>
            </div>
            <div className="bottom-nav">
              <button className="nav-item active"><Icon name="Profile" size={24} filled /></button>
              <button className="nav-item"><Icon name="Films" size={24} /></button>
              <button className="nav-item"><Icon name="Search" size={24} /></button>
            </div>
          </div>
        );
      }
      
      // ONBOARDING
      if (screen === 'onboarding') {
        return (
          <div className="app">
            <div className="onboarding-screen">
              <div className="onboarding-poster-row">
                <img src={SHOWS[10].poster} alt="" className="onboarding-poster" />
                <img src={SHOWS[11].poster} alt="" className="onboarding-poster center" />
                <img src={SHOWS[12].poster} alt="" className="onboarding-poster" />
              </div>
              <div className="onboarding-actions">
                <div className="onboarding-action"><Icon name="Eye" size={28} /><span>I've watched it!</span></div>
                <div className="onboarding-action" style={{ color: 'var(--brand-orange)' }}><Icon name="Heart" size={28} filled /><span>loved it!</span></div>
                <div className="onboarding-action"><Icon name="Star" size={28} /></div>
                <div className="onboarding-action"><Icon name="Clock" size={28} filled /></div>
              </div>
              <div className="onboarding-content">
                <h2 className="onboarding-title">Get started</h2>
                <p className="onboarding-desc">Would you like to browse our most popular shows and tell us what you've watched and liked?</p>
                <p className="onboarding-desc">Titles you mark as watched are added to the <strong>Films</strong> tab on your profile, and used to recommend content and improve filters.</p>
              </div>
              <div className="onboarding-buttons">
                <button className="onboarding-btn onboarding-btn-skip" onClick={() => setScreen('main')}>Skip for now</button>
                <button className="onboarding-btn onboarding-btn-action" onClick={() => setScreen('main')}>Browse shows</button>
              </div>
            </div>
          </div>
        );
      }
      
      // MAIN APP
      return (
        <div className="app">
          {/* HEADERS */}
          {bottomTab === 'home' && (
            <>
              <div className="header"><h1 className="header-title">RocketWatch</h1></div>
              <div className="top-tabs">
                {['Films', 'Reviews', 'Lists', 'Journal'].map(tab => (
                  <button key={tab} className={`top-tab ${mainTab === tab.toLowerCase() ? 'active' : ''}`} onClick={() => setMainTab(tab.toLowerCase())}>
                    {tab}{tab === 'Journal' && <span className="notification-dot" />}
                  </button>
                ))}
              </div>
            </>
          )}
          
          {bottomTab === 'search' && <div className="search-header">Search</div>}
          
          {bottomTab === 'activity' && (
            <>
              <div className="header">
                <div className="header-row">
                  <div style={{ width: 44 }} />
                  <span style={{ fontSize: 17, fontWeight: 600 }}>Activity</span>
                  <button className="header-btn" onClick={() => setShowFilters(true)}><Icon name="Filter" size={22} /></button>
                </div>
              </div>
              <div className="segment-control">
                {['Friends', 'You', 'Incoming'].map(tab => (
                  <button key={tab} className={`segment-btn ${activityTab === tab.toLowerCase() ? 'active' : ''}`} onClick={() => setActivityTab(tab.toLowerCase())}>{tab}</button>
                ))}
              </div>
            </>
          )}
          
          {bottomTab === 'profile' && (
            <>
              <div className="profile-header-row">
                <button className="header-btn" onClick={() => { setShowSettings(true); setSettingsPage('main'); }}><Icon name="Settings" size={24} /></button>
                <span className="profile-username">{USERS.me.username}</span>
                <button className="header-btn"><Icon name="MoreHorizontal" size={24} /></button>
              </div>
              <div className="profile-tabs-scroll">
                <button className={`profile-tab ${profileTab === 'profile' ? 'active' : ''}`} onClick={() => setProfileTab('profile')}>Profile</button>
                <button className={`profile-tab ${profileTab === 'films' ? 'active' : ''}`} onClick={() => setProfileTab('films')}>
                  Films<span className="profile-tab-count">{Object.values(watched).filter(Boolean).length}</span>
                </button>
                <button className={`profile-tab ${profileTab === 'diary' ? 'active' : ''}`} onClick={() => setProfileTab('diary')}>Diary</button>
                <button className={`profile-tab ${profileTab === 'reviews' ? 'active' : ''}`} onClick={() => setProfileTab('reviews')}>
                  Reviews<span className="profile-tab-count">{userReviews.length}</span>
                </button>
                <button className={`profile-tab ${profileTab === 'watchlist' ? 'active' : ''}`} onClick={() => setProfileTab('watchlist')}>
                  Watchlist<span className="profile-tab-count">{Object.values(watchlist).filter(Boolean).length}</span>
                </button>
                <button className={`profile-tab ${profileTab === 'lists' ? 'active' : ''}`} onClick={() => setProfileTab('lists')}>
                  Lists<span className="profile-tab-count">{getMyLists().length}</span>
                </button>
                <button className={`profile-tab ${profileTab === 'likes' ? 'active' : ''}`} onClick={() => setProfileTab('likes')}>Likes</button>
                <button className={`profile-tab ${profileTab === 'tags' ? 'active' : ''}`} onClick={() => setProfileTab('tags')}>Tags</button>
                <button className={`profile-tab ${profileTab === 'network' ? 'active' : ''}`} onClick={() => setProfileTab('network')}>Network</button>
                <button className={`profile-tab ${profileTab === 'stats' ? 'active' : ''}`} onClick={() => setProfileTab('stats')}>
                  Stats<span className="stats-pro-badge">PRO</span>
                </button>
              </div>
            </>
          )}
          
          {/* CONTENT */}
          <div className="main-content">
            {/* FILMS TAB */}
            {bottomTab === 'home' && mainTab === 'films' && (
              <>
                <div className="genre-pills">
                  {['All', 'Reality', 'Drama', 'Comedy'].map(g => (
                    <button key={g} className={`genre-pill ${genreFilter === g ? 'active' : ''}`} onClick={() => setGenreFilter(g)}>{g}</button>
                  ))}
                </div>
                <div className="section-header">
                  <span>Popular this week</span>
                  <span className="section-header-action" onClick={() => setBulkSelectMode(!bulkSelectMode)}>
                    {bulkSelectMode ? 'Cancel' : 'Select Multiple'}
                  </span>
                </div>
                <div className="poster-grid">
                  {filteredShows.map(show => (
                    <div key={show.id} className={`poster-item ${selectedForBulk[show.id] ? 'selected' : ''}`} onClick={() => handleEpisodePress({ id: show.id, poster: show.poster, showName: show.name, season: 1, episode: 1, name: 'Episode 1', year: show.year })}>
                      <img src={show.poster} alt={show.name} className="poster-img" />
                      {watched[show.id] && !bulkSelectMode && <div className="poster-watched"><Icon name="Check" size={12} /></div>}
                      {bulkSelectMode && (
                        <div className={`poster-select ${selectedForBulk[show.id] ? 'checked' : ''}`}>
                          {selectedForBulk[show.id] && <Icon name="Check" size={14} />}
                        </div>
                      )}
                    </div>
                  ))}
                </div>
              </>
            )}
            
            {/* REVIEWS TAB - ENHANCED 1.2 with spoilers */}
            {bottomTab === 'home' && mainTab === 'reviews' && (
              <>
                {/* User's own reviews first */}
                {userReviews.length > 0 && (
                  <>
                    <div className="section-header">Your Reviews</div>
                    {userReviews.map(review => (
                      <div key={review.id} className="review-card">
                        <div className="review-header">
                          <div className="review-left">
                            <div className="review-user-row">
                              <Avatar user={USERS.me} size="sm" />
                              <span style={{ fontSize: 13 }}>{USERS.me.username}</span>
                              {review.hasSpoilers && <span className="review-spoiler-badge">SPOILER</span>}
                            </div>
                            <div className="review-title-row">
                              <span className="review-title">{review.showName}</span>
                              <span className="review-year">{review.year}</span>
                            </div>
                            <div className="review-rating-row">
                              {review.rating > 0 && <Stars rating={review.rating} />}
                            </div>
                            <div className="review-date">{review.date}</div>
                          </div>
                          <img src={review.poster} alt="" className="review-poster" />
                        </div>
                        <p className="review-text">{review.text ? renderMarkdown(review.text) : <em style={{ color: 'var(--text-tertiary)' }}>No review text</em>}</p>
                        <div className="my-review-actions">
                          <span className="my-review-action" onClick={() => handleEditReview(review)}>Edit</span>
                          <span className="my-review-action delete" onClick={() => handleDeleteReview(review.id)}>Delete</span>
                        </div>
                      </div>
                    ))}
                  </>
                )}
                
                {/* Community reviews with spoiler blur */}
                <div className="section-header">Popular Reviews</div>
                {REVIEWS.map(review => {
                  const user = USERS[review.userId];
                  const isWatched = watched[review.showId];
                  const showSpoiler = review.hasSpoilers && !isWatched && !revealedSpoilers[review.id];
                  const reactions = reviewReactions[review.id] || {};
                  const comments = reviewComments[review.id] || [];
                  const isLiked = reviewLikes[review.id];
                  const commentsExpanded = expandedComments[review.id];
                  
                  return (
                    <div key={review.id} className="review-card">
                      <div className="review-header">
                        <div className="review-left">
                          <div className="review-user-row">
                            <Avatar user={user} size="sm" />
                            <span style={{ fontSize: 13 }}>{user?.username}</span>
                            <Badge type={user?.badge} />
                            {review.hasSpoilers && <span className="review-spoiler-badge">SPOILER</span>}
                            <div style={{ marginLeft: 'auto', position: 'relative' }}>
                              <button 
                                style={{ background: 'none', border: 'none', color: 'var(--text-muted)', cursor: 'pointer', padding: 4 }}
                                onClick={() => setShowUserMenu(showUserMenu === review.id ? null : review.id)}
                              >
                                <Icon name="MoreHorizontal" size={18} />
                              </button>
                              {showUserMenu === review.id && (
                                <>
                                  <div className="user-actions-backdrop" onClick={() => setShowUserMenu(null)} />
                                  <div className="user-actions-menu">
                                    <div className="user-action-item" onClick={() => { toggleFollow(review.userId); setShowUserMenu(null); }}>
                                      <Icon name="Profile" size={18} />
                                      {following.includes(review.userId) ? 'Unfollow' : 'Follow'} @{user?.username}
                                    </div>
                                    <div className="user-action-item" onClick={() => { blockUser(review.userId); }}>
                                      <Icon name="Lock" size={18} />
                                      Block @{user?.username}
                                    </div>
                                    <div className="user-action-item danger" onClick={() => { setShowReportModal({ type: 'review', id: review.id }); setShowUserMenu(null); }}>
                                      <Icon name="Activity" size={18} />
                                      Report Review
                                    </div>
                                  </div>
                                </>
                              )}
                            </div>
                          </div>
                          <div className="review-title-row">
                            <span className="review-title">{review.showName}</span>
                            <span className="review-year">{review.year}</span>
                          </div>
                          <div className="review-rating-row">
                            {review.rating > 0 && <Stars rating={review.rating} />}
                            <Icon name="Heart" size={14} filled style={{ color: 'var(--brand-orange)' }} />
                          </div>
                          <div className="review-date">{review.date}</div>
                        </div>
                        <img src={review.poster} alt="" className="review-poster" />
                      </div>
                      {showSpoiler ? (
                        <div className="review-spoiler-overlay">
                          <p className="review-text review-spoiler-blur">{renderMarkdown(review.text)}</p>
                          <button className="spoiler-reveal-btn" onClick={() => toggleSpoilerReveal(review.id)}>
                            Reveal Spoiler
                          </button>
                        </div>
                      ) : (
                        <p className="review-text">{renderMarkdown(review.text)}</p>
                      )}
                      
                      {/* Reactions Row */}
                      {Object.keys(reactions).length > 0 && (
                        <div className="review-reactions">
                          {Object.entries(reactions).filter(([_, count]) => count > 0).map(([emoji, count]) => (
                            <button 
                              key={emoji}
                              className={`review-reaction ${userReactions[`${review.id}-${emoji}`] ? 'active' : ''}`}
                              onClick={() => toggleReaction(review.id, emoji)}
                            >
                              <span className="review-reaction-emoji">{emoji}</span>
                              <span className="review-reaction-count">{count}</span>
                            </button>
                          ))}
                          <div style={{ position: 'relative' }}>
                            <button 
                              className="add-reaction-btn"
                              onClick={() => setShowReactionPicker(showReactionPicker === review.id ? null : review.id)}
                            >
                              +
                            </button>
                            {showReactionPicker === review.id && (
                              <>
                                <div className="reaction-picker-backdrop" onClick={() => setShowReactionPicker(null)} />
                                <div className="reaction-picker">
                                  {REACTION_EMOJIS.map(emoji => (
                                    <span 
                                      key={emoji} 
                                      className="reaction-picker-item"
                                      onClick={() => toggleReaction(review.id, emoji)}
                                    >
                                      {emoji}
                                    </span>
                                  ))}
                                </div>
                              </>
                            )}
                          </div>
                        </div>
                      )}
                      
                      {/* Action Buttons */}
                      <div className="review-actions">
                        <button 
                          className={`review-action ${isLiked ? 'liked' : ''}`}
                          onClick={() => toggleReviewLike(review.id)}
                        >
                          <Icon name="Heart" size={18} filled={isLiked} />
                          <span className="review-action-count">{(review.likes || 0) + (isLiked ? 1 : 0)}</span>
                        </button>
                        <button 
                          className="review-action"
                          onClick={() => setExpandedComments(prev => ({ ...prev, [review.id]: !prev[review.id] }))}
                        >
                          <Icon name="Comment" size={18} />
                          <span className="review-action-count">{comments.length}</span>
                        </button>
                        <button 
                          className="review-action"
                          onClick={() => setShowShareMenu(review.id)}
                        >
                          <Icon name="Share" size={18} />
                        </button>
                        {!Object.keys(reactions).length && (
                          <div style={{ position: 'relative', marginLeft: 'auto' }}>
                            <button 
                              className="add-reaction-btn"
                              onClick={() => setShowReactionPicker(showReactionPicker === review.id ? null : review.id)}
                            >
                              😀+
                            </button>
                            {showReactionPicker === review.id && (
                              <>
                                <div className="reaction-picker-backdrop" onClick={() => setShowReactionPicker(null)} />
                                <div className="reaction-picker">
                                  {REACTION_EMOJIS.map(emoji => (
                                    <span 
                                      key={emoji} 
                                      className="reaction-picker-item"
                                      onClick={() => toggleReaction(review.id, emoji)}
                                    >
                                      {emoji}
                                    </span>
                                  ))}
                                </div>
                              </>
                            )}
                          </div>
                        )}
                      </div>
                      
                      {/* Comments Section */}
                      {commentsExpanded && (
                        <div className="comments-section">
                          <div className="comments-header">
                            <span className="comments-title">{comments.length} Comment{comments.length !== 1 ? 's' : ''}</span>
                          </div>
                          
                          {comments.map(comment => {
                            const commentUser = USERS[comment.userId] || USERS.me;
                            return (
                              <div key={comment.id}>
                                <div className="comment-item">
                                  <Avatar user={commentUser} size="sm" />
                                  <div className="comment-content">
                                    <div className="comment-header">
                                      <span className="comment-username">{commentUser.displayName || commentUser.username}</span>
                                      <span className="comment-time">{comment.time}</span>
                                    </div>
                                    <div className="comment-text" dangerouslySetInnerHTML={{ 
                                      __html: comment.text.replace(/@(\w+)/g, '<span class="mention">@$1</span>') 
                                    }} />
                                    <div className="comment-actions">
                                      <button 
                                        className={`comment-action ${commentLikes[comment.id] ? 'liked' : ''}`}
                                        onClick={() => toggleCommentLike(comment.id)}
                                      >
                                        ❤️ {comment.likes + (commentLikes[comment.id] ? 1 : 0)}
                                      </button>
                                      <button 
                                        className="comment-action"
                                        onClick={() => setReplyingTo({ reviewId: review.id, commentId: comment.id, username: commentUser.username })}
                                      >
                                        Reply
                                      </button>
                                    </div>
                                  </div>
                                </div>
                                
                                {/* Nested Replies */}
                                {comment.replies?.map(reply => {
                                  const replyUser = USERS[reply.userId] || USERS.me;
                                  return (
                                    <div key={reply.id} className="comment-item reply">
                                      <Avatar user={replyUser} size="sm" />
                                      <div className="comment-content">
                                        <div className="comment-header">
                                          <span className="comment-username">{replyUser.displayName || replyUser.username}</span>
                                          <span className="comment-time">{reply.time}</span>
                                        </div>
                                        <div className="comment-text" dangerouslySetInnerHTML={{ 
                                          __html: reply.text.replace(/@(\w+)/g, '<span class="mention">@$1</span>') 
                                        }} />
                                        <div className="comment-actions">
                                          <button 
                                            className={`comment-action ${commentLikes[reply.id] ? 'liked' : ''}`}
                                            onClick={() => toggleCommentLike(reply.id)}
                                          >
                                            ❤️ {reply.likes + (commentLikes[reply.id] ? 1 : 0)}
                                          </button>
                                        </div>
                                      </div>
                                    </div>
                                  );
                                })}
                              </div>
                            );
                          })}
                          
                          {/* Comment Input */}
                          <div className="comment-input-wrapper">
                            <Avatar user={USERS.me} size="sm" />
                            <input 
                              type="text"
                              className="comment-input"
                              placeholder={replyingTo?.reviewId === review.id ? `Reply to @${replyingTo.username}...` : 'Add a comment...'}
                              value={commentText}
                              onChange={(e) => setCommentText(e.target.value)}
                              onKeyDown={(e) => e.key === 'Enter' && addComment(review.id)}
                            />
                            <button 
                              className="comment-submit"
                              disabled={!commentText.trim()}
                              onClick={() => addComment(review.id)}
                            >
                              <Icon name="Send" size={16} />
                            </button>
                          </div>
                          {replyingTo?.reviewId === review.id && (
                            <div className="reply-indicator">
                              <span>Replying to @{replyingTo.username}</span>
                              <button 
                                className="reply-indicator-cancel"
                                onClick={() => setReplyingTo(null)}
                              >
                                ✕
                              </button>
                            </div>
                          )}
                        </div>
                      )}
                    </div>
                  );
                })}
              </>
            )}
            
            {/* LISTS TAB - ENHANCED CATEGORY 2 */}
            {bottomTab === 'home' && mainTab === 'lists' && (
              <>
                {/* My Lists Section - Always show header with New List option */}
                <div className="section-header">
                  <span>Your Lists</span>
                  <span className="section-header-action" onClick={() => setShowNewList(true)}>New List</span>
                </div>
                {getMyLists().length > 0 ? (
                  getMyLists().map(list => {
                    return (
                      <div key={list.id} className="list-card" onClick={() => setShowListDetail(list)}>
                        <div className="list-card-header">
                          <span className="list-title">
                            {list.title}
                            {!list.isPublic && <span className="list-private-badge"><Icon name="Lock" size={10} /> Private</span>}
                          </span>
                        </div>
                        <p className="list-desc">{list.desc}</p>
                        <div className="list-posters-scroll">
                          {list.posters.slice(0, 6).map((p, i) => <img key={i} src={p} alt="" className="list-poster-sm" />)}
                        </div>
                        <div className="list-meta">
                          <span className="list-meta-item">{list.entries.length} shows</span>
                          {list.isRanked && <span className="list-meta-item">Ranked</span>}
                        </div>
                      </div>
                    );
                  })
                ) : (
                  <div style={{ padding: '24px 16px', color: 'var(--text-tertiary)', textAlign: 'center' }}>
                    You haven't created any lists yet. Tap "New List" to get started!
                  </div>
                )}
                
                {/* Popular Lists */}
                <div className="section-header" style={{ marginTop: 16 }}>
                  <span>Popular Lists</span>
                </div>
                {getPopularLists().filter(l => l.userId !== 'me').slice(0, 5).map(list => {
                  const user = USERS[list.userId];
                  return (
                    <div key={list.id} className="list-card" onClick={() => setShowListDetail(list)}>
                      <div className="list-card-header">
                        <span className="list-title">{list.title}</span>
                        <div className="list-user">
                          <span style={{ fontSize: 13, color: 'var(--text-secondary)' }}>{user?.username}</span>
                          <Avatar user={user} size="sm" />
                        </div>
                      </div>
                      <p className="list-desc">{list.desc}</p>
                      <div className="list-posters-scroll">
                        {list.posters.slice(0, 6).map((p, i) => <img key={i} src={p} alt="" className="list-poster-sm" />)}
                      </div>
                      <div className="list-meta">
                        <span className="list-meta-item"><Icon name="Heart" size={12} /> {list.likes}</span>
                        <span className="list-meta-item"><Icon name="Comment" size={12} /> {list.comments}</span>
                        <span className="list-meta-item">{list.entries.length} shows</span>
                      </div>
                    </div>
                  );
                })}
                
                {userLists.filter(l => l.userId !== 'me').length === 0 && (
                  <EmptyState title="No lists yet." quoteIndex={0} />
                )}
              </>
            )}
            
            {/* JOURNAL TAB */}
            {bottomTab === 'home' && mainTab === 'journal' && (
              <>
                <div className="journal-card">
                  <img src="https://image.tmdb.org/t/p/w1280/uDgy6hyPd82kOHh6I95FLtLnj6p.jpg" alt="" className="journal-img" />
                  <h3 className="journal-title">Live and Learn</h3>
                  <p className="journal-desc"><em>Half Nelson</em> filmmakers Ryan Fleck and Anna Boden reflect on twenty years of their scrappy indie drama.</p>
                </div>
                <div className="journal-card">
                  <img src="https://image.tmdb.org/t/p/w1280/9z3CCXR7UsCWqmGXVj5aJP0Tc6p.jpg" alt="" className="journal-img" />
                  <h3 className="journal-title">Freedom Now!</h3>
                  <p className="journal-desc">A starter pack of 24 films about the Civil Rights Movement and Black liberation.</p>
                </div>
              </>
            )}
            
            {/* SEARCH - CATEGORY 6 ENHANCED */}
            {bottomTab === 'search' && (
              <div className="search-container">
                {/* Search Input */}
                <div className="search-input-wrapper">
                  <Icon name="Search" size={18} />
                  <input 
                    type="text" 
                    placeholder="Find shows, members, lists..." 
                    value={searchQuery}
                    onChange={(e) => handleSearch(e.target.value)}
                  />
                  {searchQuery && (
                    <button className="search-clear" onClick={() => setSearchQuery('')}>
                      <Icon name="X" size={16} />
                    </button>
                  )}
                </div>
                
                {/* Search Results */}
                {searchQuery.trim() ? (
                  <>
                    {/* Search Tabs */}
                    <div className="search-tabs">
                      <button className={`search-tab ${searchTab === 'films' ? 'active' : ''}`} onClick={() => setSearchTab('films')}>Films</button>
                      <button className={`search-tab ${searchTab === 'members' ? 'active' : ''}`} onClick={() => setSearchTab('members')}>Members</button>
                      <button className={`search-tab ${searchTab === 'lists' ? 'active' : ''}`} onClick={() => setSearchTab('lists')}>Lists</button>
                      <button className={`search-tab ${searchTab === 'reviews' ? 'active' : ''}`} onClick={() => setSearchTab('reviews')}>Reviews</button>
                    </div>
                    
                    {/* Film Results */}
                    {searchTab === 'films' && (
                      <div className="search-results">
                        {searchShows(searchQuery).length === 0 ? (
                          <div className="no-results">
                            <div className="no-results-icon">🔍</div>
                            <div className="no-results-title">No shows found</div>
                            <div className="no-results-text">Try a different search term</div>
                          </div>
                        ) : (
                          searchShows(searchQuery).map(show => (
                            <div 
                              key={show.id} 
                              className="search-result-item"
                              onClick={() => { addToRecentSearches(searchQuery); setShowDetailPage(show); setSearchQuery(''); }}
                            >
                              <img src={show.poster} alt="" className="search-result-poster" />
                              <div className="search-result-info">
                                <div className="search-result-title">{highlightMatch(show.name, searchQuery)}</div>
                                <div className="search-result-meta">{show.year} • {show.genre}</div>
                                {show.communityRating && (
                                  <div className="search-result-rating">
                                    <Stars rating={show.communityRating} />
                                    <span style={{ fontSize: 12, color: 'var(--text-tertiary)' }}>{show.communityRating.toFixed(1)}</span>
                                  </div>
                                )}
                              </div>
                            </div>
                          ))
                        )}
                      </div>
                    )}
                    
                    {/* Member Results */}
                    {searchTab === 'members' && (
                      <div className="search-results">
                        {searchMembers(searchQuery).length === 0 ? (
                          <div className="no-results">
                            <div className="no-results-icon">👤</div>
                            <div className="no-results-title">No members found</div>
                            <div className="no-results-text">Try a different search term</div>
                          </div>
                        ) : (
                          searchMembers(searchQuery).filter(u => u.id !== 'me' && !blockedUsers.includes(u.id)).map(user => (
                            <div key={user.id} className="search-result-item" onClick={() => addToRecentSearches(searchQuery)}>
                              <div className="search-result-avatar">{user.username?.charAt(0).toUpperCase()}</div>
                              <div className="search-result-info">
                                <div className="search-result-title">
                                  {highlightMatch(user.displayName || user.username, searchQuery)}
                                  {user.badge && <Badge type={user.badge} />}
                                </div>
                                <div className="search-result-meta">@{user.username}</div>
                              </div>
                              <button 
                                className={`follow-btn ${following.includes(user.id) ? 'following' : 'not-following'}`}
                                onClick={(e) => { e.stopPropagation(); toggleFollow(user.id); }}
                              >
                                {following.includes(user.id) ? 'Following' : 'Follow'}
                              </button>
                            </div>
                          ))
                        )}
                      </div>
                    )}
                    
                    {/* List Results */}
                    {searchTab === 'lists' && (
                      <div className="search-results">
                        {searchLists(searchQuery).length === 0 ? (
                          <div className="no-results">
                            <div className="no-results-icon">📋</div>
                            <div className="no-results-title">No lists found</div>
                            <div className="no-results-text">Try a different search term</div>
                          </div>
                        ) : (
                          searchLists(searchQuery).map(list => {
                            const user = USERS[list.userId] || USERS.me;
                            return (
                              <div 
                                key={list.id} 
                                className="search-result-item"
                                onClick={() => { addToRecentSearches(searchQuery); setViewingList(list); setSearchQuery(''); }}
                              >
                                <div style={{ display: 'flex', gap: 2 }}>
                                  {list.posters?.slice(0, 2).map((p, i) => (
                                    <img key={i} src={p} alt="" style={{ width: 22, height: 33, borderRadius: 2, objectFit: 'cover' }} />
                                  ))}
                                </div>
                                <div className="search-result-info">
                                  <div className="search-result-title">{highlightMatch(list.title, searchQuery)}</div>
                                  <div className="search-result-meta">by {user.displayName || user.username} • {list.entries?.length || 0} films</div>
                                </div>
                              </div>
                            );
                          })
                        )}
                      </div>
                    )}
                    
                    {/* Review Results */}
                    {searchTab === 'reviews' && (
                      <div className="search-results">
                        {searchReviews(searchQuery).length === 0 ? (
                          <div className="no-results">
                            <div className="no-results-icon">✍️</div>
                            <div className="no-results-title">No reviews found</div>
                            <div className="no-results-text">Try a different search term</div>
                          </div>
                        ) : (
                          searchReviews(searchQuery).map(review => {
                            const user = USERS[review.userId] || USERS.me;
                            return (
                              <div key={review.id} className="search-result-item" onClick={() => addToRecentSearches(searchQuery)}>
                                <img src={review.poster} alt="" className="search-result-poster" />
                                <div className="search-result-info">
                                  <div className="search-result-title">{review.showName}</div>
                                  <div className="search-result-meta">
                                    Review by {user.displayName || user.username}
                                    {review.rating && <> • <Stars rating={review.rating} /></>}
                                  </div>
                                  <div style={{ fontSize: 12, color: 'var(--text-tertiary)', marginTop: 4, display: '-webkit-box', WebkitLineClamp: 2, WebkitBoxOrient: 'vertical', overflow: 'hidden' }}>
                                    {review.text?.replace(/\*\*/g, '').replace(/\*/g, '').slice(0, 100)}...
                                  </div>
                                </div>
                              </div>
                            );
                          })
                        )}
                      </div>
                    )}
                  </>
                ) : (
                  <>
                    {/* Recent Searches */}
                    {recentSearches.length > 0 && (
                      <div className="recent-searches">
                        <div className="recent-searches-header">
                          <span className="recent-searches-title">Recent Searches</span>
                          <button className="recent-searches-clear" onClick={clearRecentSearches}>Clear</button>
                        </div>
                        {recentSearches.map((search, i) => (
                          <div key={i} className="recent-search-item" onClick={() => setSearchQuery(search)}>
                            <span className="recent-search-icon"><Icon name="Clock" size={16} /></span>
                            <span className="recent-search-text">{search}</span>
                            <button className="recent-search-remove" onClick={(e) => { e.stopPropagation(); setRecentSearches(prev => prev.filter(s => s !== search)); }}>
                              <Icon name="X" size={14} />
                            </button>
                          </div>
                        ))}
                      </div>
                    )}
                    
                    {/* Browse By */}
                    <div className="browse-title">Browse by</div>
                    <div className="browse-row" onClick={() => setBrowsePage('genre')}>
                      <span className="browse-row-label">Genre</span>
                      <span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span>
                    </div>
                    <div className="browse-row" onClick={() => setBrowsePage('decade')}>
                      <span className="browse-row-label">Decade</span>
                      <span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span>
                    </div>
                    <div className="browse-row" onClick={() => setBrowsePage('service')}>
                      <span className="browse-row-label">Streaming Service</span>
                      <span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span>
                    </div>
                    <div className="browse-row" onClick={() => { setBottomTab('profile'); setProfileTab('tags'); }}>
                      <span className="browse-row-label">Tags</span>
                      <span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span>
                    </div>
                    <div className="browse-row" onClick={() => setShowAdvancedFilters(true)} style={{ background: 'linear-gradient(135deg, rgba(0,208,124,0.1), rgba(64,192,203,0.1))' }}>
                      <span className="browse-row-label" style={{ color: 'var(--brand-green)' }}>
                        ⚡ Advanced Filters
                        {(advancedFilters.genres.length > 0 || advancedFilters.ratingMin > 0 || advancedFilters.services.length > 0 || advancedFilters.yearFrom > 1990 || advancedFilters.yearTo < 2025) && (
                          <span style={{ marginLeft: 8, fontSize: 11, background: 'var(--brand-green)', color: '#000', padding: '2px 6px', borderRadius: 10 }}>
                            {advancedFilters.genres.length + (advancedFilters.ratingMin > 0 ? 1 : 0) + advancedFilters.services.length + (advancedFilters.yearFrom > 1990 || advancedFilters.yearTo < 2025 ? 1 : 0)} active
                          </span>
                        )}
                      </span>
                      <span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span>
                    </div>
                    
                    {/* Your Tags Quick Access */}
                    {allUserTags.length > 0 && (
                      <>
                        <div className="browse-title">Your Tags</div>
                        <div className="tags-grid">
                          {allUserTags.slice(0, 6).map(tag => (
                            <div key={tag.name} className="tag-browse-chip" onClick={() => { setBottomTab('profile'); setProfileTab('tags'); setShowTagDetail(tag.name); }}>
                              <span>{tag.name}</span>
                              <span className="tag-count">{tag.count}</span>
                            </div>
                          ))}
                        </div>
                      </>
                    )}
                    
                    {/* Discovery */}
                    <div className="browse-title">Discover</div>
                    <div className="browse-row" onClick={() => setBrowsePage('popular')}>
                      <span className="browse-row-label">Most Popular</span>
                      <span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span>
                    </div>
                    <div className="browse-row" onClick={() => setBrowsePage('rated')}>
                      <span className="browse-row-label">Highest Rated</span>
                      <span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span>
                    </div>
                    <div className="browse-row">
                      <span className="browse-row-label">New Releases</span>
                      <span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span>
                    </div>
                    <div className="browse-row">
                      <span className="browse-row-label">Featured Lists</span>
                      <span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span>
                    </div>
                    
                    {/* App Info */}
                    <div className="browse-title">rocketwatch.app</div>
                    <div className="browse-row"><span className="browse-row-label">New here?</span><span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span></div>
                    <div className="browse-row"><span className="browse-row-label">Frequent questions</span><span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span></div>
                    <div className="browse-row"><span className="browse-row-label">About subscriptions</span><span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span></div>
                  </>
                )}
              </div>
            )}
            
            {/* ACTIVITY - FIXED: time on RIGHT, stars INLINE */}
            {bottomTab === 'activity' && activityTab === 'friends' && FRIEND_ACTIVITY.map(a => {
              const user = Object.values(USERS).find(u => u.id === a.userId);
              return (
                <div key={a.id} className="activity-item">
                  <Avatar user={user} />
                  <div className="activity-content">
                    <div className="activity-row">
                      <p className="activity-text">
                        <strong>{user?.username}</strong>
                        {a.type === 'liked_review' && <> liked <strong>{a.target}</strong>'s {a.rating && <Stars rating={a.rating} />} review of <strong>{a.showName}</strong></>}
                        {a.type === 'followed' && <> followed <strong>{a.target}</strong></>}
                        {a.type === 'watchlist' && <> added <strong>{a.showName}</strong> to his watchlist</>}
                      </p>
                      <span className="activity-time">{a.time}</span>
                    </div>
                  </div>
                </div>
              );
            })}
            {bottomTab === 'activity' && activityTab === 'you' && <EmptyState title="No activity." quoteIndex={1} />}
            {bottomTab === 'activity' && activityTab === 'incoming' && <EmptyState title="No activity." quoteIndex={2} />}
            
            {/* PROFILE - ENHANCED CAT 3.1 */}
            {bottomTab === 'profile' && profileTab === 'profile' && (
              <>
                {/* Profile Backdrop (Patron Feature) */}
                <div className="profile-backdrop">
                  {userProfile.backdrop && <img src={userProfile.backdrop} alt="" />}
                  <div className="profile-backdrop-overlay" />
                  {USERS.me.badge === 'patron' && <span className="profile-backdrop-badge">PATRON</span>}
                </div>
                
                {/* Main Profile Info */}
                <div className="profile-main-info">
                  <div className="profile-avatar-container">
                    <div className="profile-avatar-large">{USERS.me.username?.charAt(0).toUpperCase() || '?'}</div>
                    <div className="profile-names">
                      <div className="profile-display-name">
                        {userProfile.displayName || USERS.me.username}
                        <Badge type={USERS.me.badge} />
                      </div>
                      <div className="profile-handle">
                        @{USERS.me.username}
                        {userProfile.pronouns && <span className="profile-pronouns" style={{ marginLeft: 8 }}>{userProfile.pronouns}</span>}
                      </div>
                    </div>
                  </div>
                  
                  {/* Edit Profile Button */}
                  <button 
                    style={{ 
                      width: '100%',
                      background: 'var(--bg-card)', 
                      border: '1px solid var(--divider)', 
                      padding: '10px 16px', 
                      borderRadius: 8, 
                      color: 'var(--text-primary)', 
                      fontSize: 14, 
                      fontWeight: 600, 
                      cursor: 'pointer',
                      marginBottom: 16
                    }}
                    onClick={() => setShowEditProfile(true)}
                  >
                    Edit Profile
                  </button>
                  
                  {/* Bio */}
                  {userProfile.bio && <p className="profile-bio">{userProfile.bio}</p>}
                  
                  {/* Meta (Location, Website, Twitter) */}
                  {(userProfile.location || userProfile.website || userProfile.twitter) && (
                    <div className="profile-meta-row">
                      {userProfile.location && (
                        <div className="profile-meta-item">
                          <Icon name="MapPin" size={14} />
                          <span>{userProfile.location}</span>
                        </div>
                      )}
                      {userProfile.website && (
                        <div className="profile-meta-item">
                          <Icon name="Link" size={14} />
                          <a href={userProfile.website} className="profile-meta-link" target="_blank" rel="noopener noreferrer">
                            {userProfile.website.replace(/^https?:\/\//, '')}
                          </a>
                        </div>
                      )}
                      {userProfile.twitter && (
                        <div className="profile-meta-item">
                          <Icon name="Twitter" size={14} />
                          <a href={`https://x.com/${userProfile.twitter}`} className="profile-meta-link" target="_blank" rel="noopener noreferrer">
                            @{userProfile.twitter}
                          </a>
                        </div>
                      )}
                    </div>
                  )}
                  
                  {/* Top Four Favorites - Display Only (tap Edit Profile to change) */}
                  {userProfile.topFour?.length > 0 && (
                    <div className="top-four-section">
                      <div className="top-four-label">Favorites</div>
                      <div className="top-four-grid">
                        {[0, 1, 2, 3].map(i => {
                          const showId = userProfile.topFour[i];
                          const show = showId ? getShowById(showId) : null;
                          if (!show) return null;
                          return (
                            <div key={i} className="top-four-poster">
                              <img src={show.poster} alt={show.name} />
                            </div>
                          );
                        })}
                      </div>
                    </div>
                  )}
                </div>
                
                {/* Pinned Reviews (Pro Feature) */}
                {userProfile.pinnedReviews?.length > 0 && (
                  <div className="pinned-section">
                    <div className="pinned-header">
                      <Icon name="Pin" size={12} filled />
                      <span>Pinned Review</span>
                      <span className="pinned-badge">PRO</span>
                    </div>
                    {userProfile.pinnedReviews.map(reviewId => {
                      const review = getReviewById(reviewId);
                      if (!review) return null;
                      return (
                        <div key={reviewId} className="pinned-review">
                          <div className="pinned-review-header">
                            <img src={review.poster} alt="" className="pinned-review-poster" />
                            <div className="pinned-review-info">
                              <div className="pinned-review-title">{review.showName}</div>
                              <div className="pinned-review-meta">
                                {review.rating > 0 && <Stars rating={review.rating} />}
                                <span>{review.date}</span>
                              </div>
                            </div>
                          </div>
                          <p className="pinned-review-text">{review.text?.replace(/\*\*/g, '').replace(/\*/g, '')}</p>
                        </div>
                      );
                    })}
                  </div>
                )}
                
                {/* Pinned Lists (Pro Feature) */}
                {userProfile.pinnedLists?.length > 0 && (
                  <div className="pinned-section">
                    <div className="pinned-header">
                      <Icon name="Pin" size={12} filled />
                      <span>Pinned List</span>
                      <span className="pinned-badge">PRO</span>
                    </div>
                    {userProfile.pinnedLists.map(listId => {
                      const list = getListById(listId);
                      if (!list) return null;
                      return (
                        <div key={listId} className="pinned-list" onClick={() => setShowListDetail(list)}>
                          <div className="pinned-list-header">
                            <div className="pinned-list-title">{list.title}</div>
                            <div className="pinned-list-count">{list.entries.length} shows</div>
                          </div>
                          <div className="pinned-list-posters">
                            {list.posters.slice(0, 5).map((p, i) => (
                              <img key={i} src={p} alt="" className="pinned-list-poster" />
                            ))}
                          </div>
                        </div>
                      );
                    })}
                  </div>
                )}
                
                {/* RATING SCALE - AUDIT FIX */}
                <div className="rating-scale">
                  <div className="rating-scale-title">Ratings</div>
                  <div className="rating-scale-row">
                    <div className="rating-scale-stars" style={{ color: 'var(--brand-green)' }}>½</div>
                    <div className="rating-scale-label">Awful</div>
                  </div>
                  <div className="rating-scale-row">
                    <div className="rating-scale-stars" style={{ color: 'var(--brand-green)' }}>★</div>
                    <div className="rating-scale-label">Terrible</div>
                  </div>
                  <div className="rating-scale-row">
                    <div className="rating-scale-stars" style={{ color: 'var(--brand-green)' }}>★½</div>
                    <div className="rating-scale-label">Bad</div>
                  </div>
                  <div className="rating-scale-row">
                    <div className="rating-scale-stars" style={{ color: 'var(--brand-green)' }}>★★</div>
                    <div className="rating-scale-label">Poor</div>
                  </div>
                  <div className="rating-scale-row">
                    <div className="rating-scale-stars" style={{ color: 'var(--brand-green)' }}>★★½</div>
                    <div className="rating-scale-label">Decent</div>
                  </div>
                  <div className="rating-scale-row">
                    <div className="rating-scale-stars" style={{ color: 'var(--brand-green)' }}>★★★</div>
                    <div className="rating-scale-label">Good</div>
                  </div>
                  <div className="rating-scale-row">
                    <div className="rating-scale-stars" style={{ color: 'var(--brand-green)' }}>★★★½</div>
                    <div className="rating-scale-label">Very good</div>
                  </div>
                  <div className="rating-scale-row">
                    <div className="rating-scale-stars" style={{ color: 'var(--brand-green)' }}>★★★★</div>
                    <div className="rating-scale-label">Great</div>
                  </div>
                  <div className="rating-scale-row">
                    <div className="rating-scale-stars" style={{ color: 'var(--brand-green)' }}>★★★★½</div>
                    <div className="rating-scale-label">Excellent</div>
                  </div>
                  <div className="rating-scale-row">
                    <div className="rating-scale-stars" style={{ color: 'var(--brand-green)' }}>★★★★★</div>
                    <div className="rating-scale-label">Masterpiece</div>
                  </div>
                </div>
                
                {/* Profile Stats Rows */}
                <div style={{ marginTop: 8 }}>
                  <div className="profile-row" onClick={() => setProfileTab('network')} style={{ borderTop: '1px solid var(--divider)', cursor: 'pointer' }}>
                    <span className="profile-row-label">Network</span>
                    <span className="profile-row-value">{following.length} following · {followers.length} followers<span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span></span>
                  </div>
                  <div className="profile-row" onClick={() => setProfileTab('films')} style={{ cursor: 'pointer' }}>
                    <span className="profile-row-label">Films</span>
                    <span className="profile-row-value">{Object.values(watched).filter(Boolean).length}<span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span></span>
                  </div>
                  <div className="profile-row" onClick={() => setProfileTab('stats')} style={{ cursor: 'pointer' }}>
                    <span className="profile-row-label">This Year</span>
                    <span className="profile-row-value">{getFilmsThisYear()}<span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span></span>
                  </div>
                  <div className="profile-row" onClick={() => setProfileTab('diary')} style={{ cursor: 'pointer' }}>
                    <span className="profile-row-label">Diary</span>
                    <span className="profile-row-value">{diaryEntries.length}<span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span></span>
                  </div>
                  <div className="profile-row" onClick={() => setProfileTab('reviews')} style={{ cursor: 'pointer' }}>
                    <span className="profile-row-label">Reviews</span>
                    <span className="profile-row-value">{userReviews.length}<span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span></span>
                  </div>
                  <div className="profile-row" onClick={() => setProfileTab('watchlist')} style={{ cursor: 'pointer' }}>
                    <span className="profile-row-label">Watchlist</span>
                    <span className="profile-row-value">{Object.values(watchlist).filter(Boolean).length}<span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span></span>
                  </div>
                  <div className="profile-row" onClick={() => setProfileTab('lists')} style={{ cursor: 'pointer' }}>
                    <span className="profile-row-label">Lists</span>
                    <span className="profile-row-value">{getMyLists().length}<span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span></span>
                  </div>
                  <div className="profile-row" onClick={() => setProfileTab('likes')} style={{ cursor: 'pointer' }}>
                    <span className="profile-row-label">Likes</span>
                    <span className="profile-row-value">{getLikedShowsCount() + getLikedReviewsCount() + getLikedListsCount()}<span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span></span>
                  </div>
                  <div className="profile-row" onClick={() => setProfileTab('stats')} style={{ cursor: 'pointer' }}>
                    <span className="profile-row-label">Stats</span>
                    <span className="profile-row-value"><span style={{ fontSize: 10, background: 'var(--brand-orange)', color: '#000', padding: '1px 4px', borderRadius: 3, marginRight: 4 }}>PRO</span><span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span></span>
                  </div>
                </div>
              </>
            )}
            
            {/* DIARY - ENHANCED 1.4 */}
            {bottomTab === 'profile' && profileTab === 'diary' && (
              <>
                {/* Diary Header with View Toggle */}
                <div className="diary-header">
                  <div className="diary-month-nav">
                    <button onClick={handlePrevMonth}><Icon name="ChevronLeft" size={20} /></button>
                    <span className="diary-month-label">{formatMonthYear(diaryMonth)}</span>
                    <button onClick={handleNextMonth}><span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span></button>
                  </div>
                  <div className="diary-view-toggle">
                    <button className={`diary-view-btn ${diaryView === 'list' ? 'active' : ''}`} onClick={() => setDiaryView('list')}>
                      <Icon name="Menu" size={18} />
                    </button>
                    <button className={`diary-view-btn ${diaryView === 'calendar' ? 'active' : ''}`} onClick={() => setDiaryView('calendar')}>
                      <Icon name="Calendar" size={18} />
                    </button>
                  </div>
                </div>
                
                {/* Calendar View */}
                {diaryView === 'calendar' && (
                  <div className="diary-calendar">
                    <div className="calendar-weekdays">
                      {['S', 'M', 'T', 'W', 'T', 'F', 'S'].map((d, i) => (
                        <span key={i} className="calendar-weekday">{d}</span>
                      ))}
                    </div>
                    <div className="calendar-grid">
                      {/* Empty cells for days before month starts */}
                      {Array.from({ length: getFirstDayOfMonth(diaryMonth) }).map((_, i) => (
                        <div key={`empty-${i}`} className="calendar-day empty" />
                      ))}
                      {/* Days of the month */}
                      {Array.from({ length: getDaysInMonth(diaryMonth) }).map((_, i) => {
                        const day = i + 1;
                        const entries = getEntriesForDay(day);
                        const isToday = day === new Date().getDate() && 
                          diaryMonth.getMonth() === new Date().getMonth() && 
                          diaryMonth.getFullYear() === new Date().getFullYear();
                        
                        return (
                          <div 
                            key={day} 
                            className={`calendar-day ${entries.length > 0 ? 'has-entry' : ''} ${isToday ? 'today' : ''}`}
                            onClick={() => entries.length > 0 && handleEditDiaryEntry(entries[0])}
                          >
                            <span className="calendar-day-number">{day}</span>
                            {entries.length > 0 && (
                              <>
                                <img src={entries[0].poster} alt="" className="calendar-day-poster" />
                                {entries.length > 1 && <span className="calendar-day-count">+{entries.length - 1}</span>}
                              </>
                            )}
                          </div>
                        );
                      })}
                    </div>
                  </div>
                )}
                
                {/* List View */}
                {diaryView === 'list' && (
                  <>
                    {diaryEntries.map(entry => (
                      <div key={entry.id} className="diary-entry" onClick={() => handleEditDiaryEntry(entry)}>
                        <div className="diary-date">{entry.day}</div>
                        <img src={entry.poster} alt="" className="diary-poster" />
                        <div className="diary-info">
                          <div className="diary-title-row">
                            <span className="diary-title">{entry.showName}</span>
                            <span className="diary-year">{entry.year}</span>
                            {entry.isDraft && <span className="diary-draft-badge">DRAFT</span>}
                          </div>
                          <div className="diary-actions">
                            {entry.rating > 0 && <Stars rating={entry.rating} />}
                            {entry.liked && <Icon name="Heart" size={14} filled style={{ color: 'var(--brand-orange)' }} />}
                            {entry.rewatch && <Icon name="Repeat" size={14} style={{ color: 'var(--brand-green)' }} />}
                            <span className="diary-menu"><Icon name="Menu" size={16} /></span>
                          </div>
                          {entry.tags && entry.tags.length > 0 && (
                            <div style={{ display: 'flex', gap: 4, marginTop: 4, flexWrap: 'wrap' }}>
                              {entry.tags.map(tag => (
                                <span key={tag} className={`tag-chip ${isNestedTag(tag) ? 'nested' : ''}`} style={{ fontSize: 11, padding: '2px 6px' }}>{tag}</span>
                              ))}
                            </div>
                          )}
                        </div>
                      </div>
                    ))}
                    {diaryEntries.length === 0 && <EmptyState title="No diary entries." quoteIndex={0} />}
                  </>
                )}
              </>
            )}
            
            {/* TAGS SECTION - NEW 1.3 */}
            {bottomTab === 'profile' && profileTab === 'tags' && !showTagDetail && (
              <>
                <div className="tags-section-title">Your Tags ({allUserTags.length})</div>
                <div className="tags-grid">
                  {allUserTags.sort((a, b) => b.count - a.count).map(tag => (
                    <div key={tag.name} className="tag-browse-chip" onClick={() => setShowTagDetail(tag.name)}>
                      <span>{tag.name}</span>
                      <span className="tag-count">{tag.count}</span>
                    </div>
                  ))}
                </div>
                {allUserTags.length === 0 && (
                  <EmptyState title="No tags yet." quoteIndex={2} />
                )}
                <div className="tags-section-title">Popular Tags</div>
                <div className="tags-grid">
                  {popularTags.map(tag => (
                    <span key={tag} className="tag-suggestion popular" onClick={() => handleAddTag(tag)}>{tag}</span>
                  ))}
                </div>
              </>
            )}
            
            {/* TAG DETAIL VIEW - NEW 1.3 */}
            {bottomTab === 'profile' && profileTab === 'tags' && showTagDetail && (
              <>
                <div className="tag-detail-header">
                  <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>
                    <span style={{ cursor: 'pointer' }} onClick={() => setShowTagDetail(null)}>
                      <Icon name="ChevronLeft" size={24} />
                    </span>
                    <div>
                      <div className="tag-detail-name">{showTagDetail}</div>
                      <div className="tag-detail-count">{getEntriesForTag(showTagDetail).length} entries</div>
                    </div>
                  </div>
                  <div className="tag-detail-actions">
                    <button className="tag-action-btn" onClick={() => {
                      const newName = prompt('Rename tag:', showTagDetail);
                      if (newName) handleRenameTag(showTagDetail, newName);
                    }}>Rename</button>
                    <button className="tag-action-btn" onClick={() => handleDeleteTag(showTagDetail)}>Delete</button>
                  </div>
                </div>
                <div className="poster-grid">
                  {getEntriesForTag(showTagDetail).map(show => (
                    <div key={show.id} className="poster-item" onClick={() => handleEpisodePress({ id: show.id, poster: show.poster, showName: show.name, season: 1, episode: 1, name: 'Episode 1', year: show.year })}>
                      <img src={show.poster} alt={show.name} className="poster-img" />
                    </div>
                  ))}
                </div>
                {getEntriesForTag(showTagDetail).length === 0 && (
                  <EmptyState title="No entries with this tag." quoteIndex={1} />
                )}
              </>
            )}
            
            {bottomTab === 'profile' && profileTab === 'lists' && (
              <>
                <div className="section-header">
                  <span>Your Lists ({getMyLists().length})</span>
                  <span className="section-header-action" onClick={() => setShowNewList(true)}>New</span>
                </div>
                {getMyLists().length > 0 ? (
                  getMyLists().map(list => (
                    <div key={list.id} className="list-card" onClick={() => setShowListDetail(list)}>
                      <div className="list-card-header">
                        <span className="list-title">
                          {list.title}
                          {!list.isPublic && <span className="list-private-badge"><Icon name="Lock" size={10} /> Private</span>}
                        </span>
                      </div>
                      <p className="list-desc">{list.desc}</p>
                      <div className="list-posters-scroll">
                        {list.posters.slice(0, 6).map((p, i) => <img key={i} src={p} alt="" className="list-poster-sm" />)}
                      </div>
                      <div className="list-meta">
                        <span className="list-meta-item">{list.entries.length} shows</span>
                        {list.isRanked && <span className="list-meta-item">Ranked</span>}
                      </div>
                    </div>
                  ))
                ) : (
                  <EmptyState title="No lists yet. Create one!" quoteIndex={3} />
                )}
              </>
            )}
            
            {bottomTab === 'profile' && profileTab === 'watchlist' && (
              <>
                <div className="watchlist-sort-bar">
                  <span className="watchlist-sort-label">{Object.values(watchlist).filter(Boolean).length} films</span>
                  <select 
                    className="watchlist-sort-select"
                    value={watchlistSort}
                    onChange={(e) => setWatchlistSort(e.target.value)}
                  >
                    <option value="added">When Added</option>
                    <option value="priority">By Priority</option>
                    <option value="title">Alphabetical</option>
                    <option value="year">By Year</option>
                  </select>
                </div>
                {Object.values(watchlist).filter(Boolean).length > 0 ? (
                  <div className="films-grid">
                    {getSortedWatchlist().map(show => (
                      <div key={show.id} className="films-grid-item" style={{ position: 'relative' }} onClick={() => handleEpisodePress({ id: show.id, poster: show.poster, showName: show.name, year: show.year })}>
                        <img src={show.poster} alt={show.name} />
                        {watchlistPriorities[show.id] && (
                          <span className={`priority-badge ${watchlistPriorities[show.id]}`} style={{ position: 'absolute', top: 4, right: 4 }}>
                            {watchlistPriorities[show.id] === 'high' ? '!!!' : watchlistPriorities[show.id] === 'medium' ? '!!' : '!'}
                          </span>
                        )}
                      </div>
                    ))}
                  </div>
                ) : (
                  <EmptyState title="No films in watchlist." quoteIndex={3} />
                )}
              </>
            )}
            
            {/* FILMS TAB - CAT 3.2 */}
            {bottomTab === 'profile' && profileTab === 'films' && (
              <>
                <div className="films-tab-header">
                  <span className="films-tab-count">{Object.values(watched).filter(Boolean).length} films</span>
                  <button className="films-tab-sort">
                    When Added <Icon name="ChevronDown" size={16} />
                  </button>
                </div>
                {Object.values(watched).filter(Boolean).length > 0 ? (
                  <div className="films-grid">
                    {SHOWS.filter(s => watched[s.id]).map(show => (
                      <div key={show.id} className="films-grid-item" onClick={() => handleEpisodePress({ id: show.id, poster: show.poster, showName: show.name, year: show.year })}>
                        <img src={show.poster} alt={show.name} />
                      </div>
                    ))}
                  </div>
                ) : (
                  <EmptyState title="No films watched yet." quoteIndex={0} />
                )}
              </>
            )}
            
            {/* REVIEWS TAB - CAT 3.2 */}
            {bottomTab === 'profile' && profileTab === 'reviews' && (
              <>
                <div className="reviews-tab-header">
                  <span className="reviews-tab-count">{userReviews.length} reviews</span>
                  <button className="films-tab-sort">
                    When Added <Icon name="ChevronDown" size={16} />
                  </button>
                </div>
                {userReviews.length > 0 ? (
                  userReviews.map(review => (
                    <div key={review.id} className="review-card">
                      <div className="review-header">
                        <div className="review-left">
                          <div className="review-title-row">
                            <span className="review-title">{review.showName}</span>
                            <span className="review-year">{review.year}</span>
                          </div>
                          <div className="review-rating-row">
                            {review.rating > 0 && <Stars rating={review.rating} />}
                            {review.hasSpoilers && <span className="review-spoiler-badge">SPOILER</span>}
                          </div>
                          <div className="review-date">{review.date}</div>
                        </div>
                        <img src={review.poster} alt="" className="review-poster" />
                      </div>
                      <p className="review-text">{review.text ? renderMarkdown(review.text) : <em style={{ color: 'var(--text-tertiary)' }}>No review text</em>}</p>
                      <div className="my-review-actions">
                        <span className="my-review-action" onClick={() => handleEditReview(review)}>Edit</span>
                        <span className="my-review-action delete" onClick={() => handleDeleteReview(review.id)}>Delete</span>
                      </div>
                    </div>
                  ))
                ) : (
                  <EmptyState title="No reviews yet." quoteIndex={1} />
                )}
              </>
            )}
            
            {/* LIKES TAB - CAT 3.2 */}
            {bottomTab === 'profile' && profileTab === 'likes' && (
              <>
                <div className="likes-segment">
                  <button className={`likes-segment-btn ${likesView === 'films' ? 'active' : ''}`} onClick={() => setLikesView('films')}>
                    Films ({getLikedShowsCount()})
                  </button>
                  <button className={`likes-segment-btn ${likesView === 'reviews' ? 'active' : ''}`} onClick={() => setLikesView('reviews')}>
                    Reviews ({getLikedReviewsCount()})
                  </button>
                  <button className={`likes-segment-btn ${likesView === 'lists' ? 'active' : ''}`} onClick={() => setLikesView('lists')}>
                    Lists ({getLikedListsCount()})
                  </button>
                </div>
                
                {likesView === 'films' && (
                  getLikedShowsCount() > 0 ? (
                    <div className="likes-grid">
                      {SHOWS.filter(s => likedShows[s.id]).map(show => (
                        <div key={show.id} className="poster-item" onClick={() => handleEpisodePress({ id: show.id, poster: show.poster, showName: show.name, year: show.year })}>
                          <img src={show.poster} alt={show.name} className="poster-img" />
                        </div>
                      ))}
                    </div>
                  ) : (
                    <EmptyState title="No liked films yet." quoteIndex={2} />
                  )
                )}
                
                {likesView === 'reviews' && (
                  getLikedReviewsCount() > 0 ? (
                    REVIEWS.filter(r => likedReviews[r.id]).map(review => {
                      const user = USERS[review.userId];
                      return (
                        <div key={review.id} className="review-card">
                          <div className="review-header">
                            <div className="review-left">
                              <div className="review-user-row">
                                <Avatar user={user} size="sm" />
                                <span style={{ fontSize: 13 }}>{user?.username}</span>
                                <Badge type={user?.badge} />
                              </div>
                              <div className="review-title-row">
                                <span className="review-title">{review.showName}</span>
                                <span className="review-year">{review.year}</span>
                              </div>
                              <div className="review-rating-row">
                                {review.rating > 0 && <Stars rating={review.rating} />}
                              </div>
                            </div>
                            <img src={review.poster} alt="" className="review-poster" />
                          </div>
                          <p className="review-text">{renderMarkdown(review.text)}</p>
                        </div>
                      );
                    })
                  ) : (
                    <EmptyState title="No liked reviews yet." quoteIndex={1} />
                  )
                )}
                
                {likesView === 'lists' && (
                  getLikedListsCount() > 0 ? (
                    userLists.filter(l => likedLists[l.id]).map(list => {
                      const user = USERS[list.userId];
                      return (
                        <div key={list.id} className="list-card" onClick={() => setShowListDetail(list)}>
                          <div className="list-card-header">
                            <span className="list-title">{list.title}</span>
                            <div className="list-user">
                              <span style={{ fontSize: 13, color: 'var(--text-secondary)' }}>{user?.username}</span>
                              <Avatar user={user} size="sm" />
                            </div>
                          </div>
                          <p className="list-desc">{list.desc}</p>
                          <div className="list-posters-scroll">
                            {list.posters.slice(0, 6).map((p, i) => <img key={i} src={p} alt="" className="list-poster-sm" />)}
                          </div>
                        </div>
                      );
                    })
                  ) : (
                    <EmptyState title="No liked lists yet." quoteIndex={0} />
                  )
                )}
              </>
            )}
            
            {/* NETWORK TAB (Following/Followers) - CAT 3.2 */}
            {bottomTab === 'profile' && profileTab === 'network' && (
              <>
                <div className="network-segment">
                  <button className={`network-segment-btn ${networkView === 'following' ? 'active' : ''}`} onClick={() => setNetworkView('following')}>
                    Following ({following.length})
                  </button>
                  <button className={`network-segment-btn ${networkView === 'followers' ? 'active' : ''}`} onClick={() => setNetworkView('followers')}>
                    Followers ({followers.length})
                  </button>
                </div>
                
                {networkView === 'following' && (
                  following.length > 0 ? (
                    following.map(userId => {
                      const user = USERS[userId];
                      if (!user) return null;
                      return (
                        <div key={userId} className="network-user">
                          <Avatar user={user} />
                          <div className="network-user-info">
                            <div className="network-user-name">
                              {user.displayName || user.username}
                              {user.badge && <Badge type={user.badge} />}
                            </div>
                            <div className="network-user-handle">@{user.username}</div>
                            {user.bio && <div className="network-user-bio">{user.bio}</div>}
                          </div>
                          <button 
                            className="network-follow-btn following"
                            onClick={() => handleFollow(userId)}
                          >
                            Following
                          </button>
                        </div>
                      );
                    })
                  ) : (
                    <EmptyState title="Not following anyone yet." quoteIndex={2} />
                  )
                )}
                
                {networkView === 'followers' && (
                  followers.length > 0 ? (
                    followers.map(userId => {
                      const user = USERS[userId];
                      if (!user) return null;
                      const isFollowing = following.includes(userId);
                      return (
                        <div key={userId} className="network-user">
                          <Avatar user={user} />
                          <div className="network-user-info">
                            <div className="network-user-name">
                              {user.displayName || user.username}
                              {user.badge && <Badge type={user.badge} />}
                            </div>
                            <div className="network-user-handle">@{user.username}</div>
                            {user.bio && <div className="network-user-bio">{user.bio}</div>}
                          </div>
                          <button 
                            className={`network-follow-btn ${isFollowing ? 'following' : 'not-following'}`}
                            onClick={() => handleFollow(userId)}
                          >
                            {isFollowing ? 'Following' : 'Follow'}
                          </button>
                        </div>
                      );
                    })
                  ) : (
                    <EmptyState title="No followers yet." quoteIndex={3} />
                  )
                )}
              </>
            )}
            
            {/* RATINGS TAB (Histogram) - CAT 3.2 */}
            {/* STATS TAB - CAT 4: STATS & ANALYTICS (Pro) */}
            {bottomTab === 'profile' && profileTab === 'stats' && (
              <div className="stats-page">
                {/* Stats Header */}
                <div className="stats-header">
                  <div className="stats-header-title">
                    Your Stats
                    <span className="stats-pro-badge"><Icon name="Star" size={10} filled /> PRO</span>
                  </div>
                  <div className="stats-header-subtitle">All-time viewing statistics</div>
                </div>
                
                {/* Hero Stats */}
                <div className="stats-hero">
                  <div className="stats-hero-item">
                    <div className="stats-hero-value">{Object.values(watched).filter(Boolean).length}</div>
                    <div className="stats-hero-label">Films</div>
                  </div>
                  <div className="stats-hero-item">
                    <div className="stats-hero-value">{getTotalHoursWatched()}</div>
                    <div className="stats-hero-label">Hours</div>
                  </div>
                  <div className="stats-hero-item">
                    <div className="stats-hero-value">
                      {Object.values(ratings).filter(r => r > 0).length > 0 
                        ? (Object.values(ratings).filter(r => r > 0).reduce((a, b) => a + b, 0) / Object.values(ratings).filter(r => r > 0).length).toFixed(1)
                        : '—'}
                    </div>
                    <div className="stats-hero-label">Avg Rating</div>
                  </div>
                </div>
                
                {/* Year Navigation */}
                <div className="stats-year-nav">
                  <button onClick={() => setStatsYear(y => Math.max(2020, y - 1))} disabled={statsYear <= 2020}><Icon name="ChevronLeft" size={24} /></button>
                  <span className="stats-year-label">{statsYear}</span>
                  <button onClick={() => setStatsYear(y => Math.min(currentYear, y + 1))} disabled={statsYear >= currentYear}><Icon name="ChevronRight" size={24} /></button>
                </div>
                
                {/* This Year Stats */}
                <div className="stats-section">
                  <div className="stats-section-header">
                    <span className="stats-section-title">{statsYear === currentYear ? 'This Year' : statsYear}</span>
                    <span className="stats-section-link">{getFilmsInStatsYear()} films</span>
                  </div>
                  
                  {/* Films Per Month Chart */}
                  <div style={{ background: 'var(--bg-card)', borderRadius: 12, padding: 16 }}>
                    <div className="stats-month-chart">
                      {getFilmsPerMonth().map((count, i) => {
                        const maxCount = Math.max(...getFilmsPerMonth(), 1);
                        return (
                          <div 
                            key={i} 
                            className="stats-month-bar"
                            style={{ height: count > 0 ? `${(count / maxCount) * 100}%` : '4px', opacity: count > 0 ? 1 : 0.3 }}
                          />
                        );
                      })}
                    </div>
                    <div className="stats-month-labels">
                      {['J', 'F', 'M', 'A', 'M', 'J', 'J', 'A', 'S', 'O', 'N', 'D'].map((m, i) => (
                        <span key={i} className="stats-month-label">{m}</span>
                      ))}
                    </div>
                  </div>
                </div>
                
                {/* Longest Streak */}
                <div className="stats-section">
                  <div className="stats-section-header">
                    <span className="stats-section-title">Streak</span>
                  </div>
                  <div className="stats-streak">
                    <span className="stats-streak-icon">🔥</span>
                    <div className="stats-streak-number">{getLongestStreak()}</div>
                    <div className="stats-streak-text">
                      <div className="stats-streak-label">Day Watching Streak</div>
                      <div className="stats-streak-sub">Your longest run this year</div>
                    </div>
                  </div>
                </div>
                
                {/* Rating Distribution */}
                <div className="stats-section">
                  <div className="stats-section-header">
                    <span className="stats-section-title">Ratings</span>
                    <span className="stats-section-link">{Object.values(ratings).filter(r => r > 0).length} rated</span>
                  </div>
                  <div style={{ background: 'var(--bg-card)', borderRadius: 12, padding: 16 }}>
                    {(() => {
                      const dist = getRatingsDistribution();
                      const maxCount = Math.max(...Object.values(dist), 1);
                      const ratingLabels = ['½', '1', '1½', '2', '2½', '3', '3½', '4', '4½', '5'];
                      const ratingValues = [0.5, 1, 1.5, 2, 2.5, 3, 3.5, 4, 4.5, 5];
                      
                      return (
                        <div className="ratings-histogram">
                          {ratingValues.map((rating, i) => (
                            <div key={rating} className="ratings-bar-container">
                              <span className="ratings-bar-count">{dist[rating] > 0 ? dist[rating] : ''}</span>
                              <div className="ratings-bar-wrapper">
                                <div 
                                  className="ratings-bar" 
                                  style={{ height: dist[rating] > 0 ? `${(dist[rating] / maxCount) * 100}%` : '2px' }}
                                />
                              </div>
                              <span className="ratings-bar-label">{ratingLabels[i]}</span>
                            </div>
                          ))}
                        </div>
                      );
                    })()}
                  </div>
                </div>
                
                {/* Genres */}
                <div className="stats-section">
                  <div className="stats-section-header">
                    <span className="stats-section-title">Genres</span>
                  </div>
                  <div className="stats-bar-chart">
                    {getGenreDistribution().slice(0, 5).map(([genre, count]) => {
                      const maxCount = Math.max(...getGenreDistribution().map(g => g[1]), 1);
                      return (
                        <div key={genre} className="stats-bar-row">
                          <span className="stats-bar-label">{genre}</span>
                          <div className="stats-bar-track">
                            <div className="stats-bar-fill" style={{ width: `${(count / maxCount) * 100}%` }} />
                          </div>
                          <span className="stats-bar-count">{count}</span>
                        </div>
                      );
                    })}
                  </div>
                </div>
                
                {/* Decades */}
                <div className="stats-section">
                  <div className="stats-section-header">
                    <span className="stats-section-title">Decades</span>
                  </div>
                  <div className="stats-bar-chart">
                    {getDecadeDistribution().map(([decade, count]) => {
                      const maxCount = Math.max(...getDecadeDistribution().map(d => d[1]), 1);
                      return (
                        <div key={decade} className="stats-bar-row">
                          <span className="stats-bar-label">{decade}</span>
                          <div className="stats-bar-track">
                            <div className="stats-bar-fill" style={{ width: `${(count / maxCount) * 100}%` }} />
                          </div>
                          <span className="stats-bar-count">{count}</span>
                        </div>
                      );
                    })}
                  </div>
                </div>
                
                {/* Most Watched (by rewatches) */}
                <div className="stats-section">
                  <div className="stats-section-header">
                    <span className="stats-section-title">Most Watched</span>
                  </div>
                  <div style={{ display: 'flex', gap: 8, overflowX: 'auto', paddingBottom: 8 }}>
                    {SHOWS.filter(s => watched[s.id]).slice(0, 5).map(show => (
                      <div key={show.id} style={{ flexShrink: 0, width: 80, textAlign: 'center' }} onClick={() => handleEpisodePress({ id: show.id, poster: show.poster, showName: show.name, year: show.year })}>
                        <img src={show.poster} alt={show.name} style={{ width: 80, height: 120, borderRadius: 6, objectFit: 'cover' }} />
                        <div style={{ fontSize: 11, marginTop: 4, color: 'var(--text-secondary)', whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis' }}>{show.name}</div>
                      </div>
                    ))}
                  </div>
                </div>
                
                {/* Highs & Lows */}
                <div className="stats-section">
                  <div className="stats-section-header">
                    <span className="stats-section-title">Highs & Lows</span>
                  </div>
                  
                  {getHighestRated() && (
                    <div className="stats-highlight-card">
                      <div className="stats-highlight-row">
                        <img src={getHighestRated().show.poster} alt="" className="stats-highlight-poster" />
                        <div className="stats-highlight-info">
                          <div className="stats-highlight-label">Highest Rated</div>
                          <div className="stats-highlight-title">{getHighestRated().show.name}</div>
                          <div className="stats-highlight-meta">
                            <Stars rating={getHighestRated().rating} />
                            <span>{getHighestRated().show.year}</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  )}
                  
                  {getLowestRated() && (
                    <div className="stats-highlight-card">
                      <div className="stats-highlight-row">
                        <img src={getLowestRated().show.poster} alt="" className="stats-highlight-poster" />
                        <div className="stats-highlight-info">
                          <div className="stats-highlight-label">Lowest Rated</div>
                          <div className="stats-highlight-title">{getLowestRated().show.name}</div>
                          <div className="stats-highlight-meta">
                            <Stars rating={getLowestRated().rating} />
                            <span>{getLowestRated().show.year}</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  )}
                </div>
                
                {/* Milestone Progress */}
                <div className="stats-section">
                  <div className="stats-section-header">
                    <span className="stats-section-title">Milestone Progress</span>
                  </div>
                  <div className="stats-milestones">
                    <div className="stats-milestone">
                      <div className="stats-milestone-header">
                        <span className="stats-milestone-title">IMDb Top 250 TV</span>
                        <span className="stats-milestone-count">{Math.min(Object.values(watched).filter(Boolean).length, 12)}/250</span>
                      </div>
                      <div className="stats-milestone-bar">
                        <div className="stats-milestone-progress" style={{ width: `${(Math.min(Object.values(watched).filter(Boolean).length, 12) / 250) * 100}%` }} />
                      </div>
                    </div>
                    <div className="stats-milestone">
                      <div className="stats-milestone-header">
                        <span className="stats-milestone-title">Emmy Winners</span>
                        <span className="stats-milestone-count">{Math.min(Object.values(watched).filter(Boolean).length, 8)}/100</span>
                      </div>
                      <div className="stats-milestone-bar">
                        <div className="stats-milestone-progress" style={{ width: `${(Math.min(Object.values(watched).filter(Boolean).length, 8) / 100) * 100}%` }} />
                      </div>
                    </div>
                    <div className="stats-milestone">
                      <div className="stats-milestone-header">
                        <span className="stats-milestone-title">Prestige Drama</span>
                        <span className="stats-milestone-count">{getGenreDistribution().find(g => g[0] === 'Drama')?.[1] || 0}/50</span>
                      </div>
                      <div className="stats-milestone-bar">
                        <div className="stats-milestone-progress" style={{ width: `${((getGenreDistribution().find(g => g[0] === 'Drama')?.[1] || 0) / 50) * 100}%` }} />
                      </div>
                    </div>
                  </div>
                </div>
                
                {/* Recently Rated Gallery */}
                <div className="stats-section">
                  <div className="stats-section-header">
                    <span className="stats-section-title">Recently Rated</span>
                  </div>
                  {Object.entries(ratings).filter(([id, r]) => r > 0).length > 0 ? (
                    <div className="poster-grid">
                      {Object.entries(ratings)
                        .filter(([id, r]) => r > 0)
                        .slice(0, 6)
                        .map(([id, rating]) => {
                          const show = SHOWS.find(s => s.id === parseInt(id));
                          if (!show) return null;
                          return (
                            <div key={id} className="poster-item" onClick={() => handleEpisodePress({ id: show.id, poster: show.poster, showName: show.name, year: show.year })}>
                              <img src={show.poster} alt={show.name} className="poster-img" />
                              <div style={{ position: 'absolute', bottom: 4, left: 4, background: 'rgba(0,0,0,0.7)', padding: '2px 6px', borderRadius: 4, fontSize: 11 }}>
                                <Stars rating={rating} />
                              </div>
                            </div>
                          );
                        })}
                    </div>
                  ) : (
                    <EmptyState title="No rated films yet." quoteIndex={1} />
                  )}
                </div>
              </div>
            )}
          </div>
          
          {/* BULK SELECT BAR - NEW 1.1 */}
          {bulkSelectMode && selectedBulkCount > 0 && (
            <div className="bulk-select-bar">
              <span className="bulk-select-count">{selectedBulkCount} selected</span>
              <button className="bulk-select-btn secondary" onClick={() => setSelectedForBulk({})}>Clear</button>
              <button className="bulk-select-btn primary" onClick={handleBulkMarkWatched}>Mark Watched</button>
            </div>
          )}
          
          {/* BOTTOM NAV */}
          <div className="bottom-nav">
            <button className={`nav-item ${bottomTab === 'home' ? 'active' : ''}`} onClick={() => setBottomTab('home')}><Icon name="Films" size={24} /></button>
            <button className={`nav-item ${bottomTab === 'search' ? 'active' : ''}`} onClick={() => setBottomTab('search')}><Icon name="Search" size={24} /></button>
            <div className="nav-add"><button className="nav-add-btn" onClick={() => setShowAddFilm(true)}><Icon name="Plus" size={24} /></button></div>
            <button className={`nav-item ${bottomTab === 'activity' ? 'active' : ''}`} onClick={() => setBottomTab('activity')}><Icon name="Activity" size={24} filled={bottomTab === 'activity'} /></button>
            <button className={`nav-item ${bottomTab === 'profile' ? 'active' : ''}`} onClick={() => setBottomTab('profile')}><Icon name="Profile" size={24} filled={bottomTab === 'profile'} /></button>
          </div>
          
          {/* CATEGORY 6: BROWSE PAGES */}
          {browsePage && (
            <div className="browse-page">
              {/* Browse Header */}
              <div className="browse-header">
                <button className="browse-back" onClick={() => { 
                  if (browseFilter) {
                    setBrowseFilter(null);
                  } else {
                    setBrowsePage(null); 
                  }
                }}>
                  <Icon name="ChevronLeft" size={24} />
                </button>
                <span className="browse-header-title">
                  {browsePage === 'genre' && (browseFilter || 'Browse by Genre')}
                  {browsePage === 'decade' && (browseFilter || 'Browse by Decade')}
                  {browsePage === 'service' && (browseFilter || 'Streaming Services')}
                  {browsePage === 'popular' && 'Most Popular'}
                  {browsePage === 'rated' && 'Highest Rated'}
                </span>
              </div>
              
              {/* Genre Selection */}
              {browsePage === 'genre' && !browseFilter && (
                <div className="genre-grid">
                  {GENRES.map(genre => (
                    <div 
                      key={genre.name} 
                      className="genre-card" 
                      style={{ borderLeft: `4px solid ${genre.color}` }}
                      onClick={() => setBrowseFilter(genre.name)}
                    >
                      <div className="genre-card-icon">{genre.icon}</div>
                      <div className="genre-card-name">{genre.name}</div>
                      <div className="genre-card-count">{getShowsByGenre(genre.name).length} shows</div>
                    </div>
                  ))}
                </div>
              )}
              
              {/* Decade Selection */}
              {browsePage === 'decade' && !browseFilter && (
                <div className="decade-list">
                  {DECADES.map(decade => (
                    <div 
                      key={decade.name} 
                      className="decade-item"
                      onClick={() => setBrowseFilter(decade.name)}
                    >
                      <span className="decade-name">{decade.name}</span>
                      <span className="decade-count">{getShowsByDecade(decade.name).length} shows →</span>
                    </div>
                  ))}
                </div>
              )}
              
              {/* Service Selection */}
              {browsePage === 'service' && !browseFilter && (
                <div className="service-list">
                  {SERVICES.map(service => (
                    <div 
                      key={service.name} 
                      className="service-item"
                      onClick={() => setBrowseFilter(service.name)}
                    >
                      <div className="service-icon" style={{ background: service.color, color: service.color === '#000000' || service.color === '#002BE7' || service.color === '#113CCF' || service.color === '#0064FF' ? '#fff' : '#000' }}>
                        {service.icon}
                      </div>
                      <span className="service-name">{service.name}</span>
                      <span className="service-count">{getShowsByService(service.name).length} shows →</span>
                    </div>
                  ))}
                </div>
              )}
              
              {/* Genre Results Grid */}
              {browsePage === 'genre' && browseFilter && (
                <>
                  <div className="sort-bar">
                    <span className="sort-count">{getShowsByGenre(browseFilter).length} shows</span>
                    <div className="sort-options">
                      <button className={`sort-btn ${browseSort === 'popular' ? 'active' : ''}`} onClick={() => setBrowseSort('popular')}>Popular</button>
                      <button className={`sort-btn ${browseSort === 'rating' ? 'active' : ''}`} onClick={() => setBrowseSort('rating')}>Rating</button>
                      <button className={`sort-btn ${browseSort === 'name' ? 'active' : ''}`} onClick={() => setBrowseSort('name')}>A-Z</button>
                    </div>
                  </div>
                  {sortShows(getShowsByGenre(browseFilter), browseSort).length === 0 ? (
                    <div className="no-results">
                      <div className="no-results-icon">🎬</div>
                      <div className="no-results-title">No shows found</div>
                      <div className="no-results-text">No shows in {browseFilter}</div>
                    </div>
                  ) : (
                    <div className="browse-grid">
                      {sortShows(getShowsByGenre(browseFilter), browseSort).map(show => (
                        <div key={show.id} className="browse-grid-item" onClick={() => { setBrowsePage(null); setBrowseFilter(null); setShowDetailPage(show); }}>
                          <img src={show.poster} alt={show.name} className="browse-grid-poster" />
                          <div className="browse-grid-title">{show.name}</div>
                          {show.communityRating && (
                            <div className="browse-grid-rating">
                              <Stars rating={show.communityRating} />
                            </div>
                          )}
                        </div>
                      ))}
                    </div>
                  )}
                </>
              )}
              
              {/* Decade Results Grid */}
              {browsePage === 'decade' && browseFilter && (
                <>
                  <div className="sort-bar">
                    <span className="sort-count">{getShowsByDecade(browseFilter).length} shows</span>
                    <div className="sort-options">
                      <button className={`sort-btn ${browseSort === 'popular' ? 'active' : ''}`} onClick={() => setBrowseSort('popular')}>Popular</button>
                      <button className={`sort-btn ${browseSort === 'rating' ? 'active' : ''}`} onClick={() => setBrowseSort('rating')}>Rating</button>
                      <button className={`sort-btn ${browseSort === 'name' ? 'active' : ''}`} onClick={() => setBrowseSort('name')}>A-Z</button>
                    </div>
                  </div>
                  {sortShows(getShowsByDecade(browseFilter), browseSort).length === 0 ? (
                    <div className="no-results">
                      <div className="no-results-icon">📅</div>
                      <div className="no-results-title">No shows found</div>
                      <div className="no-results-text">No shows from the {browseFilter}</div>
                    </div>
                  ) : (
                    <div className="browse-grid">
                      {sortShows(getShowsByDecade(browseFilter), browseSort).map(show => (
                        <div key={show.id} className="browse-grid-item" onClick={() => { setBrowsePage(null); setBrowseFilter(null); setShowDetailPage(show); }}>
                          <img src={show.poster} alt={show.name} className="browse-grid-poster" />
                          <div className="browse-grid-title">{show.name}</div>
                          {show.communityRating && (
                            <div className="browse-grid-rating">
                              <Stars rating={show.communityRating} />
                            </div>
                          )}
                        </div>
                      ))}
                    </div>
                  )}
                </>
              )}
              
              {/* Service Results Grid */}
              {browsePage === 'service' && browseFilter && (
                <>
                  <div className="sort-bar">
                    <span className="sort-count">{getShowsByService(browseFilter).length} shows</span>
                    <div className="sort-options">
                      <button className={`sort-btn ${browseSort === 'popular' ? 'active' : ''}`} onClick={() => setBrowseSort('popular')}>Popular</button>
                      <button className={`sort-btn ${browseSort === 'rating' ? 'active' : ''}`} onClick={() => setBrowseSort('rating')}>Rating</button>
                      <button className={`sort-btn ${browseSort === 'name' ? 'active' : ''}`} onClick={() => setBrowseSort('name')}>A-Z</button>
                    </div>
                  </div>
                  {sortShows(getShowsByService(browseFilter), browseSort).length === 0 ? (
                    <div className="no-results">
                      <div className="no-results-icon">📺</div>
                      <div className="no-results-title">No shows found</div>
                      <div className="no-results-text">No shows on {browseFilter}</div>
                    </div>
                  ) : (
                    <div className="browse-grid">
                      {sortShows(getShowsByService(browseFilter), browseSort).map(show => (
                        <div key={show.id} className="browse-grid-item" onClick={() => { setBrowsePage(null); setBrowseFilter(null); setShowDetailPage(show); }}>
                          <img src={show.poster} alt={show.name} className="browse-grid-poster" />
                          <div className="browse-grid-title">{show.name}</div>
                          {show.communityRating && (
                            <div className="browse-grid-rating">
                              <Stars rating={show.communityRating} />
                            </div>
                          )}
                        </div>
                      ))}
                    </div>
                  )}
                </>
              )}
              
              {/* Most Popular Grid */}
              {browsePage === 'popular' && (
                <>
                  <div className="filter-chips">
                    <div className={`filter-chip ${!browseFilter ? 'active' : ''}`} onClick={() => setBrowseFilter(null)}>All</div>
                    {GENRES.map(g => (
                      <div key={g.name} className={`filter-chip ${browseFilter === g.name ? 'active' : ''}`} onClick={() => setBrowseFilter(g.name)}>
                        {g.icon} {g.name}
                      </div>
                    ))}
                  </div>
                  <div className="sort-bar">
                    <span className="sort-count">{getPopularShows().filter(s => !browseFilter || s.genre === browseFilter).length} shows</span>
                  </div>
                  <div className="browse-grid">
                    {getPopularShows().filter(s => !browseFilter || s.genre === browseFilter).map(show => (
                      <div key={show.id} className="browse-grid-item" onClick={() => { setBrowsePage(null); setBrowseFilter(null); setShowDetailPage(show); }}>
                        <img src={show.poster} alt={show.name} className="browse-grid-poster" />
                        <div className="browse-grid-title">{show.name}</div>
                        <div className="browse-grid-rating">
                          <span style={{ fontSize: 10, color: 'var(--text-muted)' }}>{show.watchCount ? (show.watchCount/1000).toFixed(0) + 'K watches' : ''}</span>
                        </div>
                      </div>
                    ))}
                  </div>
                </>
              )}
              
              {/* Highest Rated Grid - 4 columns per audit */}
              {browsePage === 'rated' && (
                <>
                  <div className="filter-chips">
                    <div className={`filter-chip ${!browseFilter ? 'active' : ''}`} onClick={() => setBrowseFilter(null)}>All</div>
                    {GENRES.map(g => (
                      <div key={g.name} className={`filter-chip ${browseFilter === g.name ? 'active' : ''}`} onClick={() => setBrowseFilter(g.name)}>
                        {g.icon} {g.name}
                      </div>
                    ))}
                  </div>
                  <div className="sort-bar">
                    <span className="sort-count">{getHighestRatedShows().filter(s => !browseFilter || s.genre === browseFilter).length} shows</span>
                  </div>
                  <div className="poster-grid-4">
                    {getHighestRatedShows().filter(s => !browseFilter || s.genre === browseFilter).map(show => (
                      <div key={show.id} className="poster-item" onClick={() => { setBrowsePage(null); setBrowseFilter(null); setShowDetailPage(show); }}>
                        <img src={show.poster} alt={show.name} className="poster-img" />
                        {show.communityRating && (
                          <div className="poster-rating-overlay">
                            <svg width="10" height="10" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
                            <span>{show.communityRating.toFixed(1)}</span>
                          </div>
                        )}
                      </div>
                    ))}
                  </div>
                </>
              )}
            </div>
          )}
          
          {/* CAT 5: FULL SHOW DETAIL PAGE */}
          {showDetailPage && (
            <div className="show-detail-page">
              {/* Backdrop */}
              <div style={{ position: 'relative' }}>
                <img 
                  src={showDetailPage.backdrop || showDetailPage.poster} 
                  alt="" 
                  className="show-detail-backdrop"
                />
                <div className="show-detail-backdrop-gradient" />
                
                {/* Header */}
                <div className="show-detail-header">
                  <div className="show-detail-back" onClick={() => setShowDetailPage(null)}>
                    <Icon name="ChevronLeft" size={24} />
                  </div>
                  <div className="show-detail-share">
                    <Icon name="Share" size={20} />
                  </div>
                </div>
              </div>
              
              {/* Hero Section */}
              <div className="show-detail-hero">
                <img src={showDetailPage.poster} alt="" className="show-detail-poster" />
                <div className="show-detail-info">
                  <div className="show-detail-title">{showDetailPage.name}</div>
                  <div className="show-detail-meta">
                    <span>{showDetailPage.year}</span>
                    {showDetailPage.runtime && <span>{showDetailPage.runtime} min</span>}
                    {showDetailPage.seasons && <span>{showDetailPage.seasons} seasons</span>}
                  </div>
                  <div className="show-detail-director">
                    Directed by <a>{showDetailPage.director || 'Various'}</a>
                  </div>
                </div>
              </div>
              
              {/* Quick Actions */}
              <div className="show-detail-actions">
                <div 
                  className={`show-detail-action ${watched[showDetailPage.id] ? 'active' : ''}`}
                  onClick={() => {
                    setWatched(p => ({ ...p, [showDetailPage.id]: !p[showDetailPage.id] }));
                    if (!watched[showDetailPage.id] && watchlist[showDetailPage.id]) {
                      setWatchlist(p => ({ ...p, [showDetailPage.id]: false }));
                    }
                  }}
                >
                  <Icon name="Eye" size={28} filled={watched[showDetailPage.id]} />
                  <span className="show-detail-action-label">{watched[showDetailPage.id] ? 'Watched' : 'Watch'}</span>
                </div>
                <div 
                  className={`show-detail-action ${liked[showDetailPage.id] ? 'liked' : ''}`}
                  onClick={() => setLiked(p => ({ ...p, [showDetailPage.id]: !p[showDetailPage.id] }))}
                >
                  <Icon name="Heart" size={28} filled={liked[showDetailPage.id]} />
                  <span className="show-detail-action-label">Like</span>
                </div>
                <div 
                  className={`show-detail-action ${watchlist[showDetailPage.id] ? 'active' : ''}`}
                  onClick={() => {
                    if (watchlist[showDetailPage.id]) {
                      // Already in watchlist - show priority picker
                      setShowPriorityPicker(showDetailPage.id);
                    } else {
                      // Add to watchlist
                      setWatchlist(p => ({ ...p, [showDetailPage.id]: true }));
                    }
                  }}
                >
                  <Icon name="Clock" size={28} filled={watchlist[showDetailPage.id]} />
                  <span className="show-detail-action-label">
                    {watchlist[showDetailPage.id] && watchlistPriorities[showDetailPage.id] 
                      ? `${watchlistPriorities[showDetailPage.id].charAt(0).toUpperCase() + watchlistPriorities[showDetailPage.id].slice(1)} Priority`
                      : 'Watchlist'}
                  </span>
                </div>
                <div 
                  className="show-detail-action"
                  onClick={() => handleOpenActionSheet(showDetailPage)}
                >
                  <Icon name="MoreHorizontal" size={28} />
                  <span className="show-detail-action-label">More</span>
                </div>
              </div>
              
              {/* Your Rating */}
              <div className="show-detail-rating-section">
                <div className="show-detail-rating-row">
                  <StarRating 
                    rating={ratings[showDetailPage.id] || 0} 
                    onChange={(r) => setRatings(p => ({ ...p, [showDetailPage.id]: p[showDetailPage.id] === r ? 0 : r }))} 
                  />
                </div>
                <div className="show-detail-rating-label">
                  {ratings[showDetailPage.id] ? 'Your rating' : 'Rate this show'}
                </div>
              </div>
              
              {/* Community Stats */}
              <div className="show-detail-community">
                <div className="show-detail-stat">
                  <div className="show-detail-stat-value">{showDetailPage.communityRating?.toFixed(1) || '—'}</div>
                  <div className="show-detail-stat-label">Avg Rating</div>
                </div>
                <div className="show-detail-stat">
                  <div className="show-detail-stat-value">{showDetailPage.watchCount ? (showDetailPage.watchCount / 1000).toFixed(0) + 'K' : '—'}</div>
                  <div className="show-detail-stat-label">Watches</div>
                </div>
                <div className="show-detail-stat">
                  <div className="show-detail-stat-value">{showDetailPage.likeCount ? (showDetailPage.likeCount / 1000).toFixed(0) + 'K' : '—'}</div>
                  <div className="show-detail-stat-label">Likes</div>
                </div>
                <div className="show-detail-stat">
                  <div className="show-detail-stat-value">{LISTS.filter(l => l.entries?.some(e => e.showId === showDetailPage.id)).length || '—'}</div>
                  <div className="show-detail-stat-label">In Lists</div>
                </div>
              </div>
              
              {/* Rating Histogram */}
              {showDetailPage.communityRating && (
                <div className="show-detail-histogram">
                  <div className="show-detail-histogram-title">Rating Distribution</div>
                  <div className="show-detail-histogram-bars">
                    {[0.5, 1, 1.5, 2, 2.5, 3, 3.5, 4, 4.5, 5].map((r, i) => {
                      const center = showDetailPage.communityRating;
                      const distance = Math.abs(r - center);
                      const height = Math.max(10, 100 - distance * 25);
                      return (
                        <div 
                          key={r} 
                          className={`show-detail-histogram-bar ${Math.abs(r - center) < 0.5 ? 'active' : ''}`}
                          style={{ height: `${height}%` }}
                        />
                      );
                    })}
                  </div>
                  <div className="show-detail-histogram-labels">
                    <span className="show-detail-histogram-label">½</span>
                    <span className="show-detail-histogram-label">★</span>
                    <span className="show-detail-histogram-label">1½</span>
                    <span className="show-detail-histogram-label">★★</span>
                    <span className="show-detail-histogram-label">2½</span>
                    <span className="show-detail-histogram-label">★★★</span>
                    <span className="show-detail-histogram-label">3½</span>
                    <span className="show-detail-histogram-label">★★★★</span>
                    <span className="show-detail-histogram-label">4½</span>
                    <span className="show-detail-histogram-label">★★★★★</span>
                  </div>
                </div>
              )}
              
              {/* Where to Watch - MOVED UP per Letterboxd */}
              {showDetailPage.streaming && showDetailPage.streaming.length > 0 && (
                <div className="show-detail-section">
                  <div className="show-detail-section-title">Where to Watch</div>
                  <div className="show-detail-streaming">
                    {showDetailPage.streaming.map((service, i) => {
                      const iconClass = service.name.toLowerCase().replace(/\+/g, '').replace(/ /g, '');
                      return (
                        <div key={i} className="show-detail-streaming-item">
                          <div className={`show-detail-streaming-icon ${iconClass}`}>
                            {service.name.charAt(0)}
                          </div>
                          <div>
                            <div className="show-detail-streaming-name">{service.name}</div>
                            <div className="show-detail-streaming-type">
                              {service.type === 'stream' ? 'Stream' : `Rent ${service.price || ''}`}
                            </div>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                  {/* JustWatch Attribution - AUDIT FIX */}
                  <div className="justwatch-attribution">
                    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg>
                    Streaming data by JustWatch
                  </div>
                </div>
              )}
              
              {/* Showtimes - AUDIT FIX */}
              <div className="showtimes-section">
                <div className="showtimes-row">
                  <div className="showtimes-label">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
                    Showtimes + tickets
                  </div>
                  <div className="showtimes-value">
                    No screens near you
                    <Icon name="ChevronRight" size={16} />
                  </div>
                </div>
              </div>
              
              {/* Trailer */}
              {showDetailPage.trailer && (
                <div className="show-detail-section">
                  <div className="show-detail-section-title">Trailer</div>
                  <div 
                    className="show-detail-trailer"
                    onClick={() => window.open(`https://www.youtube.com/watch?v=${showDetailPage.trailer}`, '_blank')}
                  >
                    <img 
                      src={`https://img.youtube.com/vi/${showDetailPage.trailer}/hqdefault.jpg`}
                      alt="Trailer thumbnail"
                      className="show-detail-trailer-thumb"
                      onError={(e) => { e.target.style.display = 'none'; }}
                    />
                    <div className="show-detail-trailer-play">
                      <Icon name="Play" size={28} />
                    </div>
                  </div>
                </div>
              )}
              
              {/* Synopsis */}
              {showDetailPage.synopsis && (
                <div className="show-detail-section">
                  <div className="show-detail-section-title">Synopsis</div>
                  <div className="show-detail-synopsis">{showDetailPage.synopsis}</div>
                </div>
              )}
              
              {/* RELATED NEWS - AUDIT FIX */}
              <div className="related-news">
                <div className="related-news-title">Related News</div>
                <div className="news-carousel">
                  <div className="news-carousel-track">
                    <div className="news-card">
                      <img 
                        src={showDetailPage.backdrop || 'https://image.tmdb.org/t/p/w780/default.jpg'} 
                        alt="" 
                        className="news-card-image"
                      />
                      <div className="news-card-content">
                        <div className="news-card-title">{showDetailPage.name} Returns for New Season</div>
                        <div className="news-card-meta">Entertainment Weekly • 2 days ago</div>
                      </div>
                    </div>
                  </div>
                </div>
                <div className="news-dots">
                  <div className="news-dot active" />
                  <div className="news-dot" />
                  <div className="news-dot" />
                </div>
              </div>
              
              {/* MENTIONS - AUDIT FIX */}
              <div className="mentions-section">
                <div className="mentions-title">Mentions</div>
                <div className="mentions-row">
                  <div className="mention-item">
                    <div className="mention-avatar">
                      <div className="mention-avatar-placeholder">EW</div>
                      <span className="mention-badge">3</span>
                    </div>
                    <div className="mention-name">Entertainment Weekly</div>
                  </div>
                  <div className="mention-item">
                    <div className="mention-avatar">
                      <div className="mention-avatar-placeholder">V</div>
                      <span className="mention-badge">2</span>
                    </div>
                    <div className="mention-name">Variety</div>
                  </div>
                  <div className="mention-item">
                    <div className="mention-avatar">
                      <div className="mention-avatar-placeholder">THR</div>
                      <span className="mention-badge">1</span>
                    </div>
                    <div className="mention-name">The Hollywood Reporter</div>
                  </div>
                  <div className="mention-item">
                    <div className="mention-avatar">
                      <div className="mention-avatar-placeholder">D</div>
                    </div>
                    <div className="mention-name">Deadline</div>
                  </div>
                </div>
              </div>
              
              {/* Cast */}
              {showDetailPage.cast && showDetailPage.cast.length > 0 && (
                <div className="show-detail-section">
                  <div className="show-detail-section-title">Cast</div>
                  <div className="show-detail-cast-scroll">
                    {showDetailPage.cast.map((person, i) => (
                      <div 
                        key={i} 
                        className="show-detail-cast-item"
                        onClick={() => openPersonPage(person.name)}
                        style={{ cursor: 'pointer' }}
                      >
                        <img 
                          src={person.photo || 'https://image.tmdb.org/t/p/w185/default.jpg'} 
                          alt={person.name}
                          className="show-detail-cast-photo"
                          onError={(e) => { e.target.src = 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect fill="%232c3440" width="100" height="100"/><text x="50" y="55" text-anchor="middle" fill="%236b7280" font-size="40">?</text></svg>'; }}
                        />
                        <div className="show-detail-cast-name">{person.name}</div>
                        <div className="show-detail-cast-role">{person.role}</div>
                      </div>
                    ))}
                  </div>
                </div>
              )}
              
              {/* Crew */}
              {showDetailPage.crew && showDetailPage.crew.length > 0 && (
                <div className="show-detail-section">
                  <div className="show-detail-section-title">Crew</div>
                  <div style={{ display: 'flex', flexDirection: 'column', gap: 8 }}>
                    {showDetailPage.crew.map((person, i) => (
                      <div 
                        key={i} 
                        style={{ display: 'flex', justifyContent: 'space-between', cursor: 'pointer' }}
                        onClick={() => openPersonPage(person.name)}
                      >
                        <span style={{ color: 'var(--brand-blue)', fontSize: 13 }}>{person.name}</span>
                        <span style={{ color: 'var(--text-tertiary)', fontSize: 13 }}>{person.role}</span>
                      </div>
                    ))}
                  </div>
                </div>
              )}
              
              {/* Details */}
              <div className="show-detail-section">
                <div className="show-detail-section-title">Details</div>
                <div className="show-detail-info-grid">
                  {showDetailPage.studio && (
                    <div className="show-detail-info-item">
                      <div className="show-detail-info-label">Studio</div>
                      <div className="show-detail-info-value">{showDetailPage.studio}</div>
                    </div>
                  )}
                  {showDetailPage.country && (
                    <div className="show-detail-info-item">
                      <div className="show-detail-info-label">Country</div>
                      <div className="show-detail-info-value">{showDetailPage.country}</div>
                    </div>
                  )}
                  {showDetailPage.language && (
                    <div className="show-detail-info-item">
                      <div className="show-detail-info-label">Language</div>
                      <div className="show-detail-info-value">{showDetailPage.language}</div>
                    </div>
                  )}
                  {showDetailPage.genre && (
                    <div className="show-detail-info-item">
                      <div className="show-detail-info-label">Genre</div>
                      <div className="show-detail-info-value">{showDetailPage.genre}</div>
                    </div>
                  )}
                  {showDetailPage.episodes && (
                    <div className="show-detail-info-item">
                      <div className="show-detail-info-label">Episodes</div>
                      <div className="show-detail-info-value">{showDetailPage.episodes}</div>
                    </div>
                  )}
                  {showDetailPage.runtime && (
                    <div className="show-detail-info-item">
                      <div className="show-detail-info-label">Runtime</div>
                      <div className="show-detail-info-value">{showDetailPage.runtime} min</div>
                    </div>
                  )}
                </div>
                
                {/* OPEN IN Section - AUDIT FIX */}
                <div className="open-in-section" style={{ padding: '16px 0', marginTop: 8 }}>
                  <div className="open-in-title">Open In</div>
                  <div className="open-in-buttons">
                    <button className="open-in-btn" onClick={() => window.open('https://rocketwatch.app', '_blank')}>WEB</button>
                    <button className="open-in-btn" onClick={() => window.open(`https://www.imdb.com/find?q=${encodeURIComponent(showDetailPage.name)}`, '_blank')}>IMDB</button>
                    <button className="open-in-btn" onClick={() => window.open(`https://www.themoviedb.org/search?query=${encodeURIComponent(showDetailPage.name)}`, '_blank')}>TMDB</button>
                  </div>
                </div>
              </div>
              
              {/* Similar Shows */}
              {showDetailPage.similar && showDetailPage.similar.length > 0 && (
                <div className="show-detail-section">
                  <div className="show-detail-section-title">Similar Shows</div>
                  <div className="show-detail-similar">
                    {showDetailPage.similar.map(showId => {
                      const similarShow = SHOWS.find(s => s.id === showId);
                      if (!similarShow) return null;
                      return (
                        <div 
                          key={showId} 
                          className="show-detail-similar-item"
                          onClick={() => setShowDetailPage(similarShow)}
                        >
                          <img src={similarShow.poster} alt={similarShow.name} className="show-detail-similar-poster" />
                          <div className="show-detail-similar-title">{similarShow.name}</div>
                        </div>
                      );
                    })}
                  </div>
                </div>
              )}
              
              {/* Popular Lists Containing This Show */}
              {(() => {
                const containingLists = LISTS.filter(l => l.entries?.some(e => e.showId === showDetailPage.id));
                if (containingLists.length === 0) return null;
                return (
                  <div className="show-detail-section">
                    <div className="show-detail-section-title">Popular Lists</div>
                    <div style={{ display: 'flex', flexDirection: 'column', gap: 12 }}>
                      {containingLists.slice(0, 3).map(list => {
                        const user = USERS[list.userId] || USERS.me;
                        return (
                          <div 
                            key={list.id} 
                            className="show-detail-review-card"
                            style={{ cursor: 'pointer' }}
                            onClick={() => { setShowDetailPage(null); setViewingList(list); }}
                          >
                            <div style={{ display: 'flex', gap: 8, marginBottom: 8 }}>
                              {list.posters?.slice(0, 4).map((p, i) => (
                                <img key={i} src={p} alt="" style={{ width: 40, height: 60, borderRadius: 4, objectFit: 'cover' }} />
                              ))}
                            </div>
                            <div style={{ fontWeight: 600, fontSize: 14 }}>{list.title}</div>
                            <div style={{ fontSize: 12, color: 'var(--text-tertiary)', marginTop: 4 }}>
                              by {user.displayName || user.username} • {list.entries?.length || 0} films
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                );
              })()}
              
              {/* Friends Activity */}
              {(() => {
                const friendsWhoWatched = Object.keys(USERS).filter(uid => 
                  uid !== 'me' && following.includes(uid)
                ).slice(0, 3);
                if (friendsWhoWatched.length === 0) return null;
                return (
                  <div className="show-detail-section">
                    <div className="show-detail-section-title">Friends Who Watched</div>
                    <div style={{ display: 'flex', gap: 12 }}>
                      {friendsWhoWatched.map(uid => {
                        const user = USERS[uid];
                        return (
                          <div key={uid} style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: 4 }}>
                            <Avatar user={user} size="md" />
                            <div style={{ fontSize: 11, color: 'var(--text-secondary)' }}>{user.displayName || user.username}</div>
                            <Stars rating={4 + Math.random()} />
                          </div>
                        );
                      })}
                    </div>
                  </div>
                );
              })()}
              
              {/* Reviews for this Show */}
              <div className="show-detail-section">
                <div className="show-detail-section-title">Popular Reviews</div>
                {(() => {
                  const showReviews = [...REVIEWS, ...userReviews].filter(r => r.showId === showDetailPage.id || r.showName === showDetailPage.name);
                  if (showReviews.length === 0) {
                    return <div style={{ color: 'var(--text-tertiary)', fontSize: 13 }}>No reviews yet. Be the first!</div>;
                  }
                  return (
                    <div className="show-detail-reviews">
                      {showReviews.slice(0, 3).map(review => {
                        const user = USERS[review.userId] || USERS.me;
                        return (
                          <div key={review.id} className="show-detail-review-card">
                            <div className="show-detail-review-header">
                              <Avatar user={user} size="sm" />
                              <span className="show-detail-review-user">{user.displayName || user.username}</span>
                              {review.rating && <Stars rating={review.rating} />}
                            </div>
                            <div className="show-detail-review-text">
                              {review.text?.replace(/\*\*/g, '').replace(/\*/g, '')}
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  );
                })()}
              </div>
              
              {/* Write Review Button */}
              <div className="show-detail-section" style={{ paddingBottom: 40 }}>
                <button 
                  style={{ 
                    width: '100%', 
                    padding: '14px', 
                    background: 'var(--brand-green)', 
                    color: '#000', 
                    border: 'none', 
                    borderRadius: 8, 
                    fontSize: 15, 
                    fontWeight: 600, 
                    cursor: 'pointer' 
                  }}
                  onClick={() => {
                    setShowDetailPage(null);
                    handleOpenWriteReview({ id: showDetailPage.id, showName: showDetailPage.name, year: showDetailPage.year, poster: showDetailPage.poster });
                  }}
                >
                  Write a Review
                </button>
              </div>
            </div>
          )}
          
          {/* CATEGORY 7: SETTINGS PAGE */}
          {showSettings && (
            <div className="settings-page">
              {/* Main Settings Menu */}
              {settingsPage === 'main' && (
                <>
                  <div className="settings-header">
                    <button className="settings-back" onClick={() => { setShowSettings(false); setSettingsPage('main'); }}>
                      <Icon name="ChevronLeft" size={24} />
                    </button>
                    <span className="settings-header-title">Settings</span>
                  </div>
                  
                  <div className="settings-section">
                    <div className="settings-section-title">Account</div>
                    <div className="settings-row" onClick={() => setSettingsPage('profile')}>
                      <div className="settings-row-left">
                        <div className="settings-row-icon green"><Icon name="Profile" size={18} /></div>
                        <div className="settings-row-content">
                          <div className="settings-row-label">Edit Profile</div>
                          <div className="settings-row-sublabel">Name, bio, avatar, website</div>
                        </div>
                      </div>
                      <span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span>
                    </div>
                    <div className="settings-row" onClick={() => setSettingsPage('account')}>
                      <div className="settings-row-left">
                        <div className="settings-row-icon blue"><Icon name="Lock" size={18} /></div>
                        <div className="settings-row-content">
                          <div className="settings-row-label">Account Settings</div>
                          <div className="settings-row-sublabel">Email, password, username</div>
                        </div>
                      </div>
                      <span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span>
                    </div>
                  </div>
                  
                  <div className="settings-section">
                    <div className="settings-section-title">Preferences</div>
                    <div className="settings-row">
                      <div className="settings-row-left">
                        <div className="settings-row-icon"><Icon name="Eye" size={18} /></div>
                        <div className="settings-row-content">
                          <div className="settings-row-label">Dark Mode</div>
                          <div className="settings-row-sublabel">Always on (follows system)</div>
                        </div>
                      </div>
                      <button className="settings-toggle active" />
                    </div>
                    <div className="settings-row" onClick={() => setSettingsPage('streaming')}>
                      <div className="settings-row-left">
                        <div className="settings-row-icon"><Icon name="Globe" size={18} /></div>
                        <div className="settings-row-content">
                          <div className="settings-row-label">Streaming Services</div>
                          <div className="settings-row-sublabel">{selectedStreamingServices.length} services selected</div>
                        </div>
                      </div>
                      <span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span>
                    </div>
                    <div className="settings-row" onClick={() => setSettingsPage('notifications')}>
                      <div className="settings-row-left">
                        <div className="settings-row-icon orange"><Icon name="Activity" size={18} /></div>
                        <div className="settings-row-content">
                          <div className="settings-row-label">Notifications</div>
                          <div className="settings-row-sublabel">Manage your alerts</div>
                        </div>
                      </div>
                      <span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span>
                    </div>
                    <div className="settings-row" onClick={() => setSettingsPage('privacy')}>
                      <div className="settings-row-left">
                        <div className="settings-row-icon"><Icon name="Lock" size={18} /></div>
                        <div className="settings-row-content">
                          <div className="settings-row-label">Privacy</div>
                          <div className="settings-row-sublabel">Who can see your activity</div>
                        </div>
                      </div>
                      <span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span>
                    </div>
                  </div>
                  
                  <div className="settings-section">
                    <div className="settings-section-title">Subscription</div>
                    <div className="settings-row" onClick={() => setSettingsPage('subscription')}>
                      <div className="settings-row-left">
                        <div className="settings-row-icon green"><Icon name="Star" size={18} /></div>
                        <div className="settings-row-content">
                          <div className="settings-row-label">
                            {USERS.me.badge === 'patron' ? 'Patron' : USERS.me.badge === 'pro' ? 'Pro' : 'Free'} Plan
                          </div>
                          <div className="settings-row-sublabel">
                            {USERS.me.badge ? 'Manage your subscription' : 'Upgrade for more features'}
                          </div>
                        </div>
                      </div>
                      <span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span>
                    </div>
                  </div>
                  
                  <div className="settings-section">
                    <div className="settings-section-title">Data</div>
                    <div className="settings-row" onClick={() => setSettingsPage('data')}>
                      <div className="settings-row-left">
                        <div className="settings-row-icon"><Icon name="Download" size={18} /></div>
                        <div className="settings-row-content">
                          <div className="settings-row-label">Import / Export</div>
                          <div className="settings-row-sublabel">Backup or transfer your data</div>
                        </div>
                      </div>
                      <span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span>
                    </div>
                    <div className="settings-row" onClick={() => setSettingsPage('connected')}>
                      <div className="settings-row-left">
                        <div className="settings-row-icon blue"><Icon name="Link" size={18} /></div>
                        <div className="settings-row-content">
                          <div className="settings-row-label">Connected Accounts</div>
                          <div className="settings-row-sublabel">Twitter, Instagram, Discord</div>
                        </div>
                      </div>
                      <span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span>
                    </div>
                  </div>
                  
                  <div className="settings-section">
                    <div className="settings-section-title">App Features</div>
                    <div className="settings-row" onClick={() => setShowShortcuts(true)}>
                      <div className="settings-row-left">
                        <div className="settings-row-icon"><Icon name="Activity" size={18} /></div>
                        <div className="settings-row-content">
                          <div className="settings-row-label">Keyboard Shortcuts</div>
                          <div className="settings-row-sublabel">View all shortcuts</div>
                        </div>
                      </div>
                      <span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span>
                    </div>
                    <div className="settings-row" onClick={() => { setShowOnboarding(true); setOnboardingStep(0); setShowSettings(false); }}>
                      <div className="settings-row-left">
                        <div className="settings-row-icon green"><Icon name="Play" size={18} /></div>
                        <div className="settings-row-content">
                          <div className="settings-row-label">Replay Onboarding</div>
                          <div className="settings-row-sublabel">See the welcome tour again</div>
                        </div>
                      </div>
                      <span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span>
                    </div>
                    <div className="settings-row" onClick={() => setShowCalendarView(true)}>
                      <div className="settings-row-left">
                        <div className="settings-row-icon blue"><Icon name="Calendar" size={18} /></div>
                        <div className="settings-row-content">
                          <div className="settings-row-label">Full Calendar View</div>
                          <div className="settings-row-sublabel">See your diary in calendar format</div>
                        </div>
                      </div>
                      <span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span>
                    </div>
                  </div>
                  
                  <div className="settings-section">
                    <div className="settings-section-title">Support</div>
                    <div className="settings-row">
                      <div className="settings-row-left">
                        <div className="settings-row-icon"><Icon name="Comment" size={18} /></div>
                        <div className="settings-row-content">
                          <div className="settings-row-label">Help Center</div>
                          <div className="settings-row-sublabel">FAQs and guides</div>
                        </div>
                      </div>
                      <span className="settings-row-chevron"><span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span></span>
                    </div>
                    <div className="settings-row">
                      <div className="settings-row-left">
                        <div className="settings-row-icon"><Icon name="Send" size={18} /></div>
                        <div className="settings-row-content">
                          <div className="settings-row-label">Contact Us</div>
                          <div className="settings-row-sublabel">Report a bug or send feedback</div>
                        </div>
                      </div>
                      <span className="settings-row-chevron"><span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span></span>
                    </div>
                    <div className="settings-row">
                      <div className="settings-row-left">
                        <div className="settings-row-icon orange"><Icon name="Star" size={18} /></div>
                        <div className="settings-row-content">
                          <div className="settings-row-label">Rate RocketWatch</div>
                          <div className="settings-row-sublabel">Love the app? Leave a review!</div>
                        </div>
                      </div>
                      <span className="settings-row-chevron"><span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span></span>
                    </div>
                  </div>
                  
                  <div className="settings-section">
                    <div className="settings-section-title">Legal</div>
                    <div className="settings-row">
                      <div className="settings-row-left">
                        <div className="settings-row-content">
                          <div className="settings-row-label">Terms of Service</div>
                        </div>
                      </div>
                      <span className="settings-row-chevron"><span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span></span>
                    </div>
                    <div className="settings-row">
                      <div className="settings-row-left">
                        <div className="settings-row-content">
                          <div className="settings-row-label">Privacy Policy</div>
                        </div>
                      </div>
                      <span className="settings-row-chevron"><span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span></span>
                    </div>
                    <div className="settings-row">
                      <div className="settings-row-left">
                        <div className="settings-row-content">
                          <div className="settings-row-label">Licenses</div>
                        </div>
                      </div>
                      <span className="settings-row-chevron"><span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span></span>
                    </div>
                  </div>
                  
                  <div className="settings-section">
                    <button 
                      className="settings-signout"
                      onClick={() => {
                        if (confirm('Are you sure you want to sign out?')) {
                          alert('Signed out successfully');
                          setShowSettings(false);
                        }
                      }}
                    >
                      Sign Out
                    </button>
                  </div>
                  
                  <div className="settings-version">
                    RocketWatch v5.0.0 • Made with 🚀
                  </div>
                </>
              )}
              
              {/* Edit Profile Page */}
              {settingsPage === 'profile' && (
                <>
                  <div className="settings-header">
                    <button className="settings-back" onClick={() => setSettingsPage('main')}>
                      <Icon name="ChevronLeft" size={24} />
                    </button>
                    <span className="settings-header-title">Edit Profile</span>
                  </div>
                  
                  <div className="settings-section">
                    <div className="settings-avatar-section">
                      <div className="settings-avatar-large">{editingProfile.displayName?.charAt(0) || 'T'}</div>
                      <div className="settings-avatar-buttons">
                        <button className="settings-avatar-btn">Change Photo</button>
                        <button className="settings-avatar-btn remove">Remove</button>
                      </div>
                    </div>
                    
                    {USERS.me.badge === 'patron' && (
                      <div className="settings-input-group">
                        <label className="settings-input-label">Backdrop Image</label>
                        <button className="settings-avatar-btn" style={{ width: '100%', textAlign: 'center' }}>
                          Upload Backdrop (Patron Only)
                        </button>
                        <div className="settings-input-hint">Recommended: 1500×500px</div>
                      </div>
                    )}
                    
                    <div className="settings-input-group">
                      <label className="settings-input-label">Display Name</label>
                      <input 
                        type="text" 
                        className="settings-input" 
                        value={editingProfile.displayName}
                        onChange={(e) => setEditingProfile(p => ({ ...p, displayName: e.target.value }))}
                        placeholder="Your display name"
                      />
                    </div>
                    
                    <div className="settings-input-group">
                      <label className="settings-input-label">Bio</label>
                      <textarea 
                        className="settings-textarea" 
                        value={editingProfile.bio}
                        onChange={(e) => setEditingProfile(p => ({ ...p, bio: e.target.value }))}
                        placeholder="Tell us about yourself..."
                        maxLength={300}
                      />
                      <div className="settings-input-hint">{editingProfile.bio?.length || 0}/300 characters</div>
                    </div>
                    
                    <div className="settings-input-group">
                      <label className="settings-input-label">Pronouns</label>
                      <input 
                        type="text" 
                        className="settings-input" 
                        value={editingProfile.pronouns}
                        onChange={(e) => setEditingProfile(p => ({ ...p, pronouns: e.target.value }))}
                        placeholder="e.g., she/her, he/him, they/them"
                      />
                    </div>
                    
                    <div className="settings-input-group">
                      <label className="settings-input-label">Location</label>
                      <input 
                        type="text" 
                        className="settings-input" 
                        value={editingProfile.location}
                        onChange={(e) => setEditingProfile(p => ({ ...p, location: e.target.value }))}
                        placeholder="City, Country"
                      />
                    </div>
                    
                    <div className="settings-input-group">
                      <label className="settings-input-label">Website</label>
                      <input 
                        type="url" 
                        className="settings-input" 
                        value={editingProfile.website}
                        onChange={(e) => setEditingProfile(p => ({ ...p, website: e.target.value }))}
                        placeholder="https://yourwebsite.com"
                      />
                    </div>
                    
                    <button 
                      className="settings-plan-btn"
                      onClick={() => {
                        setUserProfile(p => ({ ...p, ...editingProfile }));
                        alert('Profile saved successfully!');
                        setSettingsPage('main');
                      }}
                    >
                      Save Changes
                    </button>
                  </div>
                </>
              )}
              
              {/* Account Settings Page */}
              {settingsPage === 'account' && (
                <>
                  <div className="settings-header">
                    <button className="settings-back" onClick={() => setSettingsPage('main')}>
                      <Icon name="ChevronLeft" size={24} />
                    </button>
                    <span className="settings-header-title">Account Settings</span>
                  </div>
                  
                  <div className="settings-section">
                    <div className="settings-input-group">
                      <label className="settings-input-label">Username</label>
                      <input 
                        type="text" 
                        className="settings-input" 
                        value={editingProfile.username}
                        onChange={(e) => setEditingProfile(p => ({ ...p, username: e.target.value }))}
                      />
                      <div className="settings-input-hint">rocketwatch.app/{editingProfile.username}</div>
                    </div>
                    
                    <div className="settings-input-group">
                      <label className="settings-input-label">Email</label>
                      <input 
                        type="email" 
                        className="settings-input" 
                        value={editingProfile.email}
                        onChange={(e) => setEditingProfile(p => ({ ...p, email: e.target.value }))}
                      />
                    </div>
                    
                    <div className="settings-input-group">
                      <label className="settings-input-label">Current Password</label>
                      <input type="password" className="settings-input" placeholder="Enter current password" />
                    </div>
                    
                    <div className="settings-input-group">
                      <label className="settings-input-label">New Password</label>
                      <input type="password" className="settings-input" placeholder="Enter new password" />
                    </div>
                    
                    <div className="settings-input-group">
                      <label className="settings-input-label">Confirm New Password</label>
                      <input type="password" className="settings-input" placeholder="Confirm new password" />
                    </div>
                    
                    <button 
                      className="settings-plan-btn"
                      onClick={() => {
                        alert('Account settings saved!');
                        setSettingsPage('main');
                      }}
                    >
                      Save Changes
                    </button>
                  </div>
                  
                  <div className="settings-section">
                    <div className="settings-danger-zone">
                      <div className="settings-danger-title">⚠️ Danger Zone</div>
                      <div className="settings-danger-text">
                        Permanently delete your account and all of your data. This action cannot be undone.
                      </div>
                      <button 
                        className="settings-danger-btn"
                        onClick={() => {
                          if (confirm('Are you sure you want to delete your account? This action cannot be undone.')) {
                            alert('Account deletion requested. You will receive a confirmation email.');
                          }
                        }}
                      >
                        Delete Account
                      </button>
                    </div>
                  </div>
                </>
              )}
              
              {/* Streaming Services Page */}
              {settingsPage === 'streaming' && (
                <>
                  <div className="settings-header">
                    <button className="settings-back" onClick={() => setSettingsPage('main')}>
                      <Icon name="ChevronLeft" size={24} />
                    </button>
                    <span className="settings-header-title">Streaming Services</span>
                  </div>
                  
                  <div className="settings-section">
                    <div className="settings-input-hint" style={{ marginBottom: 16 }}>
                      Select the streaming services you subscribe to. We'll highlight where to watch films on your services.
                    </div>
                    
                    <div className="settings-services-grid">
                      {SERVICES.map(service => {
                        const isSelected = selectedStreamingServices.includes(service.name);
                        return (
                          <div 
                            key={service.name}
                            className={`settings-service-item ${isSelected ? 'selected' : ''}`}
                            onClick={() => {
                              setSelectedStreamingServices(prev => 
                                isSelected 
                                  ? prev.filter(s => s !== service.name)
                                  : [...prev, service.name]
                              );
                            }}
                          >
                            <div 
                              className="settings-service-icon" 
                              style={{ 
                                background: service.color, 
                                color: ['#000000', '#002BE7', '#113CCF', '#0064FF'].includes(service.color) ? '#fff' : '#000' 
                              }}
                            >
                              {service.icon}
                            </div>
                            <span className="settings-service-name">{service.name}</span>
                            <span className="settings-service-check">✓</span>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </>
              )}
              
              {/* Notifications Page */}
              {settingsPage === 'notifications' && (
                <>
                  <div className="settings-header">
                    <button className="settings-back" onClick={() => setSettingsPage('main')}>
                      <Icon name="ChevronLeft" size={24} />
                    </button>
                    <span className="settings-header-title">Notifications</span>
                  </div>
                  
                  <div className="settings-section">
                    <div className="settings-section-title">Push Notifications</div>
                    
                    <div className="settings-row">
                      <div className="settings-row-left">
                        <div className="settings-row-content">
                          <div className="settings-row-label">New Followers</div>
                          <div className="settings-row-sublabel">When someone follows you</div>
                        </div>
                      </div>
                      <button 
                        className={`settings-toggle ${notificationSettings.newFollowers ? 'active' : ''}`}
                        onClick={() => setNotificationSettings(p => ({ ...p, newFollowers: !p.newFollowers }))}
                      />
                    </div>
                    
                    <div className="settings-row">
                      <div className="settings-row-left">
                        <div className="settings-row-content">
                          <div className="settings-row-label">Review Likes</div>
                          <div className="settings-row-sublabel">When someone likes your review</div>
                        </div>
                      </div>
                      <button 
                        className={`settings-toggle ${notificationSettings.reviewLikes ? 'active' : ''}`}
                        onClick={() => setNotificationSettings(p => ({ ...p, reviewLikes: !p.reviewLikes }))}
                      />
                    </div>
                    
                    <div className="settings-row">
                      <div className="settings-row-left">
                        <div className="settings-row-content">
                          <div className="settings-row-label">Comments</div>
                          <div className="settings-row-sublabel">When someone comments on your content</div>
                        </div>
                      </div>
                      <button 
                        className={`settings-toggle ${notificationSettings.comments ? 'active' : ''}`}
                        onClick={() => setNotificationSettings(p => ({ ...p, comments: !p.comments }))}
                      />
                    </div>
                    
                    <div className="settings-row">
                      <div className="settings-row-left">
                        <div className="settings-row-content">
                          <div className="settings-row-label">List Updates</div>
                          <div className="settings-row-sublabel">When a list you follow is updated</div>
                        </div>
                      </div>
                      <button 
                        className={`settings-toggle ${notificationSettings.listUpdates ? 'active' : ''}`}
                        onClick={() => setNotificationSettings(p => ({ ...p, listUpdates: !p.listUpdates }))}
                      />
                    </div>
                    
                    <div className="settings-row">
                      <div className="settings-row-left">
                        <div className="settings-row-content">
                          <div className="settings-row-label">Friend Activity</div>
                          <div className="settings-row-sublabel">Highlights from people you follow</div>
                        </div>
                      </div>
                      <button 
                        className={`settings-toggle ${notificationSettings.friendActivity ? 'active' : ''}`}
                        onClick={() => setNotificationSettings(p => ({ ...p, friendActivity: !p.friendActivity }))}
                      />
                    </div>
                  </div>
                  
                  <div className="settings-section">
                    <div className="settings-section-title">Email</div>
                    
                    <div className="settings-row">
                      <div className="settings-row-left">
                        <div className="settings-row-content">
                          <div className="settings-row-label">Weekly Digest</div>
                          <div className="settings-row-sublabel">Summary of activity and recommendations</div>
                        </div>
                      </div>
                      <button 
                        className={`settings-toggle ${notificationSettings.emailDigest ? 'active' : ''}`}
                        onClick={() => setNotificationSettings(p => ({ ...p, emailDigest: !p.emailDigest }))}
                      />
                    </div>
                  </div>
                </>
              )}
              
              {/* Privacy Page */}
              {settingsPage === 'privacy' && (
                <>
                  <div className="settings-header">
                    <button className="settings-back" onClick={() => setSettingsPage('main')}>
                      <Icon name="ChevronLeft" size={24} />
                    </button>
                    <span className="settings-header-title">Privacy</span>
                  </div>
                  
                  <div className="settings-section">
                    <div className="settings-section-title">Profile Visibility</div>
                    
                    <div className="settings-row">
                      <div className="settings-row-left">
                        <div className="settings-row-content">
                          <div className="settings-row-label">Show Activity</div>
                          <div className="settings-row-sublabel">Let others see what you're watching</div>
                        </div>
                      </div>
                      <button 
                        className={`settings-toggle ${privacySettings.showActivity ? 'active' : ''}`}
                        onClick={() => setPrivacySettings(p => ({ ...p, showActivity: !p.showActivity }))}
                      />
                    </div>
                    
                    <div className="settings-row">
                      <div className="settings-row-left">
                        <div className="settings-row-content">
                          <div className="settings-row-label">Show Watchlist</div>
                          <div className="settings-row-sublabel">Let others see your watchlist</div>
                        </div>
                      </div>
                      <button 
                        className={`settings-toggle ${privacySettings.showWatchlist ? 'active' : ''}`}
                        onClick={() => setPrivacySettings(p => ({ ...p, showWatchlist: !p.showWatchlist }))}
                      />
                    </div>
                    
                    <div className="settings-row">
                      <div className="settings-row-left">
                        <div className="settings-row-content">
                          <div className="settings-row-label">Show Stats</div>
                          <div className="settings-row-sublabel">Let others see your viewing statistics</div>
                        </div>
                      </div>
                      <button 
                        className={`settings-toggle ${privacySettings.showStats ? 'active' : ''}`}
                        onClick={() => setPrivacySettings(p => ({ ...p, showStats: !p.showStats }))}
                      />
                    </div>
                  </div>
                  
                  <div className="settings-section">
                    <div className="settings-section-title">Interactions</div>
                    
                    <div className="settings-row">
                      <div className="settings-row-left">
                        <div className="settings-row-content">
                          <div className="settings-row-label">Allow Comments</div>
                          <div className="settings-row-sublabel">Let others comment on your reviews</div>
                        </div>
                      </div>
                      <button 
                        className={`settings-toggle ${privacySettings.allowComments ? 'active' : ''}`}
                        onClick={() => setPrivacySettings(p => ({ ...p, allowComments: !p.allowComments }))}
                      />
                    </div>
                  </div>
                  
                  <div className="settings-section">
                    <div className="settings-row">
                      <div className="settings-row-left">
                        <div className="settings-row-icon red"><Icon name="Lock" size={18} /></div>
                        <div className="settings-row-content">
                          <div className="settings-row-label">Blocked Users</div>
                          <div className="settings-row-sublabel">Manage blocked accounts</div>
                        </div>
                      </div>
                      <span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span>
                    </div>
                  </div>
                </>
              )}
              
              {/* Subscription Page */}
              {settingsPage === 'subscription' && (
                <>
                  <div className="settings-header">
                    <button className="settings-back" onClick={() => setSettingsPage('main')}>
                      <Icon name="ChevronLeft" size={24} />
                    </button>
                    <span className="settings-header-title">Subscription</span>
                  </div>
                  
                  <div className="settings-section">
                    {/* Current Plan */}
                    <div className="settings-plan-card">
                      <div className="settings-plan-header">
                        <div className="settings-plan-name">
                          {USERS.me.badge === 'patron' ? 'Patron' : USERS.me.badge === 'pro' ? 'Pro' : 'Free'}
                        </div>
                        <div className={`settings-plan-badge ${USERS.me.badge || ''}`}>
                          {USERS.me.badge ? 'Current Plan' : 'Free Tier'}
                        </div>
                      </div>
                      <div className="settings-plan-price">
                        {USERS.me.badge === 'patron' ? '$49/year' : USERS.me.badge === 'pro' ? '$19/year' : 'Free forever'}
                      </div>
                      {USERS.me.badge && (
                        <button className="settings-plan-btn secondary">Manage Subscription</button>
                      )}
                    </div>
                    
                    {/* Pro Plan */}
                    {USERS.me.badge !== 'pro' && USERS.me.badge !== 'patron' && (
                      <div className="settings-plan-card" style={{ borderLeft: '3px solid var(--brand-blue)' }}>
                        <div className="settings-plan-header">
                          <div className="settings-plan-name">Pro</div>
                          <div className="settings-plan-badge pro">Recommended</div>
                        </div>
                        <div className="settings-plan-price">$19/year</div>
                        <div className="settings-plan-features">
                          <div className="settings-plan-feature">
                            <span className="settings-plan-feature-icon">✓</span>
                            <span>Yearly & all-time stats</span>
                          </div>
                          <div className="settings-plan-feature">
                            <span className="settings-plan-feature-icon">✓</span>
                            <span>Filter by streaming service</span>
                          </div>
                          <div className="settings-plan-feature">
                            <span className="settings-plan-feature-icon">✓</span>
                            <span>No ads</span>
                          </div>
                          <div className="settings-plan-feature">
                            <span className="settings-plan-feature-icon">✓</span>
                            <span>Pro badge on profile</span>
                          </div>
                        </div>
                        <button className="settings-plan-btn">Upgrade to Pro</button>
                      </div>
                    )}
                    
                    {/* Patron Plan */}
                    {USERS.me.badge !== 'patron' && (
                      <div className="settings-plan-card" style={{ borderLeft: '3px solid var(--brand-orange)' }}>
                        <div className="settings-plan-header">
                          <div className="settings-plan-name">Patron</div>
                          <div className="settings-plan-badge patron">Ultimate</div>
                        </div>
                        <div className="settings-plan-price">$49/year</div>
                        <div className="settings-plan-features">
                          <div className="settings-plan-feature">
                            <span className="settings-plan-feature-icon">✓</span>
                            <span>Everything in Pro</span>
                          </div>
                          <div className="settings-plan-feature">
                            <span className="settings-plan-feature-icon">✓</span>
                            <span>Custom profile backdrop</span>
                          </div>
                          <div className="settings-plan-feature">
                            <span className="settings-plan-feature-icon">✓</span>
                            <span>Custom poster images</span>
                          </div>
                          <div className="settings-plan-feature">
                            <span className="settings-plan-feature-icon">✓</span>
                            <span>Patron badge on profile</span>
                          </div>
                          <div className="settings-plan-feature">
                            <span className="settings-plan-feature-icon">✓</span>
                            <span>Support indie development</span>
                          </div>
                        </div>
                        <button className="settings-plan-btn" style={{ background: 'var(--brand-orange)' }}>
                          {USERS.me.badge === 'pro' ? 'Upgrade to Patron' : 'Become a Patron'}
                        </button>
                      </div>
                    )}
                  </div>
                </>
              )}
              
              {/* Data Import/Export Page */}
              {settingsPage === 'data' && (
                <>
                  <div className="settings-header">
                    <button className="settings-back" onClick={() => setSettingsPage('main')}>
                      <Icon name="ChevronLeft" size={24} />
                    </button>
                    <span className="settings-header-title">Data</span>
                  </div>
                  
                  <div className="settings-section">
                    <div className="settings-section-title">Import</div>
                    
                    <div className="settings-row" onClick={simulateImport}>
                      <div className="settings-row-left">
                        <div className="settings-row-icon green"><Icon name="Activity" size={18} /></div>
                        <div className="settings-row-content">
                          <div className="settings-row-label">Import from Letterboxd</div>
                          <div className="settings-row-sublabel">Diary, reviews, and ratings</div>
                        </div>
                      </div>
                      <span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span>
                    </div>
                    
                    <div className="settings-row" onClick={simulateImport}>
                      <div className="settings-row-left">
                        <div className="settings-row-icon orange"><Icon name="Films" size={18} /></div>
                        <div className="settings-row-content">
                          <div className="settings-row-label">Import from Trakt</div>
                          <div className="settings-row-sublabel">Watchlist and history</div>
                        </div>
                      </div>
                      <span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span>
                    </div>
                    
                    <div className="settings-row" onClick={simulateImport}>
                      <div className="settings-row-left">
                        <div className="settings-row-icon"><Icon name="Copy" size={18} /></div>
                        <div className="settings-row-content">
                          <div className="settings-row-label">Import CSV</div>
                          <div className="settings-row-sublabel">Upload a spreadsheet</div>
                        </div>
                      </div>
                      <span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span>
                    </div>
                    
                    {isImporting && (
                      <div className="import-progress" style={{ padding: '0 16px' }}>
                        <div className="import-progress-bar">
                          <div className="import-progress-fill" style={{ width: `${importProgress}%` }} />
                        </div>
                        <div className="import-progress-text">Importing... {importProgress}%</div>
                      </div>
                    )}
                  </div>
                  
                  <div className="settings-section">
                    <div className="settings-section-title">Export</div>
                    
                    <div className="settings-row" onClick={exportDiaryCSV}>
                      <div className="settings-row-left">
                        <div className="settings-row-icon green"><Icon name="Download" size={18} /></div>
                        <div className="settings-row-content">
                          <div className="settings-row-label">Export Diary (CSV)</div>
                          <div className="settings-row-sublabel">Download your viewing history</div>
                        </div>
                      </div>
                      <span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span>
                    </div>
                    
                    <div className="settings-row" onClick={exportWatchlistCSV}>
                      <div className="settings-row-left">
                        <div className="settings-row-icon blue"><Icon name="Download" size={18} /></div>
                        <div className="settings-row-content">
                          <div className="settings-row-label">Export Watchlist (CSV)</div>
                          <div className="settings-row-sublabel">Download your watchlist</div>
                        </div>
                      </div>
                      <span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span>
                    </div>
                    
                    <div className="settings-row" onClick={() => {
                      const data = {
                        diary: diaryEntries,
                        watched: watched,
                        watchlist: watchlist,
                        ratings: ratings,
                        reviews: userReviews,
                        lists: lists.filter(l => l.userId === 'me'),
                        exportDate: new Date().toISOString()
                      };
                      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                      const url = URL.createObjectURL(blob);
                      const a = document.createElement('a');
                      a.href = url;
                      a.download = 'rocketwatch-backup.json';
                      a.click();
                      URL.revokeObjectURL(url);
                      alert('Backup downloaded!');
                    }}>
                      <div className="settings-row-left">
                        <div className="settings-row-icon orange"><Icon name="Download" size={18} /></div>
                        <div className="settings-row-content">
                          <div className="settings-row-label">Full Backup (JSON)</div>
                          <div className="settings-row-sublabel">All your data in one file</div>
                        </div>
                      </div>
                      <span className="settings-row-chevron"><Icon name="ChevronRight" size={20} /></span>
                    </div>
                  </div>
                </>
              )}
              
              {/* Connected Accounts Page */}
              {settingsPage === 'connected' && (
                <>
                  <div className="settings-header">
                    <button className="settings-back" onClick={() => setSettingsPage('main')}>
                      <Icon name="ChevronLeft" size={24} />
                    </button>
                    <span className="settings-header-title">Connected Accounts</span>
                  </div>
                  
                  <div className="settings-section">
                    <div className="settings-row">
                      <div className="settings-row-left">
                        <div className="settings-row-icon blue" style={{ background: '#1DA1F2', color: '#fff' }}>𝕏</div>
                        <div className="settings-row-content">
                          <div className="settings-row-label">Twitter / X</div>
                          <div className="settings-row-sublabel">Share your activity</div>
                        </div>
                      </div>
                      <button className="settings-plan-btn secondary" style={{ width: 'auto', padding: '8px 16px', fontSize: 13 }}>
                        Connect
                      </button>
                    </div>
                    
                    <div className="settings-row">
                      <div className="settings-row-left">
                        <div className="settings-row-icon" style={{ background: 'linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888)', color: '#fff' }}>📷</div>
                        <div className="settings-row-content">
                          <div className="settings-row-label">Instagram</div>
                          <div className="settings-row-sublabel">Share to Stories</div>
                        </div>
                      </div>
                      <button className="settings-plan-btn secondary" style={{ width: 'auto', padding: '8px 16px', fontSize: 13 }}>
                        Connect
                      </button>
                    </div>
                    
                    <div className="settings-row">
                      <div className="settings-row-left">
                        <div className="settings-row-icon" style={{ background: '#5865F2', color: '#fff' }}>💬</div>
                        <div className="settings-row-content">
                          <div className="settings-row-label">Discord</div>
                          <div className="settings-row-sublabel">Show currently watching</div>
                        </div>
                      </div>
                      <button className="settings-plan-btn secondary" style={{ width: 'auto', padding: '8px 16px', fontSize: 13 }}>
                        Connect
                      </button>
                    </div>
                  </div>
                </>
              )}
            </div>
          )}
          
          {/* ACTION SHEET - ENHANCED WITH 1.1 FEATURES + BLUR EFFECT */}
          {showActionSheet && selectedEpisode && (
            <>
              <div className="overlay action-sheet-backdrop" onClick={() => setShowActionSheet(false)} />
              <div className="bottom-sheet action-sheet-blur">
                <div className="sheet-handle" />
                <div className="action-sheet-content">
                  <div className="action-poster-section">
                    <img src={selectedEpisode.poster} alt="" className="action-poster" />
                    <div className="action-show-title">{selectedEpisode.showName}</div>
                    <div className="action-show-year">{selectedEpisode.year || ''}</div>
                  </div>
                  
                  {/* DATE PICKER - Letterboxd style */}
                  <div className="date-picker-section">
                    <div className="date-picker-label">Watched on</div>
                    <div className="date-picker-row">
                      <input type="date" className="date-picker-input" value={logDate} onChange={(e) => setLogDate(e.target.value)} />
                      <button className="date-today-btn" onClick={() => setLogDate(new Date().toISOString().split('T')[0])}>Today</button>
                    </div>
                  </div>
                  
                  <div className="action-row">
                    <button className={`action-btn ${watched[selectedEpisode.id] ? 'active' : ''}`} onClick={handleMarkWatched}>
                      <Icon name="Eye" size={32} filled={watched[selectedEpisode.id]} />
                      <span className="action-label">{watched[selectedEpisode.id] ? (isRewatch ? 'Log Again' : 'Watched') : 'Watch'}</span>
                    </button>
                    <button className={`action-btn ${liked[selectedEpisode.id] ? 'liked' : ''}`} onClick={() => setLiked(p => ({ ...p, [selectedEpisode.id]: !p[selectedEpisode.id] }))}>
                      <Icon name="Heart" size={32} filled={liked[selectedEpisode.id]} /><span className="action-label">Liked</span>
                    </button>
                    <button className={`action-btn ${watchlist[selectedEpisode.id] ? 'active' : ''}`} onClick={() => setWatchlist(p => ({ ...p, [selectedEpisode.id]: !p[selectedEpisode.id] }))}>
                      <Icon name="Clock" size={32} filled={watchlist[selectedEpisode.id]} /><span className="action-label">Watchlist</span>
                    </button>
                  </div>
                  
                  {/* REWATCH TOGGLE - Letterboxd style: always show, changes label */}
                  <div className="rewatch-section">
                    <span className="rewatch-label">
                      <Icon name="Repeat" size={18} />
                      {watched[selectedEpisode.id] ? 'I\'ve watched this before' : 'Watched before?'}
                      {rewatchCount[selectedEpisode.id] > 0 && <span className="rewatch-count">({rewatchCount[selectedEpisode.id] + 1}x)</span>}
                    </span>
                    <div className={`toggle ${isRewatch ? 'active' : ''}`} onClick={() => setIsRewatch(!isRewatch)}>
                      <div className="toggle-knob" />
                    </div>
                  </div>
                  
                  <div className="action-divider" />
                  <div className="rating-section">
                    <div className="rating-label">Rated</div>
                    <StarRating rating={ratings[selectedEpisode.id] || 0} onChange={(r) => setRatings(p => ({ ...p, [selectedEpisode.id]: p[selectedEpisode.id] === r ? 0 : r }))} />
                  </div>
                  
                  {/* TAGS INPUT - NEW 1.3 */}
                  <div className="tags-input-section">
                    <div className="tags-input-label">Tags</div>
                    <div className="tags-input-wrapper">
                      {currentTags.map(tag => (
                        <span key={tag} className={`tag-chip ${isNestedTag(tag) ? 'nested' : ''}`}>
                          {tag}
                          <span className="tag-chip-remove" onClick={() => handleRemoveTag(tag)}>×</span>
                        </span>
                      ))}
                      <input 
                        type="text" 
                        className="tags-text-input" 
                        placeholder={currentTags.length ? '' : 'Add tags (e.g. binged, with:partner)'}
                        value={tagInput}
                        onChange={(e) => setTagInput(e.target.value)}
                        onKeyDown={handleTagInputKeyDown}
                        onBlur={() => tagInput && handleAddTag(tagInput)}
                      />
                    </div>
                    {currentTags.length === 0 && (
                      <div className="tags-suggestions">
                        {popularTags.slice(0, 5).map(tag => (
                          <span key={tag} className="tag-suggestion" onClick={() => handleAddTag(tag)}>{tag}</span>
                        ))}
                      </div>
                    )}
                  </div>
                  
                  <div className="action-divider" />
                  <div className="menu-item" onClick={() => handleOpenWriteReview(selectedEpisode)}>Write a Review</div>
                  <div className="menu-item" onClick={() => { setShowActionSheet(false); setShowAddToList(true); }}>Add to a List</div>
                  <div className="menu-item" onClick={() => { setShowActionSheet(false); setShowChat(selectedEpisode); }}>Episode Chat Room</div>
                  <div className="menu-item" onClick={handleSaveAsDraft}>Save as Draft</div>
                  <div className="menu-item disabled">Share to Instagram Stories</div>
                </div>
              </div>
            </>
          )}
          
          {/* iOS TRACKING PERMISSION DIALOG - AUDIT FIX */}
          {showTrackingPermission && (
            <div className="ios-tracking-overlay">
              <div className="ios-tracking-dialog">
                <div className="ios-tracking-content">
                  <div className="ios-tracking-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                  </div>
                  <div className="ios-tracking-title">Allow "RocketWatch" to track your activity across other companies' apps and websites?</div>
                  <div className="ios-tracking-desc">To improve advertising quality, we use data from your activity on other apps and websites. This helps us show you more relevant ads.</div>
                </div>
                <div className="ios-tracking-buttons">
                  <button className="ios-tracking-btn ios-tracking-btn-deny" onClick={() => setShowTrackingPermission(false)}>Ask App Not to Track</button>
                  <button className="ios-tracking-btn ios-tracking-btn-allow" onClick={() => setShowTrackingPermission(false)}>Allow</button>
                </div>
              </div>
            </div>
          )}
          
          {/* ADD FILM */}
          {showAddFilm && (
            <>
              <div className="overlay" onClick={() => setShowAddFilm(false)} />
              <div className="bottom-sheet">
                <div className="sheet-header">
                  <button className="sheet-cancel" onClick={() => setShowAddFilm(false)}>Cancel</button>
                  <span className="sheet-title">Add a Film</span>
                  <Avatar user={USERS.me} size="sm" />
                </div>
                <div style={{ padding: 16 }}>
                  <input type="text" placeholder="Name of film" style={{ width: '100%', background: '#F5F5F5', border: 'none', borderRadius: 8, padding: '14px 16px', fontSize: 16, color: '#1A1A1A', outline: 'none' }} autoFocus />
                </div>
              </div>
            </>
          )}
          
          {/* NEW LIST */}
          {showNewList && (
            <>
              <div className="overlay" onClick={() => { setShowNewList(false); setEditingListId(null); }} />
              <div className="bottom-sheet" style={{ height: '85vh' }}>
                <div className="sheet-header">
                  <button className="sheet-cancel" onClick={() => { setShowNewList(false); setEditingListId(null); }}>Cancel</button>
                  <span className="sheet-title">{editingListId ? 'Edit List' : 'New List'}</span>
                  <button className="sheet-save" onClick={handleCreateList} disabled={!newListTitle.trim()}>Save</button>
                </div>
                <div style={{ padding: 16 }}>
                  <div className="new-list-section">
                    <input 
                      type="text" 
                      className="form-input" 
                      placeholder="List name..." 
                      value={newListTitle}
                      onChange={(e) => setNewListTitle(e.target.value)}
                      style={{ fontSize: 18, fontWeight: 600, marginBottom: 12 }}
                    />
                    <textarea 
                      className="form-input" 
                      placeholder="Add a description..."
                      value={newListDesc}
                      onChange={(e) => setNewListDesc(e.target.value)}
                      style={{ minHeight: 80, resize: 'none' }}
                    />
                  </div>
                  
                  <div className="new-list-section">
                    <div className="new-list-section-title">Settings</div>
                    
                    <div className="list-toggle-row">
                      <div className="list-toggle-label">
                        <Icon name={newListPublic ? 'Globe' : 'Lock'} size={20} />
                        <div>
                          <div>{newListPublic ? 'Public' : 'Private'}</div>
                          <div className="list-toggle-desc">{newListPublic ? 'Anyone can see this list' : 'Only you can see this list'}</div>
                        </div>
                      </div>
                      <div className={`toggle ${newListPublic ? 'active' : ''}`} onClick={() => setNewListPublic(!newListPublic)}>
                        <div className="toggle-knob" />
                      </div>
                    </div>
                    
                    <div className="list-toggle-row">
                      <div className="list-toggle-label">
                        <Icon name="Trophy" size={20} />
                        <div>
                          <div>Ranked</div>
                          <div className="list-toggle-desc">{newListRanked ? 'Show position numbers' : 'No position numbers'}</div>
                        </div>
                      </div>
                      <div className={`toggle ${newListRanked ? 'active' : ''}`} onClick={() => setNewListRanked(!newListRanked)}>
                        <div className="toggle-knob" />
                      </div>
                    </div>
                    
                    <div className="list-toggle-row">
                      <div className="list-toggle-label">
                        <Icon name="Comment" size={20} />
                        <div>
                          <div>Comments</div>
                          <div className="list-toggle-desc">{newListComments ? 'Anyone can comment' : 'Comments disabled'}</div>
                        </div>
                      </div>
                      <div className={`toggle ${newListComments ? 'active' : ''}`} onClick={() => setNewListComments(!newListComments)}>
                        <div className="toggle-knob" />
                      </div>
                    </div>
                  </div>
                  
                  <div className="new-list-section">
                    <div className="new-list-section-title">Entries ({newListEntries.length})</div>
                    
                    {/* Add Films Grid */}
                    <div style={{ marginBottom: 12 }}>
                      <div style={{ fontSize: 13, color: 'var(--text-secondary)', marginBottom: 8 }}>Tap to add:</div>
                      <div style={{ display: 'flex', gap: 8, overflowX: 'auto', paddingBottom: 8 }}>
                        {SHOWS.filter(s => !newListEntries.some(e => e.showId === s.id)).slice(0, 8).map(show => (
                          <img 
                            key={show.id}
                            src={show.poster}
                            alt={show.name}
                            style={{ width: 50, height: 75, borderRadius: 4, objectFit: 'cover', cursor: 'pointer', opacity: 0.7 }}
                            onClick={() => setNewListEntries(prev => [...prev, { showId: show.id, position: prev.length + 1, note: '' }])}
                          />
                        ))}
                      </div>
                    </div>
                    
                    {newListEntries.length === 0 ? (
                      <p style={{ color: 'var(--text-tertiary)', fontSize: 14 }}>No shows added yet. Tap posters above to add.</p>
                    ) : (
                      newListEntries.map((entry, i) => {
                        const show = SHOWS.find(s => s.id === entry.showId);
                        return show ? (
                          <div key={entry.showId} className="list-entry">
                            {newListRanked && <div className="list-entry-number">{i + 1}</div>}
                            <img src={show.poster} alt="" className="list-entry-poster" />
                            <div className="list-entry-info">
                              <div className="list-entry-title">{show.name}</div>
                              <div className="list-entry-year">{show.year}</div>
                            </div>
                            <button className="list-entry-action-btn" onClick={() => setNewListEntries(prev => prev.filter(e => e.showId !== entry.showId))}>
                              <Icon name="Trash" size={18} />
                            </button>
                          </div>
                        ) : null;
                      })
                    )}
                  </div>
                  
                  {/* Delete List Button (only when editing) */}
                  {editingListId && (
                    <div className="new-list-section" style={{ borderTop: '1px solid var(--divider)', marginTop: 16 }}>
                      <button 
                        onClick={() => handleDeleteList(editingListId)}
                        style={{ 
                          width: '100%', 
                          padding: '14px', 
                          background: 'transparent', 
                          border: '1px solid var(--brand-orange)', 
                          color: 'var(--brand-orange)', 
                          borderRadius: 8, 
                          fontSize: 15, 
                          fontWeight: 600,
                          cursor: 'pointer'
                        }}
                      >
                        Delete List
                      </button>
                    </div>
                  )}
                </div>
              </div>
            </>
          )}
          
          {/* LIST DETAIL - ENHANCED CATEGORY 2 */}
          {showListDetail && (
            <>
              <div className="overlay" onClick={() => setShowListDetail(null)} />
              <div className="bottom-sheet" style={{ height: '90vh' }}>
                <div className="sheet-header">
                  <button className="sheet-cancel" onClick={() => setShowListDetail(null)}><Icon name="ChevronLeft" size={24} /></button>
                  <span className="sheet-title">List</span>
                  <button className="header-btn" onClick={() => handleShareList(showListDetail)}><Icon name="Share" size={20} /></button>
                </div>
                
                {/* List Header */}
                <div className="list-detail-header">
                  <div className="list-detail-author">
                    <Avatar user={USERS[showListDetail.userId]} size="sm" />
                    <span style={{ fontSize: 13 }}>{USERS[showListDetail.userId]?.username}</span>
                    {USERS[showListDetail.userId]?.badge && <Badge type={USERS[showListDetail.userId].badge} />}
                    {!showListDetail.isPublic && <span className="list-private-badge"><Icon name="Lock" size={10} /> Private</span>}
                  </div>
                  <h2 className="list-detail-title">{showListDetail.title}</h2>
                  <p className="list-detail-desc">{showListDetail.desc}</p>
                  <div className="list-detail-stats">
                    <span>{showListDetail.entries.length} shows</span>
                    <span>{showListDetail.likes} likes</span>
                    <span>{showListDetail.comments} comments</span>
                  </div>
                  
                  {/* Action Buttons */}
                  <div className="list-detail-actions">
                    <button 
                      className={`list-action-btn ${likedLists[showListDetail.id] ? 'active' : ''}`}
                      onClick={() => handleToggleListLike(showListDetail.id)}
                    >
                      <Icon name="Heart" size={18} filled={likedLists[showListDetail.id]} />
                      {likedLists[showListDetail.id] ? 'Liked' : 'Like'}
                    </button>
                    <button className="list-action-btn" onClick={() => handleShareList(showListDetail)}>
                      <Icon name="Share" size={18} />
                      Share
                    </button>
                    {showListDetail.userId !== 'me' && (
                      <button className="list-action-btn" onClick={() => handleCloneList(showListDetail)}>
                        <Icon name="Copy" size={18} />
                        Clone
                      </button>
                    )}
                    {showListDetail.userId === 'me' && (
                      <button className="list-action-btn" onClick={() => {
                        setEditingListId(showListDetail.id);
                        setNewListTitle(showListDetail.title);
                        setNewListDesc(showListDetail.desc);
                        setNewListRanked(showListDetail.isRanked);
                        setNewListPublic(showListDetail.isPublic);
                        setNewListComments(showListDetail.allowComments);
                        setNewListEntries(showListDetail.entries);
                        setShowListDetail(null);
                        setShowNewList(true);
                      }}>
                        <Icon name="Edit" size={18} />
                        Edit
                      </button>
                    )}
                  </div>
                </div>
                
                {/* Filter/Sort Bar */}
                <div className="list-filter-bar">
                  <div style={{ display: 'flex', gap: 8 }}>
                    <button 
                      className={`list-filter-btn ${listFilter === 'all' ? 'active' : ''}`}
                      onClick={() => setListFilter('all')}
                    >All</button>
                    <button 
                      className={`list-filter-btn ${listFilter === 'watched' ? 'active' : ''}`}
                      onClick={() => setListFilter('watched')}
                    >Watched</button>
                    <button 
                      className={`list-filter-btn ${listFilter === 'unwatched' ? 'active' : ''}`}
                      onClick={() => setListFilter('unwatched')}
                    >Unwatched</button>
                  </div>
                  <select 
                    value={listSort} 
                    onChange={(e) => setListSort(e.target.value)}
                    style={{ background: 'var(--bg-input)', border: 'none', color: 'var(--text-primary)', padding: '6px 10px', borderRadius: 4, fontSize: 13 }}
                  >
                    <option value="position">List Order</option>
                    <option value="title">Title A-Z</option>
                    <option value="year">Year</option>
                    <option value="rating">Your Rating</option>
                  </select>
                </div>
                
                {/* List Entries */}
                <div style={{ overflowY: 'auto', flex: 1 }}>
                  {getFilteredListEntries(showListDetail).map((entry, i) => {
                    const show = SHOWS.find(s => s.id === entry.showId);
                    if (!show) return null;
                    const isMyList = showListDetail.userId === 'me';
                    
                    return (
                      <div key={entry.showId} className="list-entry">
                        {showListDetail.isRanked && listSort === 'position' && (
                          <div className="list-entry-number">{entry.position}</div>
                        )}
                        <img src={show.poster} alt="" className="list-entry-poster" />
                        <div className="list-entry-info">
                          <div className="list-entry-title">{show.name}</div>
                          <div className="list-entry-year">{show.year}</div>
                          {watched[show.id] && <span style={{ fontSize: 11, color: 'var(--brand-green)' }}>Watched</span>}
                          {entry.note && <div className="list-entry-note">{entry.note}</div>}
                          
                          {/* Edit Note */}
                          {editingListEntry === entry.showId && (
                            <div style={{ marginTop: 8 }}>
                              <input 
                                type="text"
                                className="form-input"
                                placeholder="Add a note..."
                                value={entryNoteInput}
                                onChange={(e) => setEntryNoteInput(e.target.value)}
                                style={{ marginBottom: 8 }}
                              />
                              <div style={{ display: 'flex', gap: 8 }}>
                                <button 
                                  className="btn-small"
                                  onClick={() => handleUpdateEntryNote(showListDetail.id, entry.showId, entryNoteInput)}
                                  style={{ background: 'var(--brand-green)', color: '#000', padding: '6px 12px', borderRadius: 4, border: 'none', fontSize: 13 }}
                                >Save</button>
                                <button 
                                  className="btn-small"
                                  onClick={() => { setEditingListEntry(null); setEntryNoteInput(''); }}
                                  style={{ background: 'var(--bg-input)', color: 'var(--text-primary)', padding: '6px 12px', borderRadius: 4, border: 'none', fontSize: 13 }}
                                >Cancel</button>
                              </div>
                            </div>
                          )}
                        </div>
                        
                        {/* Entry Actions (for user's own lists) */}
                        {isMyList && (
                          <div className="list-entry-actions">
                            <button className="list-entry-action-btn" onClick={() => handleMoveListEntry(showListDetail.id, entry.showId, 'up')}>
                              <Icon name="ArrowUp" size={16} />
                            </button>
                            <button className="list-entry-action-btn" onClick={() => handleMoveListEntry(showListDetail.id, entry.showId, 'down')}>
                              <Icon name="ArrowDown" size={16} />
                            </button>
                            <button className="list-entry-action-btn" onClick={() => { setEditingListEntry(entry.showId); setEntryNoteInput(entry.note || ''); }}>
                              <Icon name="Edit" size={16} />
                            </button>
                            <button className="list-entry-action-btn" onClick={() => handleRemoveFromList(showListDetail.id, entry.showId)}>
                              <Icon name="Trash" size={16} />
                            </button>
                          </div>
                        )}
                      </div>
                    );
                  })}
                  
                  {getFilteredListEntries(showListDetail).length === 0 && (
                    <div style={{ padding: 32, textAlign: 'center', color: 'var(--text-tertiary)' }}>
                      No shows match the current filter.
                    </div>
                  )}
                </div>
              </div>
            </>
          )}
          
          {/* ADD TO LIST MODAL */}
          {showAddToList && selectedEpisode && (
            <>
              <div className="overlay" onClick={() => setShowAddToList(false)} />
              <div className="bottom-sheet">
                <div className="sheet-header">
                  <button className="sheet-cancel" onClick={() => setShowAddToList(false)}>Cancel</button>
                  <span className="sheet-title">Add to List</span>
                  <button className="sheet-save" onClick={() => setShowAddToList(false)}>Done</button>
                </div>
                <div style={{ padding: '8px 0' }}>
                  <div 
                    className="add-to-list-item"
                    onClick={() => setShowNewList(true)}
                    style={{ borderBottom: '2px solid var(--divider)' }}
                  >
                    <Icon name="Plus" size={24} />
                    <div className="add-to-list-info">
                      <div className="add-to-list-title">Create New List</div>
                    </div>
                  </div>
                  
                  {getMyLists().map(list => {
                    const isInList = list.entries.some(e => e.showId === selectedEpisode.id);
                    return (
                      <div 
                        key={list.id} 
                        className="add-to-list-item"
                        onClick={() => handleAddToList(list.id, { id: selectedEpisode.id, poster: selectedEpisode.poster })}
                      >
                        <div className={`add-to-list-check ${isInList ? 'checked' : ''}`}>
                          {isInList && <Icon name="Check" size={14} />}
                        </div>
                        <div className="add-to-list-info">
                          <div className="add-to-list-title">{list.title}</div>
                          <div className="add-to-list-count">{list.entries.length} shows</div>
                        </div>
                        {!list.isPublic && <Icon name="Lock" size={16} style={{ color: 'var(--text-tertiary)' }} />}
                      </div>
                    );
                  })}
                  
                  {getMyLists().length === 0 && (
                    <div style={{ padding: 24, textAlign: 'center', color: 'var(--text-tertiary)' }}>
                      You haven't created any lists yet.
                    </div>
                  )}
                </div>
              </div>
            </>
          )}
          
          {/* FILTERS */}
          {showFilters && (
            <>
              <div className="overlay" onClick={() => setShowFilters(false)} />
              <div className="bottom-sheet">
                <div className="sheet-header">
                  <button className="sheet-cancel" onClick={() => setShowFilters(false)}>Cancel</button>
                  <span className="sheet-title">Filters</span>
                  <button className="sheet-save" onClick={() => setShowFilters(false)}>Done</button>
                </div>
                <div className="filters-content">
                  <div className="filter-row"><span className="filter-label">Sort by</span><span className="filter-value">Date added newest first <Icon name="ChevronRight" size={18} /></span></div>
                  <div className="filter-section-label">APPEARANCE</div>
                  <div className="filter-row"><span className="filter-label">Fade watched</span><div className={`toggle ${fadeWatched ? 'active' : ''}`} onClick={() => setFadeWatched(!fadeWatched)}><div className="toggle-knob" /></div></div>
                  <div className="filter-row"><span className="filter-label">Custom posters</span><span className="filter-value">Enabled <Icon name="ChevronRight" size={18} /></span></div>
                  <div className="filter-section-label">CONTENT</div>
                  {['Year', 'Genre', 'Country', 'Language', 'Service', 'Released', 'Length', 'Film/TV'].map(f => (
                    <div key={f} className="filter-row"><span className="filter-label">{f}</span><span className="filter-value">Any <Icon name="ChevronRight" size={18} /></span></div>
                  ))}
                  <div className="filter-section-label">ACCOUNT</div>
                  {['Watched', 'Liked', 'Rated', 'Logged'].map(f => (
                    <div key={f} className="filter-row"><span className="filter-label">{f}</span><span className="filter-value">Any</span></div>
                  ))}
                </div>
              </div>
            </>
          )}
          
          {/* CHAT ROOM */}
          {showChat && (
            <>
              <div className="overlay" onClick={() => setShowChat(null)} />
              <div className="bottom-sheet" style={{ height: '80vh' }}>
                <div className="sheet-header">
                  <button className="sheet-cancel" onClick={() => setShowChat(null)}><Icon name="ChevronLeft" size={24} /></button>
                  <div style={{ textAlign: 'center' }}><div className="sheet-title">{showChat.showName}</div><div style={{ fontSize: 12, color: 'var(--text-tertiary)' }}>S{showChat.season}E{showChat.episode} Discussion</div></div>
                  <button className="header-btn"><Icon name="MoreHorizontal" size={24} /></button>
                </div>
                <div className="chat-container">
                  <div className="chat-messages">
                    <div className="chat-message"><Avatar user={USERS.princess} /><div className="chat-bubble"><div className="chat-username">{USERS.princess.username}</div><div className="chat-text">OMG that ending though!!</div><div className="chat-time">2m ago</div></div></div>
                    <div className="chat-message"><Avatar user={USERS.lobo} /><div className="chat-bubble"><div className="chat-username">{USERS.lobo.username}</div><div className="chat-text">I KNEW IT. Called it from episode 1</div><div className="chat-time">1m ago</div></div></div>
                    <div className="chat-message own"><div className="chat-bubble own"><div className="chat-text">Wait what?? No spoilers I'm still watching!</div><div className="chat-time">Just now</div></div></div>
                  </div>
                  <div className="chat-input-area"><input type="text" className="chat-input" placeholder="Type a message..." /><button className="chat-send"><Icon name="Send" size={18} /></button></div>
                </div>
              </div>
            </>
          )}
          
          {/* WRITE REVIEW MODAL - NEW 1.2 */}
          {showWriteReview && selectedEpisode && (
            <>
              <div className="overlay" onClick={() => setShowWriteReview(false)} />
              <div className="bottom-sheet" style={{ height: '90vh' }}>
                <div className="sheet-header">
                  <button className="sheet-cancel" onClick={() => setShowWriteReview(false)}>Cancel</button>
                  <span className="sheet-title">{editingReview ? 'Edit Review' : 'Write Review'}</span>
                  <button className="sheet-save" onClick={handleSaveReview} disabled={!reviewText.trim() && !reviewRating}>
                    {editingReview ? 'Update' : 'Post'}
                  </button>
                </div>
                <div className="review-write-section">
                  {/* Show info */}
                  <div className="review-show-header">
                    <img src={selectedEpisode.poster} alt="" className="review-show-poster" />
                    <div className="review-show-info">
                      <div className="review-show-title">{selectedEpisode.showName}</div>
                      <div className="review-show-year">{selectedEpisode.year || ''}</div>
                    </div>
                  </div>
                  
                  {/* Rating (optional) */}
                  <div className="review-option-row">
                    <span className="review-option-label">Rating (optional)</span>
                  </div>
                  <div style={{ padding: '8px 0 16px', display: 'flex', justifyContent: 'center' }}>
                    <StarRating rating={reviewRating} onChange={(r) => setReviewRating(reviewRating === r ? 0 : r)} />
                  </div>
                  
                  {/* Format bar */}
                  <div className="review-format-bar">
                    <button className="format-btn" onClick={() => insertFormat('bold')} title="Bold">B</button>
                    <button className="format-btn" onClick={() => insertFormat('italic')} title="Italic" style={{ fontStyle: 'italic' }}>I</button>
                    <button className="format-btn" onClick={() => insertFormat('link')} title="Link"><Icon name="Link" size={16} /></button>
                  </div>
                  
                  {/* Review text */}
                  <textarea 
                    className="review-textarea" 
                    placeholder="Write your review... (supports **bold**, *italic*, and [links](url))"
                    value={reviewText}
                    onChange={(e) => setReviewText(e.target.value)}
                    autoFocus
                  />
                  <div className="review-char-count">{reviewText.length} characters</div>
                  
                  {/* Options */}
                  <div className="review-options">
                    <div className="review-option-row">
                      <span className="review-option-label">
                        Contains spoilers
                      </span>
                      <div className={`toggle ${reviewHasSpoilers ? 'active' : ''}`} onClick={() => setReviewHasSpoilers(!reviewHasSpoilers)}>
                        <div className="toggle-knob" />
                      </div>
                    </div>
                  </div>
                  
                  {/* TAGS INPUT - NEW 1.3 */}
                  <div className="tags-input-section">
                    <div className="tags-input-label">Tags</div>
                    <div className="tags-input-wrapper">
                      {currentTags.map(tag => (
                        <span key={tag} className={`tag-chip ${isNestedTag(tag) ? 'nested' : ''}`}>
                          {tag}
                          <span className="tag-chip-remove" onClick={() => handleRemoveTag(tag)}>×</span>
                        </span>
                      ))}
                      <input 
                        type="text" 
                        className="tags-text-input" 
                        placeholder={currentTags.length ? '' : 'Add tags...'}
                        value={tagInput}
                        onChange={(e) => setTagInput(e.target.value)}
                        onKeyDown={handleTagInputKeyDown}
                        onBlur={() => tagInput && handleAddTag(tagInput)}
                      />
                    </div>
                  </div>
                  
                  {reviewHasSpoilers && (
                    <p style={{ fontSize: 12, color: 'var(--text-tertiary)', marginTop: 8, padding: '8px 12px', background: 'var(--bg-card)', borderRadius: 8 }}>
                      This review will be blurred for users who haven't watched this show yet.
                    </p>
                  )}
                </div>
              </div>
            </>
          )}
          
          {/* EDIT DIARY ENTRY MODAL - NEW 1.4 */}
          {showEditDiary && editingDiaryEntry && (
            <>
              <div className="overlay" onClick={() => setShowEditDiary(false)} />
              <div className="bottom-sheet" style={{ height: '85vh' }}>
                <div className="sheet-header">
                  <button className="sheet-cancel" onClick={() => setShowEditDiary(false)}>Cancel</button>
                  <span className="sheet-title">Edit Entry</span>
                  <button className="sheet-save" onClick={() => handleUpdateDiaryEntry(editingDiaryEntry)}>Save</button>
                </div>
                <div className="diary-edit-section">
                  {/* Show Info */}
                  <div style={{ display: 'flex', gap: 16, marginBottom: 20, paddingBottom: 20, borderBottom: '1px solid var(--divider)' }}>
                    <img src={editingDiaryEntry.poster} alt="" style={{ width: 80, height: 120, borderRadius: 6, objectFit: 'cover' }} />
                    <div>
                      <div style={{ fontSize: 18, fontWeight: 600 }}>{editingDiaryEntry.showName}</div>
                      <div style={{ fontSize: 14, color: 'var(--text-tertiary)', marginTop: 4 }}>{editingDiaryEntry.year}</div>
                      {editingDiaryEntry.isDraft && <span className="diary-draft-badge" style={{ marginTop: 8, display: 'inline-block' }}>DRAFT</span>}
                    </div>
                  </div>
                  
                  {/* Date */}
                  <div className="diary-edit-row">
                    <span className="diary-edit-label">Watched on</span>
                    <div className="diary-edit-value">
                      <input 
                        type="date" 
                        className="date-picker-input" 
                        value={editingDiaryEntry.fullDate || `${diaryMonth.getFullYear()}-${String(diaryMonth.getMonth() + 1).padStart(2, '0')}-${editingDiaryEntry.day.padStart(2, '0')}`}
                        onChange={(e) => {
                          const newDate = new Date(e.target.value);
                          setEditingDiaryEntry({
                            ...editingDiaryEntry, 
                            day: newDate.getDate().toString(),
                            fullDate: e.target.value
                          });
                        }}
                        style={{ background: 'transparent', border: 'none', color: 'var(--text-primary)' }}
                      />
                    </div>
                  </div>
                  
                  {/* Rating */}
                  <div className="diary-edit-row">
                    <span className="diary-edit-label">Rating</span>
                    <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>
                      <StarRating 
                        rating={editingDiaryEntry.rating} 
                        onChange={(r) => setEditingDiaryEntry({...editingDiaryEntry, rating: r})} 
                      />
                    </div>
                  </div>
                  
                  {/* Liked */}
                  <div className="diary-edit-row">
                    <span className="diary-edit-label">Liked</span>
                    <div 
                      className={`toggle ${editingDiaryEntry.liked ? 'active' : ''}`} 
                      onClick={() => setEditingDiaryEntry({...editingDiaryEntry, liked: !editingDiaryEntry.liked})}
                    >
                      <div className="toggle-knob" />
                    </div>
                  </div>
                  
                  {/* Rewatch */}
                  <div className="diary-edit-row">
                    <span className="diary-edit-label">Rewatch</span>
                    <div 
                      className={`toggle ${editingDiaryEntry.rewatch ? 'active' : ''}`} 
                      onClick={() => setEditingDiaryEntry({...editingDiaryEntry, rewatch: !editingDiaryEntry.rewatch})}
                    >
                      <div className="toggle-knob" />
                    </div>
                  </div>
                  
                  {/* Draft */}
                  <div className="diary-edit-row">
                    <span className="diary-edit-label">Draft (hidden from others)</span>
                    <div 
                      className={`toggle ${editingDiaryEntry.isDraft ? 'active' : ''}`} 
                      onClick={() => setEditingDiaryEntry({...editingDiaryEntry, isDraft: !editingDiaryEntry.isDraft})}
                    >
                      <div className="toggle-knob" />
                    </div>
                  </div>
                  
                  {/* Tags */}
                  <div style={{ marginTop: 16 }}>
                    <div className="tags-input-label">Tags</div>
                    <div style={{ display: 'flex', flexWrap: 'wrap', gap: 6, marginTop: 8 }}>
                      {(editingDiaryEntry.tags || []).map(tag => (
                        <span key={tag} className={`tag-chip ${isNestedTag(tag) ? 'nested' : ''}`}>
                          {tag}
                          <span className="tag-chip-remove" onClick={() => {
                            setEditingDiaryEntry({...editingDiaryEntry, tags: editingDiaryEntry.tags.filter(t => t !== tag)});
                          }}>×</span>
                        </span>
                      ))}
                    </div>
                  </div>
                  
                  {/* Delete Button */}
                  <button 
                    style={{ 
                      width: '100%', 
                      marginTop: 32, 
                      padding: 14, 
                      background: 'transparent', 
                      border: '1px solid var(--brand-orange)', 
                      borderRadius: 8, 
                      color: 'var(--brand-orange)', 
                      fontSize: 15, 
                      cursor: 'pointer' 
                    }}
                    onClick={() => handleDeleteDiaryEntry(editingDiaryEntry.id)}
                  >
                    Delete Entry
                  </button>
                </div>
              </div>
            </>
          )}
          
          {/* EDIT PROFILE MODAL - CAT 3.1 */}
          {showEditProfile && (
            <>
              <div className="overlay" onClick={() => setShowEditProfile(false)} />
              <div className="bottom-sheet" style={{ height: '95vh' }}>
                <div className="sheet-header">
                  <button className="sheet-cancel" onClick={() => setShowEditProfile(false)}>Cancel</button>
                  <span className="sheet-title">Edit Profile</span>
                  <button className="sheet-save" onClick={handleSaveProfile}>Save</button>
                </div>
                <div className="edit-profile-section" style={{ overflowY: 'auto', maxHeight: 'calc(95vh - 60px)' }}>
                  
                  {/* Avatar */}
                  <div className="edit-profile-avatar">
                    <div className="profile-avatar-large">{USERS.me.username?.charAt(0).toUpperCase() || '?'}</div>
                    <button className="edit-profile-avatar-btn">Change Avatar</button>
                  </div>
                  
                  {/* Backdrop (Patron only) */}
                  {USERS.me.badge === 'patron' && (
                    <div className="edit-profile-field">
                      <div className="edit-profile-label">Profile Backdrop</div>
                      <div className="edit-backdrop-preview">
                        {userProfile.backdrop ? (
                          <img src={userProfile.backdrop} alt="Backdrop" />
                        ) : (
                          <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', height: '100%', color: 'var(--text-muted)' }}>
                            <Icon name="Image" size={32} />
                          </div>
                        )}
                        <span className="edit-backdrop-patron-badge">PATRON</span>
                      </div>
                      <button className="edit-backdrop-btn">Change Backdrop Image</button>
                    </div>
                  )}
                  
                  {/* Display Name */}
                  <div className="edit-profile-field">
                    <div className="edit-profile-label">Display Name</div>
                    <input 
                      type="text" 
                      className="edit-profile-input"
                      value={userProfile.displayName}
                      onChange={(e) => setUserProfile({...userProfile, displayName: e.target.value})}
                      placeholder="Your display name"
                      maxLength={50}
                    />
                  </div>
                  
                  {/* Pronouns */}
                  <div className="edit-profile-field">
                    <div className="edit-profile-label">Pronouns</div>
                    <input 
                      type="text" 
                      className="edit-profile-input"
                      value={userProfile.pronouns}
                      onChange={(e) => setUserProfile({...userProfile, pronouns: e.target.value})}
                      placeholder="e.g., she/her, he/him, they/them"
                      maxLength={20}
                    />
                    <div className="edit-profile-hint">Optional. Displayed next to your name.</div>
                  </div>
                  
                  {/* Bio */}
                  <div className="edit-profile-field">
                    <div className="edit-profile-label">Bio</div>
                    <textarea 
                      className="edit-profile-textarea"
                      value={userProfile.bio}
                      onChange={(e) => setUserProfile({...userProfile, bio: e.target.value})}
                      placeholder="Tell us about yourself..."
                      maxLength={160}
                    />
                    <div className="edit-profile-char-count">{userProfile.bio?.length || 0}/160</div>
                  </div>
                  
                  {/* Location */}
                  <div className="edit-profile-field">
                    <div className="edit-profile-label">Location</div>
                    <input 
                      type="text" 
                      className="edit-profile-input"
                      value={userProfile.location}
                      onChange={(e) => setUserProfile({...userProfile, location: e.target.value})}
                      placeholder="e.g., Los Angeles, CA"
                      maxLength={50}
                    />
                  </div>
                  
                  {/* Website */}
                  <div className="edit-profile-field">
                    <div className="edit-profile-label">Website</div>
                    <input 
                      type="url" 
                      className="edit-profile-input"
                      value={userProfile.website}
                      onChange={(e) => setUserProfile({...userProfile, website: e.target.value})}
                      placeholder="https://yoursite.com"
                    />
                  </div>
                  
                  {/* Twitter/X */}
                  <div className="edit-profile-field">
                    <div className="edit-profile-label">X (Twitter)</div>
                    <div style={{ display: 'flex', alignItems: 'center', gap: 4 }}>
                      <span style={{ color: 'var(--text-tertiary)', fontSize: 15 }}>@</span>
                      <input 
                        type="text" 
                        className="edit-profile-input"
                        style={{ flex: 1 }}
                        value={userProfile.twitter}
                        onChange={(e) => setUserProfile({...userProfile, twitter: e.target.value.replace('@', '')})}
                        placeholder="username"
                      />
                    </div>
                  </div>
                  
                  {/* Top Four Editor */}
                  <div className="top-four-editor">
                    <div className="edit-profile-label">Favorites</div>
                    <div className="top-four-editor-grid">
                      {[0, 1, 2, 3].map(i => {
                        const showId = userProfile.topFour?.[i];
                        const show = showId ? getShowById(showId) : null;
                        return (
                          <div 
                            key={i} 
                            className={`top-four-editor-slot ${!show ? 'empty' : ''}`}
                            onClick={() => {
                              setTopFourSlot(i);
                              setShowTopFourPicker(true);
                            }}
                          >
                            {show ? (
                              <>
                                <img src={show.poster} alt={show.name} />
                                <div className="top-four-remove" onClick={(e) => { e.stopPropagation(); handleRemoveFromTopFour(i); }}>×</div>
                              </>
                            ) : (
                              <Icon name="Plus" size={24} />
                            )}
                          </div>
                        );
                      })}
                    </div>
                    <div className="edit-profile-hint">Choose your 4 favorite shows to display on your profile.</div>
                  </div>
                  
                  {/* Pinned Content Section (Pro) */}
                  {(USERS.me.badge === 'pro' || USERS.me.badge === 'patron') && (
                    <>
                      <div className="edit-profile-field" style={{ marginTop: 24 }}>
                        <div className="edit-profile-label" style={{ display: 'flex', alignItems: 'center', gap: 6 }}>
                          Pin Reviews to Profile
                          <span style={{ background: 'var(--brand-orange)', color: '#000', padding: '1px 4px', borderRadius: 3, fontSize: 9, fontWeight: 600 }}>PRO</span>
                        </div>
                        <div style={{ marginTop: 8 }}>
                          {userReviews.length === 0 ? (
                            <p style={{ color: 'var(--text-muted)', fontSize: 13 }}>No reviews to pin yet.</p>
                          ) : (
                            userReviews.slice(0, 3).map(review => (
                              <div 
                                key={review.id}
                                style={{ 
                                  display: 'flex', 
                                  alignItems: 'center', 
                                  gap: 12, 
                                  padding: '10px 12px', 
                                  background: userProfile.pinnedReviews?.includes(review.id) ? 'var(--bg-pill-active)' : 'var(--bg-input)',
                                  borderRadius: 8,
                                  marginBottom: 8,
                                  cursor: 'pointer'
                                }}
                                onClick={() => togglePinnedReview(review.id)}
                              >
                                <img src={review.poster} alt="" style={{ width: 30, height: 45, borderRadius: 3, objectFit: 'cover' }} />
                                <div style={{ flex: 1 }}>
                                  <div style={{ fontSize: 13, fontWeight: 600 }}>{review.showName}</div>
                                  <div style={{ fontSize: 11, color: 'var(--text-tertiary)' }}>{review.date}</div>
                                </div>
                                <div style={{ width: 20, height: 20, borderRadius: 4, border: '2px solid var(--text-muted)', background: userProfile.pinnedReviews?.includes(review.id) ? 'var(--brand-green)' : 'transparent', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                                  {userProfile.pinnedReviews?.includes(review.id) && <Icon name="Check" size={14} />}
                                </div>
                              </div>
                            ))
                          )}
                        </div>
                      </div>
                      
                      <div className="edit-profile-field">
                        <div className="edit-profile-label" style={{ display: 'flex', alignItems: 'center', gap: 6 }}>
                          Pin Lists to Profile
                          <span style={{ background: 'var(--brand-orange)', color: '#000', padding: '1px 4px', borderRadius: 3, fontSize: 9, fontWeight: 600 }}>PRO</span>
                        </div>
                        <div style={{ marginTop: 8 }}>
                          {getMyLists().length === 0 ? (
                            <p style={{ color: 'var(--text-muted)', fontSize: 13 }}>No lists to pin yet.</p>
                          ) : (
                            getMyLists().slice(0, 3).map(list => (
                              <div 
                                key={list.id}
                                style={{ 
                                  display: 'flex', 
                                  alignItems: 'center', 
                                  gap: 12, 
                                  padding: '10px 12px', 
                                  background: userProfile.pinnedLists?.includes(list.id) ? 'var(--bg-pill-active)' : 'var(--bg-input)',
                                  borderRadius: 8,
                                  marginBottom: 8,
                                  cursor: 'pointer'
                                }}
                                onClick={() => togglePinnedList(list.id)}
                              >
                                <div style={{ display: 'flex', gap: 2 }}>
                                  {list.posters.slice(0, 2).map((p, i) => (
                                    <img key={i} src={p} alt="" style={{ width: 22, height: 33, borderRadius: 2, objectFit: 'cover' }} />
                                  ))}
                                </div>
                                <div style={{ flex: 1 }}>
                                  <div style={{ fontSize: 13, fontWeight: 600 }}>{list.title}</div>
                                  <div style={{ fontSize: 11, color: 'var(--text-tertiary)' }}>{list.entries.length} shows</div>
                                </div>
                                <div style={{ width: 20, height: 20, borderRadius: 4, border: '2px solid var(--text-muted)', background: userProfile.pinnedLists?.includes(list.id) ? 'var(--brand-green)' : 'transparent', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                                  {userProfile.pinnedLists?.includes(list.id) && <Icon name="Check" size={14} />}
                                </div>
                              </div>
                            ))
                          )}
                        </div>
                      </div>
                    </>
                  )}
                </div>
              </div>
            </>
          )}
          
          {/* TOP FOUR PICKER MODAL - CAT 3.1 */}
          {showTopFourPicker && (
            <>
              <div className="overlay" style={{ zIndex: 1100 }} onClick={() => { setShowTopFourPicker(false); setTopFourSlot(null); }} />
              <div className="bottom-sheet" style={{ height: '80vh', zIndex: 1200 }}>
                <div className="sheet-header">
                  <button className="sheet-cancel" onClick={() => { setShowTopFourPicker(false); setTopFourSlot(null); }}>Cancel</button>
                  <span className="sheet-title">Choose a Show</span>
                  <span style={{ width: 60 }}></span>
                </div>
                <div style={{ padding: 16, overflowY: 'auto', maxHeight: 'calc(80vh - 60px)' }}>
                  <div className="search-bar" style={{ margin: '0 0 16px 0' }}>
                    <Icon name="Search" size={18} />
                    <input type="text" placeholder="Search shows..." />
                  </div>
                  
                  {/* Show all shows that aren't already in top four */}
                  <div className="poster-grid">
                    {SHOWS.filter(s => !(userProfile.topFour || []).includes(s.id)).map(show => (
                      <div 
                        key={show.id} 
                        className="poster-item"
                        onClick={() => handleAddToTopFour(show.id)}
                      >
                        <img src={show.poster} alt={show.name} className="poster-img" />
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            </>
          )}
          
          {/* CATEGORY 8: SHARE MENU */}
          {showShareMenu && (
            <>
              <div className="overlay" onClick={() => setShowShareMenu(null)} />
              <div className="share-menu">
                <div className="sheet-handle" />
                <div className="share-menu-header">Share Review</div>
                <div className="share-options">
                  <button className="share-option" onClick={() => {
                    const review = REVIEWS.find(r => r.id === showShareMenu);
                    if (review) shareToTwitter(review);
                  }}>
                    <div className="share-option-icon twitter">
                      <Icon name="Twitter" size={24} />
                    </div>
                    <span className="share-option-label">Twitter</span>
                  </button>
                  <button className="share-option" onClick={() => {
                    const review = REVIEWS.find(r => r.id === showShareMenu);
                    const text = `Check out this review of ${review?.showName}!`;
                    window.open(`sms:?body=${encodeURIComponent(text + ' https://rocketwatch.app/review/' + showShareMenu)}`, '_self');
                    setShowShareMenu(null);
                  }}>
                    <div className="share-option-icon" style={{ background: '#34C759', color: '#fff' }}>
                      <Icon name="Comment" size={24} />
                    </div>
                    <span className="share-option-label">Messages</span>
                  </button>
                  <button className="share-option" onClick={() => copyLink(showShareMenu)}>
                    <div className="share-option-icon copy">
                      <Icon name="Copy" size={24} />
                    </div>
                    <span className="share-option-label">Copy Link</span>
                  </button>
                  <button className="share-option" onClick={() => {
                    if (navigator.share) {
                      const review = REVIEWS.find(r => r.id === showShareMenu);
                      navigator.share({
                        title: `Review of ${review?.showName}`,
                        url: `https://rocketwatch.app/review/${showShareMenu}`
                      });
                    }
                    setShowShareMenu(null);
                  }}>
                    <div className="share-option-icon more">
                      <Icon name="Share" size={24} />
                    </div>
                    <span className="share-option-label">More</span>
                  </button>
                </div>
              </div>
            </>
          )}
          
          {/* CATEGORY 8: REPORT MODAL */}
          {showReportModal && (
            <>
              <div className="overlay" onClick={() => { setShowReportModal(null); setReportReason(''); }} />
              <div className="bottom-sheet">
                <div className="sheet-handle" />
                <div className="report-modal">
                  <div className="report-title">
                    Report {showReportModal.type === 'user' ? 'User' : 'Review'}
                  </div>
                  <div className="report-options">
                    {['Spam or misleading', 'Harassment or hate speech', 'Inappropriate content', 'Spoilers without warning', 'Other'].map(reason => (
                      <div 
                        key={reason}
                        className={`report-option ${reportReason === reason ? 'selected' : ''}`}
                        onClick={() => setReportReason(reason)}
                      >
                        <div className="report-option-radio" />
                        <span className="report-option-text">{reason}</span>
                      </div>
                    ))}
                  </div>
                  <button 
                    className="report-submit"
                    disabled={!reportReason}
                    onClick={() => reportContent(showReportModal.type, showReportModal.id)}
                  >
                    Submit Report
                  </button>
                </div>
              </div>
            </>
          )}
          
          {/* CATEGORY 10: OFFLINE BANNER */}
          {isOffline && (
            <div className="offline-banner">
              <Icon name="Activity" size={16} />
              You're offline. Some features may be limited.
            </div>
          )}
          
          {/* CATEGORY 10: CALENDAR VIEW MODAL */}
          {showCalendarView && (
            <>
              <div className="overlay" onClick={() => setShowCalendarView(false)} />
              <div className="bottom-sheet" style={{ height: '85vh' }}>
                <div className="sheet-handle" />
                <div className="sheet-header">
                  <button className="sheet-cancel" onClick={() => setShowCalendarView(false)}>Close</button>
                  <span className="sheet-title">Calendar</span>
                  <span style={{ width: 60 }}></span>
                </div>
                <div className="calendar-container">
                  <div className="calendar-header">
                    <div className="calendar-nav">
                      <button className="calendar-nav-btn" onClick={() => {
                        if (calendarMonth === 0) {
                          setCalendarMonth(11);
                          setCalendarYear(y => y - 1);
                        } else {
                          setCalendarMonth(m => m - 1);
                        }
                      }}>
                        <Icon name="ChevronLeft" size={18} />
                      </button>
                    </div>
                    <span className="calendar-title">{MONTHS[calendarMonth]} {calendarYear}</span>
                    <div className="calendar-nav">
                      <button className="calendar-nav-btn" onClick={() => {
                        if (calendarMonth === 11) {
                          setCalendarMonth(0);
                          setCalendarYear(y => y + 1);
                        } else {
                          setCalendarMonth(m => m + 1);
                        }
                      }}>
                        <Icon name="ChevronRight" size={18} />
                      </button>
                    </div>
                  </div>
                  <div className="calendar-grid">
                    {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(d => (
                      <div key={d} className="calendar-weekday">{d}</div>
                    ))}
                    {getCalendarDays().map((day, i) => (
                      <div 
                        key={i} 
                        className={`calendar-day ${day.otherMonth ? 'other-month' : ''} ${day.isToday ? 'today' : ''} ${day.entries?.length ? 'has-entry' : ''}`}
                      >
                        <span className="calendar-day-num">{day.day}</span>
                        {day.entries?.length > 0 && (
                          <div className="calendar-day-posters">
                            {day.entries.slice(0, 2).map((e, j) => (
                              <img key={j} src={e.poster} alt="" className="calendar-day-poster" />
                            ))}
                          </div>
                        )}
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            </>
          )}
          
          {/* CATEGORY 10: ADVANCED FILTERS MODAL */}
          {showAdvancedFilters && (
            <>
              <div className="overlay" onClick={() => setShowAdvancedFilters(false)} />
              <div className="bottom-sheet" style={{ height: '80vh' }}>
                <div className="sheet-header">
                  <button className="sheet-cancel" onClick={() => setShowAdvancedFilters(false)}>Cancel</button>
                  <span className="sheet-title">Advanced Filters</span>
                  <button className="sheet-save" onClick={() => setShowAdvancedFilters(false)}>Apply</button>
                </div>
                <div className="advanced-filters" style={{ overflowY: 'auto', maxHeight: 'calc(80vh - 60px)', paddingBottom: 'max(24px, env(safe-area-inset-bottom))' }}>
                  <div className="filter-section">
                    <div className="filter-section-title">Genres</div>
                    <div className="filter-chips-wrap">
                      {['Drama', 'Comedy', 'Thriller', 'Sci-Fi', 'Reality', 'Documentary', 'Horror', 'Romance'].map(genre => (
                        <button 
                          key={genre}
                          className={`filter-chip-multi ${advancedFilters.genres.includes(genre) ? 'selected' : ''}`}
                          onClick={() => setAdvancedFilters(f => ({
                            ...f,
                            genres: f.genres.includes(genre) 
                              ? f.genres.filter(g => g !== genre)
                              : [...f.genres, genre]
                          }))}
                        >
                          {genre}
                        </button>
                      ))}
                    </div>
                  </div>
                  
                  <div className="filter-section">
                    <div className="filter-section-title">Year Range</div>
                    <div className="filter-range">
                      <input 
                        type="number" 
                        className="filter-range-input" 
                        value={advancedFilters.yearFrom}
                        onChange={(e) => setAdvancedFilters(f => ({ ...f, yearFrom: parseInt(e.target.value) || 1990 }))}
                        min="1950" 
                        max="2025"
                      />
                      <span className="filter-range-sep">to</span>
                      <input 
                        type="number" 
                        className="filter-range-input" 
                        value={advancedFilters.yearTo}
                        onChange={(e) => setAdvancedFilters(f => ({ ...f, yearTo: parseInt(e.target.value) || 2025 }))}
                        min="1950" 
                        max="2025"
                      />
                    </div>
                  </div>
                  
                  <div className="filter-section">
                    <div className="filter-section-title">Minimum Rating</div>
                    <input 
                      type="range" 
                      className="filter-slider"
                      min="0" 
                      max="5" 
                      step="0.5"
                      value={advancedFilters.ratingMin}
                      onChange={(e) => setAdvancedFilters(f => ({ ...f, ratingMin: parseFloat(e.target.value) }))}
                    />
                    <div className="filter-rating-row">
                      <span className="filter-rating-label">Any</span>
                      <span className="filter-rating-label">{advancedFilters.ratingMin === 0 ? 'Any rating' : `${advancedFilters.ratingMin}+ stars`}</span>
                      <span className="filter-rating-label">5 stars</span>
                    </div>
                  </div>
                  
                  <div className="filter-section">
                    <div className="filter-section-title">Streaming Services</div>
                    <div className="filter-chips-wrap">
                      {SERVICES.map(service => (
                        <button 
                          key={service.name}
                          className={`filter-chip-multi ${advancedFilters.services.includes(service.name) ? 'selected' : ''}`}
                          onClick={() => setAdvancedFilters(f => ({
                            ...f,
                            services: f.services.includes(service.name) 
                              ? f.services.filter(s => s !== service.name)
                              : [...f.services, service.name]
                          }))}
                        >
                          {service.name}
                        </button>
                      ))}
                    </div>
                  </div>
                  
                  <button 
                    className="export-btn secondary"
                    style={{ marginTop: 16 }}
                    onClick={() => setAdvancedFilters({ genres: [], yearFrom: 1990, yearTo: 2025, ratingMin: 0, ratingMax: 5, services: [] })}
                  >
                    Clear All Filters
                  </button>
                </div>
              </div>
            </>
          )}
          
          {/* CATEGORY 10: IMPORT/EXPORT MODAL */}
          {showImportExport && (
            <>
              <div className="overlay" onClick={() => setShowImportExport(false)} />
              <div className="bottom-sheet" style={{ height: '75vh' }}>
                <div className="sheet-header">
                  <button className="sheet-cancel" onClick={() => setShowImportExport(false)}>Close</button>
                  <span className="sheet-title">Import / Export</span>
                  <span style={{ width: 60 }}></span>
                </div>
                <div className="import-export-section">
                  <div className="filter-section-title" style={{ marginBottom: 12 }}>Import</div>
                  
                  <div className="import-card" onClick={() => !isImporting && simulateImport()}>
                    <div className="import-card-icon">📥</div>
                    <div className="import-card-title">Import from Letterboxd</div>
                    <div className="import-card-desc">Upload your Letterboxd export ZIP file</div>
                  </div>
                  
                  <div className="import-card" onClick={() => !isImporting && simulateImport()}>
                    <div className="import-card-icon">📄</div>
                    <div className="import-card-title">Import from CSV</div>
                    <div className="import-card-desc">Import shows from a CSV file</div>
                  </div>
                  
                  {isImporting && (
                    <div className="import-progress">
                      <div className="import-progress-bar">
                        <div className="import-progress-fill" style={{ width: `${importProgress}%` }} />
                      </div>
                      <div className="import-progress-text">Importing... {importProgress}%</div>
                    </div>
                  )}
                  
                  <div className="filter-section-title" style={{ marginTop: 24, marginBottom: 12 }}>Export</div>
                  
                  <button className="export-btn" onClick={exportDiaryCSV}>
                    <Icon name="Download" size={18} />
                    Export Diary (CSV)
                  </button>
                  
                  <button className="export-btn secondary" style={{ marginTop: 12 }} onClick={exportWatchlistCSV}>
                    <Icon name="Download" size={18} />
                    Export Watchlist (CSV)
                  </button>
                  
                  <button className="export-btn secondary" style={{ marginTop: 12 }} onClick={() => {
                    const data = {
                      diary: diaryEntries,
                      watched: watched,
                      watchlist: watchlist,
                      ratings: ratings,
                      reviews: userReviews,
                      lists: lists.filter(l => l.userId === 'me')
                    };
                    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'rocketwatch-backup.json';
                    a.click();
                    URL.revokeObjectURL(url);
                  }}>
                    <Icon name="Download" size={18} />
                    Export Full Backup (JSON)
                  </button>
                </div>
              </div>
            </>
          )}
          
          {/* CATEGORY 10: KEYBOARD SHORTCUTS MODAL */}
          {showShortcuts && (
            <>
              <div className="overlay" onClick={() => setShowShortcuts(false)} />
              <div className="bottom-sheet" style={{ paddingBottom: 'max(20px, env(safe-area-inset-bottom))' }}>
                <div className="sheet-handle" />
                <div className="shortcuts-modal">
                  <div className="shortcuts-title">Keyboard Shortcuts</div>
                  {KEYBOARD_SHORTCUTS.map((shortcut, i) => (
                    <div key={i} className="shortcut-row">
                      <span className="shortcut-desc">{shortcut.desc}</span>
                      <div className="shortcut-keys">
                        {shortcut.keys.map((key, j) => (
                          <React.Fragment key={j}>
                            {j > 0 && <span style={{ color: 'var(--text-muted)', fontSize: 12 }}>or</span>}
                            <span className="shortcut-key">{key}</span>
                          </React.Fragment>
                        ))}
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            </>
          )}
          
          {/* CATEGORY 10: ONBOARDING */}
          {showOnboarding && (
            <div className="onboarding-overlay">
              <div className="onboarding-slide">
                <div className="onboarding-image">{ONBOARDING_SLIDES[onboardingStep].emoji}</div>
                <div className="onboarding-title">{ONBOARDING_SLIDES[onboardingStep].title}</div>
                <div className="onboarding-desc">{ONBOARDING_SLIDES[onboardingStep].desc}</div>
              </div>
              <div className="onboarding-dots">
                {ONBOARDING_SLIDES.map((_, i) => (
                  <div key={i} className={`onboarding-dot ${i === onboardingStep ? 'active' : ''}`} />
                ))}
              </div>
              <div className="onboarding-actions">
                <button 
                  className="onboarding-btn"
                  onClick={() => {
                    if (onboardingStep < ONBOARDING_SLIDES.length - 1) {
                      setOnboardingStep(s => s + 1);
                    } else {
                      setShowOnboarding(false);
                    }
                  }}
                >
                  {onboardingStep < ONBOARDING_SLIDES.length - 1 ? 'Next' : 'Get Started'}
                </button>
                {onboardingStep < ONBOARDING_SLIDES.length - 1 && (
                  <button className="onboarding-skip" onClick={() => setShowOnboarding(false)}>
                    Skip
                  </button>
                )}
              </div>
            </div>
          )}
          
          {/* CATEGORY 10: PRIORITY PICKER MODAL */}
          {showPriorityPicker && (
            <>
              <div className="overlay" onClick={() => setShowPriorityPicker(null)} />
              <div className="bottom-sheet" style={{ paddingBottom: 'max(20px, env(safe-area-inset-bottom))' }}>
                <div className="sheet-handle" />
                <div className="action-sheet-title">Set Priority</div>
                <div className="action-sheet-options">
                  <button 
                    className={`action-sheet-option ${watchlistPriorities[showPriorityPicker] === 'high' ? 'selected' : ''}`}
                    onClick={() => {
                      setWatchlistPriorities(p => ({ ...p, [showPriorityPicker]: 'high' }));
                      setShowPriorityPicker(null);
                    }}
                  >
                    <span style={{ color: '#EF4444' }}>!!!</span> High Priority
                  </button>
                  <button 
                    className={`action-sheet-option ${watchlistPriorities[showPriorityPicker] === 'medium' ? 'selected' : ''}`}
                    onClick={() => {
                      setWatchlistPriorities(p => ({ ...p, [showPriorityPicker]: 'medium' }));
                      setShowPriorityPicker(null);
                    }}
                  >
                    <span style={{ color: '#F59E0B' }}>!!</span> Medium Priority
                  </button>
                  <button 
                    className={`action-sheet-option ${watchlistPriorities[showPriorityPicker] === 'low' ? 'selected' : ''}`}
                    onClick={() => {
                      setWatchlistPriorities(p => ({ ...p, [showPriorityPicker]: 'low' }));
                      setShowPriorityPicker(null);
                    }}
                  >
                    <span style={{ color: '#6B7280' }}>!</span> Low Priority
                  </button>
                  <button 
                    className={`action-sheet-option ${!watchlistPriorities[showPriorityPicker] ? 'selected' : ''}`}
                    onClick={() => {
                      setWatchlistPriorities(p => {
                        const { [showPriorityPicker]: _, ...rest } = p;
                        return rest;
                      });
                      setShowPriorityPicker(null);
                    }}
                  >
                    No Priority
                  </button>
                </div>
                <button 
                  className="action-sheet-cancel"
                  onClick={() => {
                    setWatchlist(p => ({ ...p, [showPriorityPicker]: false }));
                    setWatchlistPriorities(p => {
                      const { [showPriorityPicker]: _, ...rest } = p;
                      return rest;
                    });
                    setShowPriorityPicker(null);
                  }}
                >
                  Remove from Watchlist
                </button>
              </div>
            </>
          )}
          
          {/* CAST & CREW PAGE */}
          {selectedPerson && (
            <div className="person-page">
              <div className="person-header">
                <div className="person-header-bg" />
                <button className="person-back" onClick={() => setSelectedPerson(null)}>
                  <Icon name="ChevronLeft" size={24} />
                </button>
                <div className="person-header-content">
                  {selectedPerson.photo ? (
                    <img 
                      src={selectedPerson.photo} 
                      alt={selectedPerson.name}
                      className="person-photo"
                      onError={(e) => { e.target.style.display = 'none'; e.target.nextSibling.style.display = 'flex'; }}
                    />
                  ) : null}
                  <div className="person-photo-placeholder" style={{ display: selectedPerson.photo ? 'none' : 'flex' }}>
                    {selectedPerson.name?.charAt(0) || '?'}
                  </div>
                  <div className="person-name">{selectedPerson.name}</div>
                  <div className="person-role">{selectedPerson.knownFor}</div>
                  
                  <div className="person-stats">
                    <div className="person-stat">
                      <div className="person-stat-value">{getPersonStats(selectedPerson).films}</div>
                      <div className="person-stat-label">Credits</div>
                    </div>
                    <div className="person-stat">
                      <div className="person-stat-value">{getPersonStats(selectedPerson).watched}</div>
                      <div className="person-stat-label">You've Seen</div>
                    </div>
                    <div className="person-stat">
                      <div className="person-stat-value">{getPersonStats(selectedPerson).avgRating || '—'}</div>
                      <div className="person-stat-label">Your Avg</div>
                    </div>
                  </div>
                  
                  <div className="person-actions">
                    <button 
                      className={`person-follow-btn ${followedPeople.includes(selectedPerson.id) ? 'following' : 'not-following'}`}
                      onClick={() => toggleFollowPerson(selectedPerson.id)}
                    >
                      <Icon name={followedPeople.includes(selectedPerson.id) ? 'Check' : 'Plus'} size={16} />
                      {followedPeople.includes(selectedPerson.id) ? 'Following' : 'Follow'}
                    </button>
                  </div>
                  
                  {(selectedPerson.imdbId || selectedPerson.tmdbId) && (
                    <div className="person-links">
                      {selectedPerson.imdbId && (
                        <a 
                          href={`https://www.imdb.com/name/${selectedPerson.imdbId}`} 
                          target="_blank" 
                          rel="noopener noreferrer"
                          className="person-link imdb"
                        >
                          <span className="person-link-icon">IMDb</span>
                        </a>
                      )}
                      {selectedPerson.tmdbId && (
                        <a 
                          href={`https://www.themoviedb.org/person/${selectedPerson.tmdbId}`} 
                          target="_blank" 
                          rel="noopener noreferrer"
                          className="person-link tmdb"
                        >
                          <span className="person-link-icon">TMDB</span>
                        </a>
                      )}
                    </div>
                  )}
                </div>
              </div>
              
              <div className="person-content">
                {/* Bio */}
                {selectedPerson.bio && (
                  <div style={{ marginBottom: 20 }}>
                    <div className="person-bio">
                      {personBioExpanded ? selectedPerson.bio : selectedPerson.bio.slice(0, 150)}
                      {selectedPerson.bio.length > 150 && !personBioExpanded && '...'}
                    </div>
                    {selectedPerson.bio.length > 150 && (
                      <span className="person-bio-toggle" onClick={() => setPersonBioExpanded(!personBioExpanded)}>
                        {personBioExpanded ? 'Show less' : 'Read more'}
                      </span>
                    )}
                  </div>
                )}
                
                {/* Born */}
                {selectedPerson.birthdate && (
                  <div style={{ fontSize: 13, color: 'var(--text-secondary)', marginBottom: 20 }}>
                    <strong>Born:</strong> {selectedPerson.birthdate}
                    {selectedPerson.birthplace && ` in ${selectedPerson.birthplace}`}
                  </div>
                )}
                
                {/* Known For */}
                {selectedPerson.filmography && selectedPerson.filmography.length > 0 && (
                  <>
                    <div className="person-section-title">Known For</div>
                    <div className="known-for-row">
                      {selectedPerson.filmography.slice(0, 5).map((film, i) => {
                        const show = film.showId ? SHOWS.find(s => s.id === film.showId) : null;
                        const poster = show?.poster || film.poster;
                        const title = show?.name || film.title;
                        
                        return (
                          <div 
                            key={i} 
                            className="known-for-item"
                            onClick={() => {
                              if (show) {
                                setSelectedPerson(null);
                                setShowDetailPage(show);
                              }
                            }}
                          >
                            <img 
                              src={poster} 
                              alt={title}
                              className="known-for-poster"
                              onError={(e) => { e.target.src = 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 150"><rect fill="%232c3440" width="100" height="150"/></svg>'; }}
                            />
                            <div className="known-for-title">{title}</div>
                            {film.role && <div className="known-for-role">as {film.role.split(' ')[0]}</div>}
                          </div>
                        );
                      })}
                    </div>
                  </>
                )}
                
                {/* Filmography */}
                {selectedPerson.filmography && selectedPerson.filmography.length > 0 && (
                  <>
                    <div className="person-section-title">
                      <span>Filmography ({getFilteredFilmography(selectedPerson).length}{personFilter !== 'all' ? ` of ${selectedPerson.filmography.length}` : ''})</span>
                      <select 
                        className="person-sort-select"
                        value={personSort}
                        onChange={(e) => setPersonSort(e.target.value)}
                      >
                        <option value="year">By Year</option>
                        <option value="rating">By Your Rating</option>
                        <option value="title">Alphabetical</option>
                      </select>
                    </div>
                    
                    <div className="person-filter-bar">
                      {['all', 'actor', 'director', 'writer'].map(filter => (
                        <button 
                          key={filter}
                          className={`person-filter-chip ${personFilter === filter ? 'active' : ''}`}
                          onClick={() => setPersonFilter(filter)}
                        >
                          {filter === 'all' ? 'All' : filter.charAt(0).toUpperCase() + filter.slice(1)}
                        </button>
                      ))}
                    </div>
                    
                    <div className="filmography-grid">
                      {getFilteredFilmography(selectedPerson).map((film, i) => {
                        const show = film.showId ? SHOWS.find(s => s.id === film.showId) : null;
                        const poster = show?.poster || film.poster;
                        const title = show?.name || film.title;
                        const isWatched = show && watched[show.id];
                        const userRating = show && ratings[show.id];
                        const isInWatchlist = show && watchlist[show.id];
                        const isLiked = show && liked[show.id];
                        
                        return (
                          <div 
                            key={i} 
                            className={`filmography-item ${!isWatched && show ? 'filmography-unwatched' : ''}`}
                          >
                            <div onClick={() => {
                              if (show) {
                                setSelectedPerson(null);
                                setShowDetailPage(show);
                              }
                            }}>
                              <img 
                                src={poster} 
                                alt={title}
                                className="filmography-poster"
                                onError={(e) => { e.target.src = 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 150"><rect fill="%232c3440" width="100" height="150"/></svg>'; }}
                              />
                            </div>
                            <div className="filmography-year">{film.year}</div>
                            {userRating && (
                              <div className="filmography-rating">
                                <Icon name="Star" size={10} filled />
                                {userRating}
                              </div>
                            )}
                            {film.type !== 'actor' && (
                              <div className="filmography-role">
                                {film.type === 'director' ? 'DIR' : film.type === 'writer' ? 'WRI' : film.type.toUpperCase().slice(0, 3)}
                              </div>
                            )}
                            {show && (
                              <div className="filmography-actions">
                                <button 
                                  className={`filmography-action-btn ${isWatched ? 'active' : ''}`}
                                  onClick={(e) => { e.stopPropagation(); setWatched(p => ({ ...p, [show.id]: !p[show.id] })); }}
                                  title={isWatched ? 'Mark as unwatched' : 'Mark as watched'}
                                >
                                  <Icon name="Eye" size={12} />
                                </button>
                                <button 
                                  className={`filmography-action-btn ${isLiked ? 'liked' : ''}`}
                                  onClick={(e) => { e.stopPropagation(); setLiked(p => ({ ...p, [show.id]: !p[show.id] })); }}
                                  title={isLiked ? 'Unlike' : 'Like'}
                                >
                                  <Icon name="Heart" size={12} filled={isLiked} />
                                </button>
                                <button 
                                  className={`filmography-action-btn ${isInWatchlist ? 'active' : ''}`}
                                  onClick={(e) => { e.stopPropagation(); setWatchlist(p => ({ ...p, [show.id]: !p[show.id] })); }}
                                  title={isInWatchlist ? 'Remove from watchlist' : 'Add to watchlist'}
                                >
                                  <Icon name="Clock" size={12} />
                                </button>
                              </div>
                            )}
                            <div className="filmography-title">{title}</div>
                            {film.role && <div className="filmography-character">{film.role}</div>}
                          </div>
                        );
                      })}
                    </div>
                  </>
                )}
                
                {/* Empty State */}
                {(!selectedPerson.filmography || selectedPerson.filmography.length === 0) && (
                  <EmptyState title="No filmography available" quoteIndex={2} />
                )}
              </div>
            </div>
          )}
        </div>
      );
    }
    
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
